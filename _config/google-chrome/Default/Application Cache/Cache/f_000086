/*! Copyright (c) 2015 WhatsApp Inc.  All Rights Reserved. */
webpackJsonp([0],{355:function(e,t,r){e.exports={"default":r(958),__esModule:!0}},690:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function n(e){window.history.pushState({},"",window.location.href)}function i(){if(!Store.Conn.connected)return!1;var e=r(833),t=Store.Msg.any(function(e){return 0===e.ack&&e.local&&e.isSentByMe}),o=Store.Chat.any(function(e){return!!e.composeText});return t||o||e.hasText}var s=r(3),a=o(s),d=r(6),c=r(30),l=r(1);_.defaults(window.Store,r(929));var u=r(45),p=r(8),h=r(14),m=r(106),f=r(15),g=r(863),v=r(943),y=r(892),E=r(341),T=r(942),b=r(848),S=r(154),C=r(9),M=r(11),N=r(36),w=r(160),P=r(354),R=r(941),k=r(872),x=r(78),I=r(103),D=r(949),O=r(918),A=r(342),L=A.HotKeys,U=A.HotKeyMapMixin,F=window.history&&window.history.pushState&&window.location,G=d.createClass({displayName:"Main",mixins:[S,U({}),I],statics:{hasPending:i},getInitialState:function(){return{drawerActive:!1}},componentWillMount:function(){m.uiActive=!0,m.markAvailable()},componentWillUnmount:function(){D.trigger(R.Event+":"+R.Events.LOGGED_OUT),F&&(window.removeEventListener("popstate",n),window.history.back()),m.uiActive=!1,this.clearIdleMonitor(),this.clearServerPropsQueryLoop()},componentDidMount:function(){if(D.trigger(R.Event+":"+R.Events.LOGGED_IN),F&&(window.history.pushState({},"",window.location.href),window.addEventListener("popstate",n)),this.beginIdleMonitor(!0),this.beginServerPropsQueryLoop(),c.findDOMNode(this).focus(),u.isSafari){var e=f.getNUX(p.NUX.SAFARI_LIMITED_SUPPORT);(!e||e<e.maxViews)&&(this.safeDelay(function(){var e=l10n.t("whatsapp_safari_limited").replace("__chrome_homepage__",p.BROWSER_LINK.CHROME).replace("__firefox_homepage__",p.BROWSER_LINK.FIREFOX).replace("__opera_homepage__",p.BROWSER_LINK.OPERA);C.openModal(d.createElement(E,{onOK:C.closeModal.bind(C),okText:l10n.t("ok_got_it")},d.createElement("div",{dangerouslySetInnerHTML:{__html:e}})))},250),f.setNUX(p.NUX.SAFARI_LIMITED_SUPPORT,{views:1,maxViews:1}))}},beginIdleMonitor:function(e){var t=this;e=e?p.IDLE_TIMEOUT:0,this.idleMonitor=N.loopOnError(M.ShouldLoop,function(){return a["default"].delay(e).then(function(){m.markUnavailable(3e4);var e=[N.waitForEvent(document,"mousemove"),N.waitForEvent(document,"scroll"),N.waitForEvent(document,"keydown"),N.waitForEvent(window,"focus"),N.waitForEvent(window,"blur"),N.waitForEvent(window,"resize")];return a["default"].any(e).timeout(p.IDLE_TIMEOUT_WAIT,"idleMonitorTimeout")["finally"](function(){e.forEach(function(e){e["catch"](a["default"].CancellationError,_.noop),e.cancel()})})}).then(function(){throw m.markAvailable(),e=p.IDLE_TIMEOUT,new M.ShouldLoop})}).cancellable()["catch"](a["default"].CancellationError,_.noop)["catch"](a["default"].TimeoutError,function(){f.getRememberMe()?t.beginIdleMonitor():(l.log("main:beginIdleMonitor logout due to inactivity")(),h.logout())})["finally"](function(){delete t.idleMonitor})},clearIdleMonitor:function(){this.idleMonitor&&this.idleMonitor.cancel()},beginServerPropsQueryLoop:function(){var e=this;this.serverPropsQueryLoop=w.setTimeout(function(){Store.Props.fetch()["catch"](M.WapDrop,_.noop),e.beginServerPropsQueryLoop()},moment().add("1","days").valueOf())},clearServerPropsQueryLoop:function(){w.clearTimeout(this.serverPropsQueryLoop)},handleRightDrawer:function(e){if(this.setState({drawerActive:!!e}),this.refs.chatlist&&this.refs.container&&this.refs.conversation){var t=c.findDOMNode(this.refs.chatlist),r=c.findDOMNode(this.refs.conversation),o=c.findDOMNode(this.refs.container),n=r.clientWidth/(o.clientWidth-t.clientWidth);Velocity(r,{scaleX:[1,n]},{duration:300,easing:[.1,.82,.25,1]})}},onRotateFocus:function(e){var t=1;e&&(e.stopPropagation(),e.preventDefault(),t=e.shiftKey?-1:1,L.flashFocus=Date.now());var r=_.toArray(c.findDOMNode(this).querySelectorAll("[data-tab]"));if(this.refs.drawer.isFlowActive(x.DRAWER_LEFT)){var o=c.findDOMNode(this.refs.chatlist);r=_.reject(r,function(e){return o.contains(e)})}if(this.refs.drawer.isFlowActive(x.DRAWER_MID)){var n=c.findDOMNode(this.refs.conversation);n&&(r=_.reject(r,function(e){return n.contains(e)}))}if(r.length){r=_.sortBy(r,function(e){return parseInt(e.getAttribute("data-tab"),10)||0});var i=0,s=document.activeElement;s&&(i=P.ring(_.findIndex(r,function(e){return e.contains(s)})+t,r));var a=r[i];L.flashFocus=Date.now(),a.restoreFocus?a.restoreFocus():a.focus()}},onBlur:function(e){var t=this;_.delay(function(){if(t.isMounted()){var e=c.findDOMNode(t);document.activeElement===document.body&&e.focus()}},10)},showTOS:function(){switch(Store.Conn.tos){case 1:case 2:C.openModal(d.createElement(O,null));break;case 3:h.logout()}},render:function(){var e=this.state.drawerActive?"app three":"app two";u.isSafari&&(e+=" safari-fix");var t={tab:this.onRotateFocus,"shift+tab":this.onRotateFocus};return t={},d.createElement(L,{handlers:t,ref:"container",className:e,onBlur:this.onBlur},d.createElement(T,null),d.createElement(b,null),d.createElement(v,null),d.createElement(y,{ref:"drawer",onRightDrawer:this.handleRightDrawer}),d.createElement(g,{ref:"chatlist"}),d.createElement(k,{ref:"conversation"}))}});e.exports=G},770:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(1),a=r(11),d=r(9),c=r(36),l={getInitialState:function(){return this._asyncs={},{}},async:function(e,t,r){var o=this,n=e.split(".");t=t||this.props;var l=this._getAsyncIndex(n),u=t[n[0]],p=l>1?u.getp(n.slice(1,l).join(".")):u;if(!p)throw new Error("async base did not resolve to a value");var h,m,f=_.isString(p)?p:p.getp("id"),g=this._getKeyPath(n);if(l>0?(h=Store[n[l]],m=h.get(f)):(m=p,h=m.getCollection()),!m)return s.error("asyncMixin:async Non-existing state in AsyncMixin! baseId: "+f+", key: "+e)();if(h.isStateStale(f))if(d.uiBusy){var v=this._waAsyncWaits||(this._waAsyncWaits=[]),y=c.waitForBBEvent(d,"ui_idle").then(function(){return h.find(f)})["finally"](function(){o._waAsyncWaits=_.without(o._waAsyncWaits,y)})["catch"](a.WapDrop,_.noop)["catch"](i["default"].CancellationError,_.noop);v.push(y)}else h.find(f)["catch"](a.WapDrop,_.noop);return this._addObserver(m,e,p),m.getp(g)},componentWillReceiveProps:function(e){var t=this._asyncs;for(var r in e){var o=t[r];if(o)for(var n in o){var i=o[n];if(i.base!==e[r]){var s=n.split("."),a=this._getObserverKeyPath(s),d=this._getStateKey(s),c=i.object,l=i.callback,u=i.context;c.off("change:"+a,l,u),c.isState&&c._uiObservers--;var p={};p[d]=this.async(n,e),this.setState(p)}}}},componentWillUnmount:function(){this._waAsyncUnmount=!0;var e=this._waAsyncWaits;if(e)for(;e.length;)e.shift().cancel();var t=this._asyncs;for(var r in t)for(var o in t[r]){var n=this._getObserverKeyPath(o.split(".")),i=t[r][o].object,s=t[r][o].callback,a=t[r][o].context;i.off("change:"+n,s,a),i.isState&&i._uiObservers--}},_addObserver:function(e,t,r){var o=t.split("."),n=this._getKeyPath(o),i=this._getObserverKeyPath(o),s=this._asyncs,a=function(){if(this.isMounted()){var t={};t[this._getStateKey(o)]=e.getp(n),this.setState(t)}};s[o[0]]=s[o[0]]||{},s[o[0]][t]={object:e,base:r,callback:a,context:this},e.on("change:"+i,a,this),e.isState&&e._uiObservers++},_getStateKey:function(e){return e[e.length-1]},_getKeyPath:function(e){for(var t=e.length,r=0;r<e.length;r++)if(0===e.indexOf("@")){t=r;break}var o=this._getAsyncIndex(e);return e.slice(o+1,t).join(".")},_getObserverKeyPath:function(e){var t=this._getAsyncIndex(e);return e.slice(t+1).join(".")},_getAsyncIndex:function(e){for(var t=0,r=1;r<e.length;r++)if(e[r].charAt(0).toLowerCase()!==e[r].charAt(0)){t=r;break}return t}};e.exports=l},771:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){return e===t||e+"?x=2"===t||e===t+"?x=2"}var i=r(3),s=o(i),a=r(8),d=r(1),c=r(59),l=r(156),u=r(35),p=r(11),h=r(945),m=r(107),f=r(21),g=r(847),v=r(782),y=r(801),E=r(41),T=r(843),b=r(14),S=r(80),C=r(60),M=r(944),N=r(153),w=r(106),P={NOTIFICATION:"notification",GROUP_NOTIFICATION:"group_notification",GP2:"gp2",BROADCAST_NOTIFICATION:"broadcast_notification",CHAT:"chat",IMAGE:"image",VIDEO:"video",LOCATION:"location",AUDIO:"audio",PTT:"ptt",VCARD:"vcard",DOCUMENT:"document"},R={INIT:"init",REFRESHING:"refreshing",REFRESH_RETRY:"refresh_retry",URL:"url",STATUS_200:"status_200",STATUS_ERR:"status_err",NO_URL:"no_url",RMR_FETCHING:"rmr_fetching",RMR_ERROR_MISSING:"rmr_error_missing",RMR_ERROR_RETRY:"rmr_error_retry",UPLOADING:"uploading"},k={UPLOADING:"uploading",RETRY:"retry",PHONE_UPLOADING:"phone_uploading"},x=c.extend(T,{Collection:"Msg",props:{id:"msgKey",body:"string",type:{type:"string",values:_.values(P)},subtype:"string",t:"number",notifyName:"string",from:"string",to:"string",author:"string",self:{type:["string"],values:["in","out"],"default":"in"},ack:"number",invis:"boolean",isNew:"boolean",star:"boolean",recvFresh:"boolean",clientUrl:"string",url:"string",caption:"string",mimetype:"string",duration:"string",filehash:"string",size:"number",loc:"string",lat:"string",lng:"string",height:"number",width:"number",title:"string",description:"string",canonicalUrl:"string",matchedText:"string",thumbnail:"string",recipients:"array",broadcast:"boolean",avparams:"object",mediaKey:"string",pageCount:"number"},session:{fullHeight:"number",fullWidth:"number",decryptedMediaBlob:"object",decryptedMediaURL:"string",decryptMediaPromise:"object",urlState:{type:"string",values:_.values(R),"default":R.INIT},isContinuation:"boolean",local:"boolean",urlRetry:{type:"number","default":0},uploadPromise:"object",reupload:"any",resendPromise:"object",ajaxHeadPromise:"object",rmrPromise:"object",rtl:"boolean",dir:"string",search:"boolean",msgChunk:"object",refKey:"string",startOfDay:"number",startOfDaySkew:"number"},children:{senderObj:l},initialize:function(){this.sender&&(this.senderObj=Store.Contact.gadd({id:this.sender}),this.listenTo(this.senderObj,"all",this._getEventBubblingHandler("senderObj"))),this.isMMS&&this.listenTo(this,"change:needsRefresh change:isObserved",function(){this.isObserved&&this.needsRefresh&&this.initializeMedia()}),this.type===P.CHAT&&(this.dir=M.dir(this.body),this.rtl="rtl"===this.dir);var e;(e=Store.Msg.preAck[this.id])&&(d.log("Msg:initialize updating msg with out of order ack",e)(),this.updateAck(e.ack),delete Store.Msg.preAck[this.id])},derived:{chat:{fn:function(){return Store.Chat.get(this.id.remote)}},isGroupMsg:{fn:function(){return f.isGroup(this.from)||f.isGroup(this.to)}},isSentByMe:{fn:function(){var e=this.id;return"in"===e.self||this.isNotification?!1:this.from===Store.Conn.me}},isNotification:{fn:function(){switch(this.type){case P.GROUP_NOTIFICATION:case P.GP2:case P.BROADCAST_NOTIFICATION:case P.NOTIFICATION:return!0;default:return!1}}},isMedia:{fn:function(){return["image","video","audio"].indexOf(this.type)>-1}},isMMS:{fn:function(){return["image","video","audio","ptt"].indexOf(this.type)>-1}},mmsSrc:{deps:["url"],fn:function(){return E.isHttp(this.url)?this.url+"?x=2":this.url}},hasSymbol:{fn:function(){return["image","video","audio","ptt","location","vcard"].indexOf(this.type)>-1}},uploadState:{deps:["ack","uploadPromise"],fn:function(){return this.isSentByMe&&0===this.ack?this.local?this.uploadPromise?k.UPLOADING:k.RETRY:k.PHONE_UPLOADING:!1}},eventType:{deps:["invis"],fn:function(){var e,t,r=this.type,o=this.subtype;return this.isNew?("gp2"===r||"group_notification"===r?"subject"===o?e="n":"add"===o?(t=_.first(this.recipients),e=t===Store.Conn.me?"s":"i"):"remove"===o?(t=_.first(this.recipients),e=t===Store.Conn.me?"n":"i"):e="create"===o?"n":"i":e="broadcast_notification"===r||"notification"===r?"create"===o?"n":"i":this.broadcast?"i":"d",this.invis?"i"===e?"i":"n":e):"i"}},sender:{fn:function(){return this.isSentByMe?this.from:this.isGroupMsg?this.author:this.from}},needsRefresh:{deps:["clientUrl","urlState"],fn:function(){return this.clientUrl&&_.contains([R.INIT,R.REFRESH_RETRY],this.urlState)}},containsEmoji:{fn:function(){switch(this.type){case P.CHAT:return this.body&&v.containsEmoji(this.body);case P.IMAGE:return this.caption&&v.containsEmoji(this.caption);default:return!1}}},mayFail:{deps:["isSentByMe","ack"],fn:function(){return this.isSentByMe&&this.ack<=1}},isFailed:{deps:["ack"],fn:function(){return this.ack<0}},vcardWAid:{deps:["type","body"],fn:function(){if(this.type===P.VCARD){var e=this.body.match(/TEL[^\n]*;waid=(\d+):/);return e?e[1]+"@c.us":void 0}}},canForward:{deps:["ack","isMMS","isSentByMe"],fn:function(){return this.ack<1&&this.isMMS&&this.isSentByMe}}},isTrusted:function(){return this.sender===Store.Conn.me?!0:this.senderObj&&this.senderObj.isMyContact?!0:this.isGroupMsg?this.chat.groupMetadata.trusted:!1},initializeMedia:function(){this.needsRefresh&&Store.Msg.refreshMediaUrl(this)},decryptMedia:function(e,t){var r=this;return this.decryptedMediaURL?s["default"].resolve(this.decryptedMediaURL):this.decryptMediaPromise?this.decryptMediaPromise:this.decryptMediaPromise=m.get(e,m.RESP_TYPE.ARRAY_BUFFER).then(function(o){if(200===o.status){var n=h.decryptE2EImage(o.response,t);h.ackE2EImage(r.refKey,e);var i=URL.createObjectURL(n);return r.set({decryptedMediaBlob:n,decryptedMediaURL:i}),i}throw new p.ImageError("Image preload error: "+o.status,e)})["finally"](function(){r.unset("decryptMediaPromise")})["catch"](p.MediaEncryptionError,function(t){throw d.error("models:msg:decryptMedia: "+t)(),new p.ImageError("encryption error",e)})["catch"](function(t){throw d.error("models:msg:decryptMedia: "+t)(),new p.ImageError("conv:message:pic:preloadImage encryption XHR Error",e)})},"delete":function(){this.decryptedMediaURL&&(URL.revokeObjectURL(this.decryptedMediaURL),this.unset("decryptedMediaBlob"),this.unset("decryptedMediaURL")),c.prototype["delete"].call(this),Store.Msg.remove(this.id),this.msgChunk.remove(this.id)},displayName:function(e,t){if(!this.sender)return"";if(this.sender===Store.Conn.me)return l10n.t("web_you");var r=this.senderObj,o=e?r.shortName:void 0;if(o)return o;if(r.name)return r.name;var n=t&&this.notifyName?" ~"+this.notifyName:"";return l10n.isRTL()?l10n.embedLTR(f.formattedUser(this.sender))+n:f.formattedUser(this.sender)+n},updateAck:function(e){var t=this.ack;_.isNumber(e)&&("undefined"==typeof t||e>t)?this.ack=e:-1===e&&0===this.ack&&(this.ack=e)},reuploadMedia:function(){var e=this;return this.reupload?this.uploadPromise?this.uploadPromise:(this.urlState=R.UPLOADING,this.uploadPromise=this.reupload().cancellable().then(function(t){return e.clientUrl=t.url,e.sendMediaMsg(t)}).then(function(){e.set({urlState:e.url?R.STATUS_200:R.INIT,reupload:null})})["finally"](function(){e.unset("uploadPromise")})["catch"](s["default"].CancellationError,_.noop)):s["default"].resolve()},sendMediaMsg:function(e){return this.set({avparams:e,filehash:e.filehash,size:parseInt(e.size,10)}),Store.Msg.send(this).then(function(t){return{result:t,avparams:e}})},sendPlayed:function(){if("ptt"===this.type&&!(this.isSentByMe||this.ack>=a.ACK_PLAYED)){var e=this;u.sendMessagePlayed(this.id).then(function(t){e.ack=a.ACK_PLAYED})["catch"](p.WapDrop,_.noop)}},urlState200:function(e){n(this.url,e)||E.isBlob(e)?(this.urlState=R.STATUS_200,E.isBlob(e)&&(this.url=e)):d.log("Msg:status_200 set for wrong url?")()},mediaLoadError:function(e){if(!n(this.url,e))return s["default"].resolve();if(w.info===w.INFO.OFFLINE)return s["default"].resolve();if(this.urlRetry>3)return s["default"].resolve();this.urlRetry++,this.ajaxHeadPromise&&this.ajaxHeadPromise.cancel();var t,r;return r=this.ajaxHeadPromise=m.head(e).bind(this).timeout(3e4,"mediaLoadErrorTimeout").cancellable().tap(function(){t=r.cancel.bind(r),this.listenToOnce(this,"change:url",t)}).then(function(t){if(404===t.status)return this.requestMediaReupload();if(t.status>=200&&t.status<400){if("application/octet-stream"===t.getResponseHeader("content-type"))return this.requestMediaReupload();this.urlState200(e)}})["finally"](function(){this.stopListening(this,"change:url",t),r===this.ajaxHeadPromise&&this.unset("ajaxHeadPromise")})["catch"](s["default"].CancellationError,_.noop)["catch"](s["default"].TimeoutError,_.noop)["catch"](_.noop)},requestMediaReupload:function(){return this.set({url:null,urlState:R.RMR_FETCHING}),this.rmrPromise?this.rmrPromise:this.rmrPromise=u.requestMediaReupload(this).bind(this).then(function(e){200===e.status?this.set({clientUrl:e.url,urlState:R.INIT,mediaKey:e.mediaKey,refKey:e.refKey}):404===e.status?this.urlState=R.RMR_ERROR_MISSING:e.status>=400&&(this.urlState=R.RMR_ERROR_RETRY)})["finally"](function(){this.unset("rmrPromise")})["catch"](function(e){throw this.urlState=R.RMR_ERROR_RETRY,e})},forward:function(e){var t=this,r=e.id;if(f.isUser(r)){var o=Store.Contact.get(r);if(o.isBlocked())return s["default"].reject(new p.ContactBlocked("Forwarded to contact is blocked",o))}var n=this.type;if(n===P.IMAGE&&E.isEncryptedMedia(this.clientUrl))return this.decryptMedia().then(function(){e.sendMedia([{file:t.decryptedMediaBlob,type:n}])});var i,a=this.toJSON();switch(_.extend(a,{id:new C(Store.Conn.me,r,b.tag(),void 0,"out"),t:N.globalUnixTime(),from:Store.Conn.me,to:r,self:"out",origin:null,caption:void 0,local:!0,isNew:!0,ack:0}),n){case P.CHAT:i=new x(a);var d=Store.Msg.send(i);return e.msgs.add(i),d;case P.DOCUMENT:case P.VIDEO:case P.IMAGE:case P.AUDIO:case P.PTT:var c,l=a.filehash,u=a.size,h=a.url;return l&&u||h?(i=new x(a),i.type===P.PTT&&(i.type=P.AUDIO),i.urlState=R.UPLOADING,this.urlState!==R.STATUS_200&&i.unset("url"),c=e.msgs.add(i),l&&u?c.reupload=this.forwardMedia(c):c.reupload=this.ensureHashSize(c),c.reuploadMedia()):s["default"].reject(new p.MediaMissing);case P.LOCATION:return e.sendLocation(a.lat,a.lng,a.loc,a.clientUrl);case P.VCARD:return e.sendContact(a.body,a.subtype)}},forwardMedia:function(e){var t=this;return function(){return u.requestMediaUpload(e.type,e.filehash,e.size).then(function(r){var o=r.result;return"duplicate"===o?r.data:t.requestMediaReupload().then(function(){switch(t.urlState){case R.RMR_ERROR_MISSING:case R.RMR_ERROR_RETRY:throw new p.MediaMissing}var r=t.clientUrl;if(r)return{filehash:e.filehash,size:e.size,type:e.type,url:r};throw new p.MediaMissing})})}},ensureHashSize:function(e){var t=E.build(this.url,{random:Date.now()}),r=this;return function(){return g.getRetry(t,m.RESP_TYPE.BLOB).then(function(t){return 404===t.status?r.requestMediaReupload().then(function(){var t=r.ensureHashSize(e);return t()}):y.getHash("video",null,t.response).then(function(t){e.filehash=r.filehash=t.hash,e.size=r.size=t.size;var o=r.forwardMedia(e);return e.reupload=o,o()})})}},avParams:function(){return this.avparams?this.avparams:{url:this.clientUrl,type:this.type,filehash:this.filehash,duration:this.duration,width:this.fullWidth,height:this.fullHeight}},resend:function(){return this.isMMS&&!S.supportsFeature(S.F.MEDIA_RETRY)?s["default"].reject():this.resendPromise?this.resendPromise:(this.urlState=R.UPLOADING,this.resendPromise=Store.Msg.send(this).bind(this).then(function(e){"success"===e?this.urlState=R.INIT:this.urlState=R.NO_URL})["finally"](function(){this.unset("resendPromise")})["catch"](function(){this.urlState=R.NO_URL}))},getMessageInfo:function(){return Store.MsgInfo.find(this)}});x.TYPE=P,x.URL_STATE=R,x.UPLOAD_STATE=k,e.exports=x},772:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function n(e,t,r,o,i,s){if(r>o)return-1;var a,d=Math.round((r+o)/2),c=e[d],l=c.offsetLeft-i;if(l>=t)a=s;else{if(l+c.clientWidth>t)return d;a=!s}return a?n(e,t,r,d-1,i,s):n(e,t,d+1,o,i,s)}function i(e,t){for(var r=0,o=e.childNodes,n=0;n<o.length;n++){var i=o[n];if(i===t)break;r+=i.clientWidth}return r}var s=r(3),a=o(s),d=r(6),c=r(30),l=r(782),u=r(45),p=r(104),h=r(79),m=r(154),f=r(9),g=r(36),v=r(954),y=r(77),E=r(687),T=4096,b={SMALL:"small",LARGE:"large"},S=d.createClass({displayName:"EmojiText",mixins:[h,p,m,E],statics:{EMOJI_SIZE:b},propTypes:{text:d.PropTypes.string,emojiSize:d.PropTypes.oneOf(_.values(b)),element:d.PropTypes.any,classes:d.PropTypes.string,direction:d.PropTypes.string,linkify:d.PropTypes.bool,titlify:d.PropTypes.bool,ellipsify:d.PropTypes.bool,selectable:d.PropTypes.bool,wbr:d.PropTypes.number,dirMismatch:d.PropTypes.bool},getInitialState:function(){return this.debouncedRecompute=this.safeDebounce(this.recompute,20),this.reged=!1,{ellipsified:null}},getDefaultProps:function(){return{emojiSize:b.SMALL,element:"span"}},componentWillMount:function(){u.isWebkit&&this.props.ellipsify&&this.containsEmoji()&&this.regResizeListener()},componentWillReceiveProps:function(e){if(u.isWebkit&&this.props.ellipsify&&e.text!==this.props.text){var t=(e.text||"").substring(0,T);l.containsEmoji(t)?(this.setState({ellipsified:null},this.ellipsify),this.containsEmoji()||this.regResizeListener()):(this.setState({ellipsified:null}),this.containsEmoji()&&this.unregResizeListener())}},containsEmoji:function(){var e=(this.props.text||"").substring(0,T);return l.containsEmoji(e)},regResizeListener:function(){this.reged||(this.regNativeListener(window,"resize",this.debouncedRecompute),this.regCmd("resize",this.debouncedRecompute),this.reged=!0)},unregResizeListener:function(){this.reged&&(this.unregNativeListener(window,"resize",this.debouncedRecompute),this.unregCmd("resize",this.debouncedRecompute),this.reged=!1)},recompute:function(){this.setState({ellipsified:null},this.ellipsify)},ellipsifyCheck:function(){this.isMounted()&&this.containsEmoji()&&this.ellipsify()},componentDidMount:function(){u.isWebkit&&this.props.ellipsify&&(f.uiBusy?g.waitForBBEvent(f,"ui_idle").then(this.ellipsifyCheck)["catch"](a["default"].CancellationError,_.noop):this.ellipsifyCheck())},ellipsify:function(){var e=c.findDOMNode(this);if(e){var t=e.querySelectorAll("img");if(0!==t.length){var r,o=!l10n.isRTL(),s=0;if(r=e.clientWidth){if(r===e.scrollWidth)return;s=0}else{var a=e.parentNode;if(s=i(a,e),r=a.clientWidth-s,a.clientWidth===a.scrollWidth)return}var d=n(t,o?r:0,0,t.length-1,o?s:0,o);if(!(0>d)){var l=t[d],u=10;u-=Math.floor(u/4);var p=n(t,o?r-u:u,0,d,o?s:0,o);p>-1&&(l=t[p]);for(var h=e.childNodes,m=[],f=0;f<h.length;f++){var g=h[f];if(g===l)break;3===g.nodeType?m.push(g.textContent||""):m.push(g.alt||"")}if(m.length){var v=m.length-1;m[v]=m[v].trimRight()}this.setState({ellipsified:m.join("")})}}}},render:function(){if(!this.props.text)return null;var e=this.state.ellipsified;e||(e=this.props.ellipsify?(this.props.text||"").substring(0,T):this.props.text);var t,r=this.props.wbr,o=this.props.selectable?"selectable-text":void 0;this.props.linkify?t=v.linkify(e,!0,r,o):(e=r&&e.length>r?v.wbr(e,r):e,t=l.emojiToHTML(_.escape(e),o,this.props.emojiSize)),this.state.ellipsified&&(t+="&hellip;");var n=y(this.props.classes,{emojitext:!this.props.classes,ellipsify:this.props.ellipsify,"inverse-text-direction":this.props.dirMismatch,"selectable-text":this.props.selectable}),i=this.props.element;return this.props.titlify?d.createElement(i,{className:n,dir:this.props.direction,title:this.props.text,dangerouslySetInnerHTML:{__html:t}}):d.createElement(i,{className:n,dir:this.props.direction,dangerouslySetInnerHTML:{__html:t}})}});e.exports=S},773:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function n(e,t,r,o){var n=new FormData;return n.append("from",A.user(Store.Conn.me)),n.append("to",A.user(r)),n.append("file",t,o),i(e,r,n)}function i(e,t,r){return I.loopOnError(P.ShouldLoop,function(t){if(t>4)throw new P.GaveUpRetry("gave up mms upload after "+t+" tries");var o;if(S.state===S.STATE.CONNECTED){var n=Math.floor(1e3*F.expBackoff(t,60,void 0,.1));o=c["default"].delay(n).then(function(){return S.state===S.STATE.CONNECTED?void 0:I.waitForBBEvent(S,"change:state",_.matches({state:S.STATE.CONNECTED}))})}else o=I.waitForBBEvent(S,"change:state",_.matches({state:S.STATE.CONNECTED}));var i=3e5*(1+t);return o.then(function(){return x.post(e+"?f=j",r).timeout(i,"postMediaToMMSTimeout").then(function(e){if(200===e.status)return p.log("http upload success:"+e.status)(),JSON.parse(e.response);throw p.log("http upload error response: "+e.status)(),new P.ShouldLoop})["catch"](c["default"].CancellationError,_.noop)["catch"](c["default"].TimeoutError,function(e){throw new P.ShouldLoop})["catch"](function(e){return e instanceof window.XMLHttpRequestProgressEvent},function(e){throw p.log("http upload error: "+e)(),new P.ShouldLoop})})})}var s=r(956),a=o(s),d=r(3),c=o(d),l=r(6),u=r(8),p=r(1),h=r(59),m=r(800),f=r(771),g=r(156),v=r(844),y=r(811),E=r(924),T=r(80),b=r(9),S=r(14),C=r(106),M=r(35),N=r(15),w=r(153),P=r(11),R=r(60),k=r(803),x=r(107),I=r(36),D=r(41),O=r(801),A=r(21),L=r(350),U=r(950),F=r(81),G=r(159),B={GROUP:"group",BROADCAST:"broadcast",CHAT:"chat"},j=h.extend({Collection:"Chat",props:{id:"string",t:"number",unreadCount:{type:"number","default":0},archive:"boolean",isReadOnly:"boolean",modifyTag:"number",muteExpiration:{type:"number","default":0},name:"string",notSpam:"boolean"},session:{viewed:"boolean",createdLocally:"boolean",pendingAction:"number",formattedTitle:"string",active:"boolean",isLoadingMsgs:"boolean",noEarlierMsgs:"boolean",pausedTimerId:"number",presenceResendTimerId:"number",recording:"boolean",typing:"boolean",unreadDivider:"object",colors:"object",composeText:"string",composeSel:"object",squelch:"number",pendingSeenCount:{type:"number","default":0},markedUnread:"boolean",msgChunks:{type:"array","default":function(){return[]}}},collections:{msgs:E},children:{presence:m,contact:g,mute:v,groupMetadata:y},initialize:function(){if(this.presence=Store.Presence.gadd(this.id),this.listenTo(this.presence,"all",this._getEventBubblingHandler("presence")),this.mute=Store.Mute.add({id:this.id,expiration:this.muteExpiration},{merge:!0}),this.listenTo(this.mute,"all",this._getEventBubblingHandler("mute")),this.contact=Store.Contact.gadd(this.id),this.name&&!this.contact.name&&(this.contact.name=this.name),this.listenTo(this.contact,"all",this._getEventBubblingHandler("contact")),this.listenTo(this.contact,"change:formattedName",this.updateTitle),this.isGroup||this.isBroadcast){var e;this.isBroadcast&&!Store.GroupMetadata.get(this.id)&&(e=!0),this.groupMetadata=Store.GroupMetadata.gadd({id:this.id}),this.listenTo(this.groupMetadata,"all",this._getEventBubblingHandler("groupMetadata")),this.listenTo(this.groupMetadata,"change:stale",this.updateReadOnly),this.listenTo(this.groupMetadata.participants,"add remove reset",this.updateReadOnly),this.listenTo(this.groupMetadata.participants,"change:contact.formattedShortName",this.updateTitle),this.updateReadOnly();var t=this.id;this.listenTo(this,"change:isReadOnly",function(){Store.ProfilePicThumb.update(t)["catch"](P.WapDrop,_.noop),Store.GroupMetadata.update(t)["catch"](P.WapDrop,_.noop)}),e&&Store.GroupMetadata.update(t)["catch"](P.WapDrop,_.noop)}else this.listenTo(this.presence,"change:isOnline",this._presenceOnlineChanged);this.updateTitle(),this.listenTo(this.msgs,"add",this.onNewMsg),this._saveAssignedColors=_.debounce(this.saveAssignedColors,1e3),this.listenTo(this,"change:active",this.onActiveUpdate),this.pendingAction=0,this.listenTo(this,"change:pendingAction",this.onPendingActionUpdate)},derived:{kind:function(){return this.isGroup?B.GROUP:this.isBroadcast?B.BROADCAST:this.isUser?B.CHAT:void 0},isGroup:{fn:function(){return A.isGroup(this.id)}},isBroadcast:{fn:function(){return A.isBroadcast(this.id)}},isUser:{fn:function(){return A.isUser(this.id)}},hasUnread:{deps:["unreadCount"],fn:function(){return 0!==this.unreadCount}}},onActiveUpdate:function(){this.isGroup&&this.active&&(this.squelch=-1),this.presence.chatActive=this.active},onPendingActionUpdate:function(){this.pendingAction<0&&(p.log("chat:onPendingActionUpdate pendingAction value is invalid")(),this.pendingAction=0)},updateTitle:function(){this.isBroadcast?this.formattedTitle=this.contact.name||this.groupMetadata.participants.map(function(e){return e.contact.formattedShortName}).join(", "):this.isUser?this.formattedTitle=this.contact.name||A.formattedUser(this.id):this.isGroup&&(this.formattedTitle=this.contact.name)},sendExit:function(){if(!this.isGroup)return c["default"].reject(new P.ActionError);var e=M.leaveGroup(this.id),t=l10n.t("action_group_exiting"),r=e.then(function(e){return 200===e.status?l10n.t("action_group_exited"):e.status>=400?l10n.t("action_group_exit_failed"):void 0})["catch"](function(e){return p.error("models:chat:sendExit dropped")(e),l10n.t("action_group_exit_failed")});return b.openToast(l.createElement(G,{id:G.genId(),pendingText:t,actionText:r,retry:this.sendExit.bind(this)})),e.bind(this).then(function(e){200!==e.status||e._duplicate||this.exit()})},canExit:function(){return T.supportsFeature(T.F.GROUP_EXIT)},exit:function(){this.isGroup&&(this.groupMetadata.participants.remove(Store.Conn.me),this.isReadOnly=!0)},sendDelete:function(){var e,t=this.msgs.last(),r=t?t.id:void 0,o=M.sendConversationDelete(this.id,r),n=this.kind;switch(n){case B.GROUP:e=l10n.t("action_group_deleting");break;case B.BROADCAST:e=l10n.t("action_broadcast_deleting");break;case B.CHAT:e=l10n.t("action_chat_deleting")}var i=o.bind(this).then(function(e){if(200===e.status)switch(n){case B.GROUP:return l10n.t("action_group_deleted");case B.BROADCAST:return l10n.t("action_broadcast_deleted");case B.CHAT:return l10n.t("action_chat_deleted")}else if(e.status>=400)switch(n){case B.GROUP:return l10n.t("action_group_delete_failed");case B.BROADCAST:return l10n.t("action_broadcast_delete_failed");case B.CHAT:return l10n.t("action_chat_delete_failed")}})["catch"](function(e){switch(p.error("models:chat:sendDelete dropped")(e),n){case B.GROUP:return l10n.t("action_group_delete_failed");case B.BROADCAST:return l10n.t("action_broadcast_delete_failed");case B.CHAT:return l10n.t("action_chat_delete_failed")}});return b.openToast(l.createElement(G,{id:G.genId(),pendingText:e,actionText:i,retry:this.sendDelete.bind(this)})),o.bind(this).then(function(e){if(200===e.status&&!e._duplicate){var r=this.msgs.last();t===r?this["delete"](!0):this.deleteMsgsBeforeMsgInclusive(t)}})},canDelete:function(){return T.supportsFeature(T.F.DELETE)},sendClear:function(){var e=this.msgs.last(),t=e?e.id:void 0;M.sendConversationClear(this.id,t)},"delete":function(e){this.cancelPendingPromises(),h.prototype["delete"].call(this),this.groupMetadata["delete"](),this.presence["delete"](),Store.Mute.remove(this.id),this.mute["delete"](),this.deleteMsgs(),Store.Chat.remove(this.id),b.clearChat(this)},isDirty:function(){return 0!==this.unreadCount},isNewlyCreated:function(){return!!this.createdLocally&&0===this.msgs.length},isVisible:function(){return this.viewed||!this.isNewlyCreated()},onNewMsg:function(e){if(e&&"i"!==e.eventType)if(this.t=e.t,this.archive&&(this.archive=!1),e.isSentByMe||this.presence.handle({id:this.id,participant:e.author,type:"available"}),e.isSentByMe)this.unreadCount=0;else if("d"===e.eventType)this.unreadCount=this.unreadCount+1||1,b.alertNewMsg(e),this.msgs.length<u.MSG_PRELOAD_THRESHOLD&&this.loadEarlierMsgs();else if("s"===e.eventType){if("gp2"===e.type&&"add"===e.subtype&&_.first(e.recipients)===Store.Conn.me&&!this.contact.name)return;b.alertNewMsg(e)}},setArchive:function(e){if(this.archive===e)return c["default"].reject(new P.ActionError);var t=this.msgs.last(),r=t?t.id:void 0,o=M.sendConversationArchive(this.id,e,r),n=e?l10n.t("action_chat_archiving"):l10n.t("action_chat_unarchiving"),i=o.then(function(t){return 200===t.status?e?l10n.t("action_chat_archived"):l10n.t("action_chat_unarchived"):t.status>=400?e?l10n.t("action_chat_archive_failed"):l10n.t("action_chat_unarchive_failed"):void 0})["catch"](function(t){return p.error("models:chat:setArchive dropped")(t),e?l10n.t("action_chat_archive_failed"):l10n.t("action_chat_unarchive_failed")});return b.openToast(l.createElement(G,{id:G.genId(),pendingText:n,actionText:i,retry:this.setArchive.bind(this,e)})),o.bind(this).then(function(t){200!==t.status||t._duplicate||(this.archive=e)})},canArchive:function(){return this.isBroadcast?T.supportsFeature(T.F.ARCHIVE_BROADCAST):T.supportsFeature(T.F.ARCHIVE)},sendSeen:function(){if(this.markedUnread||0===this.unreadCount)return c["default"].resolve();
if(!C.available)return this.listenTo(C,"change:available",this.sendSeen),c["default"].resolve();this.stopListening(C,"change:available",this.sendSeen);for(var e,t=this.msgs.length-1;t>=0;t--){var r=this.msgs.at(t);if(r&&(!r.isSentByMe||!r.local||r.ack>0)){e=r;break}}var o=this.unreadCount-this.pendingSeenCount;if(0===o)return c["default"].resolve();this.pendingSeenCount=this.unreadCount;var n=this,i=function(){n.pendingSeenCount=n.pendingSeenCount-o,n.pendingSeenCount<0&&(p.error("models:chat:sendSeen unread "+n.unreadCount+" pending: "+n.pendingSeenCount+" delta: "+o)(),n.pendingSeenCount=0)},s=e?e.id:void 0;return T.gte([0,4])?M.sendConversationSeen(this.id,s,o).bind(this).then(function(e){return i(),200!==e.status||e._duplicate||this.markSeen(o),e})["catch"](P.WapDrop,function(e){i(),p.error("models:chat:sendConversationSeen dropped")()}):(i(),this.markSeen(o),M.sendConversationSeen(this.id,s,o).bind(this).then(function(e){return e})["catch"](P.WapDrop,function(e){p.error("models:chat:sendConversationSeen dropped")()}))},markSeen:function(e){e&&"number"==typeof e?e>0&&e<=this.unreadCount?this.unreadCount=this.unreadCount-e:-1===e&&this.unreadCount<=0&&(this.unreadCount=0):this.unreadCount=0,this.markedUnread=!1},markUnread:function(e){e?this.active&&(this.markedUnread=!0):this.markedUnread=!1;var t=e?this.sendUnseen():this.sendSeen(),r=e?l10n.t("action_chat_marking_unread"):l10n.t("action_chat_marking_read"),o=t.then(function(t){return 200===t.status?e?l10n.t("action_chat_marked_unread"):l10n.t("action_chat_marked_read"):t.status>=400?e?l10n.t("action_chat_mark_unread_failed"):l10n.t("action_chat_mark_read_failed"):void 0})["catch"](function(t){return e?l10n.t("action_chat_mark_unread_failed"):l10n.t("action_chat_mark_read_failed")});return b.openToast(l.createElement(G,{id:G.genId(),pendingText:r,actionText:o,retry:this.markUnread.bind(this,e)})),t},canMarkUnseen:function(){return T.supportsFeature(T.F.CHAT_MARK_UNSEEN)},sendUnseen:function(){var e=this,t=this.msgs.last(),r=t?t.id:void 0;return M.sendConversationUnseen(this.id,r).then(function(t){return 200===t.status?e.markUnseen():e.markedUnread=!1,t})},markUnseen:function(){this.active&&(this.markedUnread=!0),this.unreadCount=-1},markRecording:function(){if((this.presence.isOnline||this.isGroup)&&!this.recording){var e=this.id;M.sendChatstateRecording(e).then(function(t){t.status>=400&&p.error("models:chat send presence recording error "+e)()})["catch"](P.WapDrop,_.noop),this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),u.PRESENCE_RESEND_WAIT)}this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.recording=!0,this.typing=!1},markComposing:function(){if((this.presence.isOnline||this.isGroup)&&!this.typing){var e=this.id;M.sendChatstateComposing(e).then(function(t){t.status>=400&&p.error("models:chat send presence composing error "+e)()})["catch"](P.WapDrop,_.noop),this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),u.PRESENCE_RESEND_WAIT)}this.typing=!0,this.pausedTimerId&&clearTimeout(this.pausedTimerId),this.pausedTimerId=_.delay(this.markPaused.bind(this),u.SEND_PAUSED_WAIT)},markPaused:function(){if((this.presence.isOnline||this.isGroup)&&(this.typing||this.recording)){var e=this.id;M.sendChatstatePaused(e).then(function(t){t.status>=400&&p.error("models:chat send presence paused error "+e)()})["catch"](P.WapDrop,_.noop)}this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId")),this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.typing=this.recording=!1},_resendPresence:function(){var e=this.id;if(this.recording)M.sendChatstateRecording(e).then(function(t){t.status>=400&&p.error("models:chat send presence resend recording error "+e)()})["catch"](P.WapDrop,_.noop);else{if(!this.typing)return void this.unset("presenceResendTimerId");M.sendChatstateComposing(e).then(function(t){t.status>=400&&p.error("models:chat send presence resend composing error "+e)()})["catch"](P.WapDrop,_.noop)}this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),u.PRESENCE_RESEND_WAIT)},_messageSent:function(){this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId")),this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.typing=!1},_presenceOnlineChanged:function(){this.presence.isOnline?this._resendPresence():this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId"))},handleGroupAction:function(e,t,r){var o;switch(e){case"subject":return void(this.contact.name=r.subject);case"add":case"promote":case"demote":var n="promote"===e;return o=_.map(r.participants,function(e){return{id:e,isAdmin:n}}),void this.groupMetadata.participants.add(o,{merge:!0});case"remove":return o=this.groupMetadata.participants,void _.each(r.participants,function(e){o.remove(e)});case"modify":return;default:return}},mediaMsgs:function(){return this.getAllMsgs().filter(function(e){return e.isMedia})},preload:function(){1===this.msgs.length&&this.loadEarlierMsgs()},loadEarlierMsgs:function(e){var t=this;return this.noEarlierMsgs?c["default"].resolve():(e||(e=this.msgs),e.LMPromise?e.LMPromise:this._loadMsgs("before",e).then(function(e){return _.isArray(e)&&e.length<u.PAGE_SIZE&&(t.noEarlierMsgs=!0),e}))},loadRecentMsgs:function(e){return e||(e=this.msgs),e.LMPromise?e.LMPromise:this._loadMsgs("after",e)},_loadMsgs:function(e,t){var r=t.first(),o={};return r?o=r.id.clone():o.remote=this.id,o.count=u.PAGE_SIZE,this._loadMsgsPromise(t,Store.Msg.findQuery(o))},_loadMsgsPromise:function(e,t){var r=this;return this.isLoadingMsgs=!0,e.LMPromise=this.regCancellablePromise(t)["finally"](function(){r.unset("isLoadingMsgs"),delete e.LMPromise})["catch"](P.WapDrop,_.noop)["catch"](function(e){p.error("chat:loadMsgs:error "+e)()})["catch"](c["default"].CancellationError,_.noop)},getSearchContext:function(e){var t,r=e.msgChunk;if(r)t=r.LMPromise?r.LMPromise:c["default"].resolve();else{var o=e.id.clone();o.count=(0,a["default"])(u.PAGE_SIZE/3*2),r=e.msgChunk=new E,r.add(e),this.msgChunks.push(r);var n=function(){return e.msgChunk};t=this._loadMsgsPromise(r,Store.Msg.getContext(o,n))}return{collection:r,promise:t}},canSendDeleteMsg:function(){return T.supportsFeature(T.F.MESSAGE_DELETE)},sendDeleteMsgs:function(e){if(e&&!_.any(e,function(e){return!e.id||!e.msgChunk})){var t=M.sendMessageDelete(this.id,_.map(e,function(e){return e.id}),!0),r=_.size(e),o=l10n.t("action_message_deleting",{count:r,_plural:r}),n=t.then(function(e){return 200===e.status?l10n.t("action_message_deleted",{count:r,_plural:r}):e.status>=400?l10n.t("action_message_delete_failed",{count:r,_plural:r}):void 0})["catch"](function(e){return p.error("models:chat:sendDeleteMsgs dropped")(e),l10n.t("action_message_delete_failed",{count:r,_plural:r})});return b.openToast(l.createElement(G,{id:G.genId(),pendingText:o,actionText:n,retry:this.sendDeleteMsgs.bind(this,e)})),t.then(function(t){200===t.status&&_.forEach(e,function(e){e.msgChunk?e["delete"]():p.error("models:Chat:deleteMsgs missing msgChunk "+e)()})})}},removeMsg:function(e){var t=e.msgChunk,r=t.indexOf(e);0>r||(p.log("models:Chat:removeMsg "+e.get("id"))(),t.remove(e),0===t.length&&(t===this.msgs?(p.log("models:Chat:removeMsg 0 messages left, querying...")(),this.loadEarlierMsgs()):this.removeMsgsCollection(t)))},deleteMsgs:function(e){var t=this;this.getAllCMCs().forEach(function(r){for(;r.length;){var o=r.at(0);(e||!o.star)&&o["delete"]()}r!==t.msgs&&t.removeMsgsCollection(r)}),this.unreadCount=0,this.noEarlierMsgs=!0},deleteMsgsOlderThan:function(e,t){var r=this.msgs,o=_.first(r.models);if(o&&!(o.t>=e)){if(o=_.last(r.models),o.t<e)return void this.deleteMsgs(t);var n=function(r){return r&&(r.star&&!t||r.t>=e)};this.deleteMsgsPartial(n)}},deleteMsgsBeforeMsgInclusive:function(e){if(e&&this.msgs.get(e.id)){var t=this.msgs.indexOf(e),r=function(e,r){return e.msgChunk===this.msgs&&r>t};this.deleteMsgsPartial(r)}},deleteMsgsPartial:function(e){var t=this,r=this.unreadCount,o=_.flatten(this.getAllCMCs().map(function(t){return t.filter(function(){return!e.apply(this,arguments)},this)},this));if(o.forEach(function(e){e["delete"]()}),_.clone(this.msgChunks).forEach(function(e){0===e.length&&t.removeMsgsCollection(e)}),this.msgs.length>0){var n=r>this.msgs.length?this.msgs.length:r;this.unreadCount=n,this.noEarlierMsgs=!0}},getFirstMsgWithStatus:function(){return _.find(this.msgs.models,function(e){return!e.isNotification&&(e.isSentByMe||e.type===f.TYPE.PTT)})},getFirstMsgFromMe:function(){return _.find(this.msgs.models,function(e){return!e.isNotification&&e.isSentByMe})},sendMessage:function(e){if(e="undefined"==typeof e?"":e.trim(),""===e)return c["default"].resolve();this._messageSent();var t=this.id,r=Store.Conn.me,o=new f({id:new R(r,t,S.tag(),void 0,"out"),body:e,type:"chat",t:w.globalUnixTime(),from:r,to:t,self:"out",local:!0,ack:0}),n=Store.Msg.send(o);return this.msgs.add(o),n},sendLocation:function(e,t,r,o){var n=Store.Conn.me,i=this.id,s=this;return U.getThumb(e,t).then(function(a){var d={id:new R(n,i,S.tag(),void 0,"out"),body:D.parseDataURL(a).data,type:"location",t:w.globalUnixTime(),from:n,to:i,self:"out",lat:e,lng:t,local:!0,ack:0};o&&r&&(d.loc=r,d.url=o);var c=new f(d),l=Store.Msg.send(c);return s.msgs.add(c),l})},sendContact:function(e,t){var r=Store.Conn.me,o=this.id,n=new f({id:new R(r,o,S.tag(),void 0,"out"),type:"vcard",body:e,subtype:t,t:w.globalUnixTime(),from:r,to:o,self:"out",local:!0,ack:0}),i=Store.Msg.send(n);return this.msgs.add(n),i},sendMedia:function(e){var t=this;e=_.flatten([e],1);var r=[],o=[];e.forEach(function(e){var n=e.file,i=e.type,s=e.duration,a=e.caption,d=t._prepSendMedia(n,i,s,a);r.push(d.preMsg),o.push(d.AVparams)});var n=c["default"].reduce(r,function(e,r,n){var i=t._createPendingMsg(r),s=o[n];return i.uploadPromise=s.promise,i.reupload=s.reupload,e.push(i),e},[]).then(function(e){var t=_.invoke(_.pluck(o,"promise"),"reflect");return c["default"].reduce(t,function(t,r,o){var n=e[o];return r.isFulfilled()&&r.value()?n.sendMediaMsg(r.value()).then(function(){n.set({urlState:f.URL_STATE.STATUS_200,uploadPromise:null,reupload:null})}):n.unset("uploadPromise"),e},1)});return this.regCancellablePromise(n)["catch"](c["default"].CancellationError,function(){_.invoke(r,"cancel"),_.invoke(_.pluck(o,"promise"),"cancel")})},_prepSendMedia:function(e,t,r,o){function i(){return b.regCancellablePromise(c["default"].props({blob:m,okdup:T})).then(function(e){var t=e.okdup;if("duplicate"===t.result)return t.data;if("ok"===t.result){var r=t.data;return n(r,e.blob.blob,d,s)}})}var s=e.name,a=Store.Conn.me,d=this.id,l=new R(a,d,S.tag(),void 0,"out"),p=O.typeFromMimetype(e.type),h=t||p,m=O.fileToBlobs(e),f=r?r:O.getFileDuration(e),g=m.then(function(e){return O.getHash(p,e.dataUrl,e.blob)}),v=void 0;switch(h){case"video":var y=window.URL.createObjectURL(e);v=k.generateVideoThumb(y,u.IMG_THUMB_MAX_EDGE,u.IMG_THUMB_MAX_EDGE).then(function(e){return D.parseDataURL(e.url).data})["finally"](function(e){return window.URL.revokeObjectURL(y),e});break;case"image":v=k.resizeAndOrient(e,u.IMG_THUMB_MAX_EDGE,u.IMG_THUMB_MAX_EDGE).then(function(e){return D.parseDataURL(e.url).data});break;default:v=c["default"].resolve()}var E=c["default"].props({blob:m,thumb:v,duration:f,key:l,caption:o,msgType:h,file:e,hash:g}),T=g.then(function(e){return M.requestMediaUpload(p,e.hash,e.size)}),b=this,C=i()["catch"](c["default"].CancellationError,_.noop);return{preMsg:E,AVparams:{promise:C,reupload:i}}},_createPendingMsg:function(e){var t=Store.Msg.add({id:e.key,body:e.thumb,type:e.msgType,t:w.globalUnixTime(),from:Store.Conn.me,isNew:!0,to:this.id,self:"out",url:e.blob.dataUrl,urlState:f.URL_STATE.UPLOADING,duration:e.duration+"",ack:0,local:!0,mimetype:e.file.type,height:e.blob.h,width:e.blob.w,fullHeight:e.blob.h,fullWidth:e.blob.w,size:e.hash.size,caption:e.caption});return this.msgs.add(t)},updateReadOnly:function(){this.isGroup&&!this.groupMetadata.stale&&(this.isReadOnly=!this.groupMetadata.participants.get(Store.Conn.me)),this.isBroadcast&&this.updateTitle()},_updateAssignedColor:function(){if(this.colors){var e=this.groupMetadata.participants;if(0!==e.size){var t=this.colors,r=_.difference(_.keys(t),e.pluck("id").map(L));r.forEach(function(e){delete t[e]}),r.length&&this._saveAssignedColors()}}},loadAssignedColors:function(){return this.listenTo(this.groupMetadata.participants,"all",this._updateAssignedColor),N.getGroupParticipantAssignedColor(this.id)||{}},saveAssignedColors:function(){var e=this.colors;e&&N.setGroupParticipantAssignedColor(this.id,e)},assignedColor:function(e){var t,r=this.colors||(this.colors=this.loadAssignedColors()),o=L(e);return(t=r[o])?t:(t=_.keys(r).length%u.NUM_COLORS+1,r[o]=t,this._saveAssignedColors(),t)},setSubject:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?"":arguments[0];if(t=t.trim(),!t)return c["default"].reject(new P.ActionError);if(t===this.contact.name)return c["default"].reject(new P.ActionError);var r=M.changeSubject(this.id,t),o=l10n.t("action_group_renaming"),n=r.then(function(e){return 200===e.status?l10n.t("action_group_renamed",{subject:t}):e.status>=400?l10n.t("action_group_rename_failed"):void 0})["catch"](function(e){return p.error("models:chat:setSubject dropped")(e),l10n.t("action_group_rename_failed")});return b.openToast(l.createElement(G,{id:G.genId(),pendingText:o,actionText:n,retry:this.setSubject.bind(this,t)})),r.then(function(r){200!==r.status||r._duplicate||(e.contact.name=t)})},unstarAll:function(){this.getAllMsgs().forEach(function(e){e&&(e.star=!1)})},replaceMsgsCollection:function(e){p.info("model:Chat:replaceMsgsCollection:"+this.id)(),this.msgs.replace(e),this.notifyMsgCollectionMerge(e,this.msgs,this.msgs),this.msgChunks=_.without(this.msgChunks,e)},notifyMsgCollectionMerge:function(e,t,r){this.trigger("change:cmc:merge",e,t,r)},removeMsgsCollection:function(e){this.msgChunks=_.without(this.msgChunks,e)},getAllCMCs:function(){return this.msgChunks.concat([this.msgs])},getAllMsgs:function(){return _.flatten(this.getAllCMCs().map(function(e){return e.models}))}});j.KIND=B,e.exports=j},774:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(688),i=o(n),s=r(6),a=r(77),d=s.createClass({displayName:"Drawer",propTypes:{children:s.PropTypes.node.isRequired,id:s.PropTypes.string,variant:s.PropTypes.string,noContainer:s.PropTypes.bool,position:s.PropTypes.oneOf(["right","left"]),onDragLeave:s.PropTypes.func,onDrop:s.PropTypes.func,onDragOver:s.PropTypes.func},getDefaultProps:function(){return{position:"left"}},statics:{RIGHT:"right",LEFT:"left"},getInitialState:function(){return{isDragging:!1}},isDragDropDrawer:function(){return this.props.onDragOver&&this.props.onDragLeave&&this.props.onDrop},onDragOver:function(e){e.preventDefault(),this.isDragDropDrawer()&&!this.state.isDragging&&(this.props.onDragOver(e),this.setState({isDragging:!0}))},onDrop:function(e){e.preventDefault(),e.stopPropagation(),this.setState({isDragging:!1}),this.props.onDrop(e)},onDragLeave:function(e){e.preventDefault(),e.stopPropagation(),this.state.isDragging&&(this.setState({isDragging:!1}),this.props.onDragLeave(e))},render:function(){var e,t=this.props,r=a("drawer",(0,i["default"])({},"drawer-"+t.id,!!t.id));if(this.isDragDropDrawer()){var o=this.state.isDragging?{}:{display:"none"};e=s.createElement("div",{key:"mask",className:"drag-drop-mask",style:o,onDragLeave:this.onDragLeave,onDrop:this.onDrop})}if(t.noContainer)return s.createElement("div",{className:r,onDragOver:this.onDragOver},e,t.children);var n,d=a("drawer-container",(n={},(0,i["default"])(n,"drawer-container-"+t.id,!!t.id),(0,i["default"])(n,"drawer-container-"+t.position,!!t.position),(0,i["default"])(n,"drawer-container-"+t.variant,!!t.variant),n));return s.createElement("div",{className:d,onDragOver:this.onDragOver},e,s.createElement("div",{className:r},t.children))}});e.exports=d},775:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(158),i=o(n),s=r(344),a=o(s),d=r(6),c=r(77),l=d.createClass({displayName:"DrawerBody",propTypes:{expands:d.PropTypes.bool,flex:d.PropTypes.bool,classes:d.PropTypes.string},getDefaultProps:function(){return{expands:!1}},render:function(){var e=this.props,t=e.expands,r=e.classes,o=e.flex,n=(0,a["default"])(e,["expands","classes","flex"]),s=c("drawer-body","drawer-editable",r,{"drawer-body-flex":o}),l=t?d.createElement("div",{className:"drawer-body-filler"}):null;return d.createElement("div",(0,i["default"])({className:s},n),this.props.children,l)}});e.exports=l},776:function(e,t,r){"use strict";var o=r(6),n=r(345),i=r(77),s=r(78),a={SMALL:"small",LARGE:"large",POPUP:"popup",OFFSET:"offset"},d=o.createClass({displayName:"DrawerHeader",propTypes:{children:o.PropTypes.node,title:o.PropTypes.string,onBack:o.PropTypes.func,onCancel:o.PropTypes.func,a8n:o.PropTypes.string,type:o.PropTypes.oneOf(_.values(a)).isRequired},render:function(){var e=this.props,t=e.title,r=e.onBack,d=e.onCancel,c=e.type,l=e.children,u=null;if(t){var p=void 0,h={textAlign:"initial"};c===a.SMALL?(p={fontWeight:400,fontSize:16,lineHeight:"21px"},h.width=54):c===a.LARGE?(p={fontWeight:500,fontSize:19,lineHeight:"19px"},h.width=54):(p={fontWeight:500,fontSize:19,lineHeight:"19px"},h.width=48,h.opacity=.7);var m=i("icon btn-close-drawer",{"icon-back":c===a.SMALL,"icon-back-light":c!==a.SMALL}),f=r?o.createElement("span",{className:m,"data-a8n":n.key("btn-closer-drawer"),"data-ignore-capture":s.IGNORE_ANY,onClick:r}):null,g=i("icon btn-close-drawer",{"icon-x":c===a.SMALL,"icon-x-light":c!==a.SMALL}),v=d?o.createElement("span",{className:g,"data-a8n":n.key("btn-closer-drawer"),"data-ignore-capture":s.IGNORE_ANY,onClick:d}):null;u=o.createElement("div",{className:"drawer-title",style:p},o.createElement("div",{style:h,className:"drawer-title-action"},f,v),o.createElement("span",{"data-a8n":n.key(this.props.a8n),className:"drawer-title-body"},t))}var y=i({"drawer-header":c===a.LARGE,"drawer-header-small":c===a.SMALL,"drawer-header-offset":c===a.OFFSET,"drawer-header-popup":c===a.POPUP});return o.createElement("header",{className:y},u,l)}});d.Type=a,e.exports=d},777:function(e,t,r){"use strict";var o=r(6),n=r(345),i=r(104),s=r(78),a=r(342),d=a.HotKeys,c=o.createClass({displayName:"MenuItem",mixins:[i],propTypes:{shortcut:o.PropTypes.string,action:o.PropTypes.func.isRequired,a8n:o.PropTypes.string},componentWillMount:function(){},onKeyDown:function(e){if(e.metaKey){var t=this.props.shortcut;t&&e.key===t+""&&(e.preventDefault(),this.onClick(e))}},onClick:function(e){this.props.action(e)||e.target&&e.target.hasAttribute("data-ignore-capture")?e.stopPropagation():s.pop(s.MENU)},render:function(){var e=null,t=_.isString(this.props.children)?this.props.children:null,r={enter:this.onClick};return r[l10n.LR("right","left")]=this.onClick,r={},o.createElement(d,{component:"li",handlers:r,"data-a8n":n.key(this.props.a8n),className:"menu-item menu-shortcut",onClick:this.onClick},o.createElement("a",{className:"ellipsify",title:t},this.props.children),e)}});e.exports=c},778:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(158),i=o(n),s=r(688),a=o(s),d=r(344),c=o(d),l=r(6),u=r(30),p=r(161),h=r(77),m=r(9),f=r(104),g=r(154),v=72,y="data-list-scroll-container",E=l.createClass({displayName:"List",mixins:[f,g],propTypes:{extraItems:l.PropTypes.number,scrollTop:l.PropTypes.number,animate:l.PropTypes.bool.isRequired,classes:l.PropTypes.arrayOf(l.PropTypes.string),height:l.PropTypes.number.isRequired,data:l.PropTypes.arrayOf(l.PropTypes.element).isRequired},getDefaultProps:function(){return{classes:[],scrollTarget:null,data:null,height:v,extraItems:30,animate:!1}},statics:{DEFAULT_HEIGHT:v,SCROLL_ATTR:y},getInitialState:function(){return{scrollTarget:void 0,firstVisibleIndex:0,visibleCount:0,physicalCount:0,renderVisible:!0}},componentWillReceiveProps:function(e){_.isNumber(e.scrollTop)&&this.state.scrollTarget&&(this.state.scrollTarget.scrollTop=e.scrollTop),(this.props.scrollTarget!==e.scrollTarget||this.props.height!==e.height||this.props.data.length!==e.data.length)&&this.initialize(e)},componentWillMount:function(){this.scrollTop=0,this._eventLoopBusy=!1,this._uiBusy=!1,this.renderedItems={},this.disablePointerEventsOff=this.safeDebounce(this._disablePointerEventsOff,150),this.disableUIBusy=this.safeDebounce(this._disableUIBusy,150)},componentDidMount:function(){this.initialize();var e=this;this.regNativeListener(window,"resize",function(){e.initialize()})},initialize:function(e){var t=e?e:this.props;this.state.scrollTarget&&this.unregNativeListener(this.state.scrollTarget,"scroll",this.onScroll);for(var r,o=u.findDOMNode(this),n=0;5>n;n++){if(o.hasAttribute(y)){r=o;break}o=o.parentNode}if(!r)throw new Error("list scroll container not found");this.regNativeListener(r,"scroll",this.onScroll),this.scrollTop=r.scrollTop;var i=Math.floor(this.scrollTop/t.height),s=r.clientHeight,a=Math.min(Math.ceil(s/t.height),t.data.length),d=Math.min(a+t.extraItems,t.data.length);return this.setState({scrollTarget:r,firstVisibleIndex:i,visibleCount:a,physicalCount:d,renderVisible:!0}),this.renderedItems={},r},_disablePointerEventsOff:function(e){this._pointerEvents=!1,u.findDOMNode(this.refs.viewport).style.pointerEvents="auto"},disablePointerEvents:function(e){this.disablePointerEventsOff(),this._pointerEvents||(u.findDOMNode(this.refs.viewport).style.pointerEvents="none",this._pointerEvents=!0)},onScroll:function(e){this._eventLoopBusy||window.requestAnimationFrame(this._onScroll),this._eventLoopBusy=!0},_disableUIBusy:function(){m.setUiBusy(!1),this._uiBusy=!1},_onScroll:function(){if(this.isMounted()){this.disablePointerEvents(),this._uiBusy||(m.setUiBusy(!0),this._uiBusy=!0),this.disableUIBusy(),this.scrollTop=this.state.scrollTarget.scrollTop;var e=Math.floor(this.scrollTop/this.props.height);if(this.state.firstVisibleIndex===e)this._eventLoopBusy=!1;else{var t=this;this.setState({firstVisibleIndex:e,renderVisible:!1},function(){t._eventLoopBusy=!1})}}},getFirstPhysicalIndex:function(){var e=this.state.firstVisibleIndex+this.state.visibleCount/2,t=Math.max(0,Math.floor(e-this.state.physicalCount/2));return Math.min(t,this.props.data.length-this.state.physicalCount)},getComponents:function(){var e=this,t=this.getFirstPhysicalIndex(),r=Math.min(t+this.state.physicalCount,this.props.data.length),o={},n=_.chain(this.props.data).forEach(function(e,t){return o[e.key]=t}).slice(t,r).forEach(function(t,r){return e.renderedItems[t.key]=t}).value(),i=this.state.renderVisible?n:this.renderedItems;return _(i).sortBy("key").map(function(t){var r=0===o[t.key]?"first":null;return l.createElement(T,{key:t.key,rowHeight:e.props.height,classes:r,zIndex:e.props.data.length-o[t.key]-1,rowNumber:o[t.key]},t)}).value()},render:function(){var e={container:{},viewport:{height:this.props.data.length*this.props.height}},t={container:h("infinite-list",this.props.classes,{"infinite-list-animate":this.props.animate&&!this._eventLoopBusy}),viewport:"infinite-list-viewport"},r=this.getComponents();return l.createElement("div",{className:t.container,style:e.container},l.createElement("div",{className:t.viewport,ref:"viewport",style:e.viewport},r))}}),T=l.createClass({displayName:"ListItem",propTypes:{children:l.PropTypes.element.isRequired,rowNumber:l.PropTypes.number.isRequired,rowHeight:l.PropTypes.number.isRequired,zIndex:l.PropTypes.number.isRequired},getInitialState:function(){return{rendered:!1}},componentDidMount:function(){this.setState({rendered:!0})},render:function(){var e=this.props,t=e.children,r=e.rowNumber,o=e.rowHeight,n=e.zIndex,s=e.classes,d=(0,c["default"])(e,["children","rowNumber","rowHeight","zIndex","classes"]),u=(0,a["default"])({zIndex:n,height:o,willChange:"transform"},p.prefix("transform"),"translate3d(0, "+100*r+"%, 0)"),m=h(s,{"infinite-list-item":!0,"infinite-list-item-keyframe":!this.state.rendered,"infinite-list-item-transition":!0});return l.createElement("div",(0,i["default"])({className:m,style:u},d),t)}});e.exports=E},779:function(e,t,r){"use strict";var o=r(6),n=r(30),i=r(156),s=r(804),a=r(858),d=r(78),c=r(770),l=r(103),u=r(77),p=r(772),h=r(846),m=r(342),f=m.HotKeys,g={SMALL:"small",DEFAULT:"default"},v=o.createClass({displayName:"Contact",mixins:[c,l],propTypes:{contact:o.PropTypes.instanceOf(i).isRequired,onClick:o.PropTypes.func,onDelete:o.PropTypes.func,onContext:o.PropTypes.func,contextEnabled:o.PropTypes.func,admin:o.PropTypes.bool,active:o.PropTypes.object,className:o.PropTypes.string,secondary:o.PropTypes.node,type:o.PropTypes.oneOf(_.values(g)),showNotifyName:o.PropTypes.bool},getInitialState:function(){var e=this.props.contact,t=this.props.active,r={formattedName:this.async("contact.formattedName"),pendingAction:this.async("contact.pendingAction"),active:t?t.value===e.id:!1,contextMenu:!1};return this.props.showNotifyName&&(r.notifyName=this.async("contact.notifyName")),r},componentWillMount:function(){var e=this,t=this.props.active;t&&this.addObserver(t,this.props.contact.id,function(t){if("focus"===t){var r=n.findDOMNode(e);r.focus(),h.scrollIntoViewIfNeeded(r)}e.setState({active:!!t})})},componentWillUnmount:function(){var e=n.findDOMNode(this);e.contains(document.activeElement)&&d.focusNodeOrParent(e.parentNode)},contextEnabled:function(){return!1},onDelete:function(e){e.stopPropagation(),this.props.onDelete(e,this.props.contact)},onClick:function(e){_.isFunction(this.props.onClick)&&this.props.onClick(e,this.props.contact)},onEnter:function(e){e.preventDefault(),e.stopPropagation(),this.onClick(e)},onContext:function(e){return this.state.contextMenu?(d.pop(d.MENU),void this.setState({contextMenu:!1})):(this.props.onContext(e,this.props.contact,this.onContextClose),void this.setState({contextMenu:!0}))},onContextClose:function(){this.setState({contextMenu:!1})},indicateFocus:function(e){if(!(Date.now()-(f.flashFocus||0)>200)){var t=n.findDOMNode(this.refs.cell);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:this.onBlur})}},onBlur:function(e){var t=n.findDOMNode(this.refs.cell);t&&(Velocity(t,"stop"),t.style.backgroundColor="")},render:function(){var e=this.props,t=e.contact,r=e.secondary,n=e.onContext,i=e.onDelete,d=e.contextEnabled,c=e.admin,l=e.showNotifyName,h=e.className;h=u("contact",h,{active:!!this.state.active});var m=void 0,v=void 0,y=void 0;if(!t.name&&l&&this.state.notifyName&&(y=o.createElement("span",{className:"ellipsify screen-name"},o.createElement(p,{classes:"screen-name-text",direction:"auto",text:this.state.notifyName.name}))),c&&(v=o.createElement("div",{className:"chat-meta"},o.createElement("div",{className:"chat-marker chat-marker-admin"},l10n.t("web_group_admin")))),i){var E=u("icon",{"icon-x-alt-small":this.props.type===g.SMALL,"icon-x-alt":this.props.type!==g.SMALL});m=o.createElement("div",{className:"chat-controls"},o.createElement("button",{className:E,onClick:this.onDelete}))}r||(r=o.createElement(a,{status:t.status})),n&&(n=this.onContext);var _={};return o.createElement(f,{handlers:_,onFocus:this.indicateFocus,onBlur:this.onBlur},o.createElement(s,{id:t.id,ref:"cell",className:h,contextEnabled:d||this.contextEnabled,pendingAction:this.state.pendingAction,detail:m,primary:this.state.formattedName,primaryDetail:v,secondary:r,secondaryDetail:y,onClick:this.onClick,onContext:n}))}});v.Type=g,e.exports=v},780:function(e,t,r){"use strict";var o=r(6),n=r(9),i=r(154),s=r(77),a=4e3,d=o.createClass({displayName:"Toast",mixins:[i],propTypes:{id:o.PropTypes.string.isRequired,msg:o.PropTypes.string.isRequired,action:o.PropTypes.shape({actionText:o.PropTypes.string.isRequired,onAction:o.PropTypes.func.isRequired}),onDismiss:o.PropTypes.func,duration:o.PropTypes.number},statics:{genId:function(e){return _.uniqueId(e||"toast")}},getDefaultProps:function(){return{duration:a}},componentWillMount:function(){this.delay=this.safeDelay(function(){n.closeToast(this)},a)},restartDelay:function(){this.clearSafeTimeout(this.delay),this.delay=this.safeDelay(function(){n.closeToast(this)},a)},onDismiss:function(){n.closeToast(this),this.props.onDismiss&&this.props.onDismiss()},render:function(){var e,t=this.props,r=t.msg,n=t.action,i=t.className;return n&&(e=o.createElement("button",{className:"action",onClick:n.onAction},n.actionText)),o.createElement("div",{className:s("toast",i)},o.createElement("span",null,r),e,o.createElement("button",{className:"icon icon-x-alt",onClick:this.onDismiss}))}});e.exports=d},781:function(e,t,r){"use strict";var o=r(6),n=o.createClass({displayName:"HiddenToken",propTypes:{children:o.PropTypes.node.isRequired},render:function(){return o.createElement("span",{className:"hidden-token"},"",this.props.children,"")}});e.exports=n},782:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function n(e){var t={};return e.forEach(function(e){var r=e.split(""),o=_.initial(r).join(""),n=_.last(r);(t[o]||(t[o]={}))[n]=1}),_.keys(t).forEach(function(e){t[e]=s(_.keys(t[e]))}),i(t)}function i(e){return _.map(_.keys(e).sort(function(e,t){return t.length-e.length}),function(t){return _.escapeRegExp(t)+e[t]}).join("|")}function s(e){if(1===e.length)return _.escapeRegExp(e[0]);e=e.sort();for(var t=[],r=0,o=e[r],n=e.length,i=0;n>=i;i++){var s=e[i];if(!s||s.charCodeAt(0)!==o.charCodeAt(0)+(i-r)){var a=e[i-1];a===o?t.push(a):t.push(o+"-"+a),r=i,o=s}}return"["+_.escapeRegExp(t.join(""))+"]"}function a(){var e=(0,c["default"])(N).concat((0,c["default"])(E),b);try{return new RegExp("("+n(e)+")","g")}catch(t){m.log("createRegexp Failed",e)()}}var d=r(37),c=o(d),l=r(948),u=r(947),p=r(8),h=r(77),m=r(1),f=null,g={},v="",y="    ".split(/ /),E={"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0},T=["","","","","","","","","","","","","","","","","","","","","","","","","",""],b=[];T.forEach(function(e){T.forEach(function(t){b.push(e+t)})});var S=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},C=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[e[r]]=r);return t},M=C(l),N=S(S({},u),l),w={},P=y[0];_.keys(l).forEach(function(e){l[e+P]&&(w[e]=e,y.map(function(t){w[e+t]=e}))});var R={containsEmoji:_.memoize(function(e){return f||(f=a()),f.test(e)}),normalizeEmoji:_.memoize(function(e){return f||(f=a()),e?e.replace(f,function(e,t){if(E[t])return"";var r=N[t];return M[r]||v}):""}),codeToEmoji:C(N),emojiToHTML:_.memoize(function(e,t,r){f||(f=a()),r=r||"small";var o="small"===r?"emoji":"emojik";return e?e.replace(f,function(e,r){if(E[r])return"";var n=g[r];if(n)return n;var i,s=N[r];if(s){var a=M[s]||v,d=document.createElement("img");return d.alt=a,d.draggable=!1,d.className=h(o,"emoji"+s,t),d.src=p.ONE_BY_ONE_TRANS_GIF,d.outerHTML}return i=v,g[r]=i}):""},function(e,t,r){return"t:"+(e||"")+"c:"+(t||"")+"s:"+(r||"small")}),NodeToEmoji:function(e){for(var t=[""],r=0,o=e.firstChild;null!==o;){if(1===o.nodeType)switch(o.tagName){case"P":case"PRE":case"DIV":t.push(""),r++;break;case"IMG":t[r]+=o.getAttribute("alt");break;case"BR":t[r]+="\n"}else 3===o.nodeType&&(t[r]+=o.nodeValue);if(o.hasChildNodes())o=o.firstChild;else{for(;null===o.nextSibling;){if(o=o.parentNode,o===e)return t.join("\n");switch(o.tagName){case"P":case"PRE":case"DIV":t.push(""),r++}}o=o.nextSibling}}return t.join("\n")},emojiMap:N,skinToneEmojis:w,skinToneVariations:y};e.exports=R},783:function(e,t,r){"use strict";var o=r(6),n=r(866),i=r(770),s=r(155),a=r(21),d="large",c="regular",l="low",u="high",p=o.createClass({displayName:"DetailImage",mixins:[i],propTypes:{id:o.PropTypes.string.isRequired,size:o.PropTypes.oneOf([c,d]),loader:o.PropTypes.bool,quality:o.PropTypes.oneOf([l,u]),onClick:o.PropTypes.func,onLoad:o.PropTypes.func},getDefaultProps:function(){
return{size:c,quality:l}},statics:{LARGE:d,REGULAR:c,LOW:l,HIGH:u},getInitialState:function(){var e=this.props.quality;return a.isBroadcast(this.props.id)?{loaded:!1}:e===p.HIGH?{loaded:!1,imgFull:this.async("id.ProfilePicThumb.imgFull",null)}:e===p.LOW?{loaded:!1,img:this.async("id.ProfilePicThumb.img",null)}:void 0},onLoad:function(e){this.state.loaded||this.setState({loaded:!0}),this.props.onLoad&&this.props.onLoad()},onError:function(e){if(410===e){var t=Store.ProfilePicThumb.get(this.props.id);t&&t.update()}},getClasses:function(){var e="avatar",t=this.props.id;return a.isUser(t)?e+=" icon-user-default":a.isGroup(t)?e+=" icon-group-default":a.isBroadcast(t)&&(e+=" icon-broadcast-default"),this.props.size===p.LARGE&&(e+=" avatar-l"),e},getStyle:function(){return this.props.onClick?{cursor:"pointer"}:null},render:function(){var e=this.state.img||this.state.imgFull,t=Store.ProfilePicThumb.get(this.props.id),r=void 0;return!this.props.loader||this.state.loaded||t&&!t.stale&&!e||(r=o.createElement("div",{className:"avatar-spinner-container"},o.createElement(s,{size:50,stroke:3}))),e=e?o.createElement(n,{src:e,onLoad:this.onLoad,onError:this.onError}):null,o.createElement("div",{className:this.getClasses(),style:this.getStyle(),onClick:this.props.onClick},e,r)}});e.exports=p},784:function(e,t,r){"use strict";var o=r(6),n=r(781),i=r(772),s=r(771),a=r(9),d=r(21),c=r(77),l=function(e){function t(){Store.Chat.find(r.author).then(function(e){a.openChat(e)})}var r=e.msg,s=r.chat.assignedColor(r.sender),l=r.senderObj,u=c("message-author color-"+s,{"title-number":!l.name}),p=void 0;return p=l.name?o.createElement("span",{className:"text-clickable",onClick:t},o.createElement(i,{text:l.name})):[o.createElement("span",{className:"number text-clickable",key:r.id+"-number",onClick:t},d.formattedUser(l.id)),o.createElement("span",{className:"ellipsify screen-name",key:r.id+"-push-name",onClick:t},o.createElement(i,{classes:"screen-name-text",direction:"auto",text:r.notifyName}))],o.createElement("h3",{className:u},o.createElement(n,null,p))};l.shouldRender=function(e){return!e.isSentByMe&&e.isGroupMsg&&!e.isContinuation},l.propTypes={msg:o.PropTypes.instanceOf(s).isRequired},e.exports=l},785:function(e,t,r){"use strict";var o=r(6),n=r(781),i=r(885),s=r(771),a=r(770),d=r(77),c=r(153),l=o.createClass({displayName:"Meta",mixins:[a],propTypes:{msg:o.PropTypes.instanceOf(s).isRequired},getInitialState:function(){var e=this.props.msg;return{ack:e.ack<3?this.async("msg.ack"):e.ack}},render:function(){var e,t=this.props.msg;if(t.broadcast){var r=(t.type===s.TYPE.IMAGE||t.type===s.TYPE.VIDEO)&&!t.caption,a=d("icon-s",{"icon-broadcast-light":r,"icon-broadcast":!r});e=o.createElement("span",{className:a})}var l=t.caption?"image-caption":t.type,u=t.isSentByMe?o.createElement(i,{ack:this.state.ack,type:l}):null;return o.createElement("div",{className:"message-meta"},e,o.createElement(n,null,o.createElement("span",{className:"message-datetime"},c.timestampStr(t.t))),u)}});e.exports=l},786:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n,i=r(688),s=o(i),a=r(6),d=r(9),c=r(77),l=r(78),u=r(105),p=(n={},(0,s["default"])(n,l.DRAWER_LEFT,"drawer-container-left"),(0,s["default"])(n,l.DRAWER_RIGHT,"drawer-container-right"),(0,s["default"])(n,l.DRAWER_MID,"drawer-container-mid"),(0,s["default"])(n,l.MODAL,"modal"),n),h={PUSH:"-push",POP:"-pop",DEFAULT_DRAWER:"flow-transition-drawer",DEFAULT_MODAL:"flow-transition-modal"},m={propTypes:{type:a.PropTypes.oneOf(_.keys(p))},getDefaultProps:function(){return{type:p[l.MODAL]}},getInitialState:function(){return{_stack:[]}},endFlow:function(){this.props.type===p.MODAL?d.closeModal():d.closeDrawer(this.props.type)},push:function(e,t){this.state._stack.push(e),this.setState({_stack:this.state._stack,_transition:(t||this.props.transition||h.DEFAULT_MODAL)+h.PUSH})},pop:function(e,t){if(this.state._stack.length<=1)return this.endFlow();if(this.state._stack.pop(),e){var r=_.last(this.state._stack);e.key=_.uniqueId("flow_"),r=a.cloneElement(r,e),this.state._stack.splice(this.state._stack.length-1,1,r)}this.setState({_stack:this.state._stack,_transition:(t||this.props.transition||h.DEFAULT_MODAL)+h.POP})},render:function(){var e=_.last(this.state._stack);_.isFunction(e)&&(e=e());var t=c(p[this.props.type],{"flow-drawer-container":this.props.type!==p[l.MODAL]});return a.createElement("div",{className:t},a.createElement(u,{transitionName:this.state._transition},e))}};m.Type=p,m.Transition=h,e.exports=m},787:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(158),i=o(n),s=r(344),a=o(s),d=r(6),c=r(155),l=r(77),u=function(e){var t=e.className,r=l("empty-icon",t);return d.createElement("div",{className:"empty-icon-container"},d.createElement("span",{className:r}))},p=function(e){var t=e.icon,r=e.title,o=e.text,n=e.className,s=e.children,c=(0,a["default"])(e,["icon","title","text","className","children"]),u=r?d.createElement("div",{className:"empty-title"},r):null,p=o?d.createElement("div",{className:"empty-text"},o):null,h=l("empty",n);return d.createElement("div",(0,i["default"])({className:h},c),t,u,p,s)},h=function(){var e=d.createElement(u,{className:"icon-empty-blocked"});return d.createElement(p,{icon:e,title:l10n.t("blocked_empty"),text:l10n.t("add_blocked_description")})},m=function(){var e=d.createElement(u,{className:"icon-empty-archived"});return d.createElement(p,{icon:e,title:l10n.t("archived_empty")})},f=function(){return d.createElement(p,{className:"empty-top",text:l10n.t("search_no_chats_or_contacts")})},g=function(){return d.createElement(p,{className:"empty-top",text:l10n.t("search_no_contacts")})},v=function(){return d.createElement(p,{className:"empty-top",text:l10n.t("search_no_groups")})},y=function(){return d.createElement(p,{text:l10n.t("no_chats")})},E=function(){return d.createElement(p,{text:l10n.t("no_contacts")})},_=function(){return d.createElement(p,{text:l10n.t("no_groups")})},T=function(){return d.createElement(p,{text:l10n.t("all_chats_archived")})},b=function(){return d.createElement(p,null,d.createElement(c,null))};e.exports={Blocked:h,Archived:m,Search:f,SearchContacts:g,SearchGroups:v,List:y,ListContacts:E,ListGroups:_,AllArchived:T,Loading:b}},788:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(158),i=o(n),s=r(344),a=o(s),d=r(6),c=r(345),l=r(77),u=d.createClass({displayName:"DrawerSection",propTypes:{children:d.PropTypes.node.isRequired,title:d.PropTypes.node,subtitle:d.PropTypes.node,expands:d.PropTypes.bool.isRequired,classes:d.PropTypes.string,onMouseDown:d.PropTypes.func,noContainer:d.PropTypes.bool,a8n:d.PropTypes.string},getDefaultProps:function(){return{expands:!1,noContainer:!1}},render:function(){var e=this.props,t=e.children,r=e.title,o=e.subtitle,n=e.expands,s=e.classes,u=e.onMouseDown,p=e.noContainer,h=(0,a["default"])(e,["children","title","subtitle","expands","classes","onMouseDown","noContainer"]),m=l(s,{"drawer-section-expand":!!n,"drawer-section":!n,well:!!r});if(!r)return d.createElement("div",{className:m},t);var f=o?d.createElement("div",{className:"col-side"},o):null,g=t;if(!p){var v=l("drawer-section-body",{"drawer-section-body-expand":!!n,chatlist:!!n});g=d.createElement("div",{className:v},t)}return d.createElement("div",(0,i["default"])({className:m,onMouseDown:u},h),d.createElement("div",{className:"drawer-section-title title-underlined"},d.createElement("div",{"data-a8n":c.key(this.props.a8n),className:"col-main"},r),f),g)}});e.exports=u},789:function(e,t,r){"use strict";var o=r(6),n=r(30),i=r(773),s=r(804),a=r(830),d=r(824),c=r(827),l=r(868),u=r(859),p=r(850),h=r(828),m=r(832),f=r(853),g=r(791),v=r(770),y=r(103),E=r(8),T=r(78),b=r(9),S=r(77),C=r(846),M=r(342),N=M.HotKeys,w={LAST:"last",INFO:"info"},P=o.createClass({displayName:"Chat",mixins:[v,y],propTypes:{chat:o.PropTypes.instanceOf(i).isRequired,mode:o.PropTypes.oneOf(_.values(w)).isRequired,noContext:o.PropTypes.bool,onClick:o.PropTypes.func,active:o.PropTypes.object},statics:{Mode:w},getDefaultProps:function(){return{mode:w.LAST}},getInitialState:function(){this.hoverCounter=0;var e=this.props.chat,t=this.props.active;return{formattedTitle:this.async("chat.formattedTitle"),hasUnread:this.async("chat.hasUnread"),isReadOnly:this.async("chat.isReadOnly"),pendingAction:this.async("chat.pendingAction"),active:t?t.value===e.id:!1,contextMenu:!1}},componentWillMount:function(){var e=this,t=this.props.active;t&&this.addObserver(t,this.props.chat.id,function(t){if("focus"===t){var r=n.findDOMNode(e);r.focus(),C.scrollIntoViewIfNeeded(r)}e.setState({active:t})})},componentWillUpdate:function(e,t){this.state.isReadOnly!==t.isReadOnly&&T.pop(T.MENU)},componentWillUnmount:function(){var e=n.findDOMNode(this);e.contains(document.activeElement)&&T.focusNodeOrParent(e.parentNode),this.state.contextMenu&&T.pop(T.MENU)},contextEnabled:function(){var e=this.props,t=e.chat,r=e.noContext;return!r&&(t.mute.canMute()||t.canArchive()||t.canDelete()||t.canExit())},onMenu:function(e){if(this.state.contextMenu)return T.pop(T.MENU),void this.setState({contextMenu:!1});var t=this.props.chat,r=[];t.canArchive()&&r.push(o.createElement(d,{key:"archive",onArchive:this.onArchive,chat:t})),t.mute.canMute()&&r.push(o.createElement(a,{key:"mute",onMute:this.onMute,chat:t})),t.canDelete()&&r.push(o.createElement(c,{key:"delete",onDeleteOrExit:this.onDeleteOrExit,chat:t})),t.canMarkUnseen()&&r.push(o.createElement(l,{key:"mark_unread",onMarkUnread:this.onMarkUnread,chat:t})),this.setState({contextMenu:!0}),b.openContextMenu(r,{onDefault:this.onClick,onClose:this.removeContext,event:e.event,anchor:e.anchor,parent:this})},removeContext:function(){this.setState({contextMenu:!1})},onMute:function(e){b.muteChat(this.props.chat,e,this)},onArchive:function(e){b.archiveChat(this.props.chat,e)},onDeleteOrExit:function(){b.deleteOrExitChat(this.props.chat,this)},onMarkUnread:function(e){b.markChatUnread(this.props.chat,e)},onClick:function R(e){var t=this.props,R=t.onClick,r=t.chat;_.isFunction(R)?R(e,r):b.openChat(r)},onEnter:function(e){e.preventDefault(),e.stopPropagation(),N.flashFocus=Date.now(),this.onClick(e)},onMouseDown:function(e){0===e.button&&this.props.chat.preload()},onDragEnter:function(e){var t=e.dataTransfer;_.contains(t.types,E.DRAG_TYPE_FILE)&&(0===this.hoverCounter&&this.setState({dragging:!0}),this.hoverCounter+=1)},onDragLeave:function(e){var t=e.dataTransfer;_.contains(t.types,E.DRAG_TYPE_FILE)&&(this.hoverCounter-=1,0===this.hoverCounter&&this.setState({dragging:!1}))},onDrop:function(e){this.setState({dragging:!1});var t=void 0,r=e.dataTransfer;_.contains(r.types,E.DRAG_TYPE_FILE)&&(t=Array.prototype.slice.call(e.target.files||r.files),b.openChat(this.props.chat,void 0,!1),b.openDrawer(o.createElement(g,{files:t,chat:this.props.chat,type:T.DRAWER_MID}),"slide-up"))},indicateFocus:function(e){if(!(Date.now()-(N.flashFocus||0)>200)){var t=n.findDOMNode(this.refs.cell);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:this.onBlur})}},onBlur:function(e){var t=n.findDOMNode(this.refs.cell);t&&(Velocity(t,"stop"),t.style.backgroundColor="")},render:function(){var e=this,t=this.props,r=t.chat,n=t.mode,i=t.secondary,a=t.className;a=S(a,{unread:this.state.hasUnread,active:!!this.state.active,"chat-drag":this.state.dragging});var d=void 0,c=void 0,l=void 0;switch(n){case w.LAST:d=o.createElement(u,{chat:r}),i||(i=o.createElement(p,{chat:r}),c=o.createElement(f,{chat:r})),l={enter:this.onEnter,a:function(){e.onArchive(!r.archive)},backspace:this.onDeleteOrExit,"delete":this.onDeleteOrExit,u:function(){e.onMarkUnread(!r.unreadCount)},right:function(){e.refs.cell.openContextMenu()}},r.isGroup&&(l.m=function(){e.onMute(!r.mute.isMuted)});break;case w.INFO:i||(i=r.isGroup?o.createElement(h,{presence:r.presence,groupMetadata:r.groupMetadata,location:"list"}):o.createElement(m,{presence:r.presence,location:"list"})),l={enter:this.onEnter}}return l={},o.createElement(N,{handlers:l,onFocus:this.indicateFocus,onBlur:this.onBlur,className:"chat-drag-cover",onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDrop:this.onDrop},o.createElement(s,{id:r.id,ref:"cell",className:a,contextEnabled:this.contextEnabled,pendingAction:this.state.pendingAction,contextMenu:this.state.contextMenu,primary:this.state.formattedTitle,primaryDetail:d,secondary:i,secondaryDetail:c,onClick:this.onClick,onContext:this.onMenu,onMouseDown:this.onMouseDown}))}});e.exports=P},790:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(158),i=o(n),s=r(344),a=o(s),d=r(6),c=r(30),l=r(104),u=r(77),p={COVER:"cover",SCALE_DOWN:"scaleDown"},h=d.createClass({displayName:"ObjectFit",mixins:[l],propTypes:{children:d.PropTypes.node.isRequired,type:d.PropTypes.oneOf(_.values(p)).isRequired,size:d.PropTypes.shape({width:d.PropTypes.number.isRequired,height:d.PropTypes.number.isRequired})},statics:{TYPES:p},getInitialState:function(){return{style:this.props.size,className:"object-fit",computed:!1}},componentDidMount:function(){if(!this.shouldUseNativeObjectFit()){this.initialize();var e=this;this.regNativeListener(window,"resize",function(){e.initialize()})}},componentWillReceiveProps:function(e){this.initialize(e)},initialize:function(e){this.shouldUseNativeObjectFit()||(e=e||this.props,e.size&&this.setState(this[e.type](e.size.width,e.size.height)))},shouldUseNativeObjectFit:function(){return!1},cover:function(e,t){var r=c.findDOMNode(this),o=r.clientWidth,n=r.clientHeight,i=e,s=t,a=0,d=0;return i!==o&&(s*=o/i,i=o,s>n&&(a=n/2-s/2)),n>s&&(i*=n/s,s=n,i>o&&(d=o/2-i/2)),{style:{width:i,height:s,top:a,left:d,position:"absolute"},className:"object-fit object-fit-cover",computed:!0}},scaleDown:function(e,t){var r=c.findDOMNode(this),o=r.clientWidth,n=r.clientHeight,i=t,s=e;return i>n&&(i=n,s=e*(n/t)),s>o&&(s=o,i=t*(o/e)),{style:{width:s,height:i},className:"object-fit object-fit-scaledown",computed:!0}},render:function(){var e=this.props,t=e.children,r=(e.size,e.type,e.className),o=(0,a["default"])(e,["children","size","type","className"]);if(this.shouldUseNativeObjectFit())return d.createElement("div",{className:"native-scale-down"},t);var n=u(this.state.className,r),s=this.state.computed?this.state.style:{visibility:"hidden"};return d.createElement("div",(0,i["default"])({},o,{className:n}),d.createElement("div",{style:s},t))}});e.exports=h},791:function(e,t,r){"use strict";var o=r(6),n=r(786),i=r(839),s=r(773),a=o.createClass({displayName:"AttachMediaFlow",mixins:[n],propTypes:{files:o.PropTypes.array,state:o.PropTypes.string,chat:o.PropTypes.instanceOf(s).isRequired},componentWillMount:function(){this.push(o.createElement(i,{files:this.props.files,state:this.props.state,onBack:this.endFlow,onSend:this.sendMedia}))},sendMedia:function(e){var t=this.props.chat;_.delay(function(){t.sendMedia(e)},300),this.endFlow()}});e.exports=a},792:function(e,t,r){"use strict";function o(){var e={value:null,set:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];e&&this.trigger(e,t?"focus":"select");var r=this.value;r&&!_.isEqual(r,e)&&this.trigger(r,!1),this.value=e},next:function(e){if(_.isEmpty(e))return null;var t=this.value;if(!t)return _.first(e);var r=_.findIndex(e,{id:t});return-1===r?_.first(e):r===e.length-1?_.last(e):e[r+1]},prev:function(e){if(_.isEmpty(e))return null;var t=this.value;if(!t)return _.first(e);var r=_.findIndex(e,{id:t});return-1===r?_.first(e):0===r?_.first(e):e[r-1]}};return n.createEmitter(e),e}var n=r(46);e.exports=o},793:function(e,t,r){"use strict";var o=r(6),n=r(836),i=r(837),s=r(865),a=r(105),d=r(9),c=r(346),l=r(78),u=r(157),p=r(77),h=o.createClass({displayName:"AdvancedInput",mixins:[u],propTypes:{id:o.PropTypes.string,editable:o.PropTypes.bool,value:o.PropTypes.string,maxLength:o.PropTypes.number,showRemaining:o.PropTypes.bool,selection:o.PropTypes.object,onEnter:o.PropTypes.func,onChange:o.PropTypes.func,onCancel:o.PropTypes.func,onSelectionChange:o.PropTypes.func,multiline:o.PropTypes.bool,placeholder:o.PropTypes.string,floating:o.PropTypes.bool,parent:o.PropTypes.object},getDefaultProps:function(){return{placeholder:"",floating:!0,multiline:!0,showRemaining:!1,editable:!1}},getInitialState:function(){return{active:!1}},componentDidMount:function(){this.regWithUIManager()},componentDidUpdate:function(e){!e.editable&&this.props.editable?this.regWithUIManager():e.editable&&!this.props.editable&&this.unregWithUIManager()},regWithUIManager:function(){this.props.id&&this.props.editable&&this.uimPush(this.props.parent||this,this.props.id,{popable:!0,maintainFocus:!0})},unregWithUIManager:function(){this.props.id&&this.uimPop(this.props.id),l.popDependents(this)},componentWillUnmount:function(){this.unregWithUIManager()},onEmoji:function(e){this.refs.inputLine.replaceSelection(e)},onFocus:function(){this.props.id&&l.stealFocus(this.props.id),this.setState({active:!0})},onBlur:function(){this.setState({active:!1})},restoreFocus:function(){this.refs.inputLine.restoreFocus()},onEmojiPicker:function(e){e&&(e.preventDefault(),e.stopPropagation());var t=o.createElement(i,{onEmoji:this.onEmoji});this.props.id&&this.regWithUIManager(),d.openContextMenu(t,{anchor:e.target,parent:this,menuDirection:{y:c.Direction.Y.TOP},type:c.Type.EMOJI_PICKER}),this.restoreFocus()},uimClose:function(){this.props.onCancel&&this.props.onCancel()},uimFocus:function(){this.restoreFocus()},focus:function(){this.restoreFocus()},preventBlur:function(e){e.preventDefault(),e.stopPropagation(),this.restoreFocus()},render:function(){var e=p("input-emoji input-advanced",{active:this.state.active,"static":!this.props.editable}),t=this.props.editable?o.createElement("button",{className:"icon icon-emoji-input",onClick:this.onEmojiPicker}):null,r=this.props.floating?this.props.placeholder:void 0,i=this.props.value||this.props.floating?void 0:this.props.placeholder;return o.createElement("div",{className:e,onMouseDown:this.preventBlur},o.createElement(s,{placeholder:r,hasText:!!this.props.value},o.createElement("div",{className:"input-main"},o.createElement(n,{ref:"inputLine",value:this.props.value,className:"input-line",placeholder:i,onChange:this.props.onChange,onEnter:this.props.onEnter,editable:this.props.editable,maxLength:this.props.maxLength,showRemaining:this.props.showRemaining,onFocus:this.onFocus,onBlur:this.onBlur}),o.createElement(a,{transitionName:"pop",className:"btn-input"},t))))}});e.exports=h},794:function(e,t,r){"use strict";var o=r(6),n=r(30),i=r(154),s=r(78),a=r(157),d=r(105),c=o.createClass({displayName:"ChatlistSearch",mixins:[i,a],propTypes:{searchText:o.PropTypes.string.isRequired,searchType:o.PropTypes.oneOf([s.CHAT_SEARCH,s.CONTACT_SEARCH]).isRequired,onSearch:o.PropTypes.func.isRequired,placeholder:o.PropTypes.string},getInitialState:function(){return{isSearching:!1}},componentWillUnmount:function(){this.onCancel()},componentWillReceiveProps:function(e){this.state.isSearching&&(e.searchText||n.findDOMNode(this).contains(document.activeElement)||this.setState({isSearching:!1}))},onBlur:function(e){this.props.searchText||this.onCancel()},onChange:function(e){this.props.onSearch(e.target.value)},onCancel:function(e){this.uimPop(this.props.searchType)},onReset:function(e){e.stopPropagation(),this.focus(),this.props.onSearch("")},onSearchOn:function(e){this.setState({isSearching:!0}),this.uimPush(this,this.props.searchType,{escapable:!0}),this.safeDefer(function(){this.refs.input.focus()})},focus:function(){this.refs.input.focus()},uimFocus:function(){this.focus()},uimClose:function(){this.safeIsMounted()&&(this.refs.input.blur(),this.props.onSearch(""),this.setState({isSearching:!1}))},render:function(){var e="pane-subheader pane-list-subheader subheader-search";this.state.isSearching&&(e+=" active");var t=null;this.state.isSearching&&(_.isEmpty(this.props.searchText)||(t=o.createElement("button",{className:"icon icon-x-alt",key:"icon-clear-search",onClick:this.onReset})));var r=this.props.placeholder||l10n.t("search_or_start_new_chat"),n=this.state.isSearching?this.onCancel:this.onSearchOn;return o.createElement("div",{className:e},o.createElement("button",{className:"icon icon-search-morph",onMouseDown:n},o.createElement("div",{className:"icon icon-back-blue"}),o.createElement("div",{className:"icon icon-search"})),o.createElement(d,{transitionName:"pop"},t),o.createElement("div",{className:"input-placeholder"},r),o.createElement("label",{htmlFor:"input-chatlist-search",className:"cont-input-search"},o.createElement("input",{type:"text",ref:"input",className:"input input-search","data-tab":2,dir:"auto",title:r,value:this.props.searchText,onBlur:this.onBlur,onFocus:this.state.isSearching?null:this.onSearchOn,onChange:this.onChange})))}});e.exports=c},795:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(158),i=o(n),s=r(344),a=o(s),d=r(3),c=o(d),l=r(6),u=r(106),p=r(14),h=r(103),m=r(36),f=r(107),g=r(11),v=r(41),y=r(81),E=r(8),T=10,b=l.createClass({displayName:"ImageTag",mixins:[h],propTypes:{hasPrivacyChecks:l.PropTypes.bool},getInitialState:function(){var e=new Image;return e.src=this.props.src,e.complete?{src:this.props.src}:(this.ensureLoaded(this.props.src),{src:null})},componentWillReceiveProps:function(e){this.props.src!==e.src&&this.ensureLoaded(e.src)},componentWillUnmount:function(){this.ensureLoadedPromise&&this.ensureLoadedPromise.cancel()},ensureLoaded:function(e){var t=this;this.ensureLoadedPromise&&this.ensureLoadedPromise.cancel(),this.ensureLoadedPromise=m.loopOnError(g.ShouldLoop,c["default"].TimeoutError,function(r){if(r>=T)throw new g.ImageError("Too many image retries",e);var o;return o=t.props.hasPrivacyChecks&&!u.phoneActive&&r>0?m.waitForBBEvent(u,"change:phoneActive",_.matches({phoneActive:!0})):p.state===p.STATE.CONNECTED?c["default"].delay(Math.floor(1e3*y.expBackoff(r,60,void 0,.1))):m.waitForBBEvent(p,"change:state",_.matches({state:p.STATE.CONNECTED})),r>0&&v.isHttp(e)&&(o=o.then(function(){return new c["default"](function(r,o){f.get(e).then(function(n){var i=n.status;i>=200&&400>i?r():i>=500?o(new g.ShouldLoop):(t.props.onError(i),o(new g.ImageError("Image error: "+i,e)))})["catch"](function(e){o(new g.ShouldLoop)})})}).timeout(3e4,"imageTagRetryTimeout")),o.then(function(){return new c["default"](function(t,r){var o=function(t){r(v.isHttp(e)?new g.ShouldLoop:new g.ImageError("Invalid Data URI",e))},n=new Image;n.onload=function(){t(e)},n.onerror=o,n.src=e})}).then(function(e){t.isMounted()&&t.setState({src:e})})})["finally"](function(){delete t.ensureLoadedPromise})["catch"](c["default"].CancellationError,_.noop)["catch"](g.ImageError,this.props.onError||_.noop)},render:function(){var e,t,r=this.props,o=(r.src,r.onLoad,(0,a["default"])(r,["src","onLoad"]));return this.state.src?(t=this.state.src,e=this.props.onLoad):(t=E.ONE_BY_ONE_TRANS_GIF,e=null),l.createElement("img",(0,i["default"])({src:t,onLoad:e},o))}});e.exports=b},796:function(e,t,r){"use strict";var o=r(6),n=r(781),i=r(155),s=o.createClass({displayName:"Pending",render:function(){return o.createElement("div",{className:"media-state-controls"},o.createElement("button",{className:"icon-xl icon-media icon-media-disabled"},o.createElement(i,{size:50,stroke:3})))}}),a=o.createClass({displayName:"PendingCancel",render:function(){return o.createElement("div",{className:"media-state-controls"},o.createElement("button",{className:"icon-xl icon-media-cancel"},o.createElement(i,{size:50,stroke:3})))}}),d=o.createClass({displayName:"Cancel",render:function(){return o.createElement("div",{className:"media-state-controls"},o.createElement("button",{className:"icon-xl icon-media-download"}))}}),c=o.createClass({displayName:"Download",propTypes:{filesize:o.PropTypes.number.isRequired},render:function(){return o.createElement("div",{className:"media-state-controls"},o.createElement("button",{className:"btn-meta"},o.createElement("span",{className:"icon-xl icon-media-download-noborder"}),o.createElement(n,null,this.props.filesize>0?l10n.filesize(this.props.filesize):null)))}}),l=o.createClass({displayName:"Upload",propTypes:{filesize:o.PropTypes.number.isRequired},render:function(){return o.createElement("div",{className:"media-state-controls"},o.createElement("button",{className:"btn-meta"},o.createElement("span",{className:"icon-xl icon-media-upload-noborder"}),o.createElement(n,null,this.props.filesize>0?l10n.filesize(this.props.filesize):null)))}}),u=o.createClass({displayName:"Play",render:function(){return o.createElement("div",{className:"media-state-controls"},o.createElement("button",{className:"icon-xl icon-media-play"}))}}),p=o.createClass({displayName:"Missing",render:function(){var e;switch(this.props.msg.type){case"image":e=l10n.t("missing_photo_title");break;case"video":e=l10n.t("missing_video_title");break;case"audio":e=l10n.t("missing_audio_title")}return o.createElement("div",{className:"media-state-controls"},o.createElement("button",{className:"btn-meta missing-text"},e))}});e.exports={Pending:s,Cancel:d,PendingCancel:a,Download:c,Upload:l,Play:u,Missing:p}},797:function(e,t,r){"use strict";var o=r(6),n=r(8),i=r(341),s=r(9),a=r(45),d={GUIDE_ALLOW:"guide-allow",GUIDE_UNBLOCK:"guide-unblock",GUIDE_NONE:"guide-none"},c={CHROME_MEDIA_ERROR:"__chrome_media_error__",FIREFOX_LOCK:"__firefox_lock__",OPERA_MEDIA:"__opera_media__"},l=o.createClass({displayName:"GuidePopup",propTypes:{title:o.PropTypes.string.isRequired,desc:o.PropTypes.string.isRequired,browserPrefixDesc:o.PropTypes.bool.isRequired,type:o.PropTypes.oneOf(_.values(d)).isRequired,onConfirm:o.PropTypes.func,onCancel:o.PropTypes.func},statics:{TYPE:d},getDefaultProps:function(){return{browserPrefixDesc:!0,type:d.GUIDE_NONE,onConfirm:s.closeModal.bind(s)}},componentDidMount:function(){var e=this.getDescription(),t=this.refs.description;e.indexOf(c.CHROME_MEDIA_ERROR)>-1&&(t.innerHTML=t.innerHTML.replace(c.CHROME_MEDIA_ERROR,'<span class="chrome-media-icon"></span>')),e.indexOf(c.FIREFOX_LOCK)>-1&&(t.innerHTML=t.innerHTML.replace(c.FIREFOX_LOCK,'<span class="firefox-lock-icon"></span>')),e.indexOf(c.OPERA_MEDIA)>-1&&(t.innerHTML=t.innerHTML.replace(c.OPERA_MEDIA,'<span class="opera-media-icon"></span>'))},getDescription:function(){var e=this.props.desc+"_"+a.browser;return this.props.browserPrefixDesc&&l10n.hasT(e)?l10n.t(e):l10n.t(this.props.desc)},render:function(){var e="popup-guide";if(a.browser===n.BROWSER_TYPE.CHROME)switch(a.os){case n.OS_TYPE.MAC:e+=" popup-guide-mac";break;case n.OS_TYPE.CHROMEOS:e+=" popup-guide-chrome";break;case n.OS_TYPE.WINDOWS:}var t=null;this.props.type!==d.GUIDE_NONE&&a.browser===n.BROWSER_TYPE.CHROME&&(t=o.createElement("div",{className:"round"},o.createElement("div",{className:"round-body "+this.props.type})));var r=this.props.onCancel?l10n.t("learn_more"):void 0;return o.createElement(i,{title:l10n.t(this.props.title),classes:e,onOK:this.props.onConfirm,okText:l10n.t("ok_got_it"),onCancel:this.props.onCancel,cancelText:r},t,o.createElement("div",{className:"text text-tip",ref:"description"},this.getDescription()))}});e.exports=l},798:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(344),i=o(n),s=r(6),a=r(795),d=r(783),c=r(772),l=r(790),u=r(156),p=r(9),h=r(78),m=r(157),f=r(770),g=r(77),v=500,y=s.createClass({displayName:"PhotoViewerModal",mixins:[f,m],propTypes:{contact:s.PropTypes.instanceOf(u),imgFull:s.PropTypes.string,animateBorderRadius:s.PropTypes.bool,getZoomNode:s.PropTypes.func.isRequired},getInitialState:function(){return{formattedUser:this.async("contact.formattedUser"),imgFull:this.props.imgFull||this.async("contact.profilePicThumb.imgFull"),style:{visibility:"hidden"}}},componentWillMount:function(){this.uimPush(this,h.MEDIA_VIEWER,{popable:!0})},uimClose:function(){var e=void 0;if(this.props.getZoomNode(function(t){e=t}),!e)return p.closeModal();var t=this.refs.image,r=t.getBoundingClientRect(),o=e.getBoundingClientRect(),n=o.top-r.top,i=o.left-r.left,s=e.clientWidth/t.clientWidth;Velocity(t,{translateX:[i,0],translateY:[n,0],scale:[s,1]},{duration:200,easing:[.1,.82,.25,1]}).then(function(){p.closeModal()})},onClose:function(){h.find(h.MEDIA_VIEWER)&&this.uimPop(h.MEDIA_VIEWER)},onImageLoad:function(e){var t=this,r=e.target;this.setState({size:{width:r.naturalWidth,height:r.naturalHeight}},function(){t.props.getZoomNode(function(e){var o=r.getBoundingClientRect(),n=e.getBoundingClientRect(),i=n.top-o.top,s=n.left-o.left,a=e.clientWidth/r.clientWidth,d={visibility:"hidden",transform:"translateX("+s+"px) translateY("+i+"px) scale("+a+")",transition:"transform 0s"};t.props.animateBorderRadius&&(d.borderRadius="50%"),t.setState({style:d},function(){var e={transform:"translateX(0px) translateY(0px) scale(1)",transition:"transform "+v+"ms cubic-bezier(.1,.82,.25,1)"};t.props.animateBorderRadius&&(e={transform:"translateX(0px) translateY(0px) scale(1)",borderRadius:"0%",transition:"transform "+v+"ms cubic-bezier(.1,.82,.25,1),\n                                         border-radius "+v+"ms cubic-bezier(.1,.82,.25,1)"}),t.setState({style:e})})})})},render:function(){var e=this.props,t=e.contact,r=((0,i["default"])(e,["contact"]),g("media-viewer","media-viewer-animate"));return s.createElement("div",{className:r,onWheel:this.onScroll,onClick:this.onClose},s.createElement("div",{className:"media-panel-header"},s.createElement("div",{className:"chat media-chat"},s.createElement("div",{className:"chat-avatar"},s.createElement(d,{id:t.id})),s.createElement("div",{className:"chat-body"},s.createElement("div",{className:"chat-main"},s.createElement(c,{text:this.state.formattedUser})))),s.createElement("div",{className:"menu menu-horizontal media-panel-tools"},s.createElement("div",{className:"menu-item"},s.createElement("button",{className:"icon icon-x-viewer",title:l10n.t("web_close"),onClick:this.onClose},l10n.t("web_close"))))),s.createElement("div",{className:"media-content",dir:"ltr",ref:"container"},s.createElement("div",{className:"media"},s.createElement(l,{type:l.TYPES.SCALE_DOWN,size:this.state.size},s.createElement("div",{className:"profile-viewer",ref:"image",style:this.state.style},s.createElement(a,{src:this.state.imgFull,hasPrivacyChecks:!0,onLoad:this.onImageLoad,className:"profile-viewer-img"}))))))}});e.exports=y},799:function(e,t,r){"use strict";var o=r(6),n=r(341),i=r(771),s=r(9),a=o.createClass({displayName:"RemoteUpload",propTypes:{msg:o.PropTypes.instanceOf(i).isRequired},render:function(){var e,t;switch(this.props.msg.type){case i.TYPE.IMAGE:e=l10n.t("retry_upload_photo_title"),t=l10n.t("retry_upload_photo_text");break;case i.TYPE.VIDEO:e=l10n.t("retry_upload_video_title"),t=l10n.t("retry_upload_video_text");break;case i.TYPE.AUDIO:case i.TYPE.PTT:e=l10n.t("retry_upload_audio_title"),t=l10n.t("retry_upload_audio_text")}return o.createElement(n,{title:e,onOK:s.closeModal.bind(s),okText:l10n.t("web_ok")},t)}});e.exports=a},800:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(8),a=r(1),d=r(21),c=r(59),l=r(347),u=r(35),p=r(153),h=1500,m=2e3,f=c.extend({props:{id:"string",type:{type:"string",values:["available","unavailable","composing","recording"]},t:{type:"number",allowNull:!0},deny:"boolean"},session:{updateTime:"number",_expireTimerId:0}}),g=l.extend({model:f}),v=c.extend({Collection:"Presence",props:{id:"string"},session:{isOnline:"boolean",stale:["boolean",!1,!0],hasData:["boolean",!1,!1],isSubscribed:["boolean",!1,!1],withholdDisplay:["boolean",!1,!0],forceDisplay:["boolean",!1,!1],chatActive:["boolean",!1,!1],withholdDisplayTimer:"number",forceDisplayTimer:"number"},children:{chatstate:f},collections:{chatstates:g},derived:{isGroup:{fn:function(){return d.isGroup(this.id)}},isUser:{fn:function(){return d.isUser(this.id)}}},initialize:function(){this.isGroup?(this.chatstate.set({id:"",type:"unavailable"}),this.listenTo(this.chatstates,"add change",function(){var e,t=!1;
this.chatstates.forEach(function(r){"composing"!==r.type&&"recording"!==r.type||e&&!(e.updateTime<r.updateTime)||(e=r),t=t||"unavailable"!==r.type}),this.set({isOnline:t,chatstate:{id:e?e.id:"",type:e?e.type:"unavailable"}})})):(this.chatstate.set({id:this.id}),this.listenTo(this.chatstate,"change:type",function(){this.isOnline="unavailable"!==this.chatstate.type})),this.listenTo(this,"change:chatActive",this.onChatActiveChange)},"delete":function(){c.prototype["delete"].call(this),Store.Presence.remove(this.id),this.chatstate["delete"](),this.chatstates.forEach(function(e){e["delete"]()})},handle:function(e){"undefined"==typeof e.type?e.type=this.chatstate.type||"unavailable":"paused"===e.type&&(e.type="available"),this.isGroup&&"available"!==e.type&&(e.updateTime=Date.now());var t;if(this.isGroup){if(e.id=e.participant,e.participant=void 0,!e.id)return;t=this.chatstates.add(e,{merge:!0})}else t=this.chatstate.set(e);t._expireTimerId&&clearTimeout(t._expireTimerId),"composing"===t.type||"recording"===t.type?t._expireTimerId=_.delay(this._expireComposing,s.PRESENCE_COMPOSING_TIMEOUT,t):t._expireTimerId=0;var r=this.forceDisplay||this.isOnline||this.isUser&&!this.chatstate.deny;this.set({hasData:!0,forceDisplay:r})},_expireComposing:function(e){var t=e.type;"composing"===t||"recording"===t?e.type="available":a.error("models:presence:expireComposing "+t)()},reset:function(){this.hasData=!1,this.isGroup?this.chatstates.forEach(function(e){e.type="unavailable"}):this.isUser&&(this.chatstate.unset("t"),this.chatstate.unset("deny")),this.chatstate.set({id:this.isGroup?"":this.id,type:"unavailable",t:void 0,deny:void 0})},isActive:function(){var e=this.chatstate.type;return this.hasData&&("composing"===e||"recording"===e)},getFormattedString:function(){if(!this.hasData)return null;if(this.isGroup){var e=this.chatstate.id;if(!e)return null;var t=Store.Contact.get(e);if(!t)return null;var r=t.formattedShortName;return"composing"===this.chatstate.type?l10n.t("web_conversation_name_is_composing",{participant:r}):l10n.t("web_conversation_name_is_recording",{participant:r})}if(!this.isUser)return null;var o=this.chatstate;switch(o.type){case"available":return l10n.t("web_conversation_contact_online");case"composing":return l10n.t("web_conversation_is_composing");case"recording":return l10n.t("web_conversation_is_recording");case"unavailable":return o.deny||!o.t?null:p.lastSeenStr(o.t)}},onChatActiveChange:function(){var e=this.chatActive;e?(this.hasData?this.withholdDisplay=!1:this.withholdDisplayTimer=_.delay(function(e){e.set({withholdDisplay:!1,withholdDisplayTimer:0})},h,this),this.forceDisplayTimer=_.delay(function(e){e.set({forceDisplay:!0,forceDisplayTimer:0})},m,this)):(this.withholdDisplayTimer&&(clearTimeout(this.withholdDisplayTimer),this.withholdDisplayTimer=0),this.forceDisplayTimer&&(clearTimeout(this.forceDisplayTimer),this.forceDisplayTimer=0))},subscribe:function(){return this.isSubscribed?i["default"].resolve():this.isUser?this.update():this.isGroup?(this.isSubscribed=!0,i["default"].join(this.update(),u.presenceSubscribe(this.id),_.noop).bind(this)["catch"](function(e){return this.isSubscribed=!1,i["default"].reject(e)})):i["default"].resolve()}});e.exports=v},801:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(1),a=r(8),d=r(812),c=r(41),l={fileToCanvas:function(e,t,r,o){var n,i,s=l.typeFromMimetype(e.type),a=document.createElement("canvas");"image"===s?(n=new Image,i=function(e){n.onload=e}):"video"===s&&(n=document.createElement("video"),i=function(e){n.addEventListener("seeked",e),n.addEventListener("loadeddata",function(){var e=n.seekable.end(0);n.currentTime=~~(e/2)})});var c=function(){var e=d.boundHeightWidth(n.height,n.width,r,t);a.width=e.width,a.height=e.height;var i=a.getContext("2d");i.drawImage(n,0,0,e.width,e.height),URL.revokeObjectURL(n.src),o&&o(a)};i(c),n.src=URL.createObjectURL(e)},fileToBlobs:function(e){var t=this;return new i["default"](function(r){var o=t.typeFromMimetype(e.type);"image"===o?t.fileToCanvas(e,a.IMG_MAX_EDGE,a.IMG_MAX_EDGE,function(e){var t=e.toDataURL("image/jpeg"),o=window.dataURLtoBlob(t);r({dataUrl:t,blob:o,h:e.height,w:e.width})}):("video"===o||"audio"===o)&&r({dataUrl:URL.createObjectURL(e),blob:e})})},fileToAudio:function(e,t){var r=document.createElement("audio");t&&r.addEventListener("loadeddata",function(){t(r)}),r.src=URL.createObjectURL(e)},fileToVideo:function(e,t){var r=document.createElement("video");t&&r.addEventListener("loadeddata",function(){t(r)}),r.src=URL.createObjectURL(e)},getHash:function(e,t,r){return new i["default"](function(o){var n,i;if("image"===e){var a=c.parseDataURL(t);n=CryptoJS.enc.Base64.parse(a.data),i=CryptoJS.SHA256(n),o({hash:i.toString(CryptoJS.enc.Base64),size:n.sigBytes})}else if("video"===e||"audio"===e){var d=new FileReader;d.onload=function(e){n=CryptoJS.enc.Latin1.parse(e.target.result),i=CryptoJS.SHA256(n),o({hash:i.toString(CryptoJS.enc.Base64),size:n.sigBytes})},d.onerror=function(e){s.log("wa:getHash:filereader error: "+e)()},d.readAsBinaryString(r)}})},getFileDuration:function(e){var t=this;return new i["default"](function(r){var o=t.typeFromMimetype(e.type);"image"===o?r(void 0):"video"===o?t.fileToVideo(e,function(e){r(~~e.seekable.end(0)),URL.revokeObjectURL(e.src)}):"audio"===o&&t.fileToAudio(e,function(e){r(~~e.seekable.end(0)),URL.revokeObjectURL(e.src)})})},typeFromMimetype:function(e){return e.split("/")[0]}};e.exports=l},802:function(e,t,r){"use strict";function o(e,t){var r,o,n="";if("create"===e){var i=parseInt(t,10);n=l10n.t("web_you_created_list_unnamed",{count:i,_plural:i})}else"add"===e?(r=Store.Contact.get(t),o=r?r.get("name"):"",o=o?o:d.formattedUser(t),n=l10n.t("web_list_recipient_added",{name:o})):"remove"===e&&(r=Store.Contact.get(t),o=r?r.get("name"):"",o=o?o:d.formattedUser(t),n=l10n.t("web_list_recipient_removed",{name:o}));return n}function n(e){var t,r,o="",n=e.get("type"),s=e.get("subtype"),a=e.displayName(),c=e.get("author"),l=e.get("body");if("group_notification"===n)switch(s){case"add":o=c===Store.Conn.me?l10n.t("web_group_participant_added_you"):l10n.t("web_group_participant_added_name",{name:a});break;case"remove":o=c===Store.Conn.me?l10n.t("web_group_participant_removed_you"):l10n.t("web_group_participant_removed_name",{name:a});break;case"leave":o=c===Store.Conn.me?l10n.t("web_group_participant_left_you"):l10n.t("web_group_participant_left_name",{name:a});break;case"picture":o="remove"===l?c===Store.Conn.me?l10n.t("web_photo_removed_by_you"):l10n.t("web_photo_removed_by",{name:a}):c===Store.Conn.me?l10n.t("web_photo_changed_by_you"):l10n.t("web_photo_changed_by",{name:a});break;case"subject":o=c===Store.Conn.me?l10n.t("web_group_subject_changed_by_you",{subject:l}):l10n.t("web_group_subject_changed_by_name",{name:a,subject:l});break;case"modify":t=d.formattedUser(e.get("author")),r=d.formattedUser(l),o=t===a?l10n.t("web_group_participant_changed_number_unknown_name",{name:a,new_number:r}):l10n.t("web_group_participant_changed_number",{name:a,old_number:t,new_number:r});break;default:i.log("wa:formatGroupNotification:unknown message subtype: "+s)()}else if("gp2"===n){var u,p=e.recipients,h=p?p.map(function(e){var t=Store.Contact.get(e);return t?t.get("formattedName"):d.formattedUser(e)}).join(l10n.t("enumeration_comma")):"",m=p?_.first(p):"",f=Store.Contact.get(m),g=f?f.get("formattedName"):m?d.formattedUser(m):"";switch(s){case"add":o=c?c===Store.Conn.me?l10n.t("web_group_participants_you_added_names",{participants:h}):m===Store.Conn.me?l10n.t("web_group_participants_name_added_you",{name:a}):l10n.t("web_group_participants_name_added_names",{name:a,participants:h}):m===Store.Conn.me?l10n.t("web_group_participant_added_you"):l10n.t("web_group_participant_added_name",{name:g});break;case"remove":o=c?c===Store.Conn.me?l10n.t("web_group_participants_you_removed_names",{participants:h}):m===Store.Conn.me?l10n.t("web_group_participants_name_removed_you",{name:a}):l10n.t("web_group_participants_name_removed_names",{name:a,participants:h}):m===Store.Conn.me?l10n.t("web_group_participant_removed_you"):l10n.t("web_group_participant_removed_name",{name:g});break;case"leave":o=m===Store.Conn.me?l10n.t("web_group_participant_left_you"):l10n.t("web_group_participant_left_name",{name:h});break;case"picture":o="remove"===l?c===Store.Conn.me?l10n.t("web_photo_removed_by_you"):l10n.t("web_photo_removed_by",{name:a}):c===Store.Conn.me?l10n.t("web_photo_changed_by_you"):l10n.t("web_photo_changed_by",{name:a});break;case"subject":o=c===Store.Conn.me?l10n.t("web_group_subject_changed_by_you",{subject:l}):l10n.t("web_group_subject_changed_by_name",{name:a,subject:l});break;case"modify":t=d.formattedUser(c),r=d.formattedUser(m),o=t===a?l10n.t("web_group_participant_changed_number_unknown_name",{name:a,new_number:r}):l10n.t("web_group_participant_changed_number",{name:a,old_number:t,new_number:r});break;case"create":o=c===Store.Conn.me?l?l10n.t("web_group_created_by_you",{subject:l}):l10n.t("web_group_created_by_you_no_subject"):l?l10n.t("web_group_created_by_name",{name:a,subject:l}):l10n.t("web_group_created_by_name_no_subject",{name:a});break;case"delete":o=c===Store.Conn.me?l10n.t("web_group_ended_you"):l10n.t("web_group_ended_name",{name:a});break;case"promote":u=p.length,o=1===u&&m===Store.Conn.me?l10n.t("web_group_participant_promoted_you"):l10n.t("web_group_participant_promoted_names",{count:u,participants:h,_plural:u});break;case"demote":u=p.length,o=1===u&&m===Store.Conn.me?l10n.t("web_group_participant_demoted_you"):l10n.t("web_group_participant_demoted_names",{count:u,participants:h,_plural:u});break;default:i.log("wa:formatGroupNotification:unknown message subtype: "+s)()}}return l10n.isRTL()&&(o=l10n.forceRTL(o)),o}var i=r(1),s=r(45),a=r(153),d=r(21),c=r(771).TYPE;e.exports={formatBroadcastNotification:o,formatGroupNotification:n,asDesktopNotification:function(e){var t,r,i,d,l="";switch(e.from!==Store.Conn.me&&e.isGroupMsg&&(l=e.displayName()),e.type){case c.CHAT:t=e.body;break;case c.IMAGE:i=s.hasEmoji?" ":"",t=i+(e.caption||l10n.t("web_conversations_most_recent_image"));break;case c.VIDEO:i=s.hasEmoji?" ":"",d=e.caption||l10n.t("web_conversations_most_recent_video"),t=i+" "+d+" ("+a.durationStr(e.duration)+")";break;case c.PTT:i=s.hasEmoji?" ":"",t=i+" "+l10n.t("web_conversations_most_recent_voice")+" ("+a.durationStr(e.duration)+")";break;case c.AUDIO:i=s.hasEmoji?" ":"",t=i+" "+l10n.t("web_conversations_most_recent_audio")+" ("+a.durationStr(e.duration)+")";break;case c.LOCATION:i=s.hasEmoji?" ":"",t=i+(e.loc||l10n.t("web_conversations_most_recent_location"));break;case c.GROUP_NOTIFICATION:case c.GP2:t=n(e),l="";break;case c.BROADCAST_NOTIFICATION:r=e.subtype;var u=e.body;t=o(r,u);break;case c.NOTIFICATION:t=e.body;break;case c.VCARD:i=s.hasEmoji?" ":"",t=i+(e.subType||l10n.t("web_conversations_most_recent_contact"));break;default:t=""}return(l?l+": ":"")+t},msgText:function(e){switch(e.type){case c.CHAT:return e.body;case c.IMAGE:return e.caption?e.caption:l10n.t("web_conversations_most_recent_image");case c.VIDEO:return e.caption?e.caption:l10n.t("web_conversations_most_recent_video");case c.PTT:return a.durationStr(e.duration);case c.AUDIO:return l10n.t("web_conversations_most_recent_audio");case c.LOCATION:return e.loc||l10n.t("web_conversations_most_recent_location");case c.GROUP_NOTIFICATION:case c.GP2:return n(e);case c.BROADCAST_NOTIFICATION:return o(e.subtype,e.body);case c.NOTIFICATION:return e.body;case c.VCARD:return l10n.t("web_conversations_most_recent_contact");case c.DOCUMENT:return" "+e.caption+" "+l10n.t("web_conversations_most_recent_document",{count:e.pageCount,_plural:e.pageCount});default:return""}}}},803:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(695),a=r(812),d={readFile:function(e){return new i["default"](function(t,r){var o=new FileReader;o.readAsDataURL(e),o.onload=function(r){return t({file:e,url:this.result})},o.onabort=function(e){return r("onabort",e)},o.onerror=function(e){return r("onerror",e)}})},generateVideoThumb:function(e,t,r){return new i["default"](function(o,n){var i=document.createElement("video");i.autoplay=!1,i.loop=!1,i.onloadeddata=function(){var e=document.createElement("canvas"),n=d.boundWidthHeight(i.videoWidth,i.videoHeight,t,r);e.width=n.width,e.height=n.height;var s=e.getContext("2d");return s.drawImage(i,0,0,n.width,n.height),o({url:e.toDataURL("image/jpeg"),width:n.width,height:n.height})},i.onerror=function(e){n(e)},i.src=e,i.load()})},resizeAndOrient:function(e,t,r){return new i["default"](function(o,n){if(!e.type.match("image.*"))return n("Invalid image file",e);var i=new FileReader,a=new Image;i.onload=function(){s(this.result,function(e){a.src=e})},a.onload=function(){if(0===this.width||0===this.height)return n("Invalid image",a);var e=document.createElement("canvas"),i=d.boundWidthHeight(a.width,a.height,t,r);e.width=i.width,e.height=i.height;var s=e.getContext("2d");return s.drawImage(a,0,0,i.width,i.height),o({url:e.toDataURL("image/jpeg"),width:i.width,height:i.height})};var c=function(e){return n("onabort",e)},l=function(e){return n("onerror",e)};i.onabort=c,i.onerror=l,a.onabort=c,a.onerror=l,i.readAsDataURL(e)})},crop:function(e,t,r,o,n,s,a){return new i["default"](function(i,d){var c=document.createElement("canvas"),l=c.getContext("2d"),u=new Image;u.onload=function(){return s&&a?(c.height=a,c.width=s,l.drawImage(u,t,r,o,n,0,0,s,a)):(c.height=n,c.width=o,l.drawImage(u,t,r,o,n)),i({url:c.toDataURL("image/jpeg"),width:o,height:n})};var p=function(e){return d("onabort",e)},h=function(e){return d("onerror",e)};0!==e.indexOf("data:")&&u.setAttribute("crossOrigin","anonymous"),u.onabort=p,u.onerror=h,u.src=e})},boundWidthHeight:function(e,t,r,o){return e=e||r,t=t||o,e>t?e>r&&(t*=r/e,e=r):t>o&&(e*=o/t,t=o),{width:e,height:t}},resizeDataURI:function(e,t,r){return new i["default"](function(o,n){var i=new Image;i.onload=function(){var e=document.createElement("canvas"),n=a.boundHeightWidth(i.height,i.width,r,t);e.width=n.width,e.height=n.height;var s=e.getContext("2d");s.drawImage(i,0,0,n.width,n.height),o(e.toDataURL("image/jpeg"))},i.onerror=n,i.src=e})}};e.exports=d},804:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(158),i=o(n),s=r(344),a=o(s),d=r(6),c=r(783),l=r(772),u=r(155),p=r(78),h=r(770),m=r(687),f=r(105),g=r(77),v=d.createClass({displayName:"Cell",mixins:[h,m],propTypes:{id:d.PropTypes.string.isRequired,contextEnabled:d.PropTypes.func.isRequired,pendingAction:d.PropTypes.number,contextMenu:d.PropTypes.bool,detail:d.PropTypes.node,primary:d.PropTypes.string.isRequired,primaryDetail:d.PropTypes.node,secondary:d.PropTypes.node,secondaryDetail:d.PropTypes.node,onClick:d.PropTypes.func,onContext:d.PropTypes.func},getInitialState:function(){return{hover:!1,contextMenu:!1}},componentWillUpdate:function(e){this.props.contextMenu&&this.state.contextMenu&&!e.contextMenu&&this.setState({contextMenu:!1})},onMenuClick:function(e){this.props.contextEnabled()&&(e.stopPropagation(),e.preventDefault(),this.props.onContext({anchor:e.target}))},onContextMenu:function(e){this.props.contextEnabled()&&(e.stopPropagation(),e.preventDefault(),this.props.onContext({event:e}))},openContextMenu:function(){var e=this;this.props.contextEnabled()&&this.setState({contextMenu:!0},function(){e.refs.context.click()})},mouseOver:function(){this.state.hover||this.props.contextMenu||!this.props.contextEnabled()||this.setState({hover:!0})},mouseEnter:function(){this.state.hover||this.props.contextMenu||!this.props.contextEnabled()||this.setState({hover:!0})},mouseLeave:function(){this.state.hover&&this.setState({hover:!1})},render:function(){var e=this.props,t=e.id,r=e.contextEnabled,o=e.className,n=e.pendingAction,s=e.detail,h=e.primary,m=e.primaryDetail,v=e.secondary,y=e.secondaryDetail,E=e.onClick,_=e.onContext,T=(0,a["default"])(e,["id","contextEnabled","className","pendingAction","detail","primary","primaryDetail","secondary","secondaryDetail","onClick","onContext"]),b=this.props.contextMenu||this.state.contextMenu,S=b||this.state.hover,C=g(o,{chat:!0,hover:S}),M=null,N=null;return n?N=d.createElement("div",{className:"btn-context icon-spinner"},d.createElement(u,{size:18,stroke:6})):S&&(M=d.createElement("span",{className:"icon icon-down btn-context",key:"icon-context",ref:"context","data-ignore-capture":_?p.IGNORE_CONTEXT:p.IGNORE_ANY,onClick:this.onMenuClick})),s&&(s=d.createElement("div",{className:"chat-body chat-detail"},s)),d.createElement("div",(0,i["default"])({className:C,"data-ignore-capture":p.IGNORE_ANY,onClick:E,onContextMenu:r()?this.onContextMenu:null,onMouseEnter:this.state.hover?null:this.mouseEnter,onMouseOver:this.state.hover?null:this.mouseOver,onMouseLeave:this.state.hover?this.mouseLeave:null},T),d.createElement("div",{className:"chat-avatar"},d.createElement(c,{id:t})),d.createElement("div",{className:"chat-body"},d.createElement("div",{className:"chat-main"},d.createElement("div",{className:"chat-title"},d.createElement(l,{text:h,direction:"auto",titlify:!0,ellipsify:!0})),m),d.createElement("div",{className:"chat-secondary"},v,d.createElement("div",{className:"chat-meta"},y,d.createElement(f,{transitionName:"pop"},N),d.createElement(f,{transitionName:"pop-fast"},this.state.hover?M:null),b&&!this.state.hover?M:null))),s)}});e.exports=v},805:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(6),a=r(30),d=r(1),c=r(346),l=r(777),u=r(869),p=r(798),h=r(790),m=r(795),f=r(803),g=r(345),v=r(864),y=r(155),E=r(341),T=r(78),b=r(9),S=r(8),C=r(77),M=r(105),N=200,w=1.3,P=2,R={GROUP:"group",PROFILE:"profile",NO_EDIT:"no_edit"},k=s.createClass({displayName:"PhotoPicker",propTypes:{startImage:s.PropTypes.string,type:s.PropTypes.oneOf(_.values(R)).isRequired,id:s.PropTypes.string,pending:s.PropTypes.bool,onImageSet:s.PropTypes.func.isRequired},statics:{Type:R},getInitialState:function(){return{img:this.props.startImage,left:0,top:0,isEditing:!1,hover:!1,contextActive:!1}},componentWillReceiveProps:function(e){this.props.startImage!==e.startImage&&this.setState({img:e.startImage,isEditing:!1})},cropImage:function(){if(!this.refs.img)return i["default"].reject();var e=a.findDOMNode(this.refs.img),t=this.state.scale,r=Math.abs(this.state.left/t),o=Math.abs(this.state.top/t),n=N/t,s=n;n>S.MAX_PIC_SIDE?s=S.MAX_PIC_SIDE:n<S.MIN_PIC_SIDE&&(s=S.MIN_PIC_SIDE);var d;return new i["default"](function(t,i){f.crop(e.src,r,o,n,n,s,s).then(function(e){return d=e,f.crop(d.url,0,0,S.PROF_PIC_THUMB_SIDE,S.PROF_PIC_THUMB_SIDE)}).then(function(e){t({thumb:e.url,full:d.url})})})},onZoomIn:function(){var e=this.state.scale*w;e>=P||this.setState({scale:e})},onZoomOut:function(){var e=this.state.scale/w;this.state.minScale>=e&&(e=this.state.minScale),this.setState({scale:e})},onCrop:function(){this.cropImage().bind(this).then(function(e){this.props.onImageSet(e.thumb,e.full)})["catch"](function(){this.setState({img:this.props.startImage,isEditing:!1})})},onDragEnd:function(e,t){this.setState({left:e,top:t})},onUpload:function(e){var t=this.refs.imageInput;return t.click(),!0},removeImage:function(){this.props.onImageSet(),b.closeModal()},onRemove:function(e){var t=this.props.type===R.GROUP?l10n.t("remove_group_icon"):l10n.t("remove_profile_photo");b.openModal(s.createElement(E,{onOK:this.removeImage,okText:l10n.t("remove"),onCancel:b.closeModal.bind(b),cancelText:l10n.t("web_cancel")},t))},onView:function(){var e=this.refs.imageContainer,t=function(t){t(e)};b.openModal(s.createElement(p,{contact:Store.Contact.get(this.props.id),animateBorderRadius:!0,getZoomNode:t}),"profile-viewer")},onImageTake:function(e){this.createAndSetImage(e)},onImagePick:function(e){T.pop(T.MENU);var t=e.target.files[0];return t?(this.createAndSetImage(t),void(e.target.value="")):!1},createAndSetImage:function(e){var t=this;f.resizeAndOrient(e,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY).then(function(e){var r=new Image;r.onload=function(){var o,n=r.width,i=r.height;o=i>n?N/n:N/i,t.setState({img:e.url,isEditing:!0,scale:o,minScale:N/Math.min(n,i)})},r.src=e.url})["catch"](function(e){d.error("PhotoPicker:createAndSetImage:error "+e)(e)})},onImageClick:function(e){if(this.props.type===R.NO_EDIT&&this.state.img)return void this.onView();if(!this.state.isEditing){e.stopPropagation(),e.preventDefault();var t=[];this.props.id&&this.state.img&&t.push(s.createElement(l,{key:"view",action:this.onView},l10n.t("view_photo"))),navigator.getUserMedia&&t.push(s.createElement(u,{key:"take",onImageTake:this.onImageTake})),t.push(s.createElement(l,{key:"upload",action:this.onUpload},l10n.t("upload_photo"))),this.state.img&&t.push(s.createElement(l,{key:"remove",action:this.onRemove},l10n.t("remove_photo"))),b.openContextMenu(t,{onClose:this.contextClose,type:c.Type.DROPDOWN,event:e}),this.setState({contextActive:!0})}},contextClose:function(){this.setState({contextActive:!1})},onMouseOver:function(e){this.state.hover||this.setState({hover:!0})},onMouseEnter:function(e){this.state.hover||this.setState({hover:!0})},onMouseLeave:function(e){this.state.hover&&this.setState({hover:!1})},onLoad:function(e){var t=e.target.clientWidth,r=e.target.clientHeight;this.setState({imageSize:{width:t,height:r}})},render:function(){var e;if(this.state.img&&this.state.isEditing){var t={width:N,height:N};e=s.createElement(v,{ref:"img",container:t,onStop:this.onDragEnd,scale:this.state.scale},s.createElement("img",{className:"avatar-original",src:this.state.img}))}else this.state.img&&(e=s.createElement(h,{type:h.TYPES.COVER,size:this.state.imageSize},s.createElement(m,{src:this.state.img,style:{height:"100%",width:"100%"},onLoad:this.onLoad})));var r;(this.props.pending||!this.state.isEditing&&this.state.img&&!this.state.imageSize)&&(r=s.createElement("div",{className:"avatar-spinner-container"},s.createElement(y,{size:50,stroke:3})));var o=null;if(!this.props.pending&&this.props.type!==R.NO_EDIT&&(!this.state.img||this.state.imageSize)&&(!this.state.img||this.state.contextActive||!this.state.isEditing&&this.state.hover)){var n;switch(this.props.type){case"group":n=this.state.img?l10n.t("change_group_icon"):l10n.t("add_group_icon");break;case"profile":n=this.state.img?l10n.t("change_profile_photo"):l10n.t("add_profile_photo")}o=s.createElement("div",{className:"avatar-overlay",key:"avatar-overlay"},s.createElement("span",{className:"icon icon-camera-light"}),s.createElement("div",{"data-a8n":g.key("avatar-text"),className:"avatar-overlay-text"},n))}var i,a,d=C("avatar","avatar-l","draggable-container",{"icon-group-default":this.props.type!==R.PROFILE,"icon-user-default":this.props.type===R.PROFILE});this.state.isEditing&&(i=s.createElement("div",{className:"avatar-picker-controls",key:"zoom-controls"},s.createElement("button",{className:"icon icon-plus",onClick:this.onZoomIn}),s.createElement("button",{className:"icon icon-minus",onClick:this.onZoomOut})),a=s.createElement("div",{className:"tip-container tip-avatar-picker",key:"tip-controls"},s.createElement("div",{className:"tip"},s.createElement("div",{className:"tip-body"},l10n.t("adjust_image")),s.createElement("div",{className:"tip-controls"},s.createElement("button",{className:"button",onClick:this.onCrop},l10n.t("done_adjusting"))))));var c=this.props.type===R.NO_EDIT||this.props.pending||!this.state.imageSize&&this.state.img?_.noop:this.onImageClick;return s.createElement("div",{className:"avatar-picker"},s.createElement("div",{className:d,onClick:c,onMouseOver:this.onMouseOver,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,ref:"imageContainer"},e,s.createElement(M,{transitionName:"fade"},r,o)),s.createElement(M,{transitionName:"fade"},i),s.createElement(M,{transitionName:"slide"},a),s.createElement("input",{ref:"imageInput",type:"file","data-ignore-capture":T.IGNORE_ANY,accept:"image/gif,image/jpeg,image/jpg,image/png",style:{display:"none"},onChange:this.onImagePick}))}});e.exports=k},806:function(e,t,r){"use strict";var o=r(6),n=o.createClass({displayName:"SectionHeader",propTypes:{header:o.PropTypes.string.isRequired},render:function(){return o.createElement("div",{className:"list-title"},this.props.header)}});e.exports=n},807:function(e,t,r){"use strict";var o=r(6),n=r(781),i=r(771),s=r(153),a=r(41),d=o.createClass({displayName:"PreviewImage",propTypes:{duration:o.PropTypes.oneOfType([o.PropTypes.string,o.PropTypes.number]),shade:o.PropTypes.bool,thumb:o.PropTypes.string,type:o.PropTypes.oneOf([i.TYPE.AUDIO,i.TYPE.LOCATION,i.TYPE.VIDEO,i.TYPE.PTT,i.TYPE.VCARD]).isRequired},getDefaultProps:function(){return{shade:!0}},getIconClassNames:function(){return this.props.type===i.TYPE.VIDEO?"icon-sm icon-video-inv":this.props.type===i.TYPE.AUDIO?"icon-sm icon-arrow-inv":void 0},getClassNames:function(){var e="preview";return e+=this.props.type===i.TYPE.VCARD?" icon-user-default":" icon-user-default-square",this.props.thumb||(e+=" preview-"+this.props.type+" no-image"),e},getStyles:function(){var e=this.props.thumb;return e?a.isHttp(e)?{backgroundImage:'url("'+e+'")'}:{backgroundImage:'url("data:image/jpeg;base64,'+e+'")'}:{}},render:function(){var e=s.durationStr(this.props.duration),t=this.props.shade?o.createElement("span",{className:"shade"}):null;return o.createElement("div",{className:this.getClassNames(),style:this.getStyles()},t,o.createElement("span",{className:"meta meta-audio"},o.createElement("span",{className:this.getIconClassNames()}),o.createElement(n,null,e)))}});e.exports=d},808:function(e,t,r){"use strict";var o=r(6),n=r(1),i=r(831),s=r(802),a=r(103),d=r(771),c=r(9),l=r(341),u=r(772),p=r(809),h=r(777),m=r(78),f=r(799),g=r(826),v=r(886),y=r(881),E=r(880),T=r(876),b=r(888),S=r(879),C=r(882),M=r(878),N=r(77),w=r(80),P=r(773),R=r(105),k={FRONT:"front",MID:"mid",END:"end",SINGLE:"single"},x={CONVERSATION:"conversation",MSG_INFO:"msg_info"},I=o.createClass({displayName:"Wrapper",mixins:[a],propTypes:{msg:o.PropTypes.instanceOf(d).isRequired,position:o.PropTypes.oneOf(_.values(k)),displayType:o.PropTypes.oneOf(_.values(x)),hideMsgInfo:o.PropTypes.bool,selectable:o.PropTypes.bool,onMessageSelect:o.PropTypes.func},getDefaultProps:function(){return{displayType:x.CONVERSATION}},getInitialState:function(){return{failed:this.props.msg.isFailed,hover:!1,contextMenu:!1,selected:!1}},componentWillReceiveProps:function(e){e.selectable||this.setState({selected:!1})},shouldComponentUpdate:function(e,t){return t.hover!==this.state.hover||t.contextMenu!==this.state.contextMenu||t.failed!==this.state.failed||e.position!==this.props.position||t.selected!==this.state.selected||e.selectable!==this.props.selectable},componentWillMount:function(){var e=this,t=this.props.msg;w.supportsFeature(w.F.RESEND_ICON)&&t.mayFail&&(this.addObserver(t,"change:ack",this.onAckChange),this.addObserver(t,"change:urlState",function(){return e.forceUpdate()}))},onFailedChange:function(){var e=this.props.msg;e.mayFail||(this.removeObserver(e,"change:ack"),this.removeObserver(e,"change:urlState")),this.setState({failed:e.isFailed})},resend:function(){var e=this.props.msg;return e.isMMS&&!w.supportsFeature(w.F.MEDIA_RETRY)?void c.openModal(o.createElement(f,{msg:e})):void e.resend().bind(this).then(function(t){this.isMounted()&&this.setState({failed:e.isFailed})})["catch"](function(e){n.log("wrapper:resend failure: "+e)()})},openForwardFlow:function(){var e=this.props.msg;e.ack<1&&e.isMMS&&e.isSentByMe?c.openModal(o.createElement(l,{title:l10n.t("err_unsent_forward_title"),onOK:c.closeModal.bind(c),okText:l10n.t("web_ok")},l10n.t("err_unsent_forward_text"))):c.openModal(o.createElement(p,{msgs:[this.props.msg]}),"modal-flow")},openInfoDrawer:function(){if(this.props.msg.chat.kind===P.KIND.CHAT){var e=r(906);c.openDrawer(o.createElement(e,{msg:this.props.msg,key:this.props.msg.id.toString(),type:m.DRAWER_RIGHT}),"slide-left")}else{var t=r(911);c.openDrawer(o.createElement(t,{msg:this.props.msg,key:this.props.msg.id.toString(),type:m.DRAWER_RIGHT}),"slide-left")}},openContactChat:function(){Store.Chat.find(this.props.msg.author).then(function(e){c.openChat(e)})},mouseEnter:function(){this.contextEnabled()&&!this.state.hover&&this.setState({hover:!0})},mouseOver:function(){this.contextEnabled()&&!this.state.hover&&this.setState({hover:!0})},mouseLeave:function(){this.contextEnabled()&&this.state.hover&&this.setState({hover:!1})},contextEnabled:function(){return!this.props.msg.isNotification},removeContext:function(){this.setState({contextMenu:!1})},onDeleteMessage:function(){var e=this,t=function(){m.pop(m.MENU),c.closeModal(),e.props.msg.chat.sendDeleteMsgs([e.props.msg])},r=l10n.t("delete_message_confirmation");c.openModal(o.createElement(l,{onOK:t,okText:l10n.t("web_delete"),onCancel:c.closeModal.bind(c),cancelText:l10n.t("web_cancel")},o.createElement(u,{text:r})))},onMenu:function(e){if(e.stopPropagation(),e.preventDefault(),this.state.contextMenu)return m.pop(m.MENU),void this.setState({contextMenu:!1});var t=this.props.msg,r=[];t.isSentByMe&&w.supportsFeature(w.F.MESSAGE_INFO)&&this.props.displayType!==x.MSG_INFO&&r.push(o.createElement(h,{key:"info",action:this.openInfoDrawer},l10n.t("message_info"))),t.type!==d.TYPE.DOCUMENT&&r.push(o.createElement(h,{key:"forward",action:this.openForwardFlow},l10n.t("forward_message"))),t.chat.canSendDeleteMsg()&&r.push(o.createElement(h,{key:"delete",action:this.onDeleteMessage},l10n.t("delete_message"))),t.isGroupMsg&&t.author&&!t.isSentByMe&&r.push(o.createElement(h,{key:"author",action:this.openContactChat},l10n.t("message_author",{author:t.displayName()}))),this.setState({contextMenu:!0}),c.openContextMenu(r,{onClose:this.removeContext,anchor:e.target,parent:this,classes:"dropdown-compact"})},getMsgComponent:function(){var e=this.props,t=e.msg,r=e.position,i=t.type,a=t.subtype,c=r===k.MID||r===k.END;switch(i){case d.TYPE.CHAT:var l=t.senderObj?t.senderObj.name:null;return o.createElement(v,{msg:t,trusted:t.isTrusted(),ref:"component",senderName:l,isContinuation:c});case d.TYPE.IMAGE:return o.createElement(y,{msg:t,ref:"component",isMsgInfo:this.props.displayType===x.MSG_INFO,isContinuation:c});case d.TYPE.GROUP_NOTIFICATION:case d.TYPE.GP2:case d.TYPE.BROADCAST_NOTIFICATION:case d.TYPE.NOTIFICATION:var u=t.body;switch(i){case"gp2":case"group_notification":u=s.formatGroupNotification(t);break;case"broadcast_notification":u=s.formatBroadcastNotification(a,t.body)}return o.createElement(E,{text:u,ref:"component"});case d.TYPE.AUDIO:case d.TYPE.VIDEO:return o.createElement(T,{msg:t,isContinuation:c,ref:"component"});case d.TYPE.VCARD:return o.createElement(b,{msg:t,isContinuation:c,ref:"component"});case d.TYPE.LOCATION:return o.createElement(S,{msg:t,isContinuation:c,ref:"component"});case d.TYPE.PTT:return o.createElement(C,{msg:t,isContinuation:c,ref:"component"});case d.TYPE.DOCUMENT:return o.createElement(M,{msg:t,trusted:t.isTrusted(),ref:"component",senderName:t.senderObj?t.senderObj.name:null,isContinuation:c});default:n.log("messageList:render Unknown message type: "+i)()}},onSelectClick:function(){var e=!this.state.selected;this.props.onMessageSelect(this.props.msg,e),this.setState({selected:e})},render:function(){var e,t=this.props,r=t.msg,n=t.position;if(this.state.hover||this.state.contextMenu){var s=r.isGroupMsg&&!r.isSentByMe&&(n===k.FRONT||n===k.SINGLE),a=r.type==d.TYPE.CHAT&&!s&&r.body.indexOf(r.matchedText)>-1&&r.isTrusted()?"url":r.type;e=o.createElement("span",{className:"btn-context btn-context-"+a,key:"icon-context",onClick:this.onMenu})}var c;if(w.supportsFeature(w.F.RESEND_ICON)&&r.isFailed&&r.urlState!==d.URL_STATE.UPLOADING){var l=o.createElement("span",null,l10n.t("resend_message"));c=o.createElement(i,{style:{"float":"right"},trigger:!0,tooltip:l,direction:"left"},o.createElement("button",{className:"error",onClick:this.resend},o.createElement("span",{className:"icon icon-error"})))}var u=!r.isNotification&&this.props.selectable?o.createElement("div",{className:"msg-select",
onClick:this.onSelectClick},o.createElement(g,{onChange:this.onSelectClick,checked:this.state.selected})):null,p=n===k.MID||n===k.END,h={wrapper:N("msg",{"msg-continuation":n===k.FRONT||n===k.MID,"msg-group":r.isGroupMsg&&!p,selected:this.state.selected}),container:N("message",{"message-system":r.isNotification,"message-out":!r.isNotification&&r.isSentByMe,"message-in":!r.isNotification&&!r.isSentByMe,hover:this.state.contextMenu||this.state.hover,tail:n===k.END||n===k.SINGLE})};return o.createElement("div",{className:h.wrapper},o.createElement(R,{transitionName:"delay-leave"},u),o.createElement("div",{className:h.container,onMouseOver:this.mouseOver,onMouseEnter:this.mouseEnter,onMouseLeave:this.mouseLeave},c,this.getMsgComponent(),o.createElement(R,{transitionName:"pop-fast"},e)))}});I.Position=k,I.DisplayType=x,e.exports=I},809:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(6),a=r(786),d=r(341),c=r(903),l=r(771),u=r(9),p=r(11),h=r(772),m=s.createClass({displayName:"ForwardMessageFlow",mixins:[a],propTypes:{msgs:s.PropTypes.arrayOf(s.PropTypes.instanceOf(l)).isRequired,onFoward:s.PropTypes.func},componentWillMount:function(){this.push(this.chatModal)},chatModal:function(){var e=this;return s.createElement(c,{onChat:this.confirmForward,key:"ChatModal",selectedTab:this.selectedTab,onSelectTab:function(t){e.selectedTab=t},title:l10n.t("forward_message_to")})},confirmForward:function(e){var t,r=!1;e.isGroup?t=l10n.t("confirm_forward_to_group",{chat:e.formattedTitle}):e.isUser&&e.contact.isBlocked()?(t=l10n.t("confirm_unblock_contact_and_forward",{chat:e.formattedTitle}),r=!0):t=l10n.t("confirm_forward_to_contact",{chat:e.formattedTitle}),this.push(s.createElement(d,{onOK:_.partial(this.onForwardConfirmed,e,r),okText:l10n.t("web_ok"),onCancel:this.pop.bind(null,void 0,void 0),key:"ConfirmPopup",cancelText:l10n.t("web_cancel")},s.createElement(h,{text:t})))},onForwardConfirmed:function(e,t){var r,o=this,n=this,s=Date.now();r=t?e.contact.setBlock(!1):i["default"].resolve(!0);var a=[];r.then(function(){return i["default"].each(o.props.msgs,function(t){return t.forward(e)["catch"](p.MediaMissing,function(e){a.push(t)})["catch"](function(e){throw e})}).then(function(){a.length>0&&n.showMediaMissing(a,s)})["catch"](p.ContactBlocked,function(t){n.showContactBlocked(e,s)})})["catch"](_.noop),this.endFlow(),_.isFunction(this.props.onForward)&&this.props.onForward(this.props.msgs),u.openChat(e)},showContactBlocked:function(e,t){var r=Date.now()-t>1e3?void 0:!1;u.openModal(s.createElement(d,{key:"contactBlocked",onOK:u.closeModal.bind(u)},l10n.t("web_cannot_send_to_blocked_contact_1",{contact:e.contact.formattedName})),r)},showMediaMissing:function(e,t){var r,o;if(1===e.length){var n=e[0].type;switch(n){case l.TYPE.VIDEO:r=l10n.t("missing_video_title"),o=l10n.t("missing_video_forward_text");break;case l.TYPE.AUDIO:case l.TYPE.PTT:r=l10n.t("missing_audio_title"),o=l10n.t("missing_audio_forward_text");break;case l.TYPE.IMAGE:r=l10n.t("missing_photo_title"),o=l10n.t("missing_photo_forward_text")}}else r=l10n.t("missing_media_title"),o=l10n.t("missing_media_forward_text",{count:e.length,_plural:e.length});var i=Date.now()-t>1e3?void 0:!1;u.openModal(s.createElement(d,{title:r,onOK:u.closeModal.bind(u),okText:l10n.t("web_ok")},o),i)}});e.exports=m},810:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(688),i=o(n),s=r(6),a=r(77),d=s.createClass({displayName:"Modal",propTypes:{type:s.PropTypes.oneOf(["compact","box","tower"]),classes:s.PropTypes.string,title:s.PropTypes.string,children:s.PropTypes.node.isRequired},getDefaultProps:function(){return{classes:"",type:"compact"}},statics:{COMPACT:"compact",BOX:"box",TOWER:"tower"},render:function(){var e=this.props.title?s.createElement("div",{className:"popup-title",dir:"auto"},this.props.title):null,t=a("popup",this.props.classes,(0,i["default"])({},"popup-"+this.props.type,this.props.type!==d.COMPACT));return s.createElement("div",{className:"backdrop"},s.createElement("div",{className:"popup-container"},s.createElement("div",{className:t},s.createElement("div",{className:"popup-body"},e,s.createElement("div",{className:"popup-contents"},this.props.children)))))}});e.exports=d},811:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(6),a=r(1),d=r(347),c=r(348),l=r(156),u=r(59),p=r(35),l=r(156),h=r(9),m=r(80),f=r(11),g=r(159),v=r(780),y=u.extend({props:{id:"string",isAdmin:"boolean"},children:{contact:l},initialize:function(){this.contact=Store.Contact.gadd({id:this.id}),this.listenTo(this.contact,"all",this._getEventBubblingHandler("contact"))}}),E=d.extend(c,{model:y,comparator:function(e,t){return l.Comparator(e.contact,t.contact)},initialize:function(){this.listenTo(this,"change:contact.name",this.sort),this.listenTo(h,"locale_change",this.sort)},addParticipant:function(e){if(this.get(e.id))return h.openToast(s.createElement(v,{id:v.genId(),msg:l10n.t("action_participant_failed_already_added",{participant:e.formattedShortName})})),i["default"].reject(new f.ActionError);if(!this.canAdd())return i["default"].reject(new f.ActionError);var t=p.addParticipant(this.parent.id,e.id),r=l10n.t("action_participant_adding",{participant:e.formattedShortName}),o=t.then(function(t){return 200===t.status?l10n.t("action_participant_added",{participant:e.formattedShortName}):404===t.status?l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_404"):401===t.status?l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_401"):403===t.status?l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_403"):void 0})["catch"](function(e){throw a.error("models:groupMetadata:participantCollection:addParticipant dropped")(e),l10n.t("action_participant_add_failed")});return h.openToast(s.createElement(g,{id:g.genId(),pendingText:r,actionText:o,retry:this.addParticipant.bind(this,e)})),t},removeParticipant:function(e){if(!this.canRemove(e))return i["default"].reject(new f.ActionError);var t=p.removeParticipant(this.parent.id,e.id),r=l10n.t("action_participant_removing",{participant:e.contact.formattedShortName}),o=t.then(function(t){return 200===t.status?l10n.t("action_participant_removed",{participant:e.contact.formattedShortName}):404===t.status?l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_404"):401===t.status?l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_401"):403===t.status?l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_403"):void 0})["catch"](function(e){throw a.error("models:groupMetadata:participantCollection:removeParticipant dropped")(e),l10n.t("action_participant_remove_failed")});return h.openToast(s.createElement(g,{id:g.genId(),pendingText:r,actionText:o,retry:this.removeParticipant.bind(this,e)})),t},promoteParticipant:function(e){if(!this.canPromote(e))return i["default"].reject(new f.ActionError);var t=p.promoteParticipant(this.parent.id,e.id),r=l10n.t("action_participant_promoting",{participant:e.contact.formattedShortName}),o=t.then(function(t){return 200===t.status?l10n.t("action_participant_promoted",{participant:e.contact.formattedShortName}):404===t.status?l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_404"):401===t.status?l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_401"):403===t.status?l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_403"):void 0})["catch"](function(e){throw a.error("models:groupMetadata:participantCollection:removeParticipant dropped")(e),l10n.t("action_participant_promote_failed")});return h.openToast(s.createElement(g,{id:g.genId(),pendingText:r,actionText:o,retry:this.promoteParticipant.bind(this,e)})),t},canAdd:function(){return m.supportsFeature(m.F.GROUP_ADD_PARTICIPANT)&&this.iAmAdmin()?!0:!1},canPromote:function(e){return m.supportsFeature(m.F.GROUP_PROMOTE_PARTICIPANT)&&e?Store.Conn.me===e.id?!1:this.iAmAdmin()?e.isAdmin?!1:!0:!1:!1},canRemove:function(e){return m.supportsFeature(m.F.GROUP_REMOVE_PARTICIPANT)&&e?Store.Conn.me===e.id?!1:this.iAmAdmin()?!0:!1:!1},iAmMember:function(){return 1===this.where({id:Store.Conn.me}).length},iAmAdmin:function(){return 1===this.where({id:Store.Conn.me,isAdmin:!0}).length}}),_=u.extend({Collection:"GroupMetadata",props:{id:"string",creation:"number",owner:"string"},session:{stale:["boolean",!1,!0],trusted:"boolean"},collections:{participants:E},"delete":function(){u.prototype["delete"].call(this),Store.GroupMetadata.remove(this.id),this.participants.invoke("delete"),this.participants.stopListening(),this.participants.reset()},canSetSubject:function(){return m.supportsFeature(m.F.GROUP_SET_SUBJECT)&&this.participants.iAmMember()?!0:!1},initialize:function(){this.listenTo(this.participants,"change:isAdmin change:contact.isMyContact sort remove reset",this.isTrusted),this.listenTo(this,"change:owner",this.isTrusted)},isTrusted:function(){if(!this.owner)return this.trusted=!1;if(this.owner===Store.Conn.me)return this.trusted=!0;var e=Store.Contact.get(this.owner);if(e&&e.isMyContact)return this.trusted=!0;for(var t=this.participants.models,r=0,o=t.length;o>r;++r){var n=t[r];if(n.isAdmin&&n.id!==Store.Conn.me&&n.contact.isMyContact)return this.trusted=!0}return this.trusted=!1}});e.exports=_},812:function(e,t){"use strict";var r={boundHeightWidth:function(e,t,r,o){return t=t||o,e=e||r,t>e?t>o&&(e*=o/t,t=o):e>r&&(t*=r/e,e=r),{width:Math.max(t,1),height:Math.max(e,1)}}};e.exports=r},813:function(e,t,r){"use strict";function o(e){this.list=e,this.index=-1}var n=r(46);_.assign(o.prototype,n,{init:function(e){var t=void 0;if(_.isArray(this.list)&&(t=this.list[this.index]),this.list=e,t){var r=_.indexOf(this.list,t);r>-1&&(this.index=r)}},unset:function(){this.trigger(this.list[this.index],!1),this.index=-1},set:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],r=Math.min(Math.max(e,0),this.list.length-1);this.trigger(this.list[r],t?"focus":"select");var o=this.index;_.isEqual(o,e)||this.trigger(this.list[o],!1),this.index=e},setVal:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],r=_.indexOf(this.list,e);r>-1&&this.set(r,t)},setFirst:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];_.isEmpty(this.list)||this.set(0,e)},setPrev:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];_.isEmpty(this.list)||this.set(this.prev(),e)},setNext:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];_.isEmpty(this.list)||this.set(this.next(),e)},prev:function(){return _.isEmpty(this.list)?-1:-1===this.index?-1:this.index-1},next:function(){return _.isEmpty(this.list)?-1:this.index==this.list.length?this.list.length:this.index+1}}),e.exports=o},823:function(e,t,r){"use strict";var o=r(6),n=r(30),i=r(778),s=r(779),a=r(806),d=r(792),c=r(342),l=c.HotKeys,u=o.createClass({displayName:"ContactList",propTypes:{contacts:o.PropTypes.array.isRequired,exclude:o.PropTypes.array,onClick:o.PropTypes.func,onFocusSearch:o.PropTypes.func},getInitialState:function(){this.selected=d();var e=this.props.exclude;return e&&(e=_.object(e.map(function(e){return[e.id,!0]}))),{exclude:e}},setSelected:function(e,t){this.selected.set(e,t)},indicateFocus:function(e){e.target===n.findDOMNode(this)&&this.selected.value&&this.setSelected(this.selected.value)},focusFirst:function(){var e=_.first(this.props.contacts);e&&this.setSelected(e.id)},onNextContact:function(e){e.preventDefault(),e.stopPropagation();var t=this.selected.next(this.props.contacts);t&&this.setSelected(t.id)},onPrevContact:function(e){var t=this.selected.prev(this.props.contacts);t&&(_.isEqual(t.id,this.selected.value)?this.props.onFocusSearch&&(e.preventDefault(),e.stopPropagation(),this.setSelected(null),this.props.onFocusSearch(e)):(e.preventDefault(),e.stopPropagation(),this.setSelected(t.id)))},render:function(){for(var e,t=this.props.contacts,r=[],n=t.length>10,d=this.state.exclude||{},c="XXX",u=0;u<t.length;u++){var p=t[u];if(e=null,n){var h=p.header;u<t.length-1&&h!=t[u+1].header&&(e="last"),h!==c&&(r.push(o.createElement(a,{key:h,header:h})),c=h)}var m=p.id;r.push(o.createElement(s,{contact:p,active:this.selected,className:e,onClick:this.props.onClick,member:d[m],key:m}))}var f={down:this.onNextContact,up:this.onPrevContact};return f={},o.createElement(l,{handlers:f,onFocus:this.indicateFocus,"data-tab":3},o.createElement(i,{classes:["chatlist"],data:r,height:72,extraItems:4}))}});e.exports=u},824:function(e,t,r){"use strict";var o=r(6),n=r(773),i=r(770),s=r(777),a=o.createClass({displayName:"ArchiveMenuItem",mixins:[i],propTypes:{chat:o.PropTypes.instanceOf(n).isRequired,onArchive:o.PropTypes.func.isRequired},getInitialState:function(){return{archive:this.async("chat.archive")}},render:function(){var e=this.props.onArchive.bind(null,!this.state.archive);return o.createElement(s,{a8n:"mi-archive",action:e,shortcut:"a",key:"ArchiveMenuItem"},this.state.archive?l10n.t("unarchive_chat"):l10n.t("archive_chat"))}});e.exports=a},825:function(e,t,r){"use strict";var o=r(6),n=r(30),i=r(14),s=r(79),a=r(104),d=r(154),c=r(9),l=r(45),u=o.createClass({displayName:"AudioTag",mixins:[s,a,d],propTypes:{src:o.PropTypes.string,className:o.PropTypes.string,controls:o.PropTypes.bool,preload:o.PropTypes.string,type:o.PropTypes.string,onClick:o.PropTypes.func,onPlay:o.PropTypes.func,onError:o.PropTypes.func,autoPlay:o.PropTypes.bool},componentDidMount:function(){var e=n.findDOMNode(this);this.regNativeListener(e,"error",this.onPlayerError,!0),this.regNativeListener(e,"playing",this.onPlaying),this.regCmd("mediaPlaying",this.onOtherPlaying),(l.isGecko||l.isSafari)&&(this.props.autoPlay?(this.checkIteration=0,this.checkForSuccessInterval=this.safeInterval(this.checkForSuccess,250)):this.props.autoPlay?this.startCheckForSuccess():this.regNativeListener(e,"play",this.startCheckForSuccess))},startCheckForSuccess:function(){this.checkIteration=0,this.checkForSuccessInterval=this.safeInterval(this.checkForSuccess,250)},clearCheckForSuccess:function(){this.checkForSuccessInterval&&(this.clearSafeInterval(this.checkForSuccessInterval),delete this.checkForSuccessInterval,delete this.checkIteration)},checkForSuccess:function(){if(i.state===i.STATE.CONNECTED){if(this.checkIteration++,this.checkIteration>40)return void this.onPlayerError({target:{src:this.props.src,error:{code:window.MediaError.MEDIA_ERR_NETWORK}}});var e=n.findDOMNode(this),t=e.buffered;t&&t.length&&t.end(0)>0&&this.onPlaying({target:e})}},onPlayerError:function(e){this.clearCheckForSuccess(),this.props.onError&&this.props.onError(e)},onOtherPlaying:function(e){e!==this&&n.findDOMNode(this).pause()},onPlaying:function(e){this.clearCheckForSuccess(),c.mediaPlaying(this),this.props.onPlay&&this.props.onPlay(e)},render:function(){return o.createElement("audio",{src:this.props.src,className:this.props.className,onClick:this.props.onClick,controls:this.props.controls,preload:this.props.preload,type:this.props.type,autoPlay:this.props.autoPlay},this.props.children)}});e.exports=u},826:function(e,t,r){"use strict";var o=r(6),n=r(104),i=r(77),s=o.createClass({displayName:"CheckBox",mixins:[n],propTypes:{checked:o.PropTypes.bool.isRequired,onChange:o.PropTypes.func.isRequired},onToggle:function(e){e&&e.stopPropagation(),this.props.onChange()},render:function(){var e=i("checkbox",{checked:this.props.checked,unchecked:!this.props.checked});return o.createElement("div",{className:"checkbox-container",onClick:this.onToggle},o.createElement("div",{className:e,ref:"checkbox"},o.createElement("div",{className:"checkmark"})))}});e.exports=s},827:function(e,t,r){"use strict";var o=r(6),n=r(773),i=r(770),s=r(777),a=o.createClass({displayName:"DeleteMenuItem",mixins:[i],propTypes:{chat:o.PropTypes.instanceOf(n).isRequired,onDeleteOrExit:o.PropTypes.func.isRequired},getInitialState:function(){return{isReadOnly:this.async("chat.isReadOnly")}},render:function(){var e;switch(this.props.chat.kind){case n.KIND.GROUP:e=this.props.chat.isReadOnly?l10n.t("web_delete_group"):l10n.t("web_exit_group");break;case n.KIND.BROADCAST:e=l10n.t("web_delete_list");break;case n.KIND.CHAT:e=l10n.t("delete_chat")}return o.createElement(s,{a8n:"mi-delete",action:this.props.onDeleteOrExit,shortcut:"x"},e)}});e.exports=a},828:function(e,t,r){"use strict";var o=r(6),n=r(103),i=r(772),s=r(11),a=r(800),d=r(811),c=o.createClass({displayName:"GroupSubtitle",mixins:[n],propTypes:{presence:o.PropTypes.instanceOf(a),groupMetadata:o.PropTypes.instanceOf(d),placeholder:o.PropTypes.node,location:o.PropTypes.oneOf(["list","title"])},componentWillMount:function(){Store.GroupMetadata.find(this.props.groupMetadata.id)["catch"](s.WapDrop,_.noop);var e=this.props.groupMetadata.participants;this.addObserver(e,"sort remove reset"),this.addObserver(this.props.presence,"change:chatstate.id change:chatstate.type change:forceDisplay change:withholdDisplay")},getSubtitle:function(){return this.props.groupMetadata.participants.map(function(e){return e.contact.formattedShortNameWithNonBreakingSpaces}).join(", ")},render:function(){var e,t=this.props.presence;return"list"===this.props.location?(e=t.getFormattedString()||this.getSubtitle(),e?o.createElement(i,{ellipsify:!0,titlify:!0,text:e}):null):(e=t.withholdDisplay?this.props.placeholder:t.getFormattedString()||(t.forceDisplay?this.getSubtitle():this.getSubtitle()||this.props.placeholder),e?o.createElement("div",{className:"chat-status ellipsify"},o.createElement(i,{ellipsify:!0,titlify:!0,text:e})):null)}});e.exports=c},829:function(e,t,r){"use strict";var o=r(6),n=r(78),i=r(105),s=r(345),a=r(157),d=o.createClass({displayName:"MenuBar",propTypes:{children:o.PropTypes.node,a8n:o.PropTypes.string},render:function(){return o.createElement("div",{className:"menu menu-horizontal"},this.props.children)}}),c=o.createClass({displayName:"MenuBarItem",mixins:[a],propTypes:{icon:o.PropTypes.string.isRequired,title:o.PropTypes.string.isRequired,children:o.PropTypes.node,transitionName:o.PropTypes.string,onClick:o.PropTypes.func},getDefaultProps:function(){return{transitionName:"dropdown"}},getInitialState:function(){return{active:!1}},onClick:function(e){e.stopPropagation(),this.props.onClick(e)},onOpen:function(e){e.preventDefault(),e.stopPropagation(),this.setState({active:!0}),this.uimPush(this,n.MENU,{popable:!0})},onClose:function(e){e.preventDefault(),e.stopPropagation(),this.setState({active:!1}),this.uimPop(n.MENU)},uimClose:function(){this.setState({active:!1})},render:function(){var e="icon icon-"+this.props.icon,t=this.state.active,r=this.props.onClick?this.onClick:t?this.onClose:this.onOpen,a=null;if(this.props.children){var d=this.props.transitionName,c=o.Children.only(this.props.children);a=o.createElement(i,{transitionName:d},t?c:null)}var l="menu-item";return t&&(l+=" active"),o.createElement("div",{"data-a8n":s.key(this.props.a8n),className:l,onClick:r},o.createElement("button",{className:e,"data-ignore-capture":n.IGNORE_ANY,title:this.props.title},this.props.title),a)}});e.exports={MenuBar:d,MenuBarItem:c}},830:function(e,t,r){"use strict";var o=r(6),n=r(773),i=r(770),s=r(777),a=o.createClass({displayName:"MuteMenuItem",mixins:[i],propTypes:{chat:o.PropTypes.instanceOf(n).isRequired,onMute:o.PropTypes.func.isRequired},getInitialState:function(){return{isMuted:this.async("chat.mute.isMuted")}},render:function(){var e=this.props.onMute.bind(null,!this.state.isMuted);return o.createElement(s,{action:e,shortcut:"m"},this.state.isMuted?l10n.t("web_menuitem_mute_off"):l10n.t("web_menuitem_mute"))}});e.exports=a},831:function(e,t,r){"use strict";var o=r(6),n=o.createClass({displayName:"TooltipTrigger",propTypes:{trigger:o.PropTypes.bool,tooltip:o.PropTypes.node.isRequired,style:o.PropTypes.object,direction:o.PropTypes.oneOf(["top","right","bottom","left"])},getDefaultProps:function(){return{direction:"top"}},getInitialState:function(){return{active:this.props.trigger?!1:!0}},showModal:function(){this.setState({active:!0})},hideModal:function(){this.setState({active:!1})},render:function(){var e=this.state.active?o.createElement(i,{direction:this.props.direction,ref:"tooltip",body:this.props.tooltip}):null,t=this.props.trigger;return o.createElement("div",{style:this.props.style,className:"tooltip-container",onMouseEnter:t?this.showModal:null,onMouseLeave:t?this.hideModal:null},this.props.children,e)}}),i=o.createClass({displayName:"Tooltip",propTypes:{body:o.PropTypes.node.isRequired,direction:o.PropTypes.string.isRequired},render:function(){var e="tooltip "+this.props.direction;return o.createElement("div",{className:e},this.props.body)}});e.exports=n},832:function(e,t,r){"use strict";var o=r(6),n=r(770),i=r(772),s=r(800),a=o.createClass({displayName:"UserSubtitle",mixins:[n],propTypes:{presence:o.PropTypes.instanceOf(s),placeholder:o.PropTypes.node,location:o.PropTypes.oneOf(["list","title"])},getInitialState:function(){return{hasData:this.async("presence.hasData"),type:this.async("presence.chatstate.type"),deny:this.async("presence.chatstate.deny"),t:this.async("presence.chatstate.t"),forceDisplay:this.async("presence.forceDisplay"),withholdDisplay:this.async("presence.withholdDisplay")}},render:function(){var e,t=this.props.presence;return"list"===this.props.location?(e=t.getFormattedString(),e?o.createElement(i,{ellipsify:!0,titlify:!0,text:e}):null):(e=t.withholdDisplay?this.props.placeholder:t.getFormattedString()||(t.forceDisplay?"":this.props.placeholder),e?o.createElement("div",{className:"chat-status ellipsify"},o.createElement(i,{ellipsify:!0,titlify:!0,text:e})):null)}});e.exports=a},833:function(e,t,r){"use strict";var o=r(6),n=r(30),i=r(8),s=r(773),a=r(837),d=r(836),c=r(79),l=r(154),u=r(78),p=r(157),h=r(9),m=r(341),f=r(11),g=r(105),v=r(801),y=r(791),E=r(342),T=E.HotKeys,b=r(890),S=o.createClass({displayName:"ComposeBox",mixins:[c,l,p],propTypes:{chat:o.PropTypes.instanceOf(s).isRequired,onPageUpDown:o.PropTypes.func.isRequired},getInitialState:function(){var e=this.props.chat;return this.text=e.composeText||"",this.selection=e.composeSel,{hasText:this.hasText(),emojiExpanded:!1,recording:!1}},componentWillMount:function(){var e=this.props.chat;e.unset("composeText"),e.unset("composeSel"),this.regCmd("focus_chat_text_input_"+this.props.chat.id,this.focusEmojiInput),this.regCmd("paste_chat_text_input_"+this.props.chat.id,this.pasteEmojiInput),this.regCmd("enter_chat_text_input_"+this.props.chat.id,this.onSendText)},focusEmojiInput:function(){this.refs.input&&this.refs.input.restoreFocus(!0)},pasteEmojiInput:function(e){this.refs.input&&(this.refs.input.restoreFocus(!0),this.refs.input.pasteText(e))},componentWillUnmount:function(){var e=this.props.chat;e.set("composeText",this.text),e.set("composeSel",this.selection)},componentDidMount:function(){this.height=n.findDOMNode(this.refs.input).clientHeight},uimFocus:function(){this.refs.input&&this.refs.input.restoreFocus(!1)},uimClose:function(){this.state.emojiExpanded!==!1&&(this.setState({emojiExpanded:!1}),h.composeHeightChange())},onMaxPasteExceeded:function(){h.openModal(o.createElement(m,{title:l10n.t("message_too_large_title"),onOK:h.closeModal.bind(h),okText:l10n.t("web_ok")},l10n.t("message_too_large_text")))},onChange:function(e){var t=n.findDOMNode(this.refs.input),r=t.clientHeight,o=r-this.height;o&&h.composeHeightChange(o),this.height=r;var i=this.hasText();this.text=e.target.value;var s=this.hasText();s!==i&&this.setState({hasText:s}),s?(this.props.chat.presence.subscribe()["catch"](f.WapDrop,_.noop),this.props.chat.markComposing()):this.props.chat.markPaused()},onSelectionChange:function(e){this.selection=e},onFocus:function(){u.stealFocus(u.COMPOSE_INPUT)},onPaste:function(e){var t=e.clipboardData.items,r=_.filter(t,function(e){var t=v.typeFromMimetype(e.type);return"file"===e.kind&&("image"===t||"video"===t)}).map(function(e){return e.getAsFile()});if(r.length){e.preventDefault();var n=_.reject(t,{kind:"string",type:"text/html"});return void(n.length===r.length&&h.openDrawer(o.createElement(y,{files:r,chat:this.props.chat,type:u.DRAWER_MID}),"slide-up"))}},indicateFocus:function(e){if(!(Date.now()-(T.flashFocus||0)>200)){var t=n.findDOMNode(this.refs.input_hotkey);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#ffffff","#D9F3FF"],borderColor:["#ffffff","#CBE4EF"]},{duration:1300,easing:[.24,.91,.01,.99]})}},onMouseDown:function(e){u.stealFocus(u.COMPOSE_INPUT),e.defaultPrevented&&this.refs.input.restoreFocus(!1)},onPageUpDown:function(e){if(this.props.onPageUpDown){e.stopPropagation(),this.props.onPageUpDown(e);var t=this.refs.input;this.safeDefer(function(){t.restoreFocus(!0)})}},maybeFocusChatSearch:function(e){e.repeat||this.refs.input.isAtBeginning()&&(e.stopPropagation(),e.preventDefault(),T.flashFocus=Date.now(),h.focusChatSearch())},onKeyPress:function(e){return"Enter"!==e.key||e.shiftKey||e.ctrlKey?void 0:(this.onSendText(),void e.preventDefault())},hasText:function(){return S.hasText=this.text.trim().length>0},onSendText:function(){if(this.hasText()){var e=this.text;this.text="",delete this.selection,this.forceUpdate(),this.props.chat.sendMessage(e),this.closeEmojiPanel()}},handleEmoji:function(e){this.refs.input.replaceSelection(e)},openEmojiPanel:function(){this.state.emojiExpanded!==!0&&(this.setState({emojiExpanded:!0}),h.composeHeightChange(),this.uimPush(this,u.EMOJI,{escapable:!0}))},closeEmojiPanel:function(){this.state.emojiExpanded!==!1&&this.uimPop(u.EMOJI)},onPTT:function(e){e===b.REC?this.setState({recording:!0}):this.setState({recording:!1})},preventBlur:function(e){e.preventDefault(),e.stopPropagation(),this.refs.input.restoreFocus(!1)},render:function(){var e=this.state.emojiExpanded?o.createElement("button",{className:"icon icon-hide btn-emoji",onClick:this.closeEmojiPanel}):o.createElement("button",{className:"icon icon-smiley btn-emoji",onClick:this.openEmojiPanel}),t=this.state.emojiExpanded?o.createElement(a,{onEmoji:this.handleEmoji,key:"compose-emoji-panel"}):null,r="block-compose";this.state.recording&&(r+=" ptt-open");var n="input-container";this.state.recording&&(n+=" disabled");var s=null;s=navigator.getUserMedia&&window.AudioContext?this.hasText()?o.createElement("button",{className:"icon btn-icon icon-send send-container",onClick:this.onSendText}):o.createElement(b,{key:"ptt",chat:this.props.chat,onStateChange:this.onPTT}):this.hasText()?o.createElement("button",{className:"icon btn-icon icon-send send-container",onClick:this.onSendText}):o.createElement("button",{className:"icon btn-icon icon-send send-container",onClick:this.onSendText,disabled:!0});var c={pagedown:this.onPageUpDown,pageup:this.onPageUpDown};return c[l10n.LR("left","right")]=this.maybeFocusChatSearch,c={},o.createElement(T,{component:"footer",handlers:c,className:"pane-footer pane-chat-footer",onMouseDown:this.preventBlur,onContextMenu:this.preventBlur},o.createElement(g,{transitionName:"emoji"},t),o.createElement("div",{className:r},e,o.createElement(T,{ref:"input_hotkey",className:n,"data-ignore-capture":u.IGNORE_ANY,onFocus:this.indicateFocus},o.createElement(d,{placeholder:l10n.t("type_a_message"),editable:!this.state.recording,ref:"input",value:this.text,selection:this.selection,multiline:!0,maxLength:i.MAX_TXT_MSG_SIZE,maxPaste:i.MAX_TXT_MSG_SIZE,onMaxPasteExceeded:this.onMaxPasteExceeded,onKeyPress:this.onKeyPress,onPaste:this.onPaste,onMouseDown:this.onMouseDown,onChange:this.onChange,onFocus:this.onFocus,onSelectionChange:this.onSelectionChange})),s))}});e.exports=S},834:function(e,t,r){"use strict";var o=r(6),n=r(772),i=r(835),s=r(771),a=o.createClass({displayName:"Caption",propTypes:{msg:o.PropTypes.instanceOf(s).isRequired},render:function(){var e=this.props.msg;return o.createElement("div",{className:"image-caption message-text","data-id":e.id},o.createElement(i,{msg:e}),o.createElement(n,{direction:"auto",selectable:!0,text:e.caption,linkify:!0}))}});e.exports=a},835:function(e,t,r){"use strict";var o=r(6),n=r(771),i=r(153),s=o.createClass({displayName:"HiddenText",propTypes:{msg:o.PropTypes.instanceOf(n).isRequired},render:function(){var e=this.props.msg,t=e.senderObj.formattedUser,r="["+i.timeStr(e.t)+"]";return o.createElement("span",{className:"message-pre-text"},"",r,"",t,":")}});e.exports=s},836:function(e,t,r){"use strict";var o=r(6),n=r(79),i=r(104),s=r(154),a=r(782),d=r(953),c=r(45),l=r(689),u=r(77),p=o.createClass({displayName:"EmojiInput",mixins:[n,i,s],propTypes:{focusOnMount:o.PropTypes.bool,editable:o.PropTypes.bool,value:o.PropTypes.string,selection:o.PropTypes.object,className:o.PropTypes.string,placeholder:o.PropTypes.string,onKeyPress:o.PropTypes.func,onEnter:o.PropTypes.func,onChange:o.PropTypes.func,onFocus:o.PropTypes.func,onBlur:o.PropTypes.func,onMouseDown:o.PropTypes.func,onSelectionChange:o.PropTypes.func,maxLength:o.PropTypes.number,showRemaining:o.PropTypes.bool,multiline:o.PropTypes.bool},getDefaultProps:function(){return{editable:!0,value:""}},getInitialState:function(){return this.value=this.props.value||"",this.length=d.multibyteLength(this.value),this.selection=this.props.selection,null},componentWillMount:function(){this.debouncedSaveSelection=this.safeDebounce(this._saveSelection,0)},componentWillReceiveProps:function(e){if(e.value!==this.value&&(this.setNewValue(e.value||"",!1),this.updateDOM(),this.safeDefer(this.restoreFocus.bind(this,!0))),this.props.editable!==e.editable){var t=this.refs.input;t.contentEditable=e.editable,e.editable&&this._disableObjectResize()}},restoreFocus:function(e){if(this.props.editable){var t=this.refs.input;if(t.blur(),t.focus(),this.selection&&!e)this.restoreSelection(this.selection);else{var r=window.getSelection();r.selectAllChildren(t),r.collapseToEnd()}this.debouncedSaveSelection()}},componentDidMount:function(){this.props.focusOnMount&&this.safeDefer(this.restoreFocus),this.props.editable&&this._disableObjectResize(),this.setRemaining(),this.refs.input.restoreFocus=this.restoreFocus},componentWillUnmount:function(){this.refs.input.restoreFocus=null},_disableObjectResize:function(){c.isGecko&&document.execCommand("enableObjectResizing",!1,!1)},limitLength:function(e){var t=this.props.maxLength;if(!t)return e;e=e||"";var r=this.selectionLength(),o=r+t-d.multibyteLength(this.value);return o>0?d.multibyteSubstr(e,0,o):""},onMouseDown:function(e){e.stopPropagation(),this.regNativeListener(window,"mouseup",this.onWindowMouseUp),this.props.onMouseDown&&this.props.onMouseDown(e)},onWindowMouseUp:function(){this.unregNativeListener(window,"mouseup",this.onWindowMouseUp),this.debouncedSaveSelection()},onContextMenu:function(e){e.stopPropagation()},onKeyUp:function(e){if(c.isTrident&&this.onInput(e),"Backspace"===e.key||"Delete"===e.key){var t=this.refs.input;switch(t.innerHTML){case"\n":case"\r\n":case"<br>":t.innerHTML="",this.value=""}}this.debouncedSaveSelection()},onKeyPress:function(e){if(c.isTrident&&this.onInput(e),!this.props.onKeyPress||(this.props.onKeyPress(e),!e.defaultPrevented)){this.props.multiline||"Enter"!==e.key||(e.preventDefault(),this.props.onEnter&&this.props.onEnter(e));var t=this.limitLength(l.ucs2.encode([e.charCode]));t.length||e.preventDefault()}},onInput:function(e){var t=this.refs.input;this.setNewValue(a.NodeToEmoji(t),!0)},setNewValue:function(e,t){if(e!==this.value){if(e&&!this.value){var r=this.refs.placeholder;r&&(r.style.display="none")}else if(this.value&&!e){var r=this.refs.placeholder;r&&(r.style.display="")}this.value=e,this.length=d.multibyteLength(e),t&&this.props.onChange&&this.props.onChange({target:{value:e}}),this.setRemaining(),this.debouncedSaveSelection()}},setRemaining:function(){this.props.showRemaining&&this.props.maxLength&&(this.refs.counter.innerHTML=this.props.maxLength-this.length)},updateDOM:function(){var e=a.emojiToHTML(_.escape(this.value)),t=this.refs.input;t.innerHTML!==e&&(t.innerHTML=e),
this.setRemaining()},selectionLength:function(){if(!this.props.editable)return 0;var e=this.refs.input;e.focus();var t=window.getSelection();if(t.rangeCount){var r=t.getRangeAt(0);return d.multibyteLength(a.NodeToEmoji(r.cloneContents()))}return 0},_saveSelection:function(){var e=this.getSelection();_.isEqual(e,this.prevSelection)||(this.props.onSelectionChange&&this.props.onSelectionChange(e),this.prevSelection=this.selection,this.selection=e)},isCollapsed:function(){if(this.isMounted()){var e=this.refs.input;if(document.activeElement!==e)return null;var t=window.getSelection();return t.isCollapsed}},getCursor:function(){if(!this.isMounted())return-1;var e=this.refs.input;if(document.activeElement!==e)return null;var t=window.getSelection(),r=t.anchorNode,o=t.anchorOffset,n=e.childNodes,i=0;e===r&&(r=n[o]);for(var s=0;s<n.length;s++){var a=n[s];if(a===r)return i+o;a.nodeType===window.Node.ELEMENT_NODE&&a.alt?i+=a.alt.length:a.nodeType===window.Node.TEXT_NODE&&(i+=a.length)}return i},isAtBeginning:function(){return this.isCollapsed()&&0===this.getCursor()},isAtEnd:function(){return this.isCollapsed()&&this.getCursor()===this.value.length},getSelection:function(){if(!this.isMounted())return null;var e=this.refs.input;if(document.activeElement!==e)return null;for(var t=window.getSelection(),r=t.anchorNode,o=t.anchorOffset,n=t.focusNode,i=t.focusOffset,s=e.childNodes,a=-1,d=-1,c=!1,l=!1,u=0;u<s.length;u++){var p=s[u];if(p===r&&(a=u,c=!0),p===n&&(d=u,l=!0),c&&l)break}return{anchor:{index:a,offset:o},focus:{index:d,offset:i}}},restoreSelection:function(e){var t,r,o,n,i,s,a=this.refs.input,d=a.childNodes;-1===e.anchor.index?(t=a,o=e.anchor.offset,i=0):(t=d[e.anchor.index],o=e.anchor.index,i=e.anchor.offset),-1===e.focus.index?(r=a,n=e.focus.offset,s=0):(r=d[e.focus.index],n=e.focus.index,s=e.focus.offset);var l;l=o===n?s>=i?"forward":"reverse":o>n?"reverse":"forward";var u=window.getSelection();if(t&&r)try{var p=document.createRange();return void(c.isTrident?("forward"===l?(p.setStart(t,e.anchor.offset),p.setEnd(r,e.focus.offset)):(p.setStart(r,e.focus.offset),p.setEnd(t,e.anchor.offset)),u.removeAllRanges(),u.addRange(p)):(p.setStart(t,e.anchor.offset),u.removeAllRanges(),u.addRange(p),u.extend(r,e.focus.offset)))}catch(h){u.selectAllChildren(a),u.collapseToEnd()}else u.selectAllChildren(a),u.collapseToEnd()},onCut:function(e){c.isTrident&&this.onInput(e)},onPaste:function(e){if(this.props.onPaste&&this.props.onPaste(e),!e.defaultPrevented){e.preventDefault();var t=c.isTrident?"text":"text/plain",r=e.clipboardData.getData(t);this.pasteText(r)}},pasteText:function(e){e&&(this.props.maxPaste&&e.length>this.props.maxPaste?this.props.onMaxPasteExceeded():this.replaceSelection(e))},replaceSelection:function(e){if(this.props.editable&&(this.refs.input.focus(),e=this.limitLength(e),0!==e.length)){this.props.multiline||(e=e.replace(/\n+/g," ").replace(/(\r\n)+/g," "));var t=a.emojiToHTML(_.escape(e));c.isTrident?this.replaceSelectionTrident(t):document.execCommand("insertHTML",!1,t),this.onInput(),this.debouncedSaveSelection()}},replaceSelectionTrident:function(e){var t=window.getSelection();if(t.getRangeAt&&t.rangeCount){var r=t.getRangeAt(0);r.deleteContents();var o=document.createElement("div");o.innerHTML=e;for(var n,i,s=document.createDocumentFragment();n=o.firstChild;)i=s.appendChild(n);r.insertNode(s),i&&(r=r.cloneRange(),r.setStartAfter(i),r.collapse(!0),t.removeAllRanges(),t.addRange(r))}},shouldComponentUpdate:function(){return!1},render:function(){var e=a.emojiToHTML(_.escape(this.value)),t=this.props.className?"input "+this.props.className:"input",r=this.props.showRemaining?o.createElement("span",{className:"input-counter",ref:"counter"}):null,n=u("input-emoji",{"input-remaining":this.props.showRemaining}),i=this.props.placeholder&&!this.props.value?o.createElement("div",{className:"input-placeholder",ref:"placeholder"},this.props.placeholder):null;return o.createElement("div",{className:n},i,o.createElement("div",{dangerouslySetInnerHTML:{__html:e},dir:"auto",ref:"input","data-tab":this.props.editable?1:null,contentEditable:this.props.editable,className:t,onInput:this.onInput,onPaste:this.onPaste,onCut:this.onCut,onKeyUp:this.onKeyUp,onKeyPress:this.onKeyPress,onMouseDown:this.onMouseDown,onContextMenu:this.onContextMenu,onFocus:this.props.onFocus,onBlur:this.props.onBlur}),r)}});e.exports=p},837:function(e,t,r){"use strict";var o=r(6),n=r(15),i=r(103),s=r(104),a=r(154),d=r(79),c=r(782),l=r(946),u=r(772),p=r(9),h=r(777),m=r(346),f=r(78),g=r(105),v={RECENT:"Recent",SMILEYS_PEOPLE:"Smileys & People",ANIMALS_NATURE:"Animals & Nature",FOOD_DRINK:"Food & Drink",ACTIVITY:"Activity",TRAVEL_PLACES:"Travel & Places",OBJECTS:"Objects",SYMBOLS:"Symbols",FLAGS:"Flags"},y=["Recent","Smileys & People","Animals & Nature","Food & Drink","Activity","Travel & Places","Objects","Symbols","Flags"],E=[""].concat(c.skinToneVariations),T=o.createClass({displayName:"EmojiPanel",propTypes:{onEmoji:o.PropTypes.func.isRequired},getInitialState:function(){var e=Store.RecentEmoji.length>0?v.RECENT:v.SMILEYS_PEOPLE,t=n.getLastEmojiTab();return y.indexOf(t)>-1&&(e=t),{selected:e}},componentWillUnmount:function(){n.setLastEmojiTab(this.state.selected)},onSelectTab:function(e){var t=y.indexOf(this.state.selected),r=y.indexOf(e),o=r>t?"right":"left";this.setState({selected:e,direction:o})},onEmoji:function(e){this.props.onEmoji(e),Store.RecentEmoji.increment(e)},render:function(){var e=o.createElement("div",{className:"emoji-panel-body",key:"emoji-"+this.state.selected},o.createElement(b,{tab:this.state.selected,onEmoji:this.onEmoji})),t=[{css:"icon-emoji-recent",tab:v.RECENT},{css:"icon-emoji-smileys",tab:v.SMILEYS_PEOPLE},{css:"icon-emoji-animals",tab:v.ANIMALS_NATURE},{css:"icon-emoji-food",tab:v.FOOD_DRINK},{css:"icon-emoji-activity",tab:v.ACTIVITY},{css:"icon-emoji-travel",tab:v.TRAVEL_PLACES},{css:"icon-emoji-objects",tab:v.OBJECTS},{css:"icon-emoji-symbols",tab:v.SYMBOLS},{css:"icon-emoji-flags",tab:v.FLAGS}],r=this;t=t.map(function(e){var t=o.createElement("button",{className:"menu-item"+(r.state.selected===e.tab?" active":""),onClick:r.onSelectTab.bind(null,e.tab),key:e.tab,title:e.tab},o.createElement("span",{className:"icon "+e.css}));return t});var n=l10n.isRTL()?-1:1,i={width:100/y.length+"%",transform:"translateX("+100*y.indexOf(this.state.selected)*n+"%)"},s="right"===this.state.direction?"slide-forward":"slide-back";return o.createElement("div",{className:"emoji-panel k"},o.createElement("div",{className:"menu-tabs menu-tabs-emoji emoji-panel-header","data-active-tab":this.state.selected},o.createElement("div",{style:i,className:"menu-tabs-marker"}),t),o.createElement(g,{transitionName:s},e))}});e.exports=T;var b=o.createClass({displayName:"EmojiTab",mixins:[i,a,s,d],propTypes:{tab:o.PropTypes.oneOf(y).isRequired,onEmoji:o.PropTypes.func.isRequired},getInitialState:function(){return this.props.tab===v.RECENT?{recent:Store.RecentEmoji.models.map(function(e){return c.emojiMap[e["char"]]}),variants:{}}:void 0},componentDidMount:function(){var e=this;this.addObserver(Store.EmojiVariant,"add remove change:variant",function(){e.forceUpdate()})},componentWillUnmount:function(){f.popDependents(this)},onEmoji:function(e){f.popDependents(this),this.props.onEmoji(e)},setEmojiVariant:function(e,t){if(this.onEmoji(t),Store.EmojiVariant.setVariant(e,t),this.state.recent){var r=this.state.variants;r[e]=t,this.setState({variants:r})}return f.pop(f.TOOLTIP),!0},onContextMenu:function(e,t,r){this.clearPickerTimer(),e&&(e.preventDefault(),e.stopPropagation());var n=this.setEmojiVariant,i=c.skinToneEmojis[t],s=E.map(function(e,r){var s=i+e;return o.createElement(h,{key:s,action:_.partial(n,t,s)},o.createElement(u,{text:s,emojiSize:u.EMOJI_SIZE.LARGE}))});p.openTooltip(s,{anchor:r||e.target,type:m.Type.PICKER,parent:this,menuDirection:{x:m.Direction.X.RIGHT,y:m.Direction.Y.TOP}})},clearPickerTimer:function(){this.pickerTimer&&(this.unregNativeListener(window,"mouseup",this.clearPickerTimer,!0),this.clearSafeTimeout(this.pickerTimer),this.pickerTimer=null)},eatClick:function(e){e.preventDefault(),e.stopPropagation(),this.unregCmd("window_click",this.eatClick)},startPickerTimer:function(e,t){this.clearPickerTimer();var r=e.target;this.pickerTimer=this.safeDelay(function(){this.regCmd("window_click",this.eatClick),this.onContextMenu(null,t,r)},250),this.regNativeListener(window,"mouseup",this.clearPickerTimer,!0)},getEmoji:function(){var e=this.onContextMenu,t=this.startPickerTimer,r=this.onEmoji,n=this.state.recent?this.state.recent:l[this.props.tab];return n.map(function(n){var i,s,a,d=c.codeToEmoji[n];if(c.skinToneEmojis[d]){s=function(t){e(t,d,t.target)},a=_.partial(t,_,d);var l;this.state.recent?(l=this.state.variants[d],l?(n=c.emojiMap[l],i=_.partial(r,l)):i=_.partial(r,d)):(l=Store.EmojiVariant.getVariant(d),l?(n=c.emojiMap[l],i=_.partial(r,l)):i=s)}else i=_.partial(r,d);return o.createElement("span",{key:d,onClick:i,onContextMenu:s,onMouseDown:a,className:"emojik emoji"+n})}.bind(this))},render:function(){var e="emoji-"+this.props.tab;return o.createElement("div",{className:e},this.getEmoji())}})},838:function(e,t,r){"use strict";var o=r(6),n=r(9),i=r(104),s=r(913),a=o.createClass({displayName:"MediaViewerFlow",mixins:[i],propTypes:{startId:o.PropTypes.string.isRequired},getInitialState:function(){var e=Store.Msg.get(this.props.startId),t=e.chat.mediaMsgs(),r=t.indexOf(e);return{mediaMsgs:t,index:r}},componentWillMount:function(){this.regNativeListener(window,"keydown",this.onKeyDown)},componentDidMount:function(){this.hasRendered=!0},onKeyDown:function(e){37===e.keyCode?this.onPrev():39===e.keyCode&&this.onNext()},onNext:function(e){e&&e.stopPropagation(),this.state.index<this.state.mediaMsgs.length-1&&this.setState({index:this.state.index+1})},onPrev:function(e){e&&e.stopPropagation(),this.state.index>0&&this.setState({index:this.state.index-1})},endFlow:function(){n.closeModal()},render:function(){var e=void 0,t=void 0;return(t=this.state.mediaMsgs[this.state.index])&&(e=o.createElement(s,{msg:t,onBack:this.endFlow,onNext:this.onNext,onPrev:this.onPrev,zoomIn:!this.hasRendered})),o.createElement("div",null,e)}});e.exports=a},839:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(6),a=r(11),d=r(104),c=r(154),l=r(8),u=r(790),p=r(774),h=r(776),m=r(775),f=r(803),g=r(155),v=r(105),y=r(793),E=r(78),T=function(e){return 150+15*e},b=400,S=10,C="image",M="video",N="url",w="invalid",P={ACTIVE:"active",PROCESSING:"processing",INVALID:"invalid"},R=s.createClass({displayName:"AttachMediaDrawer",mixins:[d,c],propTypes:{files:s.PropTypes.array,state:s.PropTypes.oneOf(_.values(P)),onBack:s.PropTypes.func.isRequired,onSend:s.PropTypes.func.isRequired},statics:{STATE:P},getDefaultProps:function(){return{state:P.PROCESSING,reason:null,isDragging:!1}},getInitialState:function(){return{state:this.props.state,activeIndex:-1,media:[]}},componentWillMount:function(){this.regNativeListener(window,"keydown",this.onKeyDown),this.regNativeListener(window,"drop",this.onWindowDrop)},componentDidMount:function(){if(this.props.files){var e=this;this.safeDelay(function(){e.initialize()},300)}},componentWillUnmount:function(){var e=this;this.state.media.forEach(function(t){var r=e.getFileType(t.file);r===M&&window.URL.revokeObjectURL(t.vid)})},componentDidUpdate:function(){this.state.state!==P.INVALID&&this.state.reason&&this.setState({reason:null})},initialize:function(){var e=this.props.files;e=e.slice(0,Math.min(e.length,S)),this.processFiles(e).bind(this).then(function(e){this.isMounted()&&this.setState({media:e,state:P.ACTIVE,activeIndex:0})})["catch"](function(e){this.isMounted()&&this.setState({state:P.INVALID,reason:e,activeIndex:-1,prevIndex:void 0})})},getFileType:function(e){var t=e.type;return t.match(/url/)?N:t.match(/^image\/.*/)?C:t.match(/^video\/.*/)?M:w},processFiles:function(e){var t=this;return t.setState({state:P.PROCESSING}),i["default"].all(e.map(function(e){if(e.size>l.MAX_MEDIA_UPLOAD_SIZE){var r=new a.MediaFileTooLarge;return r.file=e,i["default"].reject(r)}var o=t.getFileType(e),n=Math.ceil(1e6*Math.random());switch(o){case M:var s=window.URL.createObjectURL(e);return f.generateVideoThumb(s,l.IMG_MAX_EDGE,l.IMG_MAX_EDGE).then(function(t){return{file:e,img:t.url,width:t.width,height:t.height,vid:s,key:n}})["catch"](function(){return window.URL.revokeObjectURL(s),i["default"].reject("Failed to generate video thumb")});case C:return f.resizeAndOrient(e,l.IMG_MAX_EDGE,l.IMG_MAX_EDGE).then(function(e){return{file:window.dataURLtoBlob(e.url),img:e.url,width:e.width,height:e.height,key:n}});case N:return f.crop(e.url,0,0,l.IMG_MAX_EDGE,l.IMG_MAX_EDGE).then(function(e){return{file:window.dataURLtoBlob(e.url),img:e.url,width:e.width,height:e.height,key:n}});default:return i["default"].reject(new a.InvalidMediaFileType)}}))},onDragOver:function(e){this.state.isDragging||this.setState({isDragging:!0})},onWindowDrop:function(e){_.isEmpty(this.props.files)&&_.isEmpty(this.state.media)&&this.props.onBack()},onDrop:function(e){this.setState({isDragging:!1}),this.onFilePick(e)},onDragLeave:function(e){this.state.media.length||this.props.onBack(),this.setState({isDragging:!1})},onKeyDown:function(e){if(this.state.state!==P.INVALID&&!e.repeat)if(37===e.keyCode){var t=this.state.media[this.state.activeIndex],r=this.refs.emojiInput&&this.refs.emojiInput.refs.inputLine;(t&&!t.caption||r&&r.isAtBeginning())&&this.onPrev()}else if(39===e.keyCode){var t=this.state.media[this.state.activeIndex],r=this.refs.emojiInput&&this.refs.emojiInput.refs.inputLine;(t&&!t.caption||r&&r.isAtEnd())&&this.onNext()}},onNext:function(){this.state.activeIndex+1<this.state.media.length&&this.setState({prevIndex:this.state.activeIndex,activeIndex:this.state.activeIndex+1,state:P.ACTIVE})},onPrev:function(){this.state.activeIndex>0&&this.setState({prevIndex:this.state.activeIndex,activeIndex:this.state.activeIndex-1,state:P.ACTIVE})},onSelectThumb:function(e,t){e!==this.state.activeIndex&&this.setState({prevIndex:this.state.activeIndex,activeIndex:e,state:P.ACTIVE})},onSend:function(){this.props.onSend(this.state.media)},onAddFileClick:function(e){var t=this.refs.input;t.click()},onFilePick:function(e){for(var t=[],r=e.target.files||e.dataTransfer.files,o=r.length+this.state.media.length>S?Math.max(S-this.state.media.length,0):r.length,n=0;o>n;n++)t.push(r[n]);!r.length&&this.state.media.length<S&&e.dataTransfer.getData("text/uri-list")&&t.push({type:"url",url:e.dataTransfer.getData("text/uri-list")}),this.processFiles(t).bind(this).then(function(e){if(this.isMounted()){var t=this.state.media.concat(e);this.setState({prevIndex:void 0,activeIndex:Math.min(this.state.media.length,9),media:t,state:P.ACTIVE})}})["catch"](function(e){this.isMounted()&&this.setState({state:P.INVALID,activeIndex:-1,reason:e,prevIndex:void 0})}),e.target.value=""},onRemoveThumb:function(e,t){t.stopPropagation(),t.preventDefault();var r=this.state.media;r.splice(e,1);var o=this.state.activeIndex;o>=e&&(o=Math.max(--o,0)),this.setState({prevIndex:void 0,activeIndex:r.length?o:-1,media:r})},onCaptionChange:function(e){var t=this.state.media;t[this.state.activeIndex].caption=e.target.value,this.setState({media:t})},render:function(){var e,t,r,o=this,n=0,i="media-scale",d=this.state.activeIndex;if(this.state.state===P.PROCESSING)e=s.createElement(g,{key:"processing"});else if(this.state.state===P.ACTIVE&&d>-1){var c=this.state.media[d],f=this.getFileType(c.file),N=c.width&&c.height?{width:c.width,height:c.height}:null;f===C?e=s.createElement("img",{src:c.img,className:"media-viewer-img"}):f===M&&(e=s.createElement("video",{controls:!0,className:"media-viewer-img",type:c.file.type,src:c.vid})),e=s.createElement("div",{className:"media-body-container",key:this.state.media[d].key},s.createElement("div",{className:"media-element-container"},s.createElement("div",{className:"media-element"},s.createElement(u,{type:u.TYPES.SCALE_DOWN,size:N},e))),s.createElement("div",{className:"media-caption"},s.createElement(y,{id:E.CAPTION_INPUT,ref:"emojiInput",editable:!0,value:this.state.media[d].caption,floating:!1,maxLength:l.MAX_CAPTION_LENGTH,showRemaining:!0,placeholder:l10n.t("add_a_caption"),onEnter:this.onSend,onChange:this.onCaptionChange}))),_.isNumber(this.state.prevIndex)&&this.state.prevIndex!==d&&(i=this.state.prevIndex<d?"media-slide-forward":"media-slide-back")}else if(this.state.state===P.INVALID){var w,R=this.state.reason;if(R instanceof a.MediaFileTooLarge)switch(this.getFileType(R.file)){case C:w=l10n.t("image_too_big");break;case M:w=l10n.t("video_too_big")}w=w||l10n.t("invalid_media_files"),e=s.createElement("div",{className:"invalid-media-container",key:"pending"},s.createElement("div",{className:"invalid-media"},w))}this.state.media.length>0&&(t=this.state.media.map(function(e,t){var r="media-thumb stagger-delay";t===o.state.activeIndex&&(r+=" active");var n=Math.max(o.state.media.length-o.state.activeIndex-1,1),i=T(t)/n*Math.max(0,t-o.state.activeIndex)+"ms",a={backgroundImage:"url("+e.img+")"};return s.createElement("div",{className:r,key:"media-"+e.key,onClick:o.onSelectThumb.bind(null,t),staggerDelay:i},s.createElement("span",{className:"btn-delete icon icon-x-alt-light",onClick:o.onRemoveThumb.bind(null,t)}),s.createElement("div",{className:"media-thumb-body",style:a}))}),n=1===this.state.media.length?b:b+T(this.state.media.length),r=s.createElement("div",{className:"drawer-controls"},s.createElement("button",{className:"btn btn-round btn-l","data-ignore-capture":E.IGNORE_ANY,onClick:this.onSend},s.createElement("span",{className:"icon icon-send-light"}))));var k=this.state.isDragging?s.createElement("div",{key:"container",className:"drag-drop"},s.createElement("div",{className:"stitching"},l10n.t("drag_media_here"))):null,x=this.state.media.length<S?s.createElement("div",{key:"media-more",className:"media-thumb btn-add-media",onClick:this.onAddFileClick},s.createElement("button",{className:"btn-fill"},s.createElement("span",{className:"icon icon-add-alt"}),l10n.t("add_media"))):null;return s.createElement(p,{key:"attach-image-modal",ref:"container",position:"right",id:"media",variant:"noheader",onDrop:this.onDrop,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave},s.createElement(h,{title:l10n.t("web_preview_msg"),type:h.Type.OFFSET,onCancel:this.props.onBack}),s.createElement(m,null,k,s.createElement("div",{className:"media-body"},s.createElement(v,{transitionName:i},e)),s.createElement(v,{transitionName:"thumb-scale",className:"media-collection"},t,x),s.createElement(v,{transitionName:"btn",delay:n},r),s.createElement("input",{ref:"input",type:"file",accept:l.IMAGE_MIMES+","+l.VIDEO_MIMES,style:{display:"none"},onChange:this.onFilePick,multiple:!0})))}});e.exports=R},840:function(e,t,r){"use strict";var o=r(6),n=r(30),i=r(1),s=r(870),a=r(790),d=r(154),c=r(104),l=r(774),u=r(776),p=r(775),h=r(77),m=r(793),f=r(78),g=r(8),v=r(105),y={ANIMATING:"animating",LOADING:"loading",RECORDING:"active",SENDING:"sending"},E=o.createClass({displayName:"CaptureDrawer",mixins:[c,d],propTypes:{noContainer:o.PropTypes.bool,stream:o.PropTypes.object.isRequired,caption:o.PropTypes.bool,onBack:o.PropTypes.func.isRequired,onSend:o.PropTypes.func.isRequired},statics:{State:y},getInitialState:function(){return{state:y.ANIMATING,img:void 0,url:void 0}},componentDidMount:function(){this.safeDelay(function(){this.setState({state:y.LOADING,url:window.URL.createObjectURL(this.props.stream)})},300)},componentWillUnmount:function(){if(this.state.url){var e=this.props.stream;if(_.isFunction(e.stop))e.stop();else for(var t=e.getTracks(),r=0;r<t.length;r++)t[r].stop();window.URL.revokeObjectURL(this.state.url)}},onCapture:function(e){var t=document.createElement("canvas");if(this.refs.video){var r=n.findDOMNode(this.refs.video);t.height=r.videoHeight,t.width=r.videoWidth;var o=t.getContext("2d");o.translate(t.width,0),o.scale(-1,1),o.drawImage(r,0,0,r.videoWidth,r.videoHeight);var i=t.toDataURL("image/jpeg");this.setState({state:y.SENDING,img:i})}},onVideoLoaded:function(e){this.setState({state:y.RECORDING,videoSize:{width:e.target.videoWidth,height:e.target.videoHeight}})},onRetake:function(e){this.setState({state:y.RECORDING,caption:void 0})},onSend:function(e){this.props.onSend({file:window.dataURLtoBlob(this.state.img),caption:this.state.caption})},onCaptionChange:function(e){this.setState({caption:e.target.value})},render:function(){var e,t,r,n;switch(this.state.state){case y.ANIMATING:break;case y.LOADING:case y.RECORDING:var d=h("capture-video media-viewer-img webcam",{"capture-video-inactive":this.state.state===y.LOADING});r=o.createElement("div",{key:"webcam"},o.createElement(a,{type:a.TYPES.COVER,size:this.state.videoSize},o.createElement(s,{className:d,autoPlay:!0,ref:"video",onPlay:this.onVideoLoaded,src:this.state.url}))),e=o.createElement("div",{className:"drawer-controls fade",key:"btn-capture"},o.createElement("button",{className:"btn btn-round btn-l",onClick:this.onCapture},o.createElement("span",{className:"icon icon-camera-light"})));break;case y.SENDING:var c={backgroundImage:"url("+this.state.img+")"};r=o.createElement("div",{key:"snapshot"},o.createElement(a,{type:a.TYPES.COVER,size:this.state.videoSize},o.createElement("div",{className:"capture-image snapshot",style:c})));var E=this.props.noContainer?"icon icon-checkmark-light-l":"icon icon-send-light";e=o.createElement("div",{className:"drawer-controls btn-send",key:"btn-send"},o.createElement("button",{className:"btn btn-round btn-l","data-ignore-capture":f.IGNORE_ANY,onClick:this.onSend},o.createElement("span",{className:E}))),t=o.createElement("div",{className:"drawer-header-action",onClick:this.onRetake},o.createElement("span",{className:"icon icon-refresh-light"}),l10n.t("retake")),n=o.createElement(m,{id:f.CAPTION_INPUT,ref:"emojiInput",editable:!0,value:this.state.caption,floating:!1,maxLength:g.MAX_CAPTION_LENGTH,showRemaining:!0,placeholder:l10n.t("add_a_caption"),onEnter:this.onSend,onChange:this.onCaptionChange});break;default:i.log("captureDrawer:render Unhandled video capture state "+this.state.state)()}var _=void 0;_=this.props.caption?o.createElement("div",{className:"media-collection"},o.createElement(v,{transitionName:"media-caption",className:"media-caption"},n),o.createElement(v,{transitionName:"pop_delay"},e)):o.createElement("div",{className:"media-collection-no-caption"},o.createElement(v,{transitionName:"pop_delay"},e));var T=this.props.noContainer?u.Type.POPUP:u.Type.OFFSET;return o.createElement(l,{key:"attach-capture-modal",position:"right",id:"capture",variant:"noheader",noContainer:this.props.noContainer},o.createElement(u,{title:l10n.t("take_photo"),type:T,onCancel:this.props.onBack},t),o.createElement(p,null,o.createElement("div",{className:"media-body"},o.createElement("div",{className:"media-body-container"},o.createElement(v,{transitionName:"capture"},r))),_))}});e.exports=E},841:function(e,t,r){"use strict";var o=r(6),n=r(842),i=r(813),s=r(156),a=r(779),d=r(806),c=r(787),l=r(103),u=r(77),p=o.createClass({displayName:"ContactsModal",mixins:[l],propTypes:{title:o.PropTypes.string.isRequired,contacts:o.PropTypes.arrayOf(o.PropTypes.instanceOf(s)),filter:o.PropTypes.func,onCancel:o.PropTypes.func.isRequired,onSelect:o.PropTypes.func.isRequired},getDefaultProps:function(){return{filter:function(e){return Store.Contact.isFilteredContact(e)}}},getInitialState:function(){return this.selection=new i,{searchFilter:void 0}},componentWillMount:function(){this.props.contacts||this.addObserver(Store.Contact,"add remove change:name")},onSelect:function(e,t){var r=t.props.contact;this.props.filter(r)===!0&&this.props.onSelect(r)},onSearch:function(e){this.setState({searchFilter:e})},render:function(){var e=this.props,t=e.title,r=e.onCancel,i=e.filter,s=e.onSelect,l=l10n.accentFold(this.state.searchFilter),p=this.props.contacts||Store.Contact,h=p.filter(function(e){return i(e)&&(!l||l&&e.searchMatch(l))}),m=[];if(h.length){this.selection.init(_.pluck(h.filter(function(e){return i(e)===!0}),"id"));for(var f=void 0,g=void 0,v=h.length>10,y=0;y<h.length;y++){f=h[y],v&&f.header!==g&&m.push(o.createElement(d,{key:f.header,header:f.header}));var E=_.isString(i(f)),T=void 0;y<h.length-1&&h[y+1].header!==f.header&&(T="last");var b=void 0;E&&(b=o.createElement("div",{className:"chat-status ellipsify",title:i(f)},i(f)),T=u(T,"member")),m.push(o.createElement(a,{contact:f,active:this.selection,className:T,secondary:b,onClick:E?void 0:s.bind(null,f),key:f.id})),g=f.header}}else m=o.createElement(c.SearchContacts,null);return o.createElement(n,{title:t,selection:this.selection,onSearch:this.onSearch,searchPlaceholder:l10n.t("search_contacts"),onSelect:this.onSelect,onCancel:r},m)}});e.exports=p},842:function(e,t,r){"use strict";var o=r(6),n=r(774),i=r(776),s=r(775),a=r(342),d=a.HotKeys,c=r(794),l=r(78),u=r(778),p=r(810),h=r(813),m={LIST:"list",SEARCH:"search"},f=o.createClass({displayName:"ListModal",propTypes:{title:o.PropTypes.string.isRequired,selection:o.PropTypes.instanceOf(h),onSearch:o.PropTypes.func,searchPlaceholder:o.PropTypes.string,onCancel:o.PropTypes.func.isRequired,onSelect:o.PropTypes.func},getDefaultProps:function(){return{searchPlaceholder:l10n.t("search")}},getInitialState:function(){return{searchText:""}},onNext:function(e){e.preventDefault(),e.stopPropagation();var t=this.props.selection;t&&t.setNext()},onPrev:function(e){var t=this.props.selection;if(t){e.preventDefault(),e.stopPropagation();var r=t.prev();r>-1?t.setPrev():(t.unset(),d.flashFocus=Date.now(),this.refs[m.SEARCH].focus())}},onFocusList:function(e){this.refs[m.LIST]&&(e.preventDefault(),e.stopPropagation(),d.flashFocus=Date.now(),this.props.selection.setFirst())},onSelectFirst:function(e){e.preventDefault(),e.stopPropagation();var t=_.first(this.props.children);t&&this.props.onSelect(e,t)},onSearch:function(e){this.setState({searchText:e}),this.props.onSearch(e)},render:function(){var e=this.props,t=e.title,r=e.onCancel,a=e.onSearch,h=e.searchPlaceholder,f=e.children,g={down:this.onFocusList,enter:this.onSelectFirst},v={down:this.onNext,up:this.onPrev};g={},v={};var y=void 0;a&&(y=o.createElement(d,{handlers:g},o.createElement(c,{ref:m.SEARCH,searchText:this.state.searchText,onSearch:this.onSearch,searchType:l.CONTACT_SEARCH,placeholder:h})));var E=void 0;return E=f&&f.length?o.createElement(d,{handlers:v},o.createElement(u,{classes:["chatlist"],ref:m.LIST,data:f,height:72,extraItems:4})):f,o.createElement(p,{type:p.TOWER},o.createElement(n,{key:"contact-modal",onCancel:r,position:"right"},o.createElement(i,{title:t,type:i.Type.POPUP,onCancel:r}),y,o.createElement(s,{"data-list-scroll-container":!0},E)))}});e.exports=f},843:function(e,t,r){"use strict";var o=r(60),n={dataTypes:{msgKey:{set:function(e){return e instanceof o?{val:e,type:"msgKey"}:void 0},compare:function(e,t,r){return e&&t&&e.toString()===t.toString()}}}};e.exports=n},844:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(6),a=r(1),d=r(21),c=r(59),l=r(35),u=r(9),p=r(80),h=r(11),m=r(159),f=r(160),g=c.extend({props:{id:"string",expiration:{type:"number","default":0}},session:{_unmuteTimer:"string"},derived:{isMuted:{deps:["expiration"],fn:function(){return!!this.expiration}}},initialize:function(){this.expiration&&this.mute(this.expiration)},setMute:function(e,t){(e||this.expiration)&&e!==this.expiration&&(e?this.mute(e,t):this.unmute(t))},mute:function v(e,t){if(!_.isNumber(e))return a.log("models:Mute:mute called with invalid expiration "+e)(),i["default"].reject(new h.ActionError);e=Math.round(e),e>2e9&&a.log("models:Mute:mute called with wrong units?"+this.id+" exp:"+e)();var v=function(){this.isMuted&&this._clearUnmuteTimer();var t=e-moment().unix();a.log("models:Mute:mute "+this.id+" duration:"+t)(),this._unmuteTimer=f.setTimeout(this.unmute.bind(this),1e3*e),this.set({expiration:e})}.bind(this),r=d.isGroup(this.id);if(t){var o=l.sendConversationMute(this.id,e,this.expiration),n=r?l10n.t("action_group_muting"):l10n.t("action_chat_muting"),c=o["catch"](function(e){throw a.error("models:Mute:mute dropped")(e),r?l10n.t("action_group_mute_failed"):l10n.t("action_chat_mute_failed")}).then(function(e){if(200===e.status)return r?l10n.t("action_group_muted"):l10n.t("action_chat_muted");if(e.status>=400)throw r?l10n.t("action_group_mute_failed"):l10n.t("action_chat_mute_failed")});return u.openToast(s.createElement(m,{id:m.genId(),pendingText:n,actionText:c,retry:this.mute.bind(this,e,t)})),o.then(function(e){200!==e.status||e._duplicate||v()})}return v(),i["default"].resolve()},canMute:function(){return p.supportsFeature(p.F.MUTE)&&d.isGroup(this.id)||p.supportsFeature(p.F.MUTE_1_1)&&d.isUser(this.id)},_clearUnmuteTimer:function(){f.clearTimeout(this._unmuteTimer),this.unset("_unmuteTimer"),this.expiration=0},unmute:function y(e){var y=function(){a.log("models:Mute:unmute "+this.id)(),this._clearUnmuteTimer()}.bind(this),t=d.isGroup(this.id);if(e){var r=l.sendConversationMute(this.id,!1,this.expiration),o=t?l10n.t("action_group_unmuting"):l10n.t("action_chat_unmuting"),n=r["catch"](function(e){throw a.error("models:Mute:unmute dropped")(e),t?l10n.t("action_group_unmute_failed"):l10n.t("action_chat_unmute_failed")}).then(function(e){if(200===e.status)return t?l10n.t("action_group_unmuted"):l10n.t("action_chat_unmuted");if(e.status>=400)throw t?l10n.t("action_group_unmute_failed"):l10n.t("action_chat_unmute_failed")});return u.openToast(s.createElement(m,{id:m.genId(),pendingText:o,actionText:n,retry:this.unmute.bind(this,e)})),r.then(function(e){200!==e.status||e._duplicate||y()})}return y(),i["default"].resolve()},"delete":function(){c.prototype["delete"].call(this),this._clearUnmuteTimer()}});e.exports=g},845:function(e,t,r){"use strict";var o=r(6),n=r(793),i=r(105),s=r(155),a=r(77),d=r(78),c=o.createClass({displayName:"TextField",propTypes:{id:o.PropTypes.string,value:o.PropTypes.string.isRequired,placeholder:o.PropTypes.string,editable:o.PropTypes.bool,pending:o.PropTypes.bool,maxLength:o.PropTypes.number,showRemaining:o.PropTypes.bool,validate:o.PropTypes.func,onChange:o.PropTypes.func,onSave:o.PropTypes.func,onCancel:o.PropTypes.func},getDefaultProps:function(){return{placeholder:"",id:"",maxLength:25,editable:!1,showRemaining:!1,forceCancel:!1}},getInitialState:function(){return{editing:!1,value:this.props.value}},componentWillReceiveProps:function(e){this.setState({value:e.value})},onEdit:function(){this.setState({editing:!0})},onSave:function(e){e&&(e.preventDefault(),e.stopPropagation());var t=!0;this.props.validate&&(t=this.props.validate(this.props.value)),t?(this.props.onSave&&this.props.onSave(),this.setState({editing:!1})):this.props.onError&&this.props.onError()},uimClose:function(){this.onCancel()},uimFocus:function(){this.refs.input.focus()},onCancel:function(){this.state.editing&&this.setState({editing:!1},this.props.onCancel)},render:function(){var e,t=a({textfield:!0,"textfield-editable":this.props.editable,active:this.state.editing});return this.props.pending?e=o.createElement("div",{className:"icon icon-spinner"},o.createElement(s,{size:18,stroke:6})):this.state.editing?e=o.createElement("span",{className:"icon icon-checkmark",onClick:this.onSave,key:"btn-done",title:l10n.t("click_to_save_esc_to_cancel")},l10n.t("save_button")):this.props.editable&&(e=o.createElement("span",{className:"icon icon-pencil","data-ignore-capture":d.IGNORE_ANY,onClick:this.onEdit,key:"btn-edit",title:l10n.t("edit_button")},l10n.t("edit_button"))),o.createElement("div",{className:t},o.createElement(n,{id:this.props.id,ref:"input",placeholder:this.props.placeholder,value:this.state.value,editable:this.state.editing,maxLength:this.props.maxLength,showRemaining:this.props.showRemaining,onEnter:this.onSave,onChange:this.props.onChange,onCancel:this.onCancel,parent:this}),o.createElement(i,{transitionName:"pop",component:"div",className:"textfield-controls"},e))}});e.exports=c},846:function(e,t){
"use strict";var r={scrollIntoViewIfNeeded:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];if(_.isFunction(e.scrollIntoViewIfNeeded))return e.scrollIntoViewIfNeeded(t);var r=e.parentNode,o=window.getComputedStyle(r,null),n=parseInt(o.getPropertyValue("border-top-width")),i=e.offsetTop-r.offsetTop<r.scrollTop,s=e.offsetTop-r.offsetTop+e.clientHeight-n>r.scrollTop+r.clientHeight,a=i&&!s;(i||s)&&t&&(r.scrollTop=e.offsetTop-r.offsetTop-r.clientHeight/2-n+e.clientHeight/2),!i&&!s||t||e.scrollIntoView(a)}};e.exports=r},847:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){return a(function(){return p.get(e,t)})}function i(e){return a(function(){return p.head(e)})}function s(e,t){return a(function(){return p.post(e,t)})}function a(e){return u.loopOnError(m.ShouldLoop,function(t){var r;return r=l.state===l.STATE.CONNECTED?c["default"].delay(Math.floor(1e3*h.expBackoff(t,60,void 0,.1))):u.waitForBBEvent(l,"change:state",_.matches({state:l.STATE.CONNECTED})),r.then(function(){return e().then(function(e){if(e.state>=500)throw new m.ShouldLoop;return e})["catch"](function(){throw new m.ShouldLoop})})})}var d=r(3),c=o(d),l=r(14),u=r(36),p=r(107),h=r(81),m=r(11);e.exports={headRetry:i,getRetry:n,postRetry:s}},848:function(e,t,r){"use strict";var o=r(6),n=r(9),i=r(914),s=r(907),a=r(79),d=r(103),c=r(104),l=o.createClass({displayName:"ActionListener",mixins:[a,d,c],componentWillMount:function(){this.regCmd("mute_chat",this.onMute),this.regCmd("delete_or_exit_chat",this.onDeleteOrExit),this.regCmd("archive_chat",this.onArchive),this.regCmd("mark_chat_unread",this.onMarkUnread)},onMute:function u(e,t,r){if(t){var u=function(t){e.pendingAction++,e.mute.mute(t,!0)["finally"](function(){e.pendingAction--})};n.openModal(o.createElement(i,{chat:e,onMute:u}),null,r)}else e.pendingAction++,e.mute.unmute(!0)["finally"](function(){e.pendingAction--})},onDeleteOrExit:function(e,t){var r=function(t){e.pendingAction++,t["finally"](function(){e.pendingAction--})};n.openModal(o.createElement(s,{chat:e,onDeleteOrExit:r}),null,t)},onArchive:function(e,t){e.pendingAction++,e.setArchive(t)["finally"](function(){e.pendingAction--})},onMarkUnread:function(e,t){e.pendingAction++,e.markUnread(t)["finally"](function(){e.pendingAction--})},render:function(){return null}});e.exports=l},849:function(e,t,r){"use strict";var o=r(6),n=r(1),i=r(45),s=r(108),a=r(14),d=r(106),c=r(47),l=r(36),u=r(103),u=r(103),p=r(79),h=r(154),m=r(8),f=r(9),m=r(8),g=r(77),v=r(105),y=r(797),E=o.createClass({displayName:"ButterBar",mixins:[u,p],componentWillMount:function(){this.addObserver(d,"change:displayInfo"),this.addObserver(d,"change:needsUpdate")},onReload:function(){s.restart()},render:function(){var e,t=d.needsUpdate?o.createElement(_,{type:"update",key:"update",title:l10n.t("update_available"),text:l10n.t("click_to_update_whatsapp_web"),action:this.onReload}):null;switch(d.displayInfo){case d.INFO.OFFLINE:e=o.createElement(b,{key:"socket"});break;case d.INFO.OPENING:case d.INFO.CONNECTING:e=o.createElement(M,{key:"socket"});break;case d.INFO.NORMAL:e=null;break;case d.INFO.RESUMING:case d.INFO.TIMEOUT:var r=window.open.bind(window,"http://www.whatsapp.com/faq/web/28080002","_blank"),n=o.createElement("span",null,l10n.t("make_sure_phone_active_internet_connection"),"",o.createElement("span",{className:"action",onClick:r},l10n.t("learn_more")));e=o.createElement(_,{type:"phone",key:"socket",title:l10n.t("phone_not_connected"),text:n})}var i=window.Notification?o.createElement(C,{key:"notification"}):null,s=e?null:o.createElement(S,null);return o.createElement("div",{className:"butterbar-container"},o.createElement(v,{transitionName:"butterbar"},i,t,e,s))}}),_=o.createClass({displayName:"BB",propTypes:{type:o.PropTypes.oneOf(["computer","phone","notification","battery","update"]),title:o.PropTypes.node.isRequired,text:o.PropTypes.node,dismissable:o.PropTypes.bool,onDismiss:o.PropTypes.func,action:o.PropTypes.func},onClick:function(){this.props.action&&this.props.action()},render:function(){var e,t;switch(this.props.type){case"computer":case"phone":case"notification":case"battery":case"update":e="butterbar-"+this.props.type,t="icon-alert-"+this.props.type;break;default:n.log("butterbar:render invalid type")()}var r=g("butterbar",e,{action:this.props.action}),i=g("icon","icon-alert",t),s=this.props.dismissable?o.createElement("div",{className:"butterbar-controls"},o.createElement("button",{className:"icon icon-x-light",onClick:this.props.onDismiss})):null,a=this.props.text?o.createElement("div",{className:"butterbar-text"},this.props.text):null;return o.createElement("div",{className:"butterbar-wrapper"},o.createElement("div",{className:r,onClick:this.onClick},o.createElement("div",{className:"butterbar-icon"},o.createElement("span",{className:i})),o.createElement("div",{className:"butterbar-body"},o.createElement("div",{className:"butterbar-title"},this.props.title),a),s))}}),T=3e3,b=o.createClass({displayName:"Offline",mixins:[h],getInitialState:function(){return{allowReconnect:!0}},reconnect:function(){var e=a.socketSequence+1;a.poke(),l.waitForBBEvent(d,"change:displayInfo",function(){return d.displayInfo===d.INFO.NORMAL}).then(function(){new c.WebcManualWebsocketAttempt({webcManualWebsocketAttemptSuccessful:a.socketSequence===e}).commit()}),this.setState({allowReconnect:!1}),this.reconnectTimeout=this.safeDelay(this.resetReconnectTimeout,T)},resetReconnectTimeout:function(){this.clearSafeTimeout(this.reconnectTimeout),delete this.reconnectTimeout,this.setState({allowReconnect:!0})},render:function(){var e,t;return this.state.allowReconnect?(e=o.createElement("span",null,l10n.t("make_sure_computer_active_internet_connection"),"",o.createElement("span",{className:"action",onClick:this.reconnect},l10n.t("reconnect"))),t=l10n.t("computer_not_connected")):(e=null,t=l10n.t("connecting_to_whatsapp_or_phone")),o.createElement(_,{type:"computer",title:t,text:e})}}),S=o.createClass({displayName:"Battery",mixins:[u],getInitialState:function(){return{lowBatteryWarning:Store.Conn.isBatteryLow}},componentWillMount:function(){this.addObserver(Store.Conn,"change:battery",this.batteryUpdate),this.addObserver(Store.Conn,"change:isBatteryLow",this.onBatteryLowChange)},onBatteryLowChange:function(){this.setState({lowBatteryWarning:Store.Conn.isBatteryLow})},batteryUpdate:function(){Store.Conn.plugged||(Store.Conn.battery===m.BATTERY_LOW_THRESHOLD_1||Store.Conn.battery===m.BATTERY_LOW_THRESHOLD_2)&&this.setState({lowBatteryWarning:!0})},cancelLowBatteryWarning:function(){this.setState({lowBatteryWarning:!1})},render:function(){return this.state.lowBatteryWarning?o.createElement(_,{type:"battery",title:l10n.t("phone_battery_low"),text:l10n.t("charge_phone_description"),dismissable:!0,onDismiss:this.cancelLowBatteryWarning}):null}}),C=o.createClass({displayName:"Notification",getInitialState:function(){return{permission:window.Notification.permission}},guideConfirm:function(){f.closeModal()},guideLearnMore:function(){switch(i.browser){case m.BROWSER_TYPE.CHROME:return window.open("http://www.whatsapp.com/faq/web/28080004","_blank");case m.BROWSER_TYPE.FIREFOX:return window.open("http://www.whatsapp.com/faq/web/28080006","_blank");case m.BROWSER_TYPE.SAFRI:return window.open("http://www.whatsapp.com/faq/web/28080008","_blank");case m.BROWSER_TYPE.OPERA:return window.open("http://www.whatsapp.com/faq/web/28080007","_blank");default:return window.open("http://www.whatsapp.com/faq/web/28080004","_blank")}},requestPermissions:function(){f.openModal(o.createElement(y,{title:"guide_desktop_notifications_title",desc:"guide_desktop_notifications_description",onConfirm:this.guideConfirm,onCancel:this.guideLearnMore,type:y.TYPE.GUIDE_ALLOW}));var e=this;window.Notification.requestPermission(function(t){f.closeModal(),e.setState({permission:t})})},render:function(){if(this.state.permission!==m.PERMISSION_DEFAULT)return null;var e=o.createElement("span",{className:"action",onClick:this.requestPermissions},l10n.t("enable_desktop_notifications"));return o.createElement(_,{type:"notification",title:l10n.t("get_notified_of_new_messages"),text:e})}}),M=o.createClass({displayName:"Resume",mixins:[h,u],getInitialState:function(){return{takingTooLong:!1,didShowSubtitle:!1}},componentWillMount:function(){this.addObserver(a,"change:state",this.onProgress),this.addObserver(a,"change:retryTimestamp",this.onProgress)},onProgress:function(){this.clearSafeInterval(this.interval),delete this.interval,this.startTimeout(),this.setState({takingTooLong:!1})},componentDidMount:function(){this.startTimeout()},startTimeout:function(){this.safeDelay(this.connectTimeout,3e3)},connectTimeout:function(){this.interval=this.safeInterval(this.timeoutTick,1e3),this.setState({takingTooLong:!0,didShowSubtitle:!0})},timeoutTick:function(){this.setState({now:Date.now()})},retry:function(e){a.poke(),this.onProgress()},cancel:function(e){a.logout()},render:function(){var e,t;if(d.displayInfo===d.INFO.OPENING)e=l10n.t("connecting_to_whatsapp");else{if(d.displayInfo!==d.INFO.CONNECTING)return null;e=l10n.t("connecting_to_whatsapp_or_phone")}if(this.state.takingTooLong){var r=a.retryTimestamp-Date.now();if(6e4>r){var n=Math.ceil(r/1e3);r=l10n.t("retrying_in_some_seconds",{number:n,_plural:n})}else r=l10n.t("retrying_in",{duration:moment.duration(r).humanize()});t=o.createElement("span",null,r," ",o.createElement("span",{className:"action",onClick:this.retry},l10n.t("retry_now")))}else t=this.state.didShowSubtitle?o.createElement("span",null,l10n.t("retrying")):null;return o.createElement(_,{type:"computer",title:e,text:t})}});e.exports=E},850:function(e,t,r){"use strict";var o=r(6),n=r(773),i=r(772),s=r(854),a=r(103),d=o.createClass({displayName:"ChatstateInfo",mixins:[a],propTypes:{chat:o.PropTypes.instanceOf(n)},componentWillMount:function(){var e=this.props.chat;this.addObserver(e.msgs,"change:last"),this.addObserver(e.presence,"change:chatstate.id change:chatstate.type change:withholdDisplay")},render:function(){var e=this.props.chat,t=e.presence;if(t.isActive()){var r=t.getFormattedString();return o.createElement("div",{className:"chat-status typing ellipsify",dir:"auto"},o.createElement(i,{ellipsify:!0,titlify:!0,text:r}))}var n=e.msgs.last();return n?o.createElement(s,{key:n.id,msg:n}):o.createElement("div",{className:"chat-status"})}});e.exports=d},851:function(e,t,r){"use strict";var o=r(6),n=r(153),i=o.createClass({displayName:"ContactMsgInfoCell",propTypes:{title:o.PropTypes.string.isRequired,icon:o.PropTypes.node.isRequired,t:o.PropTypes.number},render:function(){var e=this.props,t=e.title,r=e.t,i=e.icon,s=r?n.relativeDateAndTimeStr(r):"-",a={cursor:"auto"};return o.createElement("div",{className:"contact chat",style:a},o.createElement("div",{className:"chat-body"},o.createElement("div",{className:"chat-main"},o.createElement("div",{className:"chat-title"},o.createElement("span",{className:"ellipsify",dir:"auto"},i,t))),o.createElement("div",{className:"chat-secondary"},o.createElement("div",{className:"chat-status ellipsify"},o.createElement("span",{className:"ellipsify",dir:"auto"},s)))))}});e.exports=i},852:function(e,t,r){"use strict";var o=r(6),n=r(804),i=r(153),s=r(770),a=o.createClass({displayName:"GroupMsgInfoCell",mixins:[s],propTypes:{participant:o.PropTypes.instanceOf(Object).isRequired},getInitialState:function(){return{formattedName:this.async("participant.contact.formattedName")}},render:function(){var e=this.props.participant,t={cursor:"auto"};return o.createElement(n,{id:e.id,contextEnabled:function(){return!1},primary:this.state.formattedName,secondary:i.relativeDateAndTimeStr(e.t),style:t})}});e.exports=a},853:function(e,t,r){"use strict";var o=r(6),n=r(770),i=r(105),s=o.createClass({displayName:"Icons",mixins:[n],propTypes:{chat:o.PropTypes.object.isRequired},getInitialState:function(){return{isMuted:this.async("chat.mute.isMuted"),unreadCount:this.async("chat.unreadCount"),archive:this.async("chat.archive")}},render:function(){var e=this.props.chat,t=this.state.isMuted?o.createElement("span",{className:"icon icon-meta icon-muted",key:"icon-muted"}):null,r=0!==e.unreadCount?o.createElement("span",{className:"icon-meta unread-count",key:"icon-unread"},e.unreadCount>0?l10n.n(this.state.unreadCount):o.createElement("span",null,"")):null,n=this.state.archive?o.createElement("span",{className:"icon-meta chat-marker chat-marker-archived",key:"icon-archived"},l10n.t("chat_archived")):null;return o.createElement(i,{transitionName:"pop"},t,n,r)}});e.exports=s},854:function(e,t,r){"use strict";var o=r(6),n=r(771),i=r(45),s=r(802),a=r(856),d=r(857),c=r(772),l=r(770),u=r(103),p=r(77),h=o.createClass({displayName:"LastMsg",mixins:[l,u],propTypes:{msg:o.PropTypes.instanceOf(n).isRequired},getInitialState:function(){return this.props.msg.sender?{formattedShortName:this.async("msg.senderObj.formattedShortName")}:{}},componentWillMount:function(){"ptt"===this.props.msg.type&&this.addObserver(this.props.msg,"change:duration")},render:function(){var e=this.props.msg,t=[];if(e.isSentByMe&&t.push(o.createElement(a,{msg:e,key:"symbol"})),!e.isSentByMe&&e.isGroupMsg&&!e.isNotification){var r=p("chat-status-name",{number:!e.senderObj.name});t.push(o.createElement(c,{text:this.state.formattedShortName,direction:"auto",classes:r,key:"author"})),t.push(o.createElement("span",{className:"chat-status-divider",key:"divider"},":"))}e.hasSymbol&&t.push(o.createElement(d,{msg:e,key:"msg-symbol"})),t.push(o.createElement(c,{direction:e.dir,ellipsify:!0,text:s.msgText(e),key:"status"}));var n="chat-status";i.isGecko&&(n+=" ellipsify");var l=l10n.embedDir(s.msgText(e),e.rtl);return o.createElement("div",{className:n,title:l},t)}});e.exports=h},855:function(e,t,r){"use strict";var o=r(6),n=r(770),i=o.createClass({displayName:"Message",mixins:[n],getInitialState:function(){return{chatName:this.async("m.chat.formattedTitle")}},onClick:function(e){if(_.isFunction(this.props.onClick)){var t=this.props.m,r=t.chat,o=r.getSearchContext(t);o.msg=t,this.props.onClick(e,r,o)}},contextEnabled:function(){return!1},render:function(){var e=this.props.m;return o.createElement("div",{onClick:this.onClick},this.state.chatName,": ",e.body)}});e.exports=i},856:function(e,t,r){"use strict";var o=r(6),n=r(771),i=r(770),s=r(77),a=o.createClass({displayName:"MsgAck",mixins:[i],propTypes:{msg:o.PropTypes.instanceOf(n)},getInitialState:function(){return{ack:this.async("msg.ack")}},render:function(){var e=this.props.msg.ack,t=s("icon",{"icon-status-time":1>e,"icon-status-check":1===e,"icon-status-dblcheck":2===e,"icon-status-dblcheck-ack":e>2});return o.createElement("span",{className:t})}});e.exports=a},857:function(e,t,r){"use strict";var o=r(6),n=r(1),i=r(771),s=r(103),a=o.createClass({displayName:"MsgSymbol",mixins:[s],propTypes:{msg:o.PropTypes.instanceOf(i)},componentWillMount:function(){var e=this.props.msg;"ptt"===e.type&&e.ack<4&&this.addObserver(this.props.msg,"change:ack")},getClasses:function(){var e="icon media-icon",t=this.props.msg;switch(t.type){case"location":case"image":case"video":case"audio":case"vcard":e+=" icon-status-"+t.type;break;case"ptt":var r=4===t.ack?"blue":t.isSentByMe?"gray":"green";e+=" icon-status-"+t.type+"-"+r;break;case"document":e+=" icon-status-document";break;default:n.log("chat:getClasses Invalid msg type.")()}return e},render:function(){return o.createElement("span",{className:this.getClasses()})}});e.exports=a},858:function(e,t,r){"use strict";var o=r(6),n=r(349),i=r(772),s=r(770),a=o.createClass({displayName:"Status",mixins:[s],propTypes:{status:o.PropTypes.instanceOf(n)},getInitialState:function(){return{status:this.async("status.status")}},render:function(){return _.isUndefined(this.state.status)?o.createElement("div",{className:"muted"},l10n.t("contact_status_loading")):o.createElement("div",{className:"chat-status ellipsify",title:this.state.status},o.createElement(i,{direction:"auto",ellipsify:!0,text:this.state.status}))}});e.exports=a},859:function(e,t,r){"use strict";var o=r(6),n=r(773),i=r(153),s=r(103),a=r(79),d=o.createClass({displayName:"Timestamp",mixins:[s,a],propTypes:{chat:o.PropTypes.instanceOf(n).isRequired},componentWillMount:function(){this.addObserver(this.props.chat.msgs,"change:last")},componentDidMount:function(){this.maybeRegMidnight()},componentDidUpdate:function(){this.maybeRegMidnight()},rerender:function(){this.forceUpdate()},maybeRegMidnight:function(){var e=this.timestamp();if(e){this.unregCmd("midnight",this.rerender);var t=moment().startOf("day").subtract(7,"day");e>=t.unix()&&this.regCmd("midnight",this.rerender)}},timestamp:function(){var e=this.props.chat.msgs.last();return e&&e.t},render:function(){var e=this.timestamp();return e?o.createElement("div",{className:"chat-meta"},o.createElement("span",{className:"chat-time"},i.relativeStr(e))):null}});e.exports=d},860:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(6),a=r(30),d=r(778),c=r(9),l=r(806),u=r(103),p=r(79),h=r(792),m=r(789),f=r(779),g=r(855),v=r(80),y=r(342),E=y.HotKeys,T=s.createClass({displayName:"Chatlist",mixins:[u,p],propTypes:{isSearching:s.PropTypes.bool,chats:s.PropTypes.array,contacts:s.PropTypes.array,onClick:s.PropTypes.func,onSelect:s.PropTypes.func,onFocusSearch:s.PropTypes.func},getDefaultProps:function(){return{chats:[]}},getInitialState:function(){return this.debouncedOpenSelected=_.debounce(this.openSelected,500),this.selected=h(),{}},componentDidMount:function(){this.regCmd("focus_chat_list",this.restoreFocus),this.addObserver(Store.Chat,"sort remove change:active",this.updateSelected)},setSelected:function(e,t){this.selected.set(e,t)},updateSelected:function(){var e=Store.Chat.active();_.isEqual(e,this.selected.value)||this.setSelected(e,!1)},openSelected:function(){var e=this;this.openPromise&&(this.openPromise.cancel(),this.openPromise=null),_.isEqual(Store.Chat.active(),this.selected.value)||(this.openPromise=Store.Chat.find(this.selected.value).cancellable().then(function(e){return c.openChat(e,void 0,!1)})["catch"](i["default"].CancellationError,_.noop)["finally"](function(){return e.openPromise=null}))},cancelOpenSelected:function(){this.debouncedOpenSelected.cancel();var e=Store.Chat.active();e&&this.setSelected(e,!0)},onClick:function(e,t,r){var o=this;Store.Chat.find(t.id).then(function(e){o.props.isSearching&&o.props.onClick&&o.props.onClick(),o.props.onSelect?o.props.onSelect(e):c.openChat(e,r)})},getList:function(){for(var e=this,t=this.props,r=t.chats,o=t.contacts,n=t.ftsResult,i=[],a=0;a<r.length;a++){var d=r[a];d&&(this.props.isSearching&&0===a&&(o.length||n.length)&&i.push(s.createElement(l,{key:"chat-header",header:l10n.t("web_chats")})),i.push(s.createElement(m,{chat:d,mode:m.Mode.LAST,onClick:this.onClick,active:this.selected,key:d.id})))}for(var c=0;c<o.length;c++){var u=o[c];u&&(0===c&&i.push(s.createElement(l,{key:"contact-header",header:l10n.t("web_contacts")})),i.push(s.createElement(f,{contact:u,active:this.selected,onClick:this.onClick,key:u.id})))}return v.supportsFeature(v.F.FULL_TEXT_SEARCH)&&_.partition(n,{star:!0}).forEach(function(t,r){for(var o=0===r?l10n.t("web_starred_messages"):l10n.t("web_messages"),n=0;n<t.length;n++)0==n&&i.push(s.createElement(l,{key:"fts-header-"+r,header:o})),i.push(s.createElement(g,{m:t[n],onClick:e.onClick,key:t[n].id.toString()}))}),i},combined:function(){var e=this.props.chats,t=this.props.contacts;return e.concat(t)},restoreFocus:function(){this.selected.value&&this.setSelected(this.selected.value)},indicateFocus:function(e){e.target===a.findDOMNode(this)&&this.selected.value&&this.setSelected(this.selected.value)},focusFirst:function(){var e=_.first(this.props.chats)||_.first(this.props.contacts);this.setSelected(e.id),this.debouncedOpenSelected()},onNextChat:function(e){e.preventDefault(),e.stopPropagation();var t=this.selected.next(this.combined());t&&(this.setSelected(t.id),this.debouncedOpenSelected())},onPrevChat:function(e){var t=this.selected.prev(this.combined());t&&(_.isEqual(t.id,this.selected.value)?this.props.onFocusSearch&&(e.preventDefault(),e.stopPropagation(),this.cancelOpenSelected(),this.props.onFocusSearch(e)):(e.preventDefault(),e.stopPropagation(),this.setSelected(t.id),this.debouncedOpenSelected()))},render:function(){var e={down:this.onNextChat,up:this.onPrevChat};return e={},s.createElement(E,{handlers:e,onFocus:this.indicateFocus,"data-tab":3},s.createElement(d,{classes:["chatlist"],data:this.getList(),height:72,animate:!0,extraItems:4}))}});e.exports=T},861:function(e,t,r){"use strict";var o=r(6),n=r(1),i=r(12),s=r(14),a=r(78),d=r(917),c=r(908),l=r(341),u=r(896),p=r(897),h=r(900),m=r(899),f=r(15),g=r(346),v=r(777),y=r(783),E=r(9),_=r(770),T=r(829),b=T.MenuBarItem,S=T.MenuBar,C=r(80),M=r(780),N=r(105),w="global_mute",P=o.createClass({displayName:"ChatlistHeader",mixins:[_],getDefaultProps:function(){return{muteId:w}},getInitialState:function(){return Store.Mute.globalMute(),{isMuted:this.async("muteId.Mute.isMuted")}},onNewChat:function(){E.openDrawer(o.createElement(u,{type:a.DRAWER_LEFT}))},onProfile:function(){E.openDrawer(o.createElement(d,{type:a.DRAWER_LEFT,id:Store.Conn.me}))},onUnmute:function(){Store.Mute.globalMute().unmute(),E.openToast(o.createElement(M,{msg:l10n.t("global_unmuted"),id:M.genId()}))},render:function(){var e=null;return this.state.isMuted&&(e=o.createElement(b,{icon:"dnd",title:l10n.t("global_unmute"),onClick:this.onUnmute,key:"btn-dnd"})),o.createElement("header",{className:"pane-header pane-list-header"},o.createElement("div",{className:"pane-list-user"},o.createElement(y,{id:Store.Conn.me,onClick:this.onProfile})),o.createElement("div",{className:"pane-list-controls"},o.createElement(S,{key:"chatlist-header"},o.createElement(N,{transitionName:"btn"},e,o.createElement(b,{a8n:"menu-bar-chat",icon:"chat",title:l10n.t("web_menuitem_new"),onClick:this.onNewChat}),o.createElement(b,{a8n:"menu-bar-menu",icon:"menu",title:l10n.t("menutitle_menu")},o.createElement(R,null))))))}});e.exports=P;var R=o.createClass({displayName:"ChatlistHeaderDropdown",getInitialState:function(){return{rememberMe:f.getRememberMe()}},onCreateGroup:function(){E.openDrawer(o.createElement(p,{type:a.DRAWER_LEFT}))},onProfile:function(){E.openDrawer(o.createElement(d,{type:a.DRAWER_LEFT,id:Store.Conn.me}))},onHelp:function(){i.upload("help-page-opened");var e,t,r=Store.Conn.PLATFORMS;switch(e=Store.Conn.platform||"unknown"){case r.ANDROID:t=l10n.t("guide_help_description_android");break;case r.BB:t=l10n.t("guide_help_description_bb");break;case r.BBX:t=l10n.t("guide_help_description_bbx");break;case r.WP7:t=l10n.t("guide_help_description_wp7");break;case r.SYMBIAN:t=l10n.t("guide_help_description_symbian");break;case r.S40:t=l10n.t("guide_help_description_s40");break;case r.IPHONE:t=l10n.t("guide_help_description_iphone");break;default:n.log("chatlistHeader:onHelp unknown platform: "+e)()}var s=function(){E.closeModal(),window.open("http://www.whatsapp.com/faq/web","_blank")};E.openModal(o.createElement(l,{title:l10n.t("guide_help_title"),onOK:E.closeModal.bind(E),okText:l10n.t("ok_got_it"),onCancel:s,cancelText:l10n.t("web_settings_faq")},l10n.t("guide_help_faq")+" "+t))},onUploadLogs:function(){i.upload()},onDisconnect:function(){var e=Store.Msg.any(function(e){return 0===e.ack&&e.local&&e.isSentByMe});return e?void E.openModal(o.createElement(l,{title:l10n.t("confirm_logout"),onOK:function(){return s.logout()},okText:l10n.t("menuitem_logout"),onCancel:function(){return E.closeModal()},cancelText:l10n.t("web_cancel")},l10n.t("some_of_your_messages_are_still_sending"))):s.logout()},onNotifications:function(){E.openModal(o.createElement(c,null))},onArchived:function(){E.openDrawer(o.createElement(m,{type:a.DRAWER_LEFT}))},onBlocked:function(){E.openDrawer(o.createElement(h,{type:a.DRAWER_LEFT}))},render:function(){var e=C.supportsFeature(C.F.GROUP_CREATE)?o.createElement(v,{a8n:"mi-new-group menu-item",action:this.onCreateGroup,shortcut:"g"},l10n.t("web_menuitem_groupchat")):null,t=C.supportsFeature(C.F.SET_BLOCK)?o.createElement(v,{action:this.onBlocked},l10n.t("menuitem_blocked")):null;return o.createElement(g,{type:g.Type.DROPDOWN_MENU,flipOnRTL:!0,key:"ChatlistHeader",direction:{x:g.Direction.X.LEFT}},e,o.createElement(v,{a8n:"mi-profile-status menu-item",action:this.onProfile},l10n.t("menuitem_profile_status")),o.createElement(v,{a8n:"mi-notifications menu-item",action:this.onNotifications},l10n.t("menuitem_notifications")),t,o.createElement(v,{a8n:"mi-archived menu-item",action:this.onArchived},l10n.t("menuitem_archived")),o.createElement(v,{a8n:"mi-help menu-item",action:this.onHelp},l10n.t("menuitem_help")),o.createElement(v,{a8n:"mi-logout menu-item",action:this.onDisconnect,shortcut:"q"},l10n.t("menuitem_logout")))}})},862:function(e,t,r){"use strict";var o=r(6),n=r(779),i=r(342),s=i.HotKeys,a=r(792),d=o.createClass({displayName:"ParticipantList",propTypes:{contacts:o.PropTypes.array.isRequired,onDelete:o.PropTypes.func.isRequired,onFocusSearch:o.PropTypes.func.isRequired},getInitialState:function(){return this.selected=a(),null},focusLast:function(){_.size(this.props.contacts)&&this.selected.set(_.last(this.props.contacts).id)},focusPrev:function(e){e.preventDefault(),e.stopPropagation();var t=this.selected.prev(this.props.contacts);this.selected.set(t.id)},focusNext:function(e){e.preventDefault(),e.stopPropagation();var t=this.selected.next(this.props.contacts);_.isEqual(t.id,this.selected.value)?(this.selected.set(null),this.props.onFocusSearch(e)):this.selected.set(t.id)},deleteContact:function(e){e.preventDefault(),e.stopPropagation();var t=_.findWhere(this.props.contacts,{id:this.selected.value}),r=this.selected.next(this.props.contacts),o=this.selected.prev(this.props.contacts);_.isEqual(o.id,this.selected.value)?_.isEqual(r.id,this.selected.value)?(this.selected.set(null),this.props.onFocusSearch(e)):this.selected.set(r.id):this.selected.set(o.id),this.props.onDelete(e,t)},onParticipantClick:function(e,t){this.selected.set(t.id)},render:function(){var e=this.props.contacts;if(!e)return null;var t=_.size(this.props.contacts)?_.map(this.props.contacts,function(e){return o.createElement(n,{contact:e,active:this.selected,onDelete:this.props.onDelete,onClick:this.onParticipantClick,type:n.Type.SMALL,key:e.id})},this):null,r={up:this.focusPrev,down:this.focusNext,backspace:this.deleteContact};r[l10n.LR("left","right")]=this.focusPrev,r[l10n.LR("right","left")]=this.focusNext,r={};var i=o.createElement("ul",{ref:"list"},t);return o.createElement(s,{handlers:r},i)}});e.exports=d},863:function(e,t,r){"use strict";var o=r(6),n=r(30),i=r(103),s=r(79),a=r(861),d=r(794),c=r(860),l=r(787),u=r(849),p=r(78),h=r(9),m=r(80),f=r(687),g=r(342),v=g.HotKeys,y=o.createClass({displayName:"ChatlistPanel",mixins:[i,s,f],propTypes:{onSelect:o.PropTypes.func},getInitialState:function(){return this.fts=_.debounce(function(e){var t=e.state.searchText;t&&Store.Msg.search(t).then(function(t){e.setState({ftsResult:t})})},750),{searchText:"",ftsResult:[]}},componentDidMount:function(){this.regCmd("focus_chat_search",this.onFocusSearch)},getFilteredContacts:function(){var e=this.state.searchText;if(!e)return[];e=l10n.accentFold(e);var t=Store.Contact.getFilteredContacts();return t.filter(function(t){var r=t.searchMatch(e);if(!r)return!1;var o=Store.Chat.get(t.id);return o&&!o.isNewlyCreated()?!1:!0})},getFilteredChats:function(){var e=this.state.searchText;return e?(e=l10n.accentFold(e),Store.Chat.filter(function(t){return t.contact.searchMatch(e)&&!t.isNewlyCreated()})):Store.Chat.filter(function(e){return!e.archive&&!e.isNewlyCreated()})},fullTextSearch:function(){this.state.searchText&&m.supportsFeature(m.F.FULL_TEXT_SEARCH)&&this.fts(this)},getEmptyChatlistState:function(){var e=this.getFilteredContacts().length,t=this.getFilteredChats().length,r=this.state.ftsResult.length,n=!(e||t||r);if(n){if(this.state.searchText)return o.createElement(l.Search,null);var i=Store.Chat.filter(function(e){return!e.isNewlyCreated()});return i.length?o.createElement(l.AllArchived,null):o.createElement(l.List,null)}},componentWillMount:function(){this.addObserver(Store.Chat,"sort remove change:archive")},componentWillUpdate:function(e,t){this.state.searchText!==t.searchText&&this.fullTextSearch()},onSearch:function(e){var t={searchText:e};this.state.searchText!==e&&(t.ftsResult=[]),this.setState(t)},onStopSearch:function(){this.setState({searchText:"",ftsResult:[]}),this.fts.cancel()},onFocusList:function(e){this.refs.chatlist&&(e.preventDefault(),e.stopPropagation(),v.flashFocus=Date.now(),this.refs.chatlist.focusFirst())},onOpenFirst:function(e){var t=_.first(this.getFilteredChats())||_.first(this.getFilteredContacts());t&&Store.Chat.find(t.id).then(function(e){v.flashFocus=Date.now(),h.openChat(e),h.focusChatTextInput(e)})},onFocusSearch:function(e){v.flashFocus=Date.now(),this.refs.search.focus()},indicateFocus:function(e){if(!(Date.now()-(v.flashFocus||0)>200)){var t=n.findDOMNode(this.refs.input_hotkey);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#fbfbfb","#D9F3FF"]},{duration:1600,easing:[.19,.69,.01,.99]})}},render:function(){var e;(e=this.getEmptyChatlistState())||(e=o.createElement(c,{isSearching:!!this.state.searchText,ref:"chatlist",chats:this.getFilteredChats(),onFocusSearch:this.onFocusSearch,ftsResult:this.state.ftsResult,onClick:this.onStopSearch,onSelect:this.props.onSelect,contacts:this.getFilteredContacts()}));var t={down:this.onFocusList,enter:this.onOpenFirst};return t={},o.createElement("div",{id:"side",className:"pane pane-list"},o.createElement(a,{key:"ChatHeader"}),o.createElement(u,{key:"ButterBar"}),o.createElement(v,{handlers:t,onFocus:this.indicateFocus,ref:"input_hotkey",className:"search-container"},o.createElement(d,{searchText:this.state.searchText,ref:"search",onSearch:this.onSearch,searchType:p.CHAT_SEARCH})),o.createElement("div",{ref:"panel",className:"pane-body pane-list-body",id:"pane-side","data-list-scroll-container":!0},e))}});e.exports=y},864:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(688),i=o(n),s=r(6),a=r(30),d=r(104),c=r(161),l=s.createClass({displayName:"Draggable",mixins:[d],propTypes:{children:s.PropTypes.node.isRequired,start:s.PropTypes.shape({x:s.PropTypes.number,y:s.PropTypes.number}),scale:s.PropTypes.number,container:s.PropTypes.shape({width:s.PropTypes.number.isRequired,height:s.PropTypes.number.isRequired}),onStart:s.PropTypes.func,onDrag:s.PropTypes.func,onStop:s.PropTypes.func},getInitialState:function(){return{dragging:!1,x:0,y:0,offsetX:0,offsetY:0}},componentDidMount:function(){this.updateContainer()},componentWillReceiveProps:function(e){e.scale!==this.props.scale||e.container.width!==this.props.container.width||e.container.height!==this.props.container.height?this.updateContainer(e,!0):this.updateContainer(e)},updateContainer:function(e,t){e=e||this.props;var r=e.container;if(r&&this.refs.draggable){var o,n=a.findDOMNode(this.refs.draggable),i=this.state.x,s=this.state.y,d=n.width*e.scale,c=n.height*e.scale;this.props.scale!==e.scale&&this.state.center?(o=this.state.center,i=r.width/2-o.x*d,s=r.height/2-o.y*c):o={x:(r.width/2-i)/d,y:(r.height/2-s)/c},i>0?i=0:i+d<r.width&&(i=r.width-d),s>0?s=0:s+c<r.height&&(s=r.height-c),this.setState({width:d,height:c,x:i,y:s,center:o}),this.props.onStop&&t&&e.onStop(i,s)}},handleMouseDown:function(e){e.preventDefault(),this.setState({dragging:!0,offsetX:e.clientX-this.state.x,offsetY:e.clientY-this.state.y}),this.regNativeListener(window,"mousemove",this.handleMouseMove),this.regNativeListener(window,"mouseup",this.handleMouseUp),this.props.onStart&&this.props.onStart()},handleMouseUp:function(e){this.unregisterListeners(),this.setState({dragging:!1}),this.props.onStop&&this.props.onStop(this.state.x,this.state.y)},handleMouseMove:function(e){if(this.state.dragging){var t=e.clientX-this.state.offsetX,r=e.clientY-this.state.offsetY,o=this.props.container;
o&&((t>0||t+this.state.width<o.width)&&(t=this.state.x),(r>0||r+this.state.height<o.height)&&(r=this.state.y)),this.setState({x:t,y:r}),this.props.onDrag&&this.props.onDrag(t,r)}},render:function(){var e=this.props.scale?" scale("+this.props.scale+")":"",t=(0,i["default"])({},c.prefix("transform"),"translate("+this.state.x+"px, "+this.state.y+"px)"+e);this.state.dragging||(t[c.prefix("transition")]="transform 200ms");var r="draggable";return this.state.dragging&&(r+=" dragging"),s.cloneElement(s.Children.only(this.props.children),{style:t,draggable:!0,ref:"draggable",className:r,onMouseDown:this.handleMouseDown})}});e.exports=l},865:function(e,t,r){"use strict";var o=r(6),n=o.createClass({displayName:"FloatingPlaceholder",propTypes:{children:o.PropTypes.node.isRequired,placeholder:o.PropTypes.string,hasText:o.PropTypes.bool},render:function(){var e="placeholder";return this.props.hasText&&(e+=" placeholder-enter"),this.props.placeholder?o.createElement("div",{className:"floating-placeholder"},o.createElement("span",{className:e},this.props.placeholder),this.props.children):this.props.children}});e.exports=n},866:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(158),i=o(n),s=r(344),a=o(s),d=r(6),c=r(795),l=r(77),u=d.createClass({displayName:"ImageLoader",propTypes:{src:d.PropTypes.string.isRequired,onError:d.PropTypes.func},getInitialState:function(){return{loaded:!1}},componentWillMount:function(){var e=new Image;e.src=this.props.src,e.complete&&this.onLoad()},onLoad:function(e){this.state.isLoaded||this.setState({loaded:!0}),this.props.onLoad&&this.props.onLoad(e)},render:function(){var e=this.props,t=e.className,r=(e.onLoad,(0,a["default"])(e,["className","onLoad"]));return t=l("avatar-image",t,{"is-loaded":this.state.loaded}),d.createElement(c,(0,i["default"])({hasPrivacyChecks:!0,onLoad:this.onLoad,className:t},r))}});e.exports=u},867:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(344),i=o(n),s=r(6),a=s.createClass({displayName:"IsolatedBlock",propTypes:{Component:s.PropTypes.string.isRequired},getDefaultProps:function(){return{Component:"span"}},render:function(){var e=this.props,t=e.Component,r=(e.children,(0,i["default"])(e,["Component","children"]));return s.createElement(t,r,"",this.props.children,"")}});e.exports=a},868:function(e,t,r){"use strict";var o=r(6),n=r(773),i=r(770),s=r(777),a=o.createClass({displayName:"MarkUnreadMenuItem",mixins:[i],propTypes:{chat:o.PropTypes.instanceOf(n).isRequired,onMarkUnread:o.PropTypes.func.isRequired},getInitialState:function(){return{unreadCount:this.async("chat.unreadCount")}},render:function(){var e=this.props.onMarkUnread.bind(null,!this.state.unreadCount);return o.createElement(s,{action:e,shortcut:"r",key:"MarkUnreadMenuItem"},this.state.unreadCount?l10n.t("mark_read_chat"):l10n.t("mark_unread_chat"))}});e.exports=a},869:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(6),a=r(78),d=r(11),c=r(9),l=r(777),u=r(902),p=r(797),h=s.createClass({displayName:"TakePhotoMenuItem",propTypes:{onImageTake:s.PropTypes.func.isRequired},onCapture:function(){a.pop(a.MENU);var e=this,t=new i["default"](function(r,o){navigator.getUserMedia({video:!0},function(o){c.closeModal(),r(o),t.isResolved()&&c.openModal(s.createElement(u,{stream:o,onSend:e.props.onImageTake}))},function(e){var r=_.isString(e)?e:e.name,n=d.GUM[r]||d.GUM.GUMError;o(new n),t&&t.isResolved()&&c.closeModal()})}).bind(this).timeout(1500,"waitForGUMTakePhotoTimeout").then(function(e){c.openModal(s.createElement(u,{stream:e,onSend:this.props.onImageTake}))})["catch"](i["default"].TimeoutError,function(e){c.openModal(s.createElement(p,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_description",type:p.TYPE.GUIDE_ALLOW}))})["catch"](d.GUM.PermissionDeniedError,function(){c.openModal(s.createElement(p,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_fail_description",type:p.TYPE.GUIDE_UNBLOCK}))})["catch"](d.GUM.GUMError,function(){c.openModal(s.createElement(p,{title:"guide_desktop_camera_missing_title",desc:"guide_desktop_camera_missing_description",type:p.TYPE.GUIDE_NONE}))})},render:function(){return s.createElement(l,{action:this.onCapture},l10n.t("take_photo"))}});e.exports=h},870:function(e,t,r){"use strict";var o=r(6),n=r(30),i=r(104),s=r(687),a=o.createClass({displayName:"Video",mixins:[i,s],propTypes:{src:o.PropTypes.string.isRequired,onPlay:o.PropTypes.func},componentDidMount:function(){var e=n.findDOMNode(this),t=this;this.regNativeListener(e,"playing",function(r){e.videoHeight&&e.videoWidth||(e.pause(),e.play()),e.videoHeight&&e.videoWidth&&t.props.onPlay(r)})},render:function(){return o.createElement("video",this.props)}});e.exports=a},871:function(e,t,r){"use strict";var o=r(6),n=r(30),i=r(14),s=r(79),a=r(104),d=r(154),c=r(9),l=r(45),u=o.createClass({displayName:"VideoTag",mixins:[s,a,d],propTypes:{src:o.PropTypes.string.isRequired,poster:o.PropTypes.string,className:o.PropTypes.string,controls:o.PropTypes.bool,width:o.PropTypes.number,height:o.PropTypes.number,onClick:o.PropTypes.func,onPlay:o.PropTypes.func,onError:o.PropTypes.func,autoPlay:o.PropTypes.bool},componentDidMount:function(){var e=n.findDOMNode(this);this.regNativeListener(e,"playing",this.onPlaying),this.regCmd("mediaPlaying",this.onOtherPlaying),this.regNativeListener(e,"error",this.onPlayerError,!0),(l.isGecko||l.isSafari)&&(this.props.autoPlay?this.startCheckForSuccess():this.regNativeListener(e,"play",this.startCheckForSuccess))},startCheckForSuccess:function(){this.checkIteration=0,this.checkForSuccessInterval=this.safeInterval(this.checkForSuccess,250)},clearCheckForSuccess:function(){this.checkForSuccessInterval&&(this.clearSafeInterval(this.checkForSuccessInterval),delete this.checkForSuccessInterval,delete this.checkIteration)},checkForSuccess:function(){if(i.state===i.STATE.CONNECTED){if(this.checkIteration++,this.checkIteration>240)return void this.onPlayerError({target:{src:this.props.src,error:{code:window.MediaError.MEDIA_ERR_NETWORK}}});var e=n.findDOMNode(this),t=e.buffered;t&&t.length&&t.end(0)>0&&this.onPlaying({target:e})}},onPlayerError:function(e){this.clearCheckForSuccess(),this.props.onError&&this.props.onError(e)},onOtherPlaying:function(e){e!==this&&n.findDOMNode(this).pause()},onPlaying:function(e){this.clearCheckForSuccess(),c.mediaPlaying(this),this.props.onPlay&&this.props.onPlay(e)},render:function(){var e={height:this.props.height,width:this.props.width};return o.createElement("video",{src:this.props.src,poster:this.props.poster,style:e,width:this.props.width,height:this.props.height,className:this.props.className,onClick:this.props.onClick,controls:this.props.controls,autoPlay:this.props.autoPlay},this.props.children)}});e.exports=u},872:function(e,t,r){"use strict";var o=r(6),n=r(79),i=r(104),s=r(103),a=r(891),d=r(898),c=r(11),l=r(8),u=r(106),p=r(9),h=o.createClass({displayName:"Conversation",mixins:[n,i,s],getInitialState:function(){return{chat:void 0,msgCollection:void 0,ftsMsg:void 0}},componentWillMount:function(){this.regCmd("open_chat",this.handleOpenChat),this.regCmd("clear_chat",this.handleClearChat),this.regNativeListener(window,"focus",this.windowGainedFocus),this.regNativeListener(window,"blur",this.windowLostFocus)},componentDidUpdate:function(e,t){var r=this.state.chat,o=t.chat;r&&o!==r&&(this.addObserver(r,"change:cmc:merge",this.msgCollectionChanged),o&&this.removeObserver(o,"change:cmc:merge"))},msgCollectionChanged:function(e,t,r){var o=this.state.msgCollection;(o===e||o===t)&&this.setState({msgCollection:r})},windowGainedFocus:function(){u.markAvailable();var e=this.state.conversation;e&&e.isUser&&e.presence.subscribe()["catch"](c.WapDrop,_.noop)},windowLostFocus:function(){u.markUnavailable(l.SEND_UNAVAILABLE_WAIT)},handleClearChat:function(e){this.state.chat===e&&this.setState({chat:void 0,msgCollection:void 0,ftsMsg:void 0})},handleOpenChat:function(e,t,r){var o=r?function(){return p.focusChatTextInput(e)}:_.noop;this.state.chat===e&&o(),(this.state.chat!==e||t&&this.state.msgCollection!==t.collection||!t&&this.state.msgCollection!==this.state.chat.msgs)&&this.setState({chat:e,msgCollection:t?t.collection:e.msgs,ftsMsg:t?t.msg:void 0},o)},render:function(){var e=this.state.chat;return e?o.createElement(a,{key:e.id,chat:e,msgCollection:this.state.msgCollection,ftsMsg:this.state.ftsMsg}):o.createElement(d,null)}});e.exports=h},873:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(6),a=r(8),d=r(770),c=r(104),l=r(78),u=r(773),p=r(828),h=r(832),m=r(783),f=r(772),g=r(791),v=r(895),y=r(905),E=r(910),T=r(901),b=r(9),S=r(797),C=r(11),M=r(829),N=M.MenuBar,w=M.MenuBarItem,P=r(346),R=r(777),k=r(830),x=r(824),I=r(827),l=r(78),D=r(831),O=s.createClass({displayName:"ConversationHeader",mixins:[d,c],propTypes:{chat:s.PropTypes.instanceOf(u).isRequired,onSelectMessages:s.PropTypes.func.isRequired},statics:{ATTACH_MEDIA_ACTIVE:"attach_media_active",GROUP_CHAT_ACTIVE:"group_chat_active"},getInitialState:function(){return{img:this.async("chat.ProfilePicThumb.img"),formattedTitle:this.async("chat.formattedTitle"),activeDropdown:void 0}},toggleInfo:function(){if(l.find(l.DRAWER_RIGHT))return void b.closeDrawer();var e=this.props.chat;e.isUser?b.openDrawer(s.createElement(y,{contact:e.contact,type:l.DRAWER_RIGHT}),"slide-left"):e.isBroadcast?b.openDrawer(s.createElement(T,{chat:e,type:l.DRAWER_RIGHT}),"slide-left"):e.isGroup&&b.openDrawer(s.createElement(E,{chat:e,type:l.DRAWER_RIGHT}),"slide-left")},render:function(){var e,t,r=this.props.chat;return r.isUser?(e=s.createElement(F,{chat:r,onSelectMessages:this.props.onSelectMessages}),t=s.createElement(h,{presence:r.presence,placeholder:l10n.t("click_here_for_user_info"),location:"title"})):r.isBroadcast?(e=s.createElement(U,{chat:r,onSelectMessages:this.props.onSelectMessages}),t=null):r.isGroup&&(e=s.createElement(L,{chat:r,onSelectMessages:this.props.onSelectMessages}),t=s.createElement(p,{presence:r.presence,groupMetadata:r.groupMetadata,placeholder:l10n.t("click_here_for_group_info"),location:"title"})),s.createElement("header",{className:"pane-header pane-chat-header"},s.createElement("div",{className:"chat-avatar",onClick:this.toggleInfo},s.createElement(m,{id:r.id})),s.createElement("div",{className:"chat-body",onClick:this.toggleInfo},s.createElement("div",{className:"chat-main"},s.createElement("h2",{className:"chat-title",dir:"auto"},s.createElement(f,{text:this.state.formattedTitle,titlify:!0,ellipsify:!0}))),t),s.createElement("div",{className:"pane-chat-controls"},s.createElement(N,{key:"conversation-header"},s.createElement(w,{a8n:"conversation-clip",icon:"clip",title:l10n.t("menutitle_attach"),transitionName:"menu"},s.createElement(A,{chat:r})),s.createElement(w,{a8n:"conversation-menu",icon:"menu",title:l10n.t("menutitle_menu")},e))))}}),A=s.createClass({displayName:"AttachMenuDropdown",mixins:[c],propTypes:{chat:s.PropTypes.instanceOf(u).isRequired},onClick:function(){l.pop(l.MENU)},stopPropagation:function(e){e.stopPropagation()},onImageClick:function(e){e.stopPropagation();var t=this.refs.input;t.click()},onFilePick:function(e){e.stopPropagation();for(var t=e.target.files,r=[],o=0;o<t.length;o++)r.push(t[o]);e.target.value="",l.pop(l.MENU),b.openDrawer(s.createElement(g,{files:r,chat:this.props.chat,type:l.DRAWER_MID}),"slide-up")},guideConfirm:function(){b.closeModal()},onCaptureClick:function(){l.pop(l.MENU);var e=this.props.chat,t=new i["default"](function(r,o){navigator.getUserMedia({video:!0},function(o){b.closeModal(),r(o),t.isResolved()&&b.openDrawer(s.createElement(v,{chat:e,stream:o,type:l.DRAWER_MID}),"slide-up")},function(e){var r=_.isString(e)?e:e.name,n=C.GUM[r]||C.GUM.GUMError;o(new n),t&&t.isResolved()&&b.closeModal()})}).bind(this).timeout(1e3,"waitForGUMConversationHeaderTimeout").then(function(t){b.openDrawer(s.createElement(v,{chat:e,stream:t,type:l.DRAWER_MID}),"slide-up")})["catch"](i["default"].TimeoutError,function(){b.openModal(s.createElement(S,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_description",type:S.TYPE.GUIDE_ALLOW}))})["catch"](C.GUM.PermissionDeniedError,function(){b.openModal(s.createElement(S,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_fail_description",type:S.TYPE.GUIDE_UNBLOCK}))})["catch"](C.GUM.GUMError,function(){b.openModal(s.createElement(S,{title:"guide_desktop_camera_missing_title",desc:"guide_desktop_camera_missing_description",type:S.TYPE.GUIDE_NONE}))})},onLocationClick:function(){},render:function(){var e=navigator.getUserMedia?s.createElement(D,{style:{"float":"right"},trigger:!0,tooltip:l10n.t("attach_capture"),direction:"left"},s.createElement("button",{className:"menu-icons-item",onClick:this.onCaptureClick},s.createElement("div",{className:"icon-xl icon-camera"}))):null;return s.createElement(P,{type:P.Type.MENU,key:"AttachMenuDropdown"},s.createElement(D,{style:{"float":"right"},trigger:!0,tooltip:l10n.t("attach_media"),direction:"left"},s.createElement("button",{className:"menu-icons-item",onClick:this.onImageClick},s.createElement("div",{className:"icon-xl icon-image"}))),e,s.createElement("input",{ref:"input",type:"file",accept:a.IMAGE_MIMES+","+a.VIDEO_MIMES,style:{display:"none"},onClick:this.stopPropagation,onChange:this.onFilePick,multiple:!0}))}}),L=s.createClass({displayName:"GroupMenuDropdown",mixins:[d],propTypes:{chat:s.PropTypes.instanceOf(u).isRequired,onSelectMessages:s.PropTypes.func.isRequired},getInitialState:function(){return{isReadOnly:this.async("chat.isReadOnly")}},onGroupInfo:function(){return l.find(l.DRAWER_RIGHT)?void b.closeDrawer():void b.openDrawer(s.createElement(E,{chat:this.props.chat,type:l.DRAWER_RIGHT}),"slide-left")},onArchive:function(e){b.archiveChat(this.props.chat,e)},onMute:function(e){b.muteChat(this.props.chat,e)},onDeleteOrExit:function(){b.deleteOrExitChat(this.props.chat)},render:function(){var e=this.props.chat,t=[],r=s.createElement(R,{a8n:"mi-select-messages",action:this.props.onSelectMessages,shortcut:"e"},l10n.t("web_select_messages"));return t.push(r),e.canArchive()&&t.push(s.createElement(x,{key:"archive",onArchive:this.onArchive,chat:e})),e.mute.canMute()&&t.push(s.createElement(k,{key:"mute",onMute:this.onMute,chat:e})),e.canDelete()&&t.push(s.createElement(I,{key:"delete",onDeleteOrExit:this.onDeleteOrExit,chat:e})),s.createElement(P,{type:P.Type.DROPDOWN_MENU,key:"GroupMenuDropdown",flipOnRTL:!0,direction:{x:P.Direction.X.LEFT}},s.createElement(R,{action:this.onGroupInfo,shortcut:"i"},l10n.t("web_group_info")),t)}}),U=s.createClass({displayName:"BroadcastMenuDropdown",propTypes:{chat:s.PropTypes.instanceOf(u).isRequired,onSelectMessages:s.PropTypes.func.isRequired},onBroadcastInfo:function(){return l.find(l.DRAWER_RIGHT)?void b.closeDrawer():void b.openDrawer(s.createElement(T,{chat:this.props.chat,type:l.DRAWER_RIGHT}),"slide-left")},onDeleteOrExit:function(){b.deleteOrExitChat(this.props.chat)},onArchive:function(e){b.archiveChat(this.props.chat,e)},render:function(){var e=this.props.chat,t=[],r=s.createElement(R,{a8n:"mi-select-messages",action:this.props.onSelectMessages,shortcut:"e"},l10n.t("web_select_messages"));return t.push(r),e.canArchive()&&t.push(s.createElement(x,{key:"archive",onArchive:this.onArchive,chat:e})),e.canDelete()&&t.push(s.createElement(I,{key:"delete",onDeleteOrExit:this.onDeleteOrExit,chat:e})),s.createElement(P,{type:P.Type.DROPDOWN_MENU,key:"BroadcastMenuDropdown",flipOnRTL:!0,direction:{x:P.Direction.X.LEFT}},s.createElement(R,{action:this.onBroadcastInfo,shortcut:"i"},l10n.t("web_list_info")),t)}}),F=s.createClass({displayName:"ContactMenuDropdown",propTypes:{chat:s.PropTypes.instanceOf(u).isRequired,onSelectMessages:s.PropTypes.func.isRequired},onContactInfo:function(){return l.find(l.DRAWER_RIGHT)?void b.closeDrawer(l.DRAWER_RIGHT):void b.openDrawer(s.createElement(y,{contact:this.props.chat.contact,type:l.DRAWER_RIGHT}),"slide-left")},onArchive:function(e){b.archiveChat(this.props.chat,e)},onMute:function(e){b.muteChat(this.props.chat,e)},onDeleteOrExit:function(){b.deleteOrExitChat(this.props.chat)},render:function(){var e=this.props.chat,t=[],r=s.createElement(R,{a8n:"mi-select-messages",action:this.props.onSelectMessages,shortcut:"e"},l10n.t("web_select_messages"));return t.push(r),e.canArchive()&&t.push(s.createElement(x,{key:"archive",onArchive:this.onArchive,chat:e})),e.mute.canMute()&&t.push(s.createElement(k,{key:"mute",onMute:this.onMute,chat:e})),e.canDelete()&&t.push(s.createElement(I,{key:"delete",onDeleteOrExit:this.onDeleteOrExit,chat:e})),s.createElement(P,{type:P.Type.DROPDOWN_MENU,key:"ContactMenuDropdown",flipOnRTL:!0,direction:{x:P.Direction.X.LEFT}},s.createElement(R,{a8n:"mi-contact",action:this.onContactInfo,shortcut:"i"},l10n.t("web_contact_info")),t)}});e.exports=O},874:function(e,t,r){"use strict";var o=r(6),n=r(30),i=r(8),s=r(770),a=r(103),d=r(79),c=r(154),l=r(889),u=r(875),p=r(9),h=r(773),m=r(104),f=r(45),g=r(801),v=r(78),y=r(791),E=r(77),T=o.createClass({displayName:"ConversationMsgs",mixins:[s,d,a,m,c],propTypes:{chat:o.PropTypes.instanceOf(h).isRequired,selectable:o.PropTypes.bool,onMessageSelect:o.PropTypes.func.isRequired},statics:{MSG_CHUNK:50},getInitialState:function(){return{cursor:Math.min(T.MSG_CHUNK,this.props.msgCollection.length),unreadCount:this.props.chat.unreadCount}},componentDidMount:function(){var e=this.props.chat;if(this.regCmd("load_earlier_msgs:"+e.id,this.loadEarlierMsgs),this.regCmd("open_chat",this.onOpenChat),this.regCmd("compose_height_change",this.composeHeightChange),this.attachMsgCollectionObservers(),this.regNativeListener(window,"focus",this.windowGainedFocus),this.regNativeListener(window,"blur",this.windowLostFocus),e.isGroup){var t=this.props.chat.groupMetadata;this.addObserver(t.participants,"change:contact.name change:contact.isMyContact"),this.addObserver(t,"change:trusted")}else e.isUser&&this.addObserver(e.contact,"change:isMyContact");if(!e.noEarlierMsgs){var r=n.findDOMNode(this);0===r.scrollTop&&p.loadEarlierMsgs(this.props.chat)}},attachMsgCollectionObservers:function(e){var t=this.props.chat,r=this.props.msgCollection;e&&(this.removeObserver(t,"change:unreadCount"),this.removeObserver(r,"change:last"),this.removeObserver(r,"bulk_add remove"),t=e.chat,r=e.msgCollection),r===t.msgs&&(this.addObserver(t,"change:unreadCount",this.onUnreadCount),this.addObserver(r,"change:last",this.onLastMsgChanged)),this.addObserver(r,"bulk_add remove")},isMostRecentCMC:function(){return this.props.chat.msgs===this.props.msgCollection},componentWillReceiveProps:function(e){this.attachMsgCollectionObservers(e)},componentWillUnmount:function(){this.isMostRecentCMC()&&(this.props.chat.isDirty()&&this.props.chat.sendSeen(),this.props.chat.markedUnread=!1)},scrollTo:function(e){e(n.findDOMNode(this))},loadEarlierMsgs:function(){var e=this.props.chat,t=this.props.msgCollection;if(t.length<=this.state.cursor){var r=this;e.loadEarlierMsgs(t).then(function(){r.isMounted()&&r.setState({cursor:t.length})})}else{var o=Math.min(this.state.cursor+T.MSG_CHUNK,t.length);this.setState({cursor:o})}},composeHeightChange:function(e){var t=n.findDOMNode(this);if(e){if(0>e&&t.scrollTop===t.scrollHeight-t.clientHeight)return;t.scrollTop=t.scrollTop+e}else{var r=t.scrollHeight-(t.scrollTop+t.clientHeight);Velocity(t,{tween:18},{progress:function(){t.scrollTop=t.scrollHeight-r-t.clientHeight},duration:300},[.1,.82,.25,1])}},nearBottom:function(e){return e=e||n.findDOMNode(this),e.scrollTop+i.SCROLL_FUDGE>e.scrollHeight-e.clientHeight},getMsgs:function(){var e=this.props.msgCollection,t=e.length,r=Math.max(0,t-this.state.cursor);return e.toArray().slice(r,t)},onScroll:function(e){this.handleScroll(e.target,this.props.chat,this.nearBottom,this)},handleScroll:_.throttle(function(e,t,r,o){0===e.scrollTop&&p.loadEarlierMsgs(t),r(e)&&t.isDirty()&&document.hasFocus()&&o.isMostRecentCMC()&&t.sendSeen()},100),windowGainedFocus:function(){var e=this.props.chat;!this.clearUnreadTimer&&e.isDirty()&&(this.clearUnreadTimer=this.safeDelay(function(){delete this.clearUnreadTimer;var t=n.findDOMNode(this);this.nearBottom(t)&&e.isDirty()&&this.isMostRecentCMC()&&e.sendSeen()},i.CLEAR_CHAT_DIRTY_WAIT))},windowLostFocus:function(){if(this.state.unreadCount&&this.isMostRecentCMC()){var e=this.props.chat;0===e.unreadCount&&this.setState({unreadCount:0}),e.markedUnread=!1}},onOpenChat:function(e){e.id===this.props.chat.id&&this.isMostRecentCMC()&&this.scrollToBottom()},scrollToBottom:function(){var e=n.findDOMNode(this);e.scrollTop=e.scrollHeight},onLastMsgChanged:function(){var e=this.props.chat,t=this.props.msgCollection,r=t.last();(document.hasFocus()||r&&r.isSentByMe)&&(this.state.unreadCount&&this.setState({unreadCount:0}),(r&&r.isSentByMe||this.nearBottom())&&this.scrollToBottom()),r&&r.isSentByMe&&e.isDirty()&&this.isMostRecentCMC()&&e.sendSeen();var o=t.length;o!==this.state.cursor&&this.setState({cursor:o})},onUnreadCount:function(){var e=this.props.chat,t=document.hasFocus();return!t&&e.unreadCount&&e.unreadCount!==this.state.unreadCount?void this.setState({unreadCount:e.unreadCount}):void(t&&e.isDirty()&&this.nearBottom()&&this.isMostRecentCMC()&&e.sendSeen())},onPageUpDown:function(e){n.findDOMNode(this).focus()},onKeyPress:function(e){e.metaKey||e.ctrlKey||("Enter"!==e.key||e.shiftKey?f.isGecko?p.pasteChatTextInput(this.props.chat,String.fromCharCode(e.charCode)):p.focusChatTextInput(this.props.chat):p.enterChatTextInput(this.props.chat))},onPaste:function(e){e.preventDefault();var t=e.clipboardData.items,r=_.filter(t,function(e){var t=g.typeFromMimetype(e.type);return"file"===e.kind&&("image"===t||"video"===t)}).map(function(e){return e.getAsFile()});return r.length?void(t.length===r.length&&p.openDrawer(o.createElement(y,{files:r,chat:this.props.chat,type:v.DRAWER_MID}),"slide-up")):void p.pasteChatTextInput(this.props.chat,e.clipboardData.getData("text/plain"))},render:function(){var e=E("pane-chat-msgs pane-chat-body lastTabIndex",{selectable:this.props.selectable});return o.createElement("div",{className:e,onScroll:this.onScroll,onKeyPress:this.onKeyPress,onPaste:this.onPaste,tabIndex:"0"},o.createElement("div",{className:"pane-chat-empty"}),o.createElement(u,{chat:this.props.chat}),o.createElement(l,{key:"ml-"+this.props.chat.id,scrollTo:this.scrollTo,chatId:this.props.chat.id,unreadCount:this.state.unreadCount,selectable:this.props.selectable,onMessageSelect:this.props.onMessageSelect,msgs:this.getMsgs()}))}});e.exports=T},875:function(e,t,r){"use strict";var o=r(6),n=r(9),i=r(155),s=r(770),a=r(773),d=o.createClass({displayName:"LoadEarlierMessages",mixins:[s],propTypes:{chat:o.PropTypes.instanceOf(a).isRequired},getInitialState:function(){return{noEarlierMsgs:this.async("chat.noEarlierMsgs"),isLoadingMsgs:this.async("chat.isLoadingMsgs")}},loadEarlierMsgs:function(e){this.state.isLoadingMsgs||n.loadEarlierMsgs(this.props.chat)},render:function(){return this.state.noEarlierMsgs?null:this.state.isLoadingMsgs?o.createElement("div",{className:"more"},o.createElement("div",{className:"btn-more",title:l10n.t("loading_messages")},o.createElement(i,{stroke:6,size:24}))):o.createElement("div",{className:"more"},o.createElement("div",{className:"btn-more",title:l10n.t("load_earlier_messages"),onClick:this.loadEarlierMsgs},o.createElement("span",{className:"icon icon-refresh"})))}});e.exports=d},876:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(6),a=r(1),d=r(771),c=r(770),l=r(104),u=r(796),p=r(834),h=r(785),m=r(784),f=r(9),g=r(838),v=r(341),y=r(799),u=r(796),E=r(11),T=r(80),b=r(153),S=s.createClass({displayName:"AudioVideo",mixins:[c,l],propTypes:{msg:s.PropTypes.instanceOf(d).isRequired,isContinuation:s.PropTypes.bool},getInitialState:function(){return this.retry=0,{urlState:this.async("msg.urlState"),url:this.async("msg.url"),uploadState:this.async("msg.uploadState")}},showMediaMissing:function(){var e,t,r=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];switch(this.props.msg.type){case d.TYPE.VIDEO:e=l10n.t("missing_video_title"),t=r?l10n.t("missing_video_forward_text"):l10n.t("missing_video_text");break;case d.TYPE.AUDIO:e=l10n.t("missing_audio_title"),t=r?l10n.t("missing_audio_forward_text"):l10n.t("missing_audio_text")}f.openModal(s.createElement(v,{title:e,onOK:f.closeModal.bind(f),okText:l10n.t("web_ok")},t))},cancelMediaReupload:function(){this.preloadImagePromise&&this.preloadImagePromise.cancel(),this.props.msg.urlState=d.URL_STATE.NO_URL},remoteMediaReupload:function(){T.supportsFeature(T.F.MEDIA_RETRY)?this.props.msg.resend()["catch"](_.noop):f.openModal(s.createElement(y,{msg:this.props.msg}))},requestMediaReupload:function(){var e=this,t=this.props.msg;t.requestMediaReupload().then(function(){e.isMounted()&&t.urlState===d.URL_STATE.URL&&e.launchMediaViewer()})["catch"](_.noop)},launchMediaViewer:function(e){f.openModal(s.createElement(g,{startId:this.props.msg.id.toString()}),"media-viewer")},cancelMmsUpload:function(){var e=this.props.msg;e.uploadPromise&&e.uploadPromise.cancel()},retryMmsUpload:function(){var e=this,t=this.props.msg.reuploadMedia();t&&t["catch"](i["default"].CancellationError,_.noop)["catch"](E.MediaMissing,function(){return e.showMediaMissing(!0)})["catch"](E.GaveUpRetry,_.noop)},render:function(){var e=this,t=this.props.msg,r=t.caption&&t.type!==d.TYPE.VIDEO||t.type===d.TYPE.AUDIO?null:s.createElement("div",{className:"shade"}),o=t.caption?s.createElement(p,{msg:t}):null,n="bubble-image bubble-video";t.caption&&(n+=" bubble-image-caption");var i=_.noop,c=null;if(t.ack<0)switch(t.urlState){case d.URL_STATE.UPLOADING:c=s.createElement(u.Pending,null);break;default:c=s.createElement(u.Upload,{filesize:t.size}),i=this.remoteMediaReupload}else switch(t.urlState){case d.URL_STATE.INIT:case d.URL_STATE.REFRESHING:c=s.createElement(u.Pending,null);break;case d.URL_STATE.NO_URL:case d.URL_STATE.RMR_ERROR_RETRY:case d.URL_STATE.STATUS_ERR:c=s.createElement(u.Download,{filesize:t.size}),i=this.requestMediaReupload;break;case d.URL_STATE.REFRESH_RETRY:c=s.createElement(u.Download,{filesize:t.size}),i=t.initializeMedia.bind(t);break;case d.URL_STATE.RMR_FETCHING:c=s.createElement(u.PendingCancel,null),i=this.cancelMediaReupload;break;case d.URL_STATE.RMR_ERROR_MISSING:i=function(){return e.showMediaMissing(!1)};break;case d.URL_STATE.URL:case d.URL_STATE.STATUS_200:case d.URL_STATE.UPLOADING:switch(t.uploadState){case d.UPLOAD_STATE.UPLOADING:c=s.createElement(u.PendingCancel,null),i=this.cancelMmsUpload;break;case d.UPLOAD_STATE.RETRY:c=s.createElement(u.Upload,{filesize:t.size}),i=this.retryMmsUpload;break;case d.UPLOAD_STATE.PHONE_UPLOADING:c=s.createElement(u.Pending,null);break;default:c=s.createElement(u.Play,null),i=this.launchMediaViewer}break;default:a.log("audioVideo:render Unknown media state")()}var l=b.durationStr(t.duration)||null;l&&(l=s.createElement("span",{className:"message-duration"},t.type===d.TYPE.VIDEO?s.createElement("span",{className:"icon-s icon-msg-video-light"}):s.createElement("span",{className:"icon-s icon-msg-audio-light"}),l));var f;if(t.type===d.TYPE.VIDEO){var g="data:image/jpeg;base64,"+t.body,v={backgroundImage:'url("'+g+'")'};f=s.createElement("div",{className:"image-thumb-body",style:v})}else t.type===d.TYPE.AUDIO&&(f=s.createElement("div",{className:"image-audio"}));var y=!this.props.isContinuation&&m.shouldRender(t)?s.createElement(m,{msg:t}):null;return s.createElement("div",null,s.createElement("div",{className:n},y,s.createElement("div",{className:"image-thumb",onClick:i},c,f,r,l),o,s.createElement(h,{msg:this.props.msg})))}});e.exports=S},877:function(e,t,r){"use strict";var o=r(6),n=r(781),i=r(772),s=r(687),a=r(79),d=r(153),c=o.createClass({displayName:"DateMarker",mixins:[a,s],propTypes:{timestamp:o.PropTypes.number.isRequired},componentDidMount:function(){this.maybeRegMidnight()},componentDidUpdate:function(){this.maybeRegMidnight()},rerender:function(){this.forceUpdate()},maybeRegMidnight:function(){this.unregCmd("midnight",this.rerender);var e=moment().startOf("day").subtract(7,"day");this.props.timestamp>=e.unix()&&this.regCmd("midnight",this.rerender)},render:function(){var e=d.relativeDateStr(this.props.timestamp).toUpperCase();return o.createElement("span",{className:"message-system-body"},o.createElement(n,null,o.createElement(i,{direction:"auto",text:e})))}});e.exports=c},878:function(e,t,r){"use strict";var o=r(6),n=r(784),i=r(785),s=r(771),a=r(772),d=r(802),c=r(77),l=r(687),u=o.createClass({displayName:"Doc",mixins:[l],propTypes:{msg:o.PropTypes.instanceOf(s).isRequired,senderName:o.PropTypes.string,isContinuation:o.PropTypes.bool,trusted:o.PropTypes.bool},render:function(){var e=this.props,t=e.msg,r=e.isContinuation,s=e.trusted,l=c("bubble","bubble-text",{"bubble-text-broadcast":t.broadcast}),u=!r&&n.shouldRender(t)?o.createElement(n,{msg:t}):null;return o.createElement("div",{className:l},u,o.createElement("div",{className:"message-text","data-id":t.id},o.createElement(a,{text:d.msgText(t),selectable:!0,dirMismatch:t.rtl!==l10n.isRTL(),direction:"auto",linkify:s,wbr:15})),o.createElement(i,{msg:t}))}});e.exports=u},879:function(e,t,r){"use strict";var o=r(6),n=r(781),i=r(807),s=r(770),a=r(771),d=r(785),c=r(784),l=r(41),u=o.createClass({displayName:"Location",mixins:[s],propTypes:{msg:o.PropTypes.instanceOf(a).isRequired,isContinuation:o.PropTypes.bool},getInitialState:function(){return{url:this.async("msg.body")}},googleMapUrl:function(){var e=this.props.msg,t=this.loc();return t&&t.name?["https://maps.google.com/maps/search",encodeURIComponent(t.name),"@"+e.lat+","+e.lng+",17z"].join("/"):l.build("https://maps.google.com/maps",{q:e.lat+","+e.lng,z:17})},mapUrl:function(){return this.props.msg.clientUrl||this.googleMapUrl()},loc:function p(){var p=this.props.msg.get("loc");return p?(p=p.split("\n"),2===p.length?{name:p[0],addr:p[1]}:{name:p}):void 0},render:function(){var e,t,r=this.props.msg,s=o.createElement("a",{href:this.googleMapUrl(),className:"preview-location",target:"_blank"},o.createElement(i,{thumb:r.body,type:r.type,shade:!1})),a=r.isSentByMe?"text no-author":"text",l=this.loc();l?(e=o.createElement("a",{href:this.mapUrl(),title:l.name,target:"_blank",className:"text-title"},o.createElement(n,null,l.name)),t=l.addr?o.createElement("div",{title:l.addr,className:"text-contents"},o.createElement(n,null,l.addr)):null):e=o.createElement("a",{href:this.mapUrl(),title:l10n.t("web_view"),target:"_blank",className:"text-title"},o.createElement(n,null,l10n.t("web_view")));var u=!this.props.isContinuation&&c.shouldRender(r)?o.createElement(c,{msg:r}):null;return o.createElement("div",{className:"bubble bubble-attach bubble-location"},u,o.createElement("div",{className:"wrapper"},s,o.createElement("div",{className:"contents"},o.createElement("div",{className:a},e,t),o.createElement(d,{msg:r}))))}});e.exports=u},880:function(e,t,r){"use strict";var o=r(6),n=r(781),i=r(772),s=r(687),a=o.createClass({displayName:"Notification",mixins:[s],propTypes:{text:o.PropTypes.string.isRequired},render:function(){return o.createElement("span",{className:"message-system-body"},o.createElement(n,null,o.createElement(i,{direction:"auto",text:this.props.text})))}});e.exports=a},881:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(6),a=r(1),d=r(770),c=r(784),l=r(834),u=r(77),p=r(9),h=r(341),m=r(799),f=r(11),g=r(41),v=r(796),y=r(838),E=r(798),T=r(785),b=r(771),S=r(104),C=r(80),M=r(8),N=s.createClass({displayName:"Picture",mixins:[d,S],propTypes:{msg:s.PropTypes.instanceOf(b).isRequired,isMsgInfo:s.PropTypes.bool,isContinuation:s.PropTypes.bool},defaultWidth:330,canLoad:function(){return _.contains([b.URL_STATE.URL,b.URL_STATE.STATUS_200],this.props.msg.urlState)},getInitialState:function(){this.retry=0;var e=this.props.msg,t=e.url,r=e.mediaKey;if(t&&this.canLoad()){var o=new Image;o.src=t,o.complete?this.onPreloadLoad(o):this.preloadImage(t,r);
}return{urlState:this.async("msg.urlState"),url:this.async("msg.url"),mediaKey:this.async("msg.mediaKey"),uploadState:this.async("msg.uploadState")}},componentDidMount:function(){this.regNativeListener(window,"online",this.ensureImageLoaded)},componentWillUpdate:function(e,t){(t.url!==this.state.url||t.mediaKey!==this.state.mediaKey)&&this.canLoad()&&this.preloadImage(t.url,t.mediaKey)},ensureImageLoaded:function(){var e=this.props.msg;e.url&&e.urlState!==b.URL_STATE.STATUS_200&&this.preloadImage(e.url,e.mediaKey)},isImageLoaded:function(e){if(!e)return!1;var t=new Image;return t.src=e,t.complete},preloadImage:function(e,t,r){if(e){this.preloadImagePromise&&this.preloadImagePromise.cancel();var o;o=g.isEncryptedMedia(e)?this.props.msg.decryptMedia(e,t):i["default"].resolve(e);var n=this.preloadImagePromise=o.then(function(t){return new i["default"](function(r,o){var n=function(t){o(new f.ImageError("Image preload error",e))},i=new Image;i.onload=function(){r(i)},i.onerror=n,i.src=t})}).bind(this).cancellable().then(this.onPreloadLoad)["finally"](function(){n===this.preloadImagePromise&&delete this.preloadImagePromise})["catch"](i["default"].CancellationError,_.noop)["catch"](f.ImageError,r?this.onImgErrorRMR:this.onPreloadError)}},onPreloadLoad:function(e){var t=this.props.msg;t.set({fullWidth:e.naturalWidth,fullHeight:e.naturalHeight}),t.urlState200(e.src)},onPreloadError:function(e){e.src===this.props.msg.url&&(this.props.msg.urlState=b.URL_STATE.STATUS_ERR)},onImgErrorRMR:function(e){this.props.msg.mediaLoadError(e.src)},getImgStyle:function(){var e=this.getHeight(),t=this.aspect(this.defaultWidth,e);return this.isPortrait(t)?{width:this.defaultWidth}:{height:"100%"}},getStyle:function(){return{width:this.defaultWidth+"px",height:this.getHeight()}},getHeight:function(){var e,t,r=this.props.msg;r.urlState===b.URL_STATE.STATUS_200?(e=r.fullWidth||r.width,t=r.fullHeight||r.height):(e=r.width||1,t=r.height||1);var o,n=this.defaultWidth,i=this.aspect(e,t),s=this.isPortrait(i);return s?o=n:i&&(i>2.4?o=n/2.4:e&&t&&(o=t*(n/e))),Math.round(o)},isPortrait:function(e){return e?1>=e:null},aspect:function(e,t){return e&&t?e/t:void 0},showMediaMissing:function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0],t=e?l10n.t("missing_photo_forward_text"):l10n.t("missing_photo_text");p.openModal(s.createElement(h,{title:l10n.t("missing_photo_title"),onOK:p.closeModal.bind(p),okText:l10n.t("web_ok")},t))},cancelMediaReupload:function(){this.preloadImagePromise&&this.preloadImagePromise.cancel(),this.props.msg.urlState=b.URL_STATE.NO_URL},remoteMediaReupload:function(){C.supportsFeature(C.F.MEDIA_RETRY)?this.props.msg.resend()["catch"](_.noop):p.openModal(s.createElement(m,{msg:this.props.msg}))},requestMediaReupload:function(){var e=this.props.msg;e.url?this.preloadImage(e.url,e.mediaKey,!0):e.requestMediaReupload()["catch"](_.noop)},cancelMmsUpload:function(){var e=this.props.msg;e.uploadPromise&&e.uploadPromise.cancel()},retryMmsUpload:function(){var e=this,t=this.props.msg.reuploadMedia();t&&t["catch"](i["default"].CancellationError,_.noop)["catch"](f.MediaMissing,function(){return e.showMediaMissing(!0)})["catch"](f.GaveUpRetry,_.noop)},launchMediaViewer:function(e){var t=this;if(this.props.isMsgInfo){var r=function(e){t.isMounted()&&e(t.refs.img)};p.openModal(s.createElement(E,{contact:this.props.msg.senderObj,imgFull:this.props.msg.url,getZoomNode:r}),"media-viewer")}else p.openModal(s.createElement(y,{startId:this.props.msg.id.toString()}),"media-viewer")},onDragStart:function(e){e.nativeEvent.dataTransfer.setData(M.DRAG_TYPE_LOCAL_IMAGE,!0)},render:function(){var e=this,t=this.props.msg,r=t.caption?null:s.createElement("div",{className:"shade"}),o=t.caption?s.createElement(l,{msg:t}):null,n=_.noop,i=null,d="data:image/jpeg;base64,"+t.body;if(t.ack<0)switch(t.urlState){case b.URL_STATE.UPLOADING:i=s.createElement(v.Pending,null);break;default:i=s.createElement(v.Upload,{filesize:t.size}),n=this.remoteMediaReupload}else switch(t.urlState){case b.URL_STATE.INIT:case b.URL_STATE.REFRESHING:i=s.createElement(v.Pending,null);break;case b.URL_STATE.NO_URL:case b.URL_STATE.RMR_ERROR_RETRY:case b.URL_STATE.STATUS_ERR:i=s.createElement(v.Download,{filesize:t.size}),n=this.requestMediaReupload;break;case b.URL_STATE.REFRESH_RETRY:i=s.createElement(v.Download,{filesize:t.size}),n=t.initializeMedia.bind(t);break;case b.URL_STATE.URL:case b.URL_STATE.RMR_FETCHING:i=s.createElement(v.PendingCancel,null),n=this.cancelMediaReupload;break;case b.URL_STATE.RMR_ERROR_MISSING:n=function(){return e.showMediaMissing(!1)};break;case b.URL_STATE.STATUS_200:d=t.url;case b.URL_STATE.UPLOADING:switch(t.uploadState){case b.UPLOAD_STATE.UPLOADING:t.url&&(d=t.url),i=s.createElement(v.PendingCancel,null),n=this.cancelMmsUpload;break;case b.UPLOAD_STATE.RETRY:t.url&&(d=t.url),i=s.createElement(v.Upload,{filesize:t.size}),n=this.retryMmsUpload;break;case b.UPLOAD_STATE.PHONE_UPLOADING:i=s.createElement(v.Pending,null);break;default:n=this.launchMediaViewer}break;default:a.log("picture:render Unknown image state")()}var p=u("bubble-image",{"bubble-image-caption":t.caption}),h=u("image-thumb-body",{"image-thumb-lores":d!==t.url}),m=!this.props.isContinuation&&c.shouldRender(t)?s.createElement(c,{msg:t}):null;return s.createElement("div",{className:p},m,s.createElement("div",{className:"image-thumb",onClick:n,style:this.getStyle()},i,s.createElement("img",{src:d,onDragStart:this.onDragStart,className:h,style:this.getImgStyle(),ref:"img"}),r),o,s.createElement(T,{msg:this.props.msg}))}});e.exports=N},882:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(6),a=r(8),d=r(1),c=r(771),l=r(770),u=r(785),p=r(784),h=r(11),m=r(807),f=r(883),g=r(884),v=r(799),y=r(9),E=r(80),T=r(341),b=s.createClass({displayName:"PTT",mixins:[l],propTypes:{msg:s.PropTypes.instanceOf(c).isRequired,isContinuation:s.PropTypes.bool},getInitialState:function(){return{uploadState:this.async("msg.uploadState"),urlState:this.async("msg.urlState"),url:this.async("msg.url"),img:this.async("msg.sender.ProfilePicThumb.img"),ack:this.async("msg.ack"),currentTime:0,playing:!1,autoPlay:!1}},getStatusClass:function(e){return e+=" audio-state-default",this.state.ack===a.ACK_PLAYED&&(e+=" audio-state-played"),e},cancelMmsUpload:function(){var e=this.props.msg;e.uploadPromise&&e.uploadPromise.cancel()},retryMmsUpload:function(){var e=this.props.msg.reuploadMedia();e&&e["catch"](i["default"].CancellationError,_.noop)["catch"](h.MediaMissing,this.showMediaMissing)["catch"](h.GaveUpRetry,_.noop)},showMediaMissing:function(){var e=l10n.t("missing_audio_title"),t=l10n.t("missing_audio_forward_text");y.openModal(s.createElement(T,{title:e,onOK:y.closeModal.bind(y),okText:l10n.t("web_ok")},t))},cancelMediaReupload:function(){this.props.msg.urlState=c.URL_STATE.NO_URL},remoteMediaReupload:function(){E.supportsFeature(E.F.MEDIA_RETRY)?this.props.msg.resend()["catch"](_.noop):y.openModal(s.createElement(v,{msg:this.props.msg}))},requestMediaReupload:function(){this.props.msg.requestMediaReupload().bind(this).then(function(){this.isMounted()&&this.setState({autoPlay:!0})})["catch"](_.noop)},handleTimeUpdate:function(e){this.setState({currentTime:e})},handlePlayingUpdate:function(e){this.setState({autoPlay:!1,playing:e})},render:function(){var e=this.props.msg,t=this.getStatusClass("bubble bubble-attach bubble-audio"),r="audio-status icon ";r+=this.state.ack===a.ACK_PLAYED?e.isSentByMe?"icon-ptt-out-blue":"icon-ptt-in-blue":e.isSentByMe?"icon-ptt-out-gray":"icon-ptt-in-green";var o,n=s.createElement("span",{className:r,key:"status"}),i=this.state.playing?this.state.currentTime:e.duration,l=s.createElement(m,{key:"image",thumb:this.state.img,type:e.type,shade:!1,duration:i}),h=e.isSentByMe?[l,n]:null,v=e.isSentByMe?null:[l,n],y=e.isSentByMe?"text no-author":"text";if(e.ack<0)o=s.createElement(f,{action:this.remoteMediaReupload,msg:e});else switch(e.urlState){case c.URL_STATE.INIT:case c.URL_STATE.REFRESHING:o=s.createElement(f,{msg:e});break;case c.URL_STATE.NO_URL:case c.URL_STATE.REFRESH_RETRY:case c.URL_STATE.RMR_ERROR_RETRY:case c.URL_STATE.STATUS_ERR:o=s.createElement(f,{action:this.requestMediaReupload,msg:e});break;case c.URL_STATE.RMR_FETCHING:o=s.createElement(f,{action:this.cancelMediaReupload,msg:e});break;case c.URL_STATE.STATUS_200:case c.URL_STATE.UPLOADING:switch(e.uploadState){case c.UPLOAD_STATE.UPLOADING:o=s.createElement(f,{action:this.cancelMmsUpload,msg:e});break;case c.UPLOAD_STATE.RETRY:o=s.createElement(f,{action:this.retryMmsUpload,msg:e});break;case c.UPLOAD_STATE.PHONE_UPLOADING:o=s.createElement(f,{msg:e});break;default:o=s.createElement(g,{msg:e,autoPlay:this.state.autoPlay,onPlayingUpdate:this.handlePlayingUpdate,onTimeUpdate:this.handleTimeUpdate})}break;case c.URL_STATE.URL:case c.URL_STATE.RMR_ERROR_MISSING:o=s.createElement(g,{msg:e,autoPlay:this.state.autoPlay,onPlayingUpdate:this.handlePlayingUpdate,onTimeUpdate:this.handleTimeUpdate});break;default:d.log("ptt:render Unknown PTT state")()}var E=!this.props.isContinuation&&p.shouldRender(e)?s.createElement(p,{msg:e}):null;return s.createElement("div",{className:t},s.createElement("div",{className:"wrapper"},h,s.createElement("div",{className:"contents"},E,s.createElement("div",{className:y},o)),v,s.createElement(u,{msg:e})))}});e.exports=b},883:function(e,t,r){"use strict";var o=r(6),n=r(1),i=r(771),s=r(155),a=o.createClass({displayName:"PTTLoader",propTypes:{action:o.PropTypes.func,msg:o.PropTypes.instanceOf(i).isRequired},render:function(){var e=null,t=this.props.msg;switch(t.uploadState){case i.UPLOAD_STATE.UPLOADING:e=o.createElement("button",{className:"btn-audio icon icon-audio-cancel-noborder",onClick:this.props.action},o.createElement(s,{stroke:3,size:38}));break;case i.UPLOAD_STATE.RETRY:e=o.createElement("button",{className:"btn-audio icon icon-audio-upload",onClick:this.props.action});break;default:if(t.ack<0)switch(t.urlState){case i.URL_STATE.UPLOADING:e=o.createElement("button",{className:"btn-audio",onClick:this.props.action},o.createElement(s,{stroke:3,size:38}));break;default:e=o.createElement("button",{className:"btn-audio icon icon-audio-upload",onClick:this.props.action})}else switch(t.urlState){case i.URL_STATE.INIT:case i.URL_STATE.REFRESHING:e=o.createElement("button",{className:"btn-audio",onClick:this.props.action},o.createElement(s,{stroke:3,size:38}));break;case i.URL_STATE.NO_URL:case i.URL_STATE.REFRESH_RETRY:case i.URL_STATE.RMR_ERROR_RETRY:case i.URL_STATE.STATUS_ERR:e=o.createElement("button",{className:"btn-audio icon icon-audio-download",onClick:this.props.action});break;case i.URL_STATE.RMR_FETCHING:e=o.createElement("button",{className:"btn-audio icon icon-audio-cancel-noborder",onClick:this.props.action},o.createElement(s,{stroke:3,size:38}));break;default:n.log("pttLoader:render Unknown PTT state")()}}return o.createElement("div",{className:"audio"},o.createElement("div",{className:"audio-controls"},e),o.createElement("div",{className:"audio-body"},o.createElement("input",{type:"range",className:"audio-track",min:0,max:100,value:0,disabled:"disabled"})))}});e.exports=a},884:function(e,t,r){"use strict";var o=r(6),n=r(30),i=r(8),s=r(1),a=r(771),d=r(9),c=r(341),l=r(104),u=r(825),p=o.createClass({displayName:"PTTPlayer",mixins:[l],propTypes:{msg:o.PropTypes.instanceOf(a).isRequired,autoPlay:o.PropTypes.bool.isRequired,onPlayingUpdate:o.PropTypes.func.isRequired,onTimeUpdate:o.PropTypes.func.isRequired},playing:!1,dragging:!1,getInitialState:function(){return{progress:0}},onPlayClick:function(){this.hasPlayed=!0;var e=n.findDOMNode(this.refs.audio);this.playing?e.pause():e.play()},onPlaying:function(){this.playing=!0;var e=this.props.msg;!e.get("isSentByMe")&&e.get("ack")<i.ACK_PLAYED&&e.sendPlayed(),this.props.onPlayingUpdate&&this.props.onPlayingUpdate(this.playing)},onPause:function(){this.playing=!1,this.props.onPlayingUpdate&&this.props.onPlayingUpdate(this.playing)},onEnded:function(){var e=n.findDOMNode(this.refs.audio);e.currentTime=0,e.load()},onTimeUpdate:function(){var e=n.findDOMNode(this.refs.audio),t=0;_.isFinite(e.duration)&&(t=Math.round(100*Math.min(1,e.currentTime/e.duration)),this.props.onTimeUpdate&&this.props.onTimeUpdate(e.currentTime)),this.setState({progress:t})},componentDidMount:function(){var e=n.findDOMNode(this.refs.audio);this.regNativeListener(e,"loadeddata",this.onLoad),this.regNativeListener(e,"playing",this.onPlaying),this.regNativeListener(e,"pause",this.onPause),this.regNativeListener(e,"ended",this.onEnded),this.regNativeListener(e,"timeupdate",this.onTimeUpdate),this.regNativeListener(e,"durationchange",this.onTimeUpdate),this.regNativeListener(e,"progress",this.onTimeUpdate),this.regNativeListener(e,"error",this.onPlayerError,!0)},onLoad:function(e){this.props.msg.urlState=a.URL_STATE.STATUS_200},onPlayerError:function(e){if(this.hasPlayed){var t=e.target.src,r=e.target.error||{code:"__MISSING__"};switch(r.code){case window.MediaError.MEDIA_ERR_NETWORK:case window.MediaError.MEDIA_ERR_DECODE:case window.MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:this.props.msg.mediaLoadError(t);break;default:s.log("pttPlayer:onError message ptt unknown error",r.code,t)()}}else this.props.msg.urlState=a.URL_STATE.NO_URL,this.props.msg.unset("url")},onDrag:function(e){var t=n.findDOMNode(this.refs.audio);this.setState({progress:e}),t.duration&&(t.currentTime=t.duration/100*e)},showMediaMissing:function(){d.openModal(o.createElement(c,{title:l10n.t("missing_audio_title"),onOK:d.closeModal.bind(d),okText:l10n.t("web_ok")},l10n.t("missing_audio_text")))},render:function(){var e="btn-audio icon ";e+=this.playing?"icon-audio-pause":"icon-audio-play";var t={value:this.state.progress,requestChange:this.onDrag},r=this.props.msg.urlState===a.URL_STATE.RMR_ERROR_MISSING?this.showMediaMissing:this.onPlayClick,n={width:this.state.progress-this.state.progress/100*3+"%"};return o.createElement("div",{className:"audio"},o.createElement("div",{className:"audio-controls"},o.createElement("button",{ref:"play_pause",className:e,onClick:r})),o.createElement("div",{className:"audio-body"},o.createElement("div",{className:"audio-track-container"},o.createElement("span",{className:"audio-progress",style:n}),o.createElement("input",{type:"range",className:"audio-track",valueLink:t,min:"0",max:"100"}))),o.createElement(u,{ref:"audio",src:this.props.msg.mmsSrc,preload:"auto",autoPlay:this.props.autoPlay}))}});e.exports=p},885:function(e,t,r){"use strict";var o=r(6),n=r(771),i=o.createClass({displayName:"Status",propTypes:{ack:o.PropTypes.number.isRequired,type:o.PropTypes.string.isRequired},getStatus:function(){var e="icon",t=this.props.ack,r=this.props.type;return e+=1>t?" icon-msg-time":1===t?" icon-msg-check":2===t?" icon-msg-dblcheck":" icon-msg-dblcheck-ack",(r===n.TYPE.IMAGE||r===n.TYPE.VIDEO||r===n.TYPE.AUDIO)&&(e+="-light"),e},render:function(){return o.createElement("span",{className:this.getStatus()})}});e.exports=i},886:function(e,t,r){"use strict";var o=r(6),n=r(784),i=r(785),s=r(835),a=r(771),d=r(772),c=r(77),l=r(687),u=o.createClass({displayName:"Text",mixins:[l],propTypes:{msg:o.PropTypes.instanceOf(a).isRequired,senderName:o.PropTypes.string,isContinuation:o.PropTypes.bool,trusted:o.PropTypes.bool},getHostname:function(e){if(e){var t=document.createElement("a");return t.href=e,t.hostname}},render:function(){var e=this.props,t=e.msg,r=e.isContinuation,a=e.trusted,l=!r&&n.shouldRender(t),u=c("bubble","bubble-text",{"bubble-text-broadcast":t.broadcast,"has-author":l}),p=l?o.createElement(n,{msg:t}):null,h=void 0;if(_.isString(t.matchedText)&&t.body.indexOf(t.matchedText)>-1&&a){var m=t.thumbnail?o.createElement("img",{className:"link-preview-media",src:"data:image/jpeg;base64,"+t.thumbnail}):null,f=t.title?o.createElement("div",{className:"link-preview-title",title:t.title},t.title):null,g=t.description?o.createElement("div",{className:"link-preview-description",title:t.description},t.description):null,v=c("link-preview-body",{nothumb:!m}),y=window.open.bind(window,t.matchedText,"","");h=o.createElement("div",{className:"link-preview-container",onClick:y},m,o.createElement("div",{className:v},f,g,o.createElement("div",{className:"link-preview-source ellipsify"},this.getHostname(t.canonicalUrl)||this.getHostname(t.matchedText))))}return o.createElement("div",{className:u},p,o.createElement("div",{className:"message-text","data-id":t.id},h,o.createElement(s,{msg:t}),o.createElement(d,{text:t.body,selectable:!0,dirMismatch:t.rtl!==l10n.isRTL(),direction:t.dir,linkify:a,wbr:15})),o.createElement(i,{msg:t}))}});e.exports=u},887:function(e,t,r){"use strict";var o=r(6),n=r(30),i=r(781),s=r(770),a=o.createClass({displayName:"Unread",mixins:[s],propTypes:{count:o.PropTypes.number.isRequired,shouldScrollTo:o.PropTypes.bool.isRequired,didInsert:o.PropTypes.func.isRequired},componentDidMount:function(){this.props.shouldScrollTo&&this.props.didInsert(n.findDOMNode(this).parentNode)},render:function(){var e=l10n.t("unread_message_count",{count:l10n.n(this.props.count),_plural:this.props.count});return o.createElement("span",{className:"msg-unread-body"},o.createElement(i,null,e))}});e.exports=a},888:function(e,t,r){"use strict";var o=r(6),n=r(807),i=r(784),s=r(785),a=r(771),d=r(77),c=r(9),l=r(955),u=r(893),p=o.createClass({displayName:"Vcard",propTypes:{msg:o.PropTypes.instanceOf(a).isRequired,isContinuation:o.PropTypes.bool},openContactChat:function(){var e=this.props.msg.vcardWAid;Store.Chat.find(e).then(function(e){c.openChat(e)})},addContactToGroup:function(){Store.Contact.find(this.props.msg.vcardWAid).then(function(e){c.openModal(o.createElement(u,{contact:e}),"modal-flow")})},render:function(){var e=this.props.msg,t=o.createElement(n,{thumb:l.thumbnail(e.body),type:e.type,ref:"media",shade:!1,duration:e.duration}),r=e.isSentByMe?t:null,a=e.isSentByMe?null:t,c=e.author?"text":"text no-author",u=d(["bubble","bubble-attach","bubble-contact"],{"bubble-attach-caption":!!e.caption}),p=void 0;e.vcardWAid&&(p=o.createElement("div",{className:"bubble-actions"},o.createElement("div",{className:"bubble-btn",onClick:this.openContactChat,title:l10n.t("message_author",{author:e.subtype})},l10n.t("message")),o.createElement("div",{className:"bubble-btn",onClick:this.addContactToGroup,title:l10n.t("add_contact_to_group")},l10n.t("add_contact_to_group"))));var h=!this.props.isContinuation&&i.shouldRender(e)?o.createElement(i,{msg:e}):null;return o.createElement("div",null,o.createElement("div",{className:u},o.createElement("div",{className:"wrapper"},r,o.createElement("div",{className:"contents"},h,o.createElement("div",{className:c},o.createElement(s,{msg:e,contextMenu:this.contextMenu})),o.createElement("div",{className:"button button-contact"},e.subtype)),a),p))}});e.exports=p},889:function(e,t,r){"use strict";var o=r(6),n=r(30),i=r(771),s=r(877),a=r(887),d=r(808),c=r(79),l=r(77),u=r(153),p={FRONT:"front",SWITCH:"switch",BACK:"back",MUTATE:"mutate",UNREAD:"unread"},h=o.createClass({displayName:"MessageList",mixins:[c],propTypes:{msgs:o.PropTypes.arrayOf(o.PropTypes.instanceOf(i)).isRequired,scrollTo:o.PropTypes.func.isRequired,chatId:o.PropTypes.string.isRequired,unreadCount:o.PropTypes.number,selectable:o.PropTypes.bool,onMessageSelect:o.PropTypes.func.isRequired},propChangeType:function(e){var t=this.props.msgs,r=e.msgs;return this.props.unreadCount!==e.unreadCount?p.UNREAD:this.props.chatId!==e.chatId?p.SWITCH:t.length&&r.length&&t[0].id!==r[0].id?p.BACK:t.length===r.length||r.length<t.length?p.MUTATE:p.FRONT},componentWillMount:function(){this.regCmd("is_msg_visible",this.isMsgVisible)},didInsertMessageUnread:function(e){this.props.scrollTo(function(t){t.scrollTop=e.offsetTop-t.clientHeight/4}),this.shouldScrollBottom=!1,this.shouldRestoreScroll=void 0},componentDidMount:function(){this._hasRendered=!0,this.shouldScrollBottom!==!1&&this.props.scrollTo(function(e){e.scrollTop=e.scrollHeight})},componentWillUpdate:function(e){this.props.scrollTo(function(t){var r=this.propChangeType(e);if(r===p.SWITCH)this.shouldScrollBottom=!0;else if(r===p.FRONT){var o=_.last(e.msgs);(o.isSentByMe||t.scrollTop+t.offsetHeight===t.scrollHeight)&&(this.shouldScrollBottom=!0),this.shouldScrollBottom||(this.shouldRestoreScroll=t.scrollHeight-t.scrollTop-t.clientHeight)}else(r===p.BACK||r===p.UNREAD)&&(this.shouldRestoreScroll=t.scrollHeight-t.scrollTop-t.clientHeight)}.bind(this))},componentDidUpdate:function(e){this.props.scrollTo(function(e){this.shouldScrollBottom?(e.scrollTop=e.scrollHeight,this.shouldScrollBottom=!1):"undefined"!=typeof this.shouldRestoreScroll&&(e.scrollTop=e.scrollHeight-this.shouldRestoreScroll-e.clientHeight,this.shouldRestoreScroll=void 0)}.bind(this))},processHiddenText:function(e,t){var r="",o="",n=o+o,i=o+o+o,s=n+"([^"+o+"]+)"+i,a=o+o+o+o,d=o+o+o+o+o,c=a+"[^"+o+"]+"+d;if(e=e.replace(new RegExp(r,"g"),""),e=e.replace(new RegExp(""+c,"g"),""),e=e.replace(new RegExp("^[^"+o+"]+"+d+"(.*)","g"),"$1"),e=e.replace(new RegExp("(.*)"+a+"[^"+o+"]+$","g"),"$1"),!new RegExp("^"+s).test(e)&&new RegExp(""+s,"g").test(e)){for(var l,p=t.getRangeAt(0).startContainer,h=0;5>h&&!(l=p.getAttribute&&p.getAttribute("data-id"));h++)p=p.parentNode;var m=Store.Msg.get(l);if(m){var f="["+u.timeStr(m.t)+"]",g=m.senderObj.formattedUser;e=n+f+" "+g+": "+i+e}}e=e.replace(new RegExp("^(.*)"+s+"$","g"),"$1");var v=e.match(new RegExp(s,"g"));return v&&1===v.length&&(e=e.replace(new RegExp(s,"g"),"")),e=e.replace(new RegExp(""+s,"g"),"\n$1"),"\n"===e.charAt(0)&&(e=e.slice(1)),e},parseSelection:function(e){for(var t,r,o="",n=0;n<e.rangeCount;n++)for(r=document.createTreeWalker(e.getRangeAt(n).cloneContents(),window.NodeFilter.SHOW_ALL);r.nextNode();)t=r.currentNode,o+=t instanceof HTMLImageElement?t.alt:t.nodeValue?t.nodeValue:"";return o},onCopy:function(e){var t=window.getSelection(),r=this.parseSelection(t);e.clipboardData.setData("text/plain",this.processHiddenText(r,t)),e.stopPropagation(),e.preventDefault()},isMsgVisible:function(e,t){var r=void 0,o=this.refs[e.toString()];if(o){var i=n.findDOMNode(this).parentNode,s=i.scrollTop,a=s+i.clientHeight,d=n.findDOMNode(o);d.offsetTop+d.clientHeight>s&&d.offsetTop<a&&(r=n.findDOMNode(o.refs.component.refs.img))}t(r)},render:function(){for(var e,t,r=[],n=this.props.msgs,c=n.length,p=this.props.unreadCount,h=[i.TYPE.CHAT,i.TYPE.IMAGE,i.TYPE.VIDEO,i.TYPE.AUDIO,i.TYPE.VCARD,i.TYPE.LOCATION,i.TYPE.PTT];p>0;){if(c--,0>c){c=n.length;break}e=n[c],h.indexOf(e.type)>-1&&p--}var m=n[c];if(m&&m.chat.noEarlierMsgs)for(t=0;c>t;t++)if(h.indexOf(n[t].type)){c=n.length;break}var f=!1,g=void 0;for(t=0;t<n.length;t++)if(e=n[t]){var v=u.dayOfMsg(e);if(0===t||g!==v){var y="msg-"+e.id+"-date";r.push(o.createElement("div",{className:"msg",key:y},o.createElement("div",{className:"message message-system"},o.createElement(s,{key:y,timestamp:e.t})))),f=!1}g=v,t===c&&(r.push(o.createElement("div",{className:"msg msg-unread message msg-wide",key:"msg-unread"},o.createElement(a,{shouldScrollTo:!this._hasRendered,didInsert:this.didInsertMessageUnread,count:this.props.unreadCount}))),f=!1);var E=_.matches({from:e.from,startOfDay:e.startOfDay}),T=_.matches({author:e.author,startOfDay:e.startOfDay}),b=e.isGroupMsg?T:E,S=d.Position.SINGLE,C=n[t+1];(C&&t+1===c||C&&C.isNotification||0===t||C&&v!==u.dayOfMsg(C))&&(C=!1),e.isNotification?S=d.Position.SINGLE:b(C)&&!b(f)?S=d.Position.FRONT:b(f)&&b(C)?S=d.Position.MID:b(f)&&!b(C)&&(S=d.Position.END),e.type===i.TYPE.IMAGE?r.push(o.createElement(d,{key:"msg-"+e.id,ref:e.id.toString(),msg:e,selectable:this.props.selectable,onMessageSelect:this.props.onMessageSelect,position:S})):r.push(o.createElement(d,{key:"msg-"+e.id,msg:e,selectable:this.props.selectable,onMessageSelect:this.props.onMessageSelect,position:S})),f=e.isNotification?!1:e}var M=l("message-list",{selectable:this.props.selectable});return o.createElement("div",{className:M,onCopy:this.onCopy},r)}});e.exports=h},890:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n,i=r(3),s=o(i),a=r(6),d=r(1),c=r(9),l=r(773),u=r(78),p=r(157),h=r(104),m=r(154),f=r(11),g=r(797),v=r(952),y=r(105),E=a.createClass({displayName:"PTT",mixins:[m,h,p],propTypes:{chat:a.PropTypes.instanceOf(l),onStateChange:a.PropTypes.func.isRequired},statics:{READY:"ready",DELAY:"delay",REC:"recording",PROCESSSING:"processsing",GUM_TIMEOUT:"ptt_gum_timeout",PERMISSION_DENIED:"permission_denied",NOT_SUPPORTED_ERROR:"not_supported_error",MANDATORY_UNSATISFIED_ERROR:"mandatory_unsatisfied_error",CANCEL:"cancel",SEND:"send"},getInitialState:function(){return{state:E.READY,active:void 0,elapsedTimeInterval:void 0,elapsedTime:0,startTime:0}},componentDidMount:function(){this.regNativeListener(window,"blur",this.cancelRecording)},isRecording:function(){var e=this.state.state;return e===E.REC||e===E.DELAY||e===E.PROCESSSING},getRecorder:function(){var e;return e=new s["default"](function(t,r){navigator.getUserMedia({audio:!0},function(r){if(e.isResolved()){if(_.isFunction(r.stop))r.stop();else for(var o=r.getTracks(),n=0;n<o.length;n++)o[n].stop();c.closeModal()}else t(r)},function(t){var o=_.isString(t)?t:t.name,n=f.GUM[o]||f.GUM.GUMError;r(new n),e&&e.isResolved()&&c.closeModal()})}).timeout(1500,"waitForGUMConversationPTTTimeout").then(function(e){return n=new v({encoderPath:"/lib/opus-recorder-oggopusEncoder-0.4.3.js",bitRate:16e3,encoderSampleRate:16e3,encoderApplication:2048}),n.stream=e,n.initStream(),n})["catch"](s["default"].TimeoutError,function(e){throw c.openModal(a.createElement(g,{title:"guide_desktop_mic_title",desc:"guide_desktop_mic_description",type:g.TYPE.GUIDE_ALLOW})),e})["catch"](f.GUM.PermissionDeniedError,function(e){throw c.openModal(a.createElement(g,{title:"guide_desktop_mic_title",desc:"guide_desktop_mic_fail_description",type:g.TYPE.GUIDE_UNBLOCK})),e})["catch"](f.GUM.GUMError,function(e){if(e instanceof f.GUM.PermissionDeniedError)throw e;throw c.openModal(a.createElement(g,{title:"guide_desktop_mic_missing_title",desc:"guide_desktop_mic_missing_description",type:g.TYPE.GUIDE_NONE})),e})},cancelRecording:function(){this.isRecording()&&(this.state.state!==E.READY&&this.props.onStateChange(E.READY),this.safeIsMounted()&&this.setState({state:E.READY,active:void 0,elapsedTime:0,startTime:0}),this.clearSafeInterval(this.elapsedTimeInterval),delete this.elapsedTimeInterval,n&&n.stop(),this.props.chat.markPaused())},startInterval:function(){var e=this;this.elapsedTimeInterval=this.safeInterval(function(){e.setState({elapsedTime:e.state.elapsedTime+1})},1e3),this.setState({elapsedTime:0,startTime:Date.now()})},cancelPTTTimer:function(){this.pttTimer&&(this.clearSafeTimeout(this.pttTimer),delete this.pttTimer)},onPTTReady:function(){delete this.pttTimer,this.state.state===E.DELAY&&this.setState({state:E.REC})},uimClose:function(){this.cancelRecording()},onMouseOverSend:function(){this.setState({active:E.SEND})},onMouseOutSend:function(){this.setState({active:void 0})},onMouseOverCancel:function(){this.setState({active:E.CANCEL})},onMouseOutCancel:function(){this.setState({active:void 0})},onMouseUpCancel:function(){this.state.elapsedTime<1||(this.cancelPTTTimer(),this.uimPop(u.PTT))},onMouseUpSend:function(){var e=this;if(!(this.state.elapsedTime<1)){this.cancelPTTTimer();var t=this.props.chat;if(this.state.state===E.REC){var r=Math.ceil((Date.now()-this.state.startTime)/1e3);t.regCancellablePromise(new s["default"](function(o,i){e.setState({state:E.PROCESSSING}),e.props.onStateChange(E.READY),n.addEventListener("dataAvailable",function(i){n.removeEventListener("dataAvailable"),t.sendMedia({file:i.detail,type:"ptt",duration:r})["finally"](o),e.uimPop(u.PTT)}),n.stop()}))["catch"](s["default"].CancellationError,function(){e.uimPop(u.PTT)})}else this.uimPop(u.PTT),d.log("ptt:onMouseUpSend duration too short")()}},onMouseDown:function(){this.state.state===E.READY&&this.getRecorder().bind(this).then(function(e){e.start(),this.props.chat.presence.update()["catch"](f.WapDrop,_.noop),this.props.chat.markRecording(),this.setState({state:E.DELAY}),this.props.onStateChange(E.REC),this.uimPush(this,u.PTT,{popable:!0}),u.stealFocus(u.PTT),this.pttTimer=this.safeDelay(this.onPTTReady,1500),this.startInterval()})["catch"](function(e){d.error("PTT Recording Error")(e)})},render:function(){var e="btn-close btn-border ptt-close";this.state.active===E.CANCEL&&(e+=" is-hover");var t="btn-border ptt-send";this.state.active===E.SEND&&(t+=" is-hover");var r=this.state.state===E.DELAY||this.state.state===E.REC?a.createElement("div",{className:"ptt-recording",key:"recording"},a.createElement("button",{className:e,onMouseOver:this.onMouseOverCancel,onMouseOut:this.onMouseOutCancel,onMouseUp:this.onMouseUpCancel},a.createElement("span",{className:"icon icon-round-x btn-state-default"}),a.createElement("span",{className:"icon icon-round-x-inv btn-state-hover"})),a.createElement("div",{className:"ptt-counter"},moment.unix(this.state.elapsedTime).format("m:ss")),a.createElement("button",{className:t,onMouseOver:this.onMouseOverSend,onMouseOut:this.onMouseOutSend,onMouseUp:this.onMouseUpSend},a.createElement("span",{className:"icon icon-round-send btn-state-default"}),a.createElement("span",{className:"icon icon-round-send-inv btn-state-hover"}))):null,o=this.state.state===E.READY||this.state.state===E.PROCESSSING?a.createElement("button",{className:"icon btn-icon icon-ptt",onMouseDown:this.onMouseDown,disabled:this.state.state===E.PROCESSSING,key:"button"}):null,n="ptt-container";return r&&(n+=" active"),a.createElement("div",{className:n},a.createElement(y,{transitionName:"ptt"},r||o))}});e.exports=E},891:function(e,t,r){"use strict";var o=r(6),n=r(103),i=r(78),s=r(773),a=r(873),d=r(874),c=r(833),l=r(940),u=r(791),p=r(839),h=r(9),m=r(47),f=r(105),g=r(809),v=r(341),y=r(772),E=r(157),T=o.createClass({displayName:"ConversationPanel",mixins:[n,E],propTypes:{chat:o.PropTypes.instanceOf(s).isRequired},getInitialState:function(){return{canCompose:this.canCompose(),selectable:!1,selectedMessages:[]}},componentWillMount:function(){var e=this.props.chat;e.isGroup?this.addObserver(e,"change:isReadOnly",this.onComposeState):e.isUser&&this.addObserver(Store.Blocklist,"add remove reset",this.onComposeState),this.openEvent=new m.WebcChatOpen({webcUnreadCount:e.unreadCount})},componentDidMount:function(){var e=this.props.chat;e.set({active:!0,viewed:!0}),e.isDirty()&&this.props.chat.msgs===this.props.msgCollection&&e.sendSeen(),this.openEvent&&(this.openEvent.markWebcChatOpenT(),this.openEvent.commit(),delete this.openEvent)},componentWillUnmount:function(){h.closeDrawer(i.DRAWER_RIGHT),this.props.chat.set("active",!1)},onComposeState:function(){var e=this.canCompose();this.state.canCompose!==e&&this.setState({canCompose:e})},canCompose:function(){var e=this.props.chat;return e.isReadOnly?!1:e.isUser?!e.contact.isBlocked():!0},onSelectMessages:function(){this.setState({selectable:!0}),this.uimPush(this,i.CONVERSATION_FOOTER,{escapable:!0})},onCancelSelection:function(){this.uimPop(i.CONVERSATION_FOOTER)},uimClose:function(){this.setState({selectable:!1,selectedMessages:[]})},onPageUpDown:function(e){this.refs.msgs.onPageUpDown(e)},onMessageSelect:function(e,t){var r;t?(r=this.state.selectedMessages.concat(e),this.setState({selectedMessages:r})):(r=_.without(this.state.selectedMessages,e),this.setState({selectedMessages:r}))},onForwardSelected:function(){var e=this,t=this.state.selectedMessages,r=_.size(t);if(_.any(t,"canForward"))if(_.some(t,_.negate(_.property("canForward")))){var n=_.filter(t,_.negate(_.property("canForward")));h.openModal(o.createElement(v,{title:l10n.t("confirm_forward_partial_messages_title"),onOK:function(){return h.openModal(o.createElement(g,{msgs:n}),"modal-flow")},okText:l10n.t("web_ok"),onCancel:h.closeModal.bind(h),cancelText:l10n.t("web_cancel")},l10n.t("confirm_forward_partial_messages_text")))}else h.openModal(o.createElement(v,{title:l10n.t("err_unsent_forward_title"),onOK:h.closeModal.bind(h),okText:l10n.t("web_ok")},l10n.t("err_unsent_forward_text",{
count:r,_plural:r})));else{var i=function(){e.onCancelSelection()};h.openModal(o.createElement(g,{msgs:t,onForward:i}),"modal-flow")}},onDeleteSelected:function(){var e=this,t=this.state.selectedMessages,r=function(){i.pop(i.MENU),h.closeModal(),e.props.chat.sendDeleteMsgs(t),e.onCancelSelection()},n=_.size(t),s=l10n.t("delete_message_confirmation",{count:n,_plural:n});h.openModal(o.createElement(v,{onOK:r,okText:l10n.t("web_delete"),onCancel:h.closeModal.bind(h),cancelText:l10n.t("web_cancel")},o.createElement(y,{text:s})))},onDragEnter:function(e){_.contains(e.dataTransfer.types,"Files")&&(h.openDrawer(o.createElement(u,{chat:this.props.chat,state:p.STATE.ACTIVE,type:i.DRAWER_MID}),"slide-up"),e.stopPropagation(),e.preventDefault())},render:function(){var e,t,r=this.props,n=r.chat,i=r.msgCollection,s=r.ftsMsg;if(this.state.selectable)t=o.createElement(l,{chat:n,selectedMessages:this.state.selectedMessages,onDelete:this.onDeleteSelected,onForward:this.onForwardSelected,onCancel:this.onCancelSelection}),e=o.createElement("footer",{className:"pane-footer pane-chat-footer"});else if(this.state.canCompose)e=o.createElement(c,{chat:n,onPageUpDown:this.onPageUpDown});else{var u=n.isGroup?l10n.t("web_cannot_send_not_a_group_participant"):l10n.t("web_cannot_send_to_blocked_contact_1",{contact:n.contact.formattedName});e=o.createElement("footer",{className:"pane-footer pane-chat-footer"},o.createElement("div",{className:"block-message"},u))}return o.createElement("div",{id:"main",className:"pane pane-chat",onDragOver:this.onDragOver,onDragEnter:this.onDragEnter},o.createElement(a,{chat:n,onSelectMessages:this.onSelectMessages}),o.createElement("div",{className:"pane-body pane-chat-tile-container"},o.createElement(d,{ref:"msgs",chat:n,selectable:this.state.selectable,onMessageSelect:this.onMessageSelect,msgCollection:i,ftsMsg:s}),o.createElement("div",{className:"pane-chat-tile"})),e,o.createElement(f,{transitionName:"slide-up"},t))}});e.exports=T},892:function(e,t,r){"use strict";var o=r(6),n=r(30),i=r(1),s=r(79),a=r(78),d=r(45),c=r(157),l=r(105),u=o.createClass({displayName:"DrawerManager",mixins:[s,c],propTypes:{onRightDrawer:o.PropTypes.func.isRequired},statics:{DEFAULT_TRANSITION:"drawer-left"},getInitialState:function(){var e={};return e[a.DRAWER_LEFT]={flow:null,transition:u.DEFAULT_TRANSITION},e[a.DRAWER_MID]={flow:null,transition:u.DEFAULT_TRANSITION},e[a.DRAWER_RIGHT]={flow:null,transition:u.DEFAULT_TRANSITION},{flows:e}},componentWillMount:function(){this.regCmd("open_drawer",this.openFlow),this.regCmd("close_drawer",this.closeFlow),this.regCmd("chat_delete",this.chatDelete)},openFlow:function(e,t,r){var o=e.props.type;return o?(o===a.DRAWER_RIGHT&&this.props.onRightDrawer(!0),this.uimPush(this,o,{escapable:!0,parent:r}),this.state.flows[o]={flow:e,transition:t||u.DEFAULT_TRANSITION},void this.setState(this.state.flows,this.focus)):void i.log("drawerManager:openFlow Tried to open flow without a type.")()},focus:function(){var e=n.findDOMNode(this);e.contains(document.activeElement)||e.focus()},uimClose:function(e){e===a.DRAWER_RIGHT&&this.props.onRightDrawer(!1);var t=this.state.flows;t[e]={flow:null,transition:t[e].transition},this.setState(t)},chatDelete:function(){this.closeFlow(a.DRAWER_RIGHT)},closeFlow:function(e){e?this.uimPop(e):(this.uimPop(a.DRAWER_MID),this.uimPop(a.DRAWER_RIGHT))},isFlowActive:function(e){var t=this.state.flows[e];return t&&t.flow},checkRTL:function(e){return l10n.isRTL()?e+"-rtl":e},preventBlur:function(e){this.isFlowActive(a.DRAWER_MID)&&document.activeElement===n.findDOMNode(this)&&"Escape"!==e.key&&(e.preventDefault(),e.stopPropagation())},render:function(){var e=a,t=this.state.flows[e.DRAWER_LEFT].flow,r=this.checkRTL(this.state.flows[e.DRAWER_LEFT].transition),n=this.state.flows[e.DRAWER_MID].flow,i=d.isTrident?"fade":this.state.flows[e.DRAWER_MID].transition,s=this.state.flows[e.DRAWER_RIGHT].flow,c=this.checkRTL(this.state.flows[e.DRAWER_RIGHT].transition);return o.createElement("div",{tabIndex:"-1",onKeyDown:this.preventBlur},o.createElement(l,{transitionName:r},t),o.createElement(l,{transitionName:i},n),o.createElement(l,{transitionName:c},s))}});e.exports=u},893:function(e,t,r){"use strict";var o=r(6),n=r(786),i=r(341),s=r(156),a=r(772),d=r(9),c=r(912),l=o.createClass({displayName:"AddContactToGroupFlow",mixins:[n],propTypes:{contact:o.PropTypes.instanceOf(s).isRequired},filter:function(e){var t=e.groupMetadata;return!e.isGroup||e.isGroup&&!t.participants.iAmMember()?!1:t.participants.get(this.props.contact.id)?l10n.t("already_added_to_group"):t.participants.iAmAdmin()?!0:l10n.t("chat_not_an_admin")},componentWillMount:function(){this.push(o.createElement(c,{chats:Store.Chat.filter(function(e){return e.isGroup}),filter:this.filter,onCancel:this.onBack,onGroup:this.confirmAddToGroup}))},confirmAddToGroup:function(e){this.push(o.createElement(i,{onOK:this.addToGroup.bind(null,e),okText:l10n.t("add_group_participant"),onCancel:this.onBack,cancelText:l10n.t("web_cancel")},o.createElement(a,{text:l10n.t("confirm_add_group_participant",{participant:this.props.contact.formattedName,subject:e.contact.name})})))},addToGroup:function(e){e.groupMetadata.participants.addParticipant(this.props.contact).then(function(){d.openChat(e)})["catch"](_.noop),this.endFlow()},onBack:function(){this.pop()}});e.exports=l},894:function(e,t,r){"use strict";var o=r(6),n=r(786),i=r(341),s=r(841),a=r(773),d=r(9),c=r(772),l=o.createClass({displayName:"AddGroupParticipantFlow",mixins:[n],propTypes:{chat:o.PropTypes.instanceOf(a).isRequired},componentWillMount:function(){var e=this.props.chat.groupMetadata,t=function(t){return Store.Contact.isFilteredContact(t)?e.participants.get(t.id)?l10n.t("already_added_to_group"):!0:!1};this.push(o.createElement(s,{title:l10n.t("add_group_participant"),filter:t,onCancel:this.onBack,onSelect:this.confirmAddParticipant}))},confirmAddParticipant:function(e){var t=this.onAddParticipant.bind(this,e),r=l10n.t("confirm_add_group_participant",{participant:e.formattedName,subject:this.props.chat.contact.name});this.push(o.createElement(i,{onOK:t,okText:l10n.t("add_group_participant"),onCancel:this.onBack,cancelText:l10n.t("web_cancel")},o.createElement(c,{text:r})))},onBack:function(){this.pop()},onAddParticipant:function(e){this.props.chat.groupMetadata.participants.addParticipant(e)["catch"](_.noop),d.closeModal()}});e.exports=l},895:function(e,t,r){"use strict";var o=r(6),n=r(786),i=r(840),s=r(773),a=o.createClass({displayName:"CaptureFlow",mixins:[n],propTypes:{chat:o.PropTypes.instanceOf(s).isRequired,stream:o.PropTypes.object.isRequired},componentWillMount:function(){this.push(o.createElement(i,{onBack:this.endFlow,caption:!0,onSend:this.sendMedia,stream:this.props.stream}))},sendMedia:function(e){this.props.chat.sendMedia(e),this.endFlow()}});e.exports=a},896:function(e,t,r){"use strict";var o=r(6),n=r(786),i=r(904),s=r(9),a=o.createClass({displayName:"NewChatFlow",mixins:[n],componentWillMount:function(){this.push(o.createElement(i,{title:l10n.t("new_chat_flow_title"),onBack:this.endFlow,onClick:this.onClick}))},onClick:function(e,t){Store.Chat.find(t.id).then(s.openChat.bind(s)),this.endFlow()}});e.exports=a},897:function(e,t,r){"use strict";var o=r(6),n=r(786),i=r(915),s=r(916),a=o.createClass({displayName:"NewGroupFlow",mixins:[n],getDefaultProps:function(){return{transition:n.Transition.DEFAULT_DRAWER}},componentWillMount:function(){this.push(o.createElement(i,{key:"NewGroupDrawer",onBack:this.endFlow,onContinue:this.groupParticipants}))},groupParticipants:function(e,t,r){this.push(o.createElement(s,{key:"NewGroupParticipantsDrawer",subject:e,thumb:t,full:r,onBack:this.participantsBack,onContinue:this.createGroup}))},createGroup:function(e,t,r,o){Store.Chat.createGroup(e,t,r,o),this.endFlow()},participantsBack:function(e,t,r){this.pop({subject:e,thumb:t,full:r})}});e.exports=a},898:function(e,t,r){"use strict";var o=r(6),n=r(345),i=o.createClass({displayName:"IntroPanel",componentDidMount:function(){var e=this.refs.image,t=this.refs.text;Velocity(e,{scale:[1,0],opacity:[1,0]},{delay:1340,duration:180,easing:[.05,1.02,0,1.01]}),Velocity(t,{translateY:[0,80],opacity:[1,0]},{delay:1300,duration:140,easing:[.05,1.02,0,1.01]})},render:function(){return o.createElement("div",{className:"pane pane-intro"},o.createElement("div",{className:"intro-body"},o.createElement("div",{ref:"image",className:"intro-image"}),o.createElement("div",{ref:"text",className:"intro-text-container"},o.createElement("h1",{"data-a8n":n.key("intro-title"),className:"intro-title"},l10n.t("intro_title")),o.createElement("div",{"data-a8n":n.key("intro-text"),className:"intro-text"},l10n.t("intro_connection")))))}});e.exports=i},899:function(e,t,r){"use strict";var o=r(6),n=r(30),i=r(9),s=r(774),a=r(776),d=r(775),c=r(778),l=r(787),u=r(789),p=r(103),h=r(792),m=r(342),f=m.HotKeys,g=o.createClass({displayName:"ArchivedDrawer",mixins:[p],getInitialState:function(){this.selected=h()},componentWillMount:function(){this.addObserver(Store.Chat,"change:archive add remove")},componentDidMount:function(){this.refs.list&&n.findDOMNode(this.refs.list).focus()},onClick:function(e,t){i.openChat(t),this.onClose()},onClose:function(){i.closeDrawer(this.props.type)},getList:function(){return Store.Chat.filter("archive")},onNextChat:function(e){e.preventDefault(),e.stopPropagation();var t=this.selected.next(this.getList());t&&this.selected.set(t.id)},onPrevChat:function(e){e.preventDefault(),e.stopPropagation();var t=this.selected.prev(this.getList());this.selected.set(t.id)},render:function(){var e=this,t=void 0,r=this.getList();if(r.length>0){var n=r.map(function(t){return o.createElement(u,{chat:t,mode:u.Mode.LAST,key:t.id,active:e.selected,onClick:e.onClick})}),i={down:this.onNextChat,up:this.onPrevChat};i={},t=o.createElement(f,{handlers:i,ref:"list",className:"drawer-section-main chatlist",onFocus:this.indicateFocus,"data-list-scroll-container":!0},o.createElement(c,{data:n,height:c.DEFAULT_HEIGHT,extraItems:4}))}else t=o.createElement(l.Archived,null);return o.createElement(s,{id:"blocked",onCancel:this.onClose},o.createElement(a,{title:l10n.t("archived_flow_title"),onBack:this.onClose,type:a.Type.LARGE}),o.createElement(d,null,t))}});e.exports=g},900:function(e,t,r){"use strict";var o=r(6),n=r(9),i=r(774),s=r(776),a=r(775),d=r(778),c=r(787),l=r(779),u=r(341),p=r(103),h=r(841),m=o.createClass({displayName:"BlockedDrawer",mixins:[p],componentWillMount:function(){this.addObserver(Store.Blocklist,"add remove")},onBlockConfirm:function(e){e.setBlock(!0)["catch"](_.noop),n.closeModal()},onBlock:function(e){var t=function(e){return Store.Contact.isFilteredContact(e)?Store.Blocklist.get(e.id)?l10n.t("participant_already_blocked"):!0:!1};n.openModal(o.createElement(h,{title:l10n.t("add_blocked_title"),filter:t,onCancel:n.closeModal.bind(n),onSelect:this.onBlockConfirm}))},onUnblockConfirm:function(e){e.setBlock(!1)["catch"](_.noop),n.closeModal()},onUnblockCancel:function(){n.closeModal()},onUnblock:function(e,t){n.openModal(o.createElement(u,{okText:l10n.t("unblock_button"),onOK:this.onUnblockConfirm.bind(this,t),cancelText:l10n.t("web_cancel"),onCancel:this.onUnblockCancel},l10n.t("unblock_confirmation",{contact:t.formattedName})))},onClose:function(){n.closeDrawer(this.props.type)},render:function(){var e=this,t=void 0,r=void 0;if(Store.Blocklist.length>0){var n=Store.Blocklist.map(function(t){return o.createElement(l,{contact:t.contact,key:t.contact.id,onClick:e.onUnblock,onDelete:e.onUnblock})});t=o.createElement("div",{className:"drawer-section-main chatlist","data-list-scroll-container":!0},o.createElement(d,{data:n,height:d.DEFAULT_HEIGHT,extraItems:4})),r=o.createElement("div",{className:"hint"},l10n.t("add_blocked_description"))}else t=o.createElement(c.Blocked,null);return o.createElement(i,{id:"blocked",onCancel:this.onClose},o.createElement(s,{title:l10n.t("blocked_flow_title"),onBack:this.onClose,type:s.Type.LARGE}),o.createElement(a,null,o.createElement("div",{className:"list-action",onClick:this.onBlock},o.createElement("div",{className:"list-action-icon"},o.createElement("span",{className:"icon icon-add-user"})),o.createElement("div",{className:"list-action-body"},l10n.t("add_blocked_title"))),t,r))}});e.exports=m},901:function(e,t,r){"use strict";var o=r(6),n=r(103),i=r(9),s=r(773),a=r(153),d=r(798),c=r(778),l=r(779),u=r(774),p=r(775),h=r(788),m=r(783),f=r(78),g=o.createClass({displayName:"BroadcastInfoDrawer",mixins:[n],propTypes:{chat:o.PropTypes.instanceOf(s).isRequired},componentWillMount:function(){var e=this.props.chat.groupMetadata;this.addObserver(e.participants,"add remove sort reset")},onParticipantClick:function(e,t){Store.Conn.me!==t.id&&Store.Chat.find(t.id).then(function(e){i.openChat(e)})},onClose:function(){i.closeDrawer(this.props.type)},onDelete:function(){i.deleteOrExitChat(this.props.chat)},onViewPicture:function(e){var t=e.target,r=function(e){e(t)};i.openModal(o.createElement(d,{contact:this.props.chat.contact,animateBorderRadius:!0,getZoomNode:r}),"profile-viewer")},render:function(){var e,t=this.props.chat,r=t.groupMetadata,n=this.onParticipantClick,i=r.participants.map(function(e){var t=Store.Contact.get(e.id)||Store.Contact.add({id:e.id});return o.createElement(l,{contact:t,admin:!!e.isAdmin,onClick:n,key:e.id})}),s=3,d=24,g={minHeight:i.length>s?s*c.DEFAULT_HEIGHT+d:i.length*c.DEFAULT_HEIGHT+d},v=i.length?o.createElement(h,{classes:"animate-enter1",title:l10n.t("web_recipients_title"),subtitle:l10n.n(i.length),style:g,expands:!0,"data-list-scroll-container":!0},o.createElement(c,{data:i,height:72,extraItems:4})):null;t.canDelete()&&(e=o.createElement(h,{classes:"animate-enter3 drawer-section-action"},o.createElement("div",{onClick:this.onDelete,className:"btn btn-danger"},l10n.t("web_delete_list"))));var y;return t.groupMetadata.creation?(y=a.timeStr(t.groupMetadata.creation),y=o.createElement("div",{className:"header-secondary"},l10n.t("web_group_creation_time",{when:y}))):y=null,o.createElement(u,{key:"contact-info-modal",id:"info",variant:"panel",onCancel:this.onClose},o.createElement("header",{className:"pane-header"},o.createElement("div",{className:"header-close"},o.createElement("button",{onClick:this.onClose,"data-ignore-capture":f.IGNORE_ANY},o.createElement("span",{className:"icon icon-x"}))),o.createElement("div",{className:"header-body"},o.createElement("div",{className:"header-main"},o.createElement("div",{className:"header-title"},l10n.t("broadcast_list_info")),y))),o.createElement(p,{expands:!!i.length},o.createElement(h,{classes:"drawer-scale drawer-section-photo"},o.createElement(m,{id:t.id,size:m.LARGE,onClick:this.onViewPicture})),v,e))}});e.exports=g},902:function(e,t,r){"use strict";var o=r(6),n=r(810),i=r(840),s=r(9),a=o.createClass({displayName:"CaptureModal",propTypes:{onSend:o.PropTypes.func.isRequired,stream:o.PropTypes.object.isRequired},onCancel:function(){s.closeModal()},onSend:function(e){this.props.onSend(e.file),this.onCancel()},render:function(){return o.createElement(n,{type:n.BOX},o.createElement(i,{onBack:this.onCancel,caption:!1,onSend:this.onSend,stream:this.props.stream,noContainer:!0}))}});e.exports=a},903:function(e,t,r){"use strict";var o=r(6),n=r(810),i=r(9),s=r(774),a=r(776),d=r(775),c=r(105),l=r(794),u=r(789),p=r(779),h=r(778),m=r(787),f=r(78),g=r(792),v=r(342),y=v.HotKeys,E=r(77),T={RECENT:"recent",GROUPS:"groups",CONTACTS:"contacts"},b=o.createClass({displayName:"ChatModal",propTypes:{title:o.PropTypes.string,onChat:o.PropTypes.func.isRequired,selectedTab:o.PropTypes.oneOf(_.values(T)),onSelectTab:o.PropTypes.func},getInitialState:function(){return this.selected=g(),{searchText:"",selected:this.props.selectedTab||T.RECENT}},onSelectTab:function(e){var t=this,r=_.values(T).indexOf(this.state.selected),o=_.values(T).indexOf(e),n=o>r?"right":"left";this.tabSelected=!0,this.setState({searchText:"",selected:e,direction:n},function(){delete t.tabSelected}),this.props.onSelectTab&&this.props.onSelectTab(e)},getFilteredChats:function(){var e=this.state.searchText;return e?(e=l10n.accentFold(e),Store.Chat.filter(function(t){return t.contact.searchMatch(e)&&!t.isNewlyCreated()})):Store.Chat.filter(function(e){return!e.isNewlyCreated()})},getFilteredGroups:function(){var e=this.state.searchText;return e?(e=l10n.accentFold(e),Store.Chat.filter(function(t){return t.isGroup&&t.contact.searchMatch(e)&&!t.isNewlyCreated()})):Store.Chat.filter(function(e){return e.isGroup&&!e.isNewlyCreated()})},getFilteredContacts:function(){var e=Store.Contact.getFilteredContacts(),t=this.state.searchText;return t?(t=l10n.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e},getData:function(){switch(this.state.selected){case T.CONTACTS:return this.getFilteredContacts();case T.GROUPS:return this.getFilteredGroups();case T.RECENT:return this.getFilteredChats()}},getList:function(){var e,t=this;switch(this.state.selected){case T.CONTACTS:e=this.getFilteredContacts(),e=e.map(function(e){return o.createElement(p,{active:t.selected,contact:e,onClick:t.forwardToContact,secondary:e.isBlocked()?l10n.t("confirm_unblock_contact_and_forward_text"):null,key:e.id})});break;case T.GROUPS:e=this.getFilteredGroups(),e=e.map(function(e){return o.createElement(u,{active:t.selected,chat:e,mode:u.Mode.INFO,noContext:!0,onClick:t.forwardToChat,key:e.id})});break;case T.RECENT:e=this.getFilteredChats(),e=e.map(function(e){return e.isGroup?o.createElement(u,{active:t.selected,chat:e,mode:u.Mode.INFO,noContext:!0,onClick:t.forwardToChat,key:e.id}):o.createElement(p,{active:t.selected,contact:e.contact,onClick:t.forwardToContact,secondary:e.contact.isBlocked()?l10n.t("confirm_unblock_contact_and_forward_text"):null,key:e.id})})}return 0===e.length?null:o.createElement(h,{data:e,ref:"list",scrollTop:this.tabSelected?0:void 0,height:72,extraItems:4})},getTabs:function(){var e=this;return[{tab:T.RECENT,title:l10n.t("web_recent_chats")},{tab:T.GROUPS,title:l10n.t("web_groups")},{tab:T.CONTACTS,title:l10n.t("web_contacts")}].map(function(t){var r=E("menu-item",{active:e.state.selected===t.tab});return o.createElement("button",{className:r,onClick:e.onSelectTab.bind(null,t.tab),key:t.tab,title:t.title},t.title)})},forwardToContact:function(e,t){Store.Chat.find(t.id).then(this.forwardToChat.bind(this,e))},forwardToChat:function(e,t){this.props.onChat(t)},onSearch:function(e){this.setState({searchText:e})},onStopSearch:function(){this.setState({searchText:""})},onCancel:function(){i.closeModal()},setSelected:function(e,t){this.selected.set(e,t)},onSelectFirst:function(e){e.preventDefault(),e.stopPropagation();var t=_.first(this.getData());t&&this.forwardToContact(e,t)},onFocusList:function(e){var t=_.first(this.getData());t&&(y.flashFocus=Date.now(),e.preventDefault(),e.stopPropagation(),this.setSelected(t.id))},onNext:function(e){e.preventDefault(),e.stopPropagation();var t=this.selected.next(this.getData());t&&this.setSelected(t.id)},onPrev:function(e){var t=this.selected.prev(this.getData());t&&(_.isEqual(t.id,this.selected.value)?(y.flashFocus=Date.now(),this.setSelected(null),this.refs.search.focus()):(e.preventDefault(),e.stopPropagation(),this.setSelected(t.id)))},render:function(){var e=this.getList();if(!e)if(this.state.searchText)e=o.createElement(m.Search,null);else switch(this.state.selected){case T.CONTACTS:e=o.createElement(m.ListContacts,null);break;case T.GROUPS:e=o.createElement(m.ListGroups,null);break;case T.RECENT:e=o.createElement(m.List,null)}var t="right"===this.state.direction?"slide-forward":"slide-back",r={down:this.onFocusList,enter:this.onSelectFirst},i={down:this.onNext,up:this.onPrev};return i=r={},o.createElement(n,{type:n.TOWER},o.createElement(s,{key:"chat-modal",onCancel:this.onCancel},o.createElement(a,{title:this.props.title,type:a.Type.POPUP,onCancel:this.onCancel}),o.createElement("div",{className:"menu-tabs menu-tabs-lists","data-active-tab":this.state.selected},this.getTabs()),o.createElement(y,{handlers:r},o.createElement(l,{ref:"search",searchText:this.state.searchText,onSearch:this.onSearch,key:this.state.selected,searchType:f.CHAT_SEARCH,placeholder:l10n.t("search")})),o.createElement(d,{"data-list-scroll-container":!0},o.createElement(c,{transitionName:t,className:"column"},o.createElement(y,{handlers:i,className:"column",key:this.state.selected},o.createElement("div",{className:"chatlist column"},e))))))}});e.exports=b},904:function(e,t,r){"use strict";var o=r(6),n=r(774),i=r(776),s=r(775),a=r(823),d=r(794),c=r(154),l=r(78),u=r(342),p=u.HotKeys,h=o.createClass({displayName:"ContactDrawer",mixins:[c],propTypes:{onBack:o.PropTypes.func.isRequired,onClick:o.PropTypes.func.isRequired},getInitialState:function(){return{searchText:"",cancelSearch:!1,active:!1}},componentDidMount:function(){this.safeDefer(function(e){e.setState({active:!0})},this)},getFilteredContacts:function(){var e=Store.Contact.getFilteredContacts(),t=this.state.searchText;return t?(t=l10n.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e},uimClose:function(){return this.searchText?(this.setState({searchText:"",cancelSearch:!0}),!0):!1},onSearch:function(e){this.setState({searchText:e})},onFocusList:function(e){this.refs.list&&(e.preventDefault(),e.stopPropagation(),p.flashFocus=Date.now(),this.refs.list.focusFirst())},onSelectFirst:function(e){e.preventDefault(),e.stopPropagation();var t=_.first(this.getFilteredContacts());t&&(p.flashFocus=Date.now(),this.props.onClick(e,t))},onFocusSearch:function(e){p.flashFocus=Date.now(),this.refs.search.focus()},render:function(){var e=this.state.active?o.createElement(a,{ref:"list",contacts:this.getFilteredContacts(),onFocusSearch:this.onFocusSearch,onClick:this.props.onClick}):null,t={down:this.onFocusList,enter:this.onSelectFirst};return t={},o.createElement(n,{key:"contact-modal",onCancel:this.props.onBack},o.createElement(i,{title:this.props.title,type:i.Type.LARGE,onBack:this.props.onBack}),o.createElement(p,{handlers:t},o.createElement(d,{ref:"search",searchText:this.state.searchText,isSearching:!this.state.cancelSearch,onSearch:this.onSearch,searchType:l.CONTACT_SEARCH,placeholder:l10n.t("search_contacts")})),o.createElement(s,{"data-list-scroll-container":!0},e))}});e.exports=h},905:function(e,t,r){"use strict";var o=r(6),n=r(770),i=r(154),s=r(9),a=r(778),d=r(798),c=r(789),l=r(774),u=r(775),p=r(788),h=r(783),m=r(867),f=r(772),g=r(11),v=r(78),y=r(156),E=r(21),T=o.createClass({displayName:"ContactInfoDrawer",mixins:[n,i],propTypes:{contact:o.PropTypes.instanceOf(y).isRequired},getInitialState:function(){return{status:this.async("contact.Status.status"),commonGroups:void 0}},componentDidMount:function(){this.safeDelay(function(){this.props.contact.findCommonGroups().bind(this).then(function(e){this.isMounted()&&this.setState({commonGroups:_.compact(e)})})["catch"](g.WapDrop,_.noop)["catch"](_.noop)},300)},onDeleteChat:function(){var e=Store.Chat.get(this.props.contact.id);s.deleteOrExitChat(e)},onClose:function(){s.closeDrawer(this.props.type)},parseSelection:function(e){for(var t,r,o="",n=0;n<e.rangeCount;n++)for(r=document.createTreeWalker(e.getRangeAt(n).cloneContents(),window.NodeFilter.SHOW_ALL);r.nextNode();)t=r.currentNode,o+=t instanceof HTMLImageElement?t.alt:t.nodeValue?t.nodeValue:"";return o},onCopyPhone:function(e){var t=this.parseSelection(window.getSelection()),r="",o="",n=""+r+o+r;if(_.startsWith(t,n)){var i=t.match(new RegExp("^"+n+"(.*?)"+n));i&&i.length>1&&(t=_.last(i))}t=t.replace(new RegExp(""+n),""),e.clipboardData.setData("text/plain",t),e.stopPropagation(),e.preventDefault()},onViewPicture:function(e){if(this.canViewPicture){var t=e.target,r=function(e){e(t)};s.openModal(o.createElement(d,{contact:this.props.contact,animateBorderRadius:!0,getZoomNode:r}),"profile-viewer")}},onDetailImageLoad:function(e){this.canViewPicture=!0},render:function(){var e,t,r=this.props.contact,n=this.state.commonGroups;if(_.isArray(n)&&n.length){e=n.map(function(e){return o.createElement(c,{chat:e,mode:c.Mode.INFO,key:e.id})});var i=3,s=24,d={minHeight:n.length>i?i*a.DEFAULT_HEIGHT+s:n.length*a.DEFAULT_HEIGHT+s};e=o.createElement(p,{title:l10n.t("web_groups_participation_you_and_name",{user:r.formattedShortName}),subtitle:l10n.n(n.length),classes:"animate-enter drawer-section-list",ref:"container",style:d,expands:!0,noContainer:!0},o.createElement("div",{className:"drawer-section-body drawer-section-body-expand chatlist",ref:"list","data-list-scroll-container":!0},o.createElement(a,{data:e,height:72,extraItems:4})))}var g=Store.Chat.get(r.id);_.isArray(n)&&g&&g.canDelete()&&(t=o.createElement(p,{classes:"animate-enter drawer-section-action"},o.createElement("div",{onClick:this.onDeleteChat,className:"btn btn-danger"},l10n.t("delete_chat"))));var y=this.state.status?o.createElement(p,{title:l10n.t("web_status"),classes:"animate-enter1"},o.createElement(f,{classes:"textfield-static",direction:"auto",text:this.state.status})):null;return o.createElement(l,{key:"contact-info-modal",id:"info",variant:"panel",onCancel:this.onClose},o.createElement("header",{className:"pane-header"},o.createElement("div",{className:"header-close"},o.createElement("button",{onClick:this.onClose,"data-ignore-capture":v.IGNORE_ANY},o.createElement("span",{className:"icon icon-x"}))),o.createElement("div",{className:"header-body"},o.createElement("div",{className:"header-main"},o.createElement("div",{className:"header-title"},l10n.t("web_contact_info"))))),o.createElement(u,{expands:!!e},o.createElement(p,{classes:"drawer-scale drawer-section-photo"},o.createElement(h,{id:r.id,size:h.LARGE,loader:!0,onLoad:this.onDetailImageLoad,onClick:this.onViewPicture,quality:h.HIGH})),y,o.createElement(p,{title:l10n.t("web_contact_phone"),classes:"animate-enter2"},o.createElement(m,{className:"textfield-static",onCopy:this.onCopyPhone,dir:"auto"},E.formattedUser(r.id))),e,t))}});e.exports=T},906:function(e,t,r){"use strict";var o=r(6),n=r(9),i=r(103),s=r(774),a=r(776),d=r(775),c=r(788),l=r(851),u=r(808),p=r(155),h=r(780),m=r(771),f=r(77),g=o.createClass({displayName:"ContactMsgInfoDrawer",mixins:[i],propTypes:{msg:o.PropTypes.instanceOf(m)},getInitialState:function(){return{msgInfo:void 0}},componentWillMount:function(){var e=this;Store.MsgInfo.find(this.props.msg).then(function(t){e.setState({msgInfo:t}),e.addObserver(t,"change:playedRemaining change:readRemaining change:deliveryRemaining")})["catch"](function(){e.setState({unimplemented:!0}),n.openToast(o.createElement(h,{msg:l10n.t("msg_info_failed"),id:h.genId("msg_info_failed")}))})},componentDidMount:function(){this.props.msg.type===m.TYPE.IMAGE&&(this.refs.scrollable.scrollTop=this.refs.scrollable.scrollHeight)},onClose:function(){n.closeDrawer(this.props.type)},render:function(){var e=this.props.msg,t=this.state,r=t.msgInfo,n=t.unimplemented,i=void 0;if(r){var h=[],g=void 0,v=void 0,y=void 0;r.isPTT&&(g=r.played.first(),v=g&&g.t,y=o.createElement("span",{className:"icon icon-status icon-status-ptt-blue"}),h.push(o.createElement(l,{title:l10n.t("message_info_played"),t:v,icon:y,key:"played"}))),g=r.read.first(),v=g&&g.t,y=o.createElement("span",{className:"icon icon-status icon-status-dblcheck-ack"}),h.push(o.createElement(l,{title:l10n.t("message_info_read"),t:v,icon:y,key:"read"})),g=r.delivery.first(),v=g&&g.t,y=o.createElement("span",{className:"icon icon-status icon-status-dblcheck"}),h.push(o.createElement(l,{title:l10n.t("message_info_delivered"),t:v,icon:y,key:"delivery"})),i=o.createElement(c,{classes:"drawer-section-info well animate-enter"},h)}var E=void 0;r||n||(E=o.createElement(c,{classes:"drawer-section-spinner",key:"spinner"},o.createElement(p,null)));var _=f("pane-preview-wrapper","pane-preview-wrapper-bg",{"pane-preview-resize":e.type===m.TYPE.PTT||e.type===m.TYPE.IMAGE||e.type===m.TYPE.LOCATION||e.type===m.TYPE.VCARD});return o.createElement(s,{key:"message-info-modal",id:"info",variant:"panel",onCancel:this.onClose},o.createElement(a,{title:l10n.t("message_info"),type:a.Type.SMALL,onCancel:this.onClose}),o.createElement("div",{className:_,ref:"scrollable"},o.createElement("div",{className:"pane-preview"},o.createElement("div",{className:"pane-chat-tile"}),o.createElement(u,{msg:e,displayType:u.DisplayType.MSG_INFO,position:u.Position.END}))),o.createElement(d,{classes:"drawer-body-msg-info"},E,i))}});e.exports=g},907:function(e,t,r){"use strict";var o=r(6),n=r(345),i=r(1),s=r(773),a=r(9),d=r(770),c=r(772),l=o.createClass({displayName:"DeleteChatPopup",mixins:[d],propTypes:{onCancel:o.PropTypes.func,onDeleteOrExit:o.PropTypes.func,chat:o.PropTypes.instanceOf(s).isRequired},getInitialState:function(){return{isReadOnly:this.async("chat.isReadOnly")}},getText:function(){var e=this.props.chat,t=e.formattedTitle;return e.isGroup?this.state.isReadOnly?l10n.t("web_delete_group_dialog_title",{groupName:t}):l10n.t("web_exit_group_dialog_title",{groupName:t}):e.isUser?l10n.t("delete_chat_dialog_title",{name:t}):e.isBroadcast?l10n.t("delete_list_dialog_title"):void 0},getButton:function(){var e=this.props.chat;return e.isGroup?this.state.isReadOnly?l10n.t("web_delete"):l10n.t("web_exit"):e.isUser||e.isBroadcast?l10n.t("web_delete"):void 0},onCancel:function(){a.closeModal(),_.isFunction(this.props.onCancel)&&this.props.onCancel()},onDelete:function(){var e,t=this.props.chat;t.isGroup?e=this.state.isReadOnly?t.sendDelete():t.sendExit():t.isUser||t.isBroadcast?e=t.sendDelete():i.error("deleteChatPopup:onDelete Unsupported chat type")(),_.isFunction(this.props.onDeleteOrExit)&&e&&this.props.onDeleteOrExit(e),a.closeModal()},render:function(){return o.createElement("div",{className:"backdrop"},o.createElement("div",{className:"popup-container"},o.createElement("div",{className:"popup"},o.createElement("div",{className:"popup-body"},o.createElement("div",{className:"popup-title"},l10n.t("are_you_sure")),o.createElement("div",{className:"popup-contents"},o.createElement(c,{text:this.getText()}))),o.createElement("div",{className:"popup-controls"},o.createElement("button",{"data-a8n":n.key("cancel-btn"),className:"btn-plain popup-controls-item",onClick:this.onCancel},l10n.t("web_cancel")),o.createElement("button",{"data-a8n":n.key("delete-btn"),className:"btn-plain btn-default popup-controls-item",onClick:this.onDelete},this.getButton())))))}});e.exports=l},908:function(e,t,r){"use strict";var o=r(6),n=r(345),i=r(1),s=r(9),a=r(826),d=r(341),c=r(780),l={title:0,hour:1,day:24,week:168},u=o.createClass({displayName:"DoNotDisturbPopup",getInitialState:function(){return{notifications:Store.Mute.getGlobalNotifications(),sounds:Store.Mute.getGlobalSounds(),previews:Store.Mute.getGlobalPreviews(),dnd:l.title}},componentWillUnmount:function(){this.state.dnd!==l.title&&s.openToast(o.createElement(c,{msg:this.globalMuteDurationLabel(this.state.dnd),id:c.genId()}))},globalMuteDurationLabel:function(e){switch(this.state.dnd){case 1:return l10n.t("global_muted_1hour");case 24:return l10n.t("global_muted_1day");case 168:return l10n.t("global_muted_1week");default:return i.log("DoNotDisturbPopup:globalMuteDurationLabel non standard global mute duration:"+e)(),l10n.t("global_muted")}},onSounds:function(){var e=!this.state.sounds;this.setState({sounds:e}),Store.Mute.setGlobalSounds(e)},onNotifications:function(){var e=!this.state.notifications;this.setState({notifications:e}),Store.Mute.setGlobalNotifications(e)},onPreviews:function(){var e=!this.state.previews;this.setState({previews:e}),Store.Mute.setGlobalPreviews(e)},onDND:function(e){var t=parseInt(e.target.value,10);if(0===t)return this.setState({dnd:l.title}),void Store.Mute.globalMute().unmute();this.setState({dnd:t});var r=moment().unix()+60*e.target.value*60;Store.Mute.globalMute().mute(r)},onClose:function(e){s.closeModal()},render:function(){return o.createElement(d,{title:l10n.t("menuitem_notifications"),okText:l10n.t("web_ok"),onOK:this.onClose},o.createElement("div",{className:"section",onClick:this.onSounds},o.createElement("div",{"data-a8n":n.key("menu-icon-notifications"),className:"section-control"},o.createElement(a,{
onChange:this.onSounds,checked:this.state.sounds})),o.createElement("div",{className:"section-label"},l10n.t("option_sounds"))),o.createElement("div",{className:"section",onClick:this.onNotifications},o.createElement("div",{"data-a8n":n.key("menu-icon-notifications"),className:"section-control"},o.createElement(a,{onChange:this.onNotifications,checked:this.state.notifications})),o.createElement("div",{className:"section-label"},l10n.t("option_desktop_notifications"))),o.createElement("div",{className:"section",onClick:this.onPreviews},o.createElement("div",{"data-a8n":n.key("menu-icon-notifications"),className:"section-control"},o.createElement(a,{onChange:this.onPreviews,checked:this.state.previews})),o.createElement("div",{className:"section-label"},l10n.t("option_msg_previews"),o.createElement("div",{className:"hint"},l10n.t("option_msg_previews_hint_text")))),o.createElement("div",{className:"section"},o.createElement("div",{className:"select"},o.createElement("select",{value:this.state.dnd,onChange:this.onDND},o.createElement("option",{value:l.title,disabled:this.state.state===l.title},l10n.t("option_select_mute")),o.createElement("option",{value:l.hour,disabled:this.state.state===l.hour},l10n.t("mute_1hour")),o.createElement("option",{value:l.day,disabled:this.state.state===l.day},l10n.t("mute_1day")),o.createElement("option",{value:l.week,disabled:this.state.state===l.week},l10n.t("mute_1week"))))))}});e.exports=u},909:function(e,t,r){"use strict";var o=r(6),n=r(77),i=o.createClass({displayName:"DrawerSectionFooter",propTypes:{children:o.PropTypes.node.isRequired,separator:o.PropTypes.bool},getDefaultProps:function(){return{separator:!0}},render:function(){var e=n("drawer-section-footer",{separator:this.props.separator});return o.createElement("div",{className:e},o.createElement("div",{className:"col-main"},this.props.children))}});e.exports=i},910:function(e,t,r){"use strict";var o=r(6),n=r(770),i=r(103),s=r(9),a=r(773),d=r(153),c=r(778),l=r(779),u=r(774),p=r(775),h=r(788),m=r(805),f=r(772),g=r(777),v=r(845),y=r(78),E=r(341),_=r(894),T=r(780),b=r(8),S=T.genId("max_participant_toast"),C=o.createClass({displayName:"GroupInfoDrawer",mixins:[n,i],propTypes:{chat:o.PropTypes.instanceOf(a).isRequired},getInitialState:function(){return{imgFull:this.async("chat.ProfilePicThumb.imgFull"),name:this.async("chat.contact.name")||"",isReadOnly:this.async("chat.isReadOnly"),pendingSubject:!1,pendingPhoto:!1}},componentWillMount:function(){var e=this.props.chat.groupMetadata;this.addObserver(e.participants,"add remove reset sort change:isAdmin")},componentWillUnmount:function(){y.popDependents(this)},onImageSet:function(e,t){var r=Store.ProfilePicThumb.get(this.props.chat.id);this.setState({pendingPhoto:!0});var o;o=e&&t?r.setPicture(e,t):r.deletePicture(),o.bind(this).then(function(){this.isMounted()&&this.setState({pendingPhoto:!1})})},onParticipantClick:function(e,t){Store.Conn.me!==t.id&&Store.Chat.find(t.id).then(function(e){s.openChat(e)})},menuEnabled:function(e){var t=this.props.chat.groupMetadata.participants,r=t.get(e.id);return r&&(t.canPromote(r)||t.canRemove(r))},onParticipantMenu:function(e,t,r){var n=this.props.chat.groupMetadata.participants,i=n.get(t.id);if(this.menuEnabled(t)){var a=[];if(n.canPromote(i)){var d=this.confirmParticipantPromote.bind(this,i);a.push(o.createElement(g,{key:"promote",action:d},l10n.t("menuitem_make_group_admin")))}if(n.canRemove(i)){var c=this.confirmParticipantRemove.bind(this,i);a.push(o.createElement(g,{key:"remove",action:c,shortcut:"d"},l10n.t("menuitem_remove")))}s.openContextMenu(a,{parent:this,anchor:e.anchor,event:e.event,onClose:r})}},confirmParticipantRemove:function(e){var t=this.onParticipantRemove.bind(this,e),r=l10n.t("confirm_remove_group_participant",{participant:e.contact.formattedName,subject:this.props.chat.contact.name});s.openModal(o.createElement(E,{onOK:t,okText:l10n.t("remove"),onCancel:s.closeModal.bind(s),cancelText:l10n.t("web_cancel")},o.createElement(f,{text:r})))},onParticipantRemove:function(e){e.contact.pendingAction++,this.props.chat.groupMetadata.participants.removeParticipant(e).then(function(){e.contact.pendingAction--}),s.closeModal()},confirmParticipantPromote:function(e){var t=this.onParticipantPromote.bind(this,e),r=l10n.t("confirm_promote_group_participant",{participant:e.contact.formattedName,subject:this.props.chat.contact.name});s.openModal(o.createElement(E,{onOK:t,okText:l10n.t("menuitem_make_group_admin"),onCancel:s.closeModal.bind(s),cancelText:l10n.t("web_cancel")},o.createElement(f,{text:r})))},onParticipantPromote:function(e){e.contact.pendingAction++,this.props.chat.groupMetadata.participants.promoteParticipant(e).then(function(){e.contact.pendingAction--}),s.closeModal()},openAddGroupParticipantFlow:function(){if(this.props.chat.groupMetadata.participants.length>=b.MAX_GROUP_SIZE){var e=l10n.t("action_group_create_failed_participant",{max:b.MAX_GROUP_SIZE});s.openToast(o.createElement(T,{msg:e,id:S}))}else{var t=o.createElement(_,{chat:this.props.chat});s.openModal(t,"modal-flow")}},onClose:function(){s.closeDrawer(this.props.type)},onExitOrDeleteGroup:function(){s.deleteOrExitChat(this.props.chat)},onSubjectChange:function(e){this.setState({name:e.target.value})},validateSubject:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return!!e.trim()},onSetSubjectError:function(){s.openModal(o.createElement(E,{onOK:s.closeModal.bind(s),okText:l10n.t("web_ok")},l10n.t("action_group_subject_empty")))},onSetSubject:function(e){var t=this.props.chat,r=t.groupMetadata;r.canSetSubject()&&this.state.name!==t.contact.name&&(this.setState({pendingSubject:!0}),t.setSubject(this.state.name).bind(this)["finally"](function(){this.isMounted()&&this.setState({name:t.contact.name,pendingSubject:!1})}))},onCancelSubject:function(){this.setState({name:this.props.chat.contact.name})},render:function(){var e,t,r=this.props.chat,n=r.groupMetadata,i=this,s=n.participants.map(function(e){var t=e.contact;return o.createElement(l,{contact:t,key:e.id,admin:!!e.isAdmin,onClick:i.onParticipantClick,contextEnabled:i.menuEnabled.bind(i,t),onContext:i.onParticipantMenu,showNotifyName:!0})});r.canDelete()&&(t=o.createElement(h,{classes:"animate-enter3 drawer-section-action"},o.createElement("div",{onClick:this.onExitOrDeleteGroup,className:"btn btn-danger"},r.isReadOnly?l10n.t("web_delete_group"):l10n.t("web_exit_group")))),n.participants.canAdd()&&(e=o.createElement("div",{className:"list-action",onClick:this.openAddGroupParticipantFlow},o.createElement("div",{className:"list-action-icon"},o.createElement("span",{className:"icon icon-add-user"})),o.createElement("div",{className:"list-action-body"},l10n.t("add_group_participant"))));var a=3,f=24,g=55,E=e?f+g:f,_={minHeight:s.length>a?a*c.DEFAULT_HEIGHT+E:s.length*c.DEFAULT_HEIGHT+E},T=s.length?o.createElement(h,{title:l10n.t("web_participants_title"),subtitle:l10n.t("web_participants_count",{count:s.length,max:b.MAX_GROUP_SIZE}),classes:"animate-enter2 drawer-section-list",expands:!0,style:_,ref:"container",noContainer:!0},e,o.createElement("div",{className:"drawer-section-body drawer-section-body-expand chatlist","data-list-scroll-container":!0},o.createElement(c,{data:s,height:c.DEFAULT_HEIGHT,extraItems:4}))):null,S=o.createElement(h,{title:l10n.t("subject"),classes:"animate-enter1"},o.createElement(v,{id:y.SUBJECT_INPUT,value:this.state.name,editable:n.canSetSubject(),pending:this.state.pendingSubject,showRemaining:!0,validate:this.validateSubject,maxLength:b.MAX_SUBJECT_LENGTH,onChange:this.onSubjectChange,onSave:this.onSetSubject,onError:this.onSetSubjectError,onCancel:this.onCancelSubject})),C=r.contact.profilePicThumb,M=r.isReadOnly||!C.canDelete()&&!C.canSet()?m.Type.NO_EDIT:m.Type.GROUP,N=o.createElement(m,{type:M,id:r.contact.id,pending:this.state.pendingPhoto,startImage:this.state.imgFull,onImageSet:this.onImageSet}),w=null;return r.groupMetadata.creation&&(w=o.createElement("div",{className:"header-secondary"},l10n.t("web_group_creation_time",{when:d.relativeDateAndTimeStr(r.groupMetadata.creation)}))),o.createElement(u,{key:"contact-info-modal",id:"info",variant:"panel",onCancel:this.onClose},o.createElement("header",{className:"pane-header"},o.createElement("div",{className:"header-close"},o.createElement("button",{onClick:this.onClose,"data-ignore-capture":y.IGNORE_ANY},o.createElement("span",{className:"icon icon-x"}))),o.createElement("div",{className:"header-body"},o.createElement("div",{className:"header-main"},o.createElement("div",{className:"header-title"},l10n.t("web_group_info"))),w)),o.createElement(p,{expands:!!s.length},o.createElement(h,{classes:"drawer-scale drawer-section-photo"},N),S,T,t))}});e.exports=C},911:function(e,t,r){"use strict";var o=r(6),n=r(9),i=r(103),s=r(774),a=r(776),d=r(775),c=r(788),l=r(909),u=r(852),p=r(808),h=r(155),m=r(780),f=r(771),g=r(77),v=o.createClass({displayName:"GroupMsgInfoDrawer",mixins:[i],propTypes:{msg:o.PropTypes.instanceOf(f)},getInitialState:function(){return{msgInfo:void 0}},componentWillMount:function(){var e=this;Store.MsgInfo.find(this.props.msg).then(function(t){e.setState({msgInfo:t}),e.addObserver(t.played,"add remove"),e.addObserver(t.read,"add remove"),e.addObserver(t.delivery,"add remove"),e.addObserver(t,"change:playedRemaining change:readRemaining change:deliveryRemaining")})["catch"](function(){e.setState({unimplemented:!0}),n.openToast(o.createElement(m,{msg:l10n.t("msg_info_failed"),id:m.genId("msg_info_failed")}))})},getAnimateEnterClass:function(e){return"animate-enter"+(-1===e?"":e)},componentDidMount:function(){this.props.msg.type===f.TYPE.IMAGE&&(this.refs.scrollable.scrollTop=this.refs.scrollable.scrollHeight)},onClose:function(){n.closeDrawer(this.props.type)},render:function(){var e=this.props.msg,t=this.state,r=t.msgInfo,n=t.unimplemented,i=-1,m=void 0;if(r&&r.isPTT){var v=o.createElement("span",{className:"icon icon-status-ptt-blue"}),y=r.played.map(function(e){return o.createElement(u,{participant:e,key:e.id})}),E=r.playedRemaining>0?o.createElement(l,{separator:0!==r.read.length},l10n.t("message_info_remaining",{count:r.playedRemaining,_plural:r.playedRemaining})):null,_=g(this.getAnimateEnterClass(i),{"drawer-section-bottom":!(r&&r.deliveryRemaining>0||r&&!(r.played.length>0&&0===r.readRemaining))});m=o.createElement(c,{classes:_,key:"played-section",expands:!0,title:l10n.t("message_info_played_by"),subtitle:v},o.createElement("div",{className:"chatlist-plain"},y),E)}var T=void 0;if(r&&(r.read.length>0||r.playedRemaining>0)){var b=o.createElement("span",{className:"icon icon-status-dblcheck-ack"}),y=r.read.map(function(e){return o.createElement(u,{participant:e,key:e.id})}),E=r.readRemaining>0?o.createElement(l,{separator:0!==r.read.length},l10n.t("message_info_remaining",{count:r.readRemaining,_plural:r.readRemaining})):null,S=g(this.getAnimateEnterClass(i),{"drawer-section-bottom":!(r&&r.deliveryRemaining>0)});T=o.createElement(c,{classes:S,key:"read-section",expands:!0,title:l10n.t("message_info_read_by"),subtitle:b},o.createElement("div",{className:"chatlist-plain"},y),E)}var C=void 0;if(r&&(r.delivery.length>0||r.deliveryRemaining>0)){var M=o.createElement("span",{className:"icon icon-status-dblcheck"}),y=r.delivery.map(function(e){return o.createElement(u,{participant:e,key:e.id})}),E=r.deliveryRemaining>0?o.createElement(l,{separator:0!==r.delivery.length},l10n.t("message_info_remaining",{count:r.deliveryRemaining,_plural:r.deliveryRemaining})):null,N=g(this.getAnimateEnterClass(i),"drawer-section-bottom");C=o.createElement(c,{classes:N,key:"delivered-section",expands:!0,title:l10n.t("message_info_delivered_to"),subtitle:M},o.createElement("div",{className:"chatlist-plain"},y),E)}var w=void 0;r||n||(w=o.createElement(c,{classes:"drawer-section-spinner",key:"spinner"},o.createElement(h,null)));var P=g("pane-preview-wrapper","pane-preview-wrapper-bg",{"pane-preview-resize":e.type===f.TYPE.PTT||e.type===f.TYPE.IMAGE||e.type===f.TYPE.LOCATION||e.type===f.TYPE.VCARD});return o.createElement(s,{key:"message-info-modal",id:"info",variant:"panel",onCancel:this.onClose},o.createElement(a,{title:l10n.t("message_info"),type:a.Type.SMALL,onCancel:this.onClose}),o.createElement("div",{className:P,ref:"scrollable"},o.createElement("div",{className:"pane-preview"},o.createElement("div",{className:"pane-chat-tile"}),o.createElement(p,{msg:e,displayType:p.DisplayType.MSG_INFO,position:p.Position.END}))),o.createElement(d,{classes:"drawer-body-msg-info"},w,m,T,C,o.createElement("div",{className:"drawer-body-filler"})))}});e.exports=v},912:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(6),a=r(842),d=r(773),c=r(789),l=r(813),u=r(787),p=s.createClass({displayName:"GroupsModal",propTypes:{chats:s.PropTypes.arrayOf(s.PropTypes.instanceOf(d)),filter:s.PropTypes.func,onCancel:s.PropTypes.func.isRequired,onGroup:s.PropTypes.func.isRequired},getDefaultProps:function(){return{filter:function(){return!0}}},getInitialState:function(){return this.selection=new l,{loading:!0,searchFilter:void 0}},componentWillMount:function(){var e=this,t=this.props.chats;i["default"].delay(300).then(function(){var e=_(t).filter(function(e){return e.groupMetadata.stale}).map(function(e){return e.groupMetadata.update()["catch"](_.noop)}).value();return i["default"].all(e)}).then(function(){return e.setState({loading:!1})})},onSelect:function(e,t){var r=t.props.chat;this.props.filter(r)===!0&&this.props.onGroup(t.props.chat)},onSearch:function(e){this.setState({searchFilter:e})},render:function(){var e=this,t=this.props,r=t.chats,o=t.onGroup,n=t.filter,i=t.onCancel,d=void 0;return this.state.loading?d=s.createElement(u.Loading,null):!function(){var t=l10n.accentFold(e.state.searchFilter),i=r.filter(function(e){return n(e)&&(!t||t&&e.contact.searchMatch(t))});i.length?(e.selection.init(_.pluck(i.filter(function(e){return n(e)===!0}),"id")),d=i.map(function(t){var r=void 0,i=void 0;return _.isString(n(t))&&(r=s.createElement("div",{className:"chat-status ellipsify",title:n(t)},n(t)),i="member"),s.createElement(c,{chat:t,mode:c.Mode.INFO,active:e.selection,secondary:r,noContext:!0,className:i,onClick:_.isString(n(t))?void 0:o.bind(null,t),key:t.id})})):d=s.createElement(u.SearchGroups,null)}(),s.createElement(a,{title:l10n.t("web_groups"),selection:this.selection,onSearch:this.onSearch,searchPlaceholder:l10n.t("search_groups"),onSelect:this.onSelect,onCancel:i},d)}});e.exports=p},913:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(6),a=r(30),d=r(1),c=r(41),l=r(771),u=r(770),p=r(104),h=r(79),m=r(772),f=r(783),g=r(795),v=r(871),y=r(825),E=r(790),T=r(796),b=r(78),S=r(9),C=r(809),M=r(341),N=r(153),w=r(17),P=r(11),R=r(812),k=r(77),x=500,I=s.createClass({displayName:"MediaViewerModal",mixins:[u,h],propTypes:{msg:s.PropTypes.instanceOf(l).isRequired,zoomIn:s.PropTypes.bool,onBack:s.PropTypes.func.isRequired,onNext:s.PropTypes.func,onPrev:s.PropTypes.func},getInitialState:function(){return{urlState:this.async("msg.urlState")}},componentWillMount:function(){var e=this;b.push(this,b.MEDIA_VIEWER,{escapable:!0}),this.regCmd("open_chat",this.onClose),this.props.zoomIn&&S.isMsgVisible(this.props.msg.id,function(t){e.setState({zoomElement:t,style:t?{transition:"transform 2s",visibility:"hidden"}:{}})})},onImageLoad:function(e){var t=this.state.zoomElement,r=e.target;t&&r&&this.props.zoomIn&&this.animateZoom(t,e.target)},animateZoom:function(e,t){var r=this,o=t.getBoundingClientRect(),n=e.getBoundingClientRect(),i=n.top-o.top,s=n.left-o.left,a=e.clientWidth/t.clientWidth;this.setState({style:{visibility:"hidden",transform:"translateX("+s+"px) translateY("+i+"px) scale("+a+")",transition:"transform 0s"}},function(){r.setState({style:{transform:"translateX(0px) translateY(0px) scale(1)",transition:"transform "+x+"ms cubic-bezier(.1,.82,.25,1)"}})})},stopPropagation:function(e){w.startDownloading(),e.stopPropagation()},openForwardFlow:function(e){e.stopPropagation();var t=this.props.msg;t.ack<1&&t.isMMS&&t.isSentByMe?S.openModal(s.createElement(M,{title:l10n.t("err_unsent_forward_title"),onOK:S.closeModal.bind(S),okText:l10n.t("web_ok")},l10n.t("err_unsent_forward_text"))):S.openModal(s.createElement(C,{msgs:[this.props.msg]}),"modal-flow")},onScroll:function(e){this.onClose()},onClose:function(){b.find(b.MEDIA_VIEWER)&&b.pop(b.MEDIA_VIEWER)},uimClose:function(e){var t=this,r=void 0;if(this.state.zoomIn?r=this.state.zoomElement:S.isMsgVisible(this.props.msg.id,function(e){r=e}),!r)return this.props.onBack();var o=this.refs.mediaImage,n=o&&o.refs?o.refs.image:null;if(!n)return this.props.onBack();n=a.findDOMNode(n);var i=n.getBoundingClientRect(),s=r.getBoundingClientRect(),d=s.top-i.top,c=s.left-i.left,l=r.clientWidth/n.clientWidth;Velocity(n,{translateX:[c,0],translateY:[d,0],scale:[l,1]},{duration:200,easing:[.1,.82,.25,1]}).then(function(){t.props.onBack()})},render:function(){var e,t=this.props.msg;switch(t.type){case"image":e=s.createElement(D,{msg:t,key:t.id,style:this.state.style,ref:"mediaImage",onLoad:this.onImageLoad});break;case"video":e=s.createElement(O,{msg:t,key:t.id});break;case"audio":e=s.createElement(L,{msg:t,key:t.id})}var r=this.props.onNext?s.createElement("button",{className:"btn btn-round btn-media-next",onClick:this.props.onNext},s.createElement("span",{className:"icon icon-chevron-right icon-l",title:l10n.t("next_button")},l10n.t("next_button"))):s.createElement("div",{className:"btn-media-next"}),o=this.props.onPrev?s.createElement("button",{className:"btn btn-round btn-media-prev",onClick:this.props.onPrev},s.createElement("span",{className:"icon icon-chevron-left icon-l",title:l10n.t("previous_button")},l10n.t("previous_button"))):s.createElement("div",{className:"btn-media-prev"}),n=[l.URL_STATE.URL,l.URL_STATE.STATUS_200].indexOf(t.urlState)>-1?s.createElement("div",{className:"menu-item"},s.createElement("a",{className:"icon icon-download",title:l10n.t("web_button_download"),onClick:this.stopPropagation,download:!0,href:t.url},l10n.t("web_button_download"))):null,i=t.displayName(!0,!0);t.isGroupMsg&&(i+=" @ "+t.chat.formattedTitle);var a=k("media-viewer",{"media-viewer-animate":this.props.zoomIn});return s.createElement("div",{className:a,onWheel:this.onScroll,onClick:this.onClose},s.createElement("div",{className:"media-panel-header"},s.createElement("div",{className:"chat media-chat"},s.createElement("div",{className:"chat-avatar"},s.createElement(f,{id:t.sender})),s.createElement("div",{className:"chat-body"},s.createElement("div",{className:"chat-main"},s.createElement(m,{text:i})),s.createElement("div",{className:"chat-secondary"},s.createElement("div",{className:"chat-status ellipsify"},N.relativeDateAndTimeStr(t.t))))),s.createElement("div",{className:"menu menu-horizontal media-panel-tools"},s.createElement("div",{className:"menu-item"},s.createElement("span",{className:"icon btn-media-forward icon-forward",title:l10n.t("forward"),onClick:this.openForwardFlow},l10n.t("forward"))),n,s.createElement("div",{className:"menu-item"},s.createElement("button",{className:"icon icon-x-viewer",title:l10n.t("web_close"),onClick:this.onClose},l10n.t("web_close"))))),s.createElement("div",{className:"media-content",dir:"ltr",ref:"container"},o,s.createElement("div",{className:"media"},s.createElement(U,{msg:t}),e),r))}}),D=s.createClass({displayName:"MediaImage",mixins:[u,p],propTypes:{msg:s.PropTypes.instanceOf(l).isRequired,onLoad:s.PropTypes.func},canLoad:function(){return _.contains([l.URL_STATE.URL,l.URL_STATE.STATUS_200],this.props.msg.urlState)},canRMR:function(){return _.contains([l.URL_STATE.NO_URL,l.URL_STATE.STATUS_ERR],this.props.msg.urlState)},getInitialState:function(){this.retry=0;var e=this.props.msg,t=e.url,r=e.mediaKey;if(t)if(this.canLoad()){var o=new Image;o.src=t,o.complete&&this.onPreloadLoad(o)}else this.canRMR()&&this.preloadImage(t,r);return{urlState:this.async("msg.urlState"),url:this.async("msg.url"),mediaKey:this.async("msg.mediaKey")}},componentDidMount:function(){this.regNativeListener(window,"online",this.ensureImageLoaded);var e=this.props.msg;e.urlState===l.URL_STATE.NO_URL&&e.requestMediaReupload()["catch"](_.noop)},componentWillUpdate:function(e,t){(t.url!==this.state.url||t.mediaKey!==this.state.mediaKey)&&this.canLoad()&&this.preloadImage(t.url,t.mediaKey)},ensureImageLoaded:function(){var e=this.props.msg;e.url&&e.urlState!==l.URL_STATE.STATUS_200&&this.preloadImage(e.url,e.mediaKey)},preloadImage:function(e,t){if(e){this.preloadImagePromise&&this.preloadImagePromise.cancel();var r;r=c.isEncryptedMedia(e)?this.props.msg.decryptMedia(e,t):i["default"].resolve(e);var o=this.preloadImagePromise=r.then(function(t){return new i["default"](function(r,o){var n=function(t){o(new P.ImageError("Image preload error",e))},i=new Image;i.onload=function(){r(i)},i.onerror=n,i.src=t})}).bind(this).cancellable().then(this.onPreloadLoad)["finally"](function(){o===this.preloadImagePromise&&delete this.preloadImagePromise})["catch"](i["default"].CancellationError,_.noop)["catch"](P.ImageError,this.onPreloadError)}},onPreloadLoad:function(e){var t=this.props.msg;t.set({fullWidth:e.naturalWidth,fullHeight:e.naturalHeight}),t.urlState200(e.src)},onPreloadError:function(e){this.props.msg.mediaLoadError(e.src)},onImageLoad:function(e){this.onPreloadLoad(e.target),this.props.onLoad&&this.props.onLoad(e)},onImageClick:function(e){e.stopPropagation()},render:function(){var e=this.props.msg,t="media-viewer-img",r=e.fullWidth,o=e.fullHeight,n=r&&o?{width:r,height:o}:null;switch(this.state.urlState){case l.URL_STATE.STATUS_200:return s.createElement(E,{type:E.TYPES.SCALE_DOWN,size:n,style:{overflow:"visible"}},s.createElement(g,{src:e.url,style:this.props.style,ref:"image",onLoad:this.onImageLoad,onClick:this.onImageClick,className:t}));default:return s.createElement(A,{msg:e})}}}),O=s.createClass({displayName:"MediaVideo",mixins:[u,p],propTypes:{msg:s.PropTypes.instanceOf(l).isRequired},getInitialState:function(){return this.retry=0,{played:!1,urlState:this.async("msg.urlState"),mmsSrc:this.async("msg.mmsSrc")}},componentDidMount:function(){var e=this.props.msg;e.urlState===l.URL_STATE.NO_URL&&e.requestMediaReupload()["catch"](_.noop)},onPlayerClick:function(e){e.stopPropagation();var t=a.findDOMNode(this.refs.player);e.clientY>t.clientHeight+t.offsetTop-44||(t.paused?t.play():t.pause())},onPlayerError:function(e){var t=e.target.src,r=e.target.error||{code:"__MISSING__"};switch(r.code){case window.MediaError.MEDIA_ERR_NETWORK:case window.MediaError.MEDIA_ERR_DECODE:case window.MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:this.props.msg.mediaLoadError(t);break;default:d.log("mediaVideoModal:onPlayerError unknown error",r.code,t)()}},onPlayerPlay:function(e){var t=e.target,r=this.props.msg;r.set({fullWidth:t.videoWidth,fullHeight:t.videoHeight}),r.urlState200(t.src),this.state.played||this.setState({played:!0})},render:function(){var e=this.props.msg,t="media-viewer-img",r=e.fullWidth,o=e.fullHeight,n=r&&o?{width:r,height:o}:null;switch(this.state.urlState){case l.URL_STATE.URL:case l.URL_STATE.STATUS_200:var i,a,d=s.createElement(E,{type:E.TYPES.SCALE_DOWN,size:n},s.createElement(v,{src:e.mmsSrc,ref:"player",className:t,onPlay:this.onPlayerPlay,onClick:this.onPlayerClick,onError:this.onPlayerError,autoPlay:!0,controls:!0},l10n.t("video_playback_not_supported")));return n||this.state.played||(i={display:"none"},a=s.createElement(A,{msg:e})),s.createElement("div",null,a,s.createElement("div",{style:i},d));default:return s.createElement(A,{msg:e})}}}),A=s.createClass({displayName:"BlurredImage",render:function(){var e=this.props.msg,t="data:image/jpeg;base64,"+e.body,r=R.boundHeightWidth(10*e.height,10*e.width,500,500),o={width:r.width,height:r.height};return s.createElement("div",{className:"media-viewer-blur-crop",style:o},s.createElement("img",{className:"media-viewer-blur-img",src:t}))}}),L=s.createClass({displayName:"MediaAudio",mixins:[u,p],propTypes:{msg:s.PropTypes.instanceOf(l).isRequired},getInitialState:function(){return this.retry=0,{urlState:this.async("msg.urlState"),mmsSrc:this.async("msg.mmsSrc")}},componentDidMount:function(){var e=this.props.msg;e.urlState===l.URL_STATE.NO_URL&&e.requestMediaReupload()["catch"](_.noop)},onPlayerClick:function(e){e.stopPropagation()},onPlayerError:function(e){var t=e.target.src,r=e.target.error||{code:"__MISSING__"};switch(r.code){case window.MediaError.MEDIA_ERR_NETWORK:case window.MediaError.MEDIA_ERR_DECODE:case window.MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:this.props.msg.mediaLoadError(t);break;default:d.log("mediaAudioModal:onPlayerError unknown error",r.code,t)()}},onPlayerPlay:function(e){this.props.msg.urlState200(e.target.src)},render:function(){var e=this.props.msg,t="media-viewer-img media-viewer-audio";switch(this.state.urlState){case l.URL_STATE.URL:case l.URL_STATE.STATUS_200:return s.createElement(y,{src:e.mmsSrc,ref:"player",className:t,onClick:this.onPlayerClick,onPlay:this.onPlayerPlay,onError:this.onPlayerError,autoPlay:!0,controls:!0},l10n.t("audio_playback_not_supported"));default:return s.createElement("div",{className:"image-audio"})}}}),U=s.createClass({displayName:"MediaState",mixins:[u],propTypes:{msg:s.PropTypes.instanceOf(l).isRequired},getInitialState:function(){return{urlState:this.async("msg.urlState")}},initializeMedia:function(e){e.stopPropagation(),this.props.msg.initializeMedia()},requestMediaReupload:function(e){e.stopPropagation(),this.props.msg.requestMediaReupload()["catch"](_.noop)},cancelMediaReupload:function(e){e.stopPropagation(),this.props.msg.urlState=l.URL_STATE.NO_URL},captureClick:function(e){e.stopPropagation()},render:function(){var e=this.props.msg;switch(this.state.urlState){case l.URL_STATE.STATUS_200:return null;case l.URL_STATE.NO_URL:case l.URL_STATE.RMR_ERROR_RETRY:case l.URL_STATE.STATUS_ERR:return s.createElement("div",{onClick:this.requestMediaReupload},s.createElement(T.Download,{filesize:e.size}));case l.URL_STATE.REFRESH_RETRY:return s.createElement("div",{onClick:this.initializeMedia},s.createElement(T.Download,{filesize:e.size}));case l.URL_STATE.INIT:case l.URL_STATE.REFRESHING:case l.URL_STATE.URL:return s.createElement(T.Pending,null);case l.URL_STATE.RMR_FETCHING:return"image"===e.type?s.createElement("div",{onClick:this.cancelMediaReupload},s.createElement(T.Pending,null)):null;case l.URL_STATE.RMR_ERROR_MISSING:return s.createElement("div",{onClick:this.captureClick},s.createElement(T.Missing,{msg:e}));case l.URL_STATE.UPLOADING:return null}}});e.exports=I},914:function(e,t,r){"use strict";var o=r(6),n=r(773),i=r(9),s=function(){return[{label:l10n.t("web_mute_8hours"),duration:8},{label:l10n.t("web_mute_1week"),duration:168},{label:l10n.t("web_mute_1year"),duration:8760}]},a=o.createClass({displayName:"MutePopup",propTypes:{onCancel:o.PropTypes.func,onMute:o.PropTypes.func.isRequired,chat:o.PropTypes.instanceOf(n).isRequired},getInitialState:function(){return{mute:8}},onChange:function(e){this.setState({mute:parseInt(e.target.value,10)})},onMute:function(e){e.stopPropagation(),i.closeModal(),this.props.onMute(3600*this.state.mute+moment().unix(),!0)},render:function(){var e=this.props.onCancel||function(){i.closeModal()},t=this.state.mute,r=this,n=s().map(function(e){var n=e.duration;return o.createElement("li",{key:"mute-"+n},o.createElement("label",null,o.createElement("input",{type:"radio",name:"duration",value:e.duration,checked:t===n,onChange:r.onChange}),e.label))}),a=this.props.chat.isGroup?l10n.t("web_mute_time"):l10n.t("web_mute_time_chat");return o.createElement("div",{className:"backdrop"},o.createElement("div",{className:"popup-container"},o.createElement("div",{className:"popup"},o.createElement("div",{className:"popup-body"},o.createElement("div",{className:"popup-title",dir:"auto"},a),o.createElement("div",{className:"popup-contents"},o.createElement("form",{ref:"form"},o.createElement("ol",{className:"choices"},n)))),o.createElement("div",{className:"popup-controls"},o.createElement("button",{className:"btn-plain popup-controls-item",onClick:e},l10n.t("web_cancel")),o.createElement("button",{className:"btn-plain btn-default popup-controls-item",onClick:this.onMute},l10n.t("web_ok"))))))}});e.exports=a},915:function(e,t,r){"use strict";var o=r(6),n=r(774),i=r(776),s=r(775),a=r(793),d=r(805),c=r(105),l=o.createClass({displayName:"NewGroupDrawer",propTypes:{thumb:o.PropTypes.string,full:o.PropTypes.string,subject:o.PropTypes.string,onBack:o.PropTypes.func.isRequired,onContinue:o.PropTypes.func.isRequired},getInitialState:function(){return{text:this.props.subject||"",thumb:this.props.thumb,full:this.props.full,emojiActive:!1}},componentDidMount:function(){this.refs.emojiInput.restoreFocus()},preventBlur:function(e){e.preventDefault(),e.stopPropagation(),this.refs.emojiInput.restoreFocus()},onImageSet:function(e,t){this.setState({thumb:e,full:t})},onContinue:function(){var e=this.state.text.trim(),t=this.refs.photoPicker;if(t.state.isEditing){var r=this;t.cropImage().then(function(t){r.props.onContinue(e,t.thumb,t.full)})}else this.props.onContinue(e,this.state.thumb,this.state.full)},onInputChange:function(e){this.setState({text:e.target.value})},render:function(){var e=this.state.text.length>0?o.createElement("div",{className:"drawer-section drawer-controls"},o.createElement("button",{className:"btn btn-round",onClick:this.onContinue},o.createElement("span",{className:"icon icon-forward-light icon-l"}))):null;return o.createElement(n,{id:"new-group",onCancel:this.props.onBack},o.createElement(i,{title:l10n.t("new_group_flow_title"),type:i.Type.LARGE,onBack:this.props.onBack}),o.createElement(s,null,o.createElement("div",{className:"drawer-section"},o.createElement(d,{type:d.Type.GROUP,startImage:this.state.full,onImageSet:this.onImageSet,ref:"photoPicker"})),o.createElement("div",{className:"drawer-section",onMouseDown:this.preventBlur},o.createElement(a,{ref:"emojiInput",placeholder:l10n.t("group_subject"),floating:!0,value:this.state.text,editable:!0,showRemaining:!0,maxLength:25,onEnter:this.onContinue,onChange:this.onInputChange})),o.createElement(c,{transitionName:"btn"},e)))}});e.exports=l},916:function(e,t,r){"use strict";var o=r(6),n=r(774),i=r(776),s=r(775),a=r(823),d=r(862),c=r(103),l=r(8),u=r(9),p=r(780),h=r(105),m=r(342),f=m.HotKeys,g=p.genId("max_participant_toast"),v=o.createClass({displayName:"NewGroupParticipantsDrawer",mixins:[c],propTypes:{thumb:o.PropTypes.string,full:o.PropTypes.string,subject:o.PropTypes.string.isRequired,onBack:o.PropTypes.func.isRequired,onContinue:o.PropTypes.func.isRequired},getInitialState:function(){return{searchText:"",participants:[],shouldFocus:!0}},getFilteredContacts:function(){var e=Store.Contact.getFilteredContacts();e=_.difference(e,this.state.participants);var t=this.state.searchText;return t?(t=l10n.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e},componentDidMount:function(){this.focus()},componentDidUpdate:function(){this.adjustInput()},onKeyDown:function(e){if("Backspace"!==e.key||this.state.searchText||_.isEmpty(this.state.participants))"Enter"===e.key&&_.size(this.state.participants)&&this.onContinue();else{e.preventDefault();var t=this.state.participants;this.setState({participants:t.slice(0,t.length-1),shouldFocus:!0})}},onInput:function(e){this.setState({searchText:e.target.value})},adjustInput:function(){var e=this.refs.input.offsetParent.offsetWidth-10,t=this.refs.sizer.offsetWidth,r=t>e?e:t;this.refs.input.style.width=r+"px";var o;o=e-this.refs.input.offsetLeft-r>0?e-this.refs.input.offsetLeft:e,this.refs.input.style.width=o+"px",this.state.shouldFocus&&this.focus()},onReset:function(){this.setState({searchText:"",shouldFocus:!0})},focus:function(){this.refs.input.focus()},uimFocus:function(){this.focus()},onBack:function(){var e=this.props;e.onBack(e.subject,e.thumb,e.full)},onContinue:function(){var e=this.props;e.onContinue(e.subject,e.thumb,e.full,this.state.participants);
},onDelete:function(e,t){var r=this.state.participants;this.setState({participants:_.without(r,t),shouldFocus:!1})},onContactClick:function(e,t){var r=this.state.participants;if(_.contains(r,t))this.setState({participants:_.without(r,t),shouldFocus:!0});else if(r.length>=l.MAX_GROUP_SIZE){var n=l10n.t("action_group_create_failed_participant",{max:l.MAX_GROUP_SIZE});u.openToast(o.createElement(p,{msg:n,id:g}))}else this.setState({participants:r.concat(t),searchText:"",shouldFocus:!0})},onFocusList:function(e){this.refs.list&&(e.preventDefault(),e.stopPropagation(),f.flashFocus=Date.now(),this.refs.list.focusFirst())},onFocusParticipants:function(e){e.repeat||0!==this.refs.input.selectionStart||this.refs.participantList&&(e.preventDefault(),e.stopPropagation(),f.flashFocus=null,this.refs.participantList.focusLast())},onSelectFirst:function(e){e.preventDefault(),e.stopPropagation();var t=_.first(this.getFilteredContacts());t&&this.onContactClick(e,t)},onFocusSearch:function(e){f.flashFocus=Date.now(),this.refs.input.focus()},render:function(){var e=_.size(this.state.participants)?o.createElement("button",{className:"btn btn-round",onClick:this.onContinue},o.createElement("span",{className:"icon icon-checkmark-light"})):null,t=_.size(this.state.participants)?" ":l10n.t("group_participant_hint"),r={down:this.onFocusList,enter:this.onSelectFirst,up:this.onFocusParticipants};return r[l10n.LR("left","right")]=this.onFocusParticipants,r={},o.createElement(n,{id:"new-group",onCancel:this.onBack},o.createElement(i,{title:l10n.t("add_group_participants_title"),type:i.Type.LARGE,onBack:this.onBack}),o.createElement(s,{flex:!0},o.createElement("div",{className:"drawer-section new-group-search"},o.createElement("div",{className:"input-clear input-ext"},o.createElement(f,{handlers:r,className:"input input-line"},o.createElement("div",{className:"list-names list-deletable new-group-preview"},o.createElement("div",{className:"new-group-participants","data-list-scroll-container":!0},o.createElement(d,{ref:"participantList",contacts:this.state.participants,onDelete:this.onDelete,onFocusSearch:this.onFocusSearch}))),o.createElement("input",{className:"inputarea",ref:"input",placeholder:t,onKeyDown:this.onKeyDown,onChange:this.onInput,value:this.state.searchText}),o.createElement("span",{className:"inputarea-sizer",ref:"sizer"},this.state.searchText)))),o.createElement("div",{className:"new-group-contacts","data-list-scroll-container":!0},o.createElement(a,{ref:"list",contacts:this.getFilteredContacts(),onFocusSearch:this.onFocusSearch,onClick:this.onContactClick})),o.createElement(h,{transitionName:"btn",className:"drawer-section drawer-controls"},e)))}});e.exports=v},917:function(e,t,r){"use strict";var o=r(6),n=r(774),i=r(776),s=r(788),a=r(775),d=r(805),c=r(341),l=r(9),u=r(770),p=r(845),h=r(78),m=r(8),f=o.createClass({displayName:"ProfileDrawer",mixins:[u],propTypes:{id:o.PropTypes.string.isRequired},getInitialState:function(){return{status:this.async("id.Status.status")||l10n.t("contact_status_loading"),imgFull:this.async("id.ProfilePicThumb.imgFull"),pendingStatus:!1,pendingPhoto:!1}},validateStatus:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return!!e.trim()},onSetStatusError:function(){l.openModal(o.createElement(c,{onOK:l.closeModal.bind(l),okText:l10n.t("web_ok")},l10n.t("action_status_empty")))},onSetStatus:function(e){if(Store.Status.canSetMyStatus()){var t=Store.Status.get(this.props.id).status;this.state.status!==t&&(this.setState({pendingStatus:!0}),Store.Status.setMyStatus(this.state.status).bind(this)["finally"](function(){this.isMounted()&&this.setState({status:Store.Status.get(this.props.id).status,pendingStatus:!1})}))}},onBack:function(){l.closeDrawer(this.props.type)},onStatusChange:function(e){this.setState({status:e.target.value})},onCancelStatus:function(){this.setState({status:Store.Status.get(this.props.id).status})},onImageSet:function(e,t){var r=Store.ProfilePicThumb.get(this.props.id);this.setState({pendingPhoto:!0});var o;o=e&&t?r.setPicture(e,t):r.deletePicture(),o.bind(this).then(function(){this.isMounted()&&this.setState({pendingPhoto:!1})})},render:function(){var e=Store.ProfilePicThumb.get(this.props.id),t=e.canSet()||e.canDelete()?d.Type.PROFILE:d.Type.NO_EDIT,r=o.createElement(d,{type:t,id:this.props.id,pending:this.state.pendingPhoto,startImage:this.state.imgFull,onImageSet:this.onImageSet});return o.createElement(n,{onCancel:this.onBack,id:"profile"},o.createElement(i,{a8n:"drawer-title-profile",title:l10n.t("menuitem_profile_status"),onBack:this.onBack,type:i.Type.SMALL}),o.createElement(a,null,o.createElement("div",{className:"drawer-section drawer-scale drawer-section-photo"},r),o.createElement(s,{a8n:"col-main-profile",title:l10n.t("web_status"),classes:"animate-enter1"},o.createElement(p,{id:h.STATUS_INPUT,value:this.state.status,editable:Store.Status.canSetMyStatus(),pending:this.state.pendingStatus,showRemaining:!0,validate:this.validateStatus,maxLength:m.MAX_STATUS_LENGTH,onChange:this.onStatusChange,onSave:this.onSetStatus,onError:this.onSetStatusError,onCancel:this.onCancelStatus}))))}});e.exports=f},918:function(e,t,r){"use strict";var o=r(6),n=r(103),i=r(9),s=o.createClass({displayName:"TermsOfServiceModal",mixins:[n],componentDidMount:function(){this.addObserver(Store.Conn,"change:tos",this.close)},close:function(){0===Store.Conn.tos&&i.closeModal()},render:function(){var e,t=null;switch(Store.Conn.tos){default:case 1:e=l10n.t("web_terms_of_service_1"),t=o.createElement("div",{className:"popup-controls"},o.createElement("button",{className:"btn-plain btn-default popup-controls-item",onClick:i.closeModal.bind(i)},l10n.t("ok_got_it")));break;case 2:e=l10n.t("web_terms_of_service_2")}return o.createElement("div",{className:"backdrop"},o.createElement("div",{className:"popup-container"},o.createElement("div",{className:"popup"},o.createElement("div",{className:"popup-body"},o.createElement("div",{className:"popup-contents"},e)),t)))}});e.exports=s},919:function(e,t,r){"use strict";var o=r(59),n=r(156),i=o.extend({Collection:"Blocklist",children:{contact:n},props:{id:"string"},initialize:function(){this.contact=Store.Contact.gadd({id:this.id}),this.listenTo(this.contact,"all",this._getEventBubblingHandler("contact"))}});e.exports=i},920:function(e,t,r){"use strict";var o=r(343),n=r(919),i=o.extend({model:n,handle:function(e){var t=e.shift(),r=t.blocklist,o=_.map(r,function(e){return{id:e}});this.set(o)}});e.exports=new i},921:function(e,t,r){"use strict";var o=r(1),n=r(59),i=r(9),s=n.extend({Collection:"Call",props:{id:"string",type:"string",from:"string"},initialize:function(){this.listenToAndRun(this,"change:type",this.updateNotification)},updateNotification:function(){o.log("call:"+this.type+" id:"+this.id+" from:"+this.from)(),"offer"===this.type?i.alertCall(this.id,this.from):i.cancelCall(this.id)}});e.exports=s},922:function(e,t,r){"use strict";var o=r(343),n=r(921),i=r(168),s=o.extend({model:n,handle:function(e){var t=e.shift();switch(t.type){case"offer":case"accept":case"reject":case"terminate":i.tosShowCallNotification&&this.add(t,{merge:!0})}}});e.exports=new s},923:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(22),i=o(n),s=r(3),a=o(s),d=r(6),c=r(8),l=r(1),u=r(343),p=r(773),h=r(35),m=r(36),f=r(60),g=r(9),v=r(11),y=r(159),E=u.extend({model:p,comparator:function(e,t){return e.t?t.t?""+e.t+e.id>""+t.t+t.id?-1:1:-1:1},initialize:function(){u.prototype.initialize.call(this),this.listenTo(this,"change:t",this.sort)},active:function T(){var T=_.first(this.filter("active"));return T?T.id:void 0},_find:function(e){return a["default"].resolve({id:e,createdLocally:!0,noEarlierMsgs:!0})},_findQuery:function(e){var t=this;return h.chatFindQuery(!!e.retry).then(function(e){return"preempted"===e?a["default"].reject("chats preempted"):(t.trigger(c.COLLECTION_HAS_SYNCED),a["default"].resolve(e))})},handle:function(e){var t=e.shift(),r=this;if(_.isArray(t)){var o=[],n=[];t.forEach(function(e){if("c.us"===e.id)n.push(e);else{var t=!!r.get(e.id),s=["delete","clear","archive","unarchive","star","unstar","spam"].indexOf(e.type)>-1;t||s?t&&s?n.push(e):l.log("Model:chat:handle received junk chat record: "+(0,i["default"])(e))():o.push(e)}}),r.add(o,{merge:!0}),n.forEach(function(e){var t=e.type;if("c.us"===e.id)switch(t){case"clear":l.log("Model:chat:handle:clear:all before: "+e.before)(),r.forEach(function(t){"number"==typeof e.before?t.deleteMsgsOlderThan(e.before,e.star):t.deleteMsgs(e.star)});break;case"delete":l.log("Model:chat:handle:delete:all")(),r.forEach(function(e){e["delete"]()});break;case"archive":l.log("Model:chat:handle:archive:all")(),r.forEach(function(e){e.archive=!0});break;case"unarchive":l.log("Model:chat:handle:unarchive:all")(),r.forEach(function(e){e.archive=!1});break;case"unstar":l.log("Model:chat:handle:unstar:all")(),r.forEach(function(e){e.unstarAll()});break;default:l.error("Model:chat:handle unknown "+(0,i["default"])(e),e)()}else{var o=r.get(e.id);if(!o)return;switch(t){case"clear":case"star":case"unstar":if(e.keys){for(var n=e.keys.length,s="star"===t,a=0;n>a;a++){var d=e.keys[a][0],c=e.keys[a][1],u=e.keys[a][2],p=c?Store.Conn.me:e.id,h=c?e.id:Store.Conn.me,m=c?"out":"in",g=new f(p,h,d,u,m),v=Store.Msg.get(g);v&&("clear"===t?o.removeMsg(v):v.star=s)}var y=e.keys.map(function(e){return e.join("_")}).join();l.log("model:Chat:handle:messages:"+[t,e.id,y,e.modifyTag].join())()}else"clear"===t&&("number"==typeof e.before?o.deleteMsgsOlderThan(e.before,e.star):o.deleteMsgs(e.star),l.log("model:Chat:handle cleared chat:"+[e.id,e.before,e.modifyTag].join())());isNaN(e.modifyTag)||(o.modifyTag=e.modifyTag);break;case"delete":o["delete"](),l.log("model:Chat:handle deleted chat for "+e.id)();break;case"archive":o.archive=!0;break;case"unarchive":o.archive=!1;break;case"spam":o.notSpam=e.notSpam}}})}else if("leave"===t.cmd)t.gids.forEach(function(e){var t=r.get(e);t&&t.exit()});else if("preempt"===t.cmd)Store.Chat.add(t.response,{merge:!0}),this.trigger(c.COLLECTION_HAS_SYNCED);else if("action"===t.cmd){var s=t.id,a=t.data;if("create"===a[0]||"introduce"===a[0]){var d=a[1],u=a[2],p=_.map(u.admins,function(e){return{id:e,isAdmin:!0}}).concat(_.map(u.regulars,function(e){return{id:e,isAdmin:!1}}));Store.GroupMetadata.add({id:s,creation:u.creation,owner:d,participants:p,stale:!1},{merge:!0}),Store.Contact.add({id:s,name:u.subject},{merge:!0});var h=Store.Chat.get(s);if(!h)return;var m=h.msgs.last();if(!m)return;"gp2"===m.type&&"add"===m.subtype&&_.first(m.recipients)===Store.Conn.me&&g.alertNewMsg(m)}else{var v=Store.Chat.get(t.id);v?v.handleGroupAction.apply(v,t.data):l.error("model:chat: unknown chat for action "+(0,i["default"])(t))()}}else l.error("model:chat: unknown payload: "+(0,i["default"])(t))()},createGroup:function(e,t,r,o){var n=_.pluck(o,"id"),i=h.createGroup(e,n),s=l10n.t("action_group_creating"),a=i.then(function(e){return 200===e.status?l10n.t("action_group_created"):406===e.status?l10n.t("action_group_create_failed")+" "+l10n.t("action_group_create_failed_406"):void 0})["catch"](function(e){throw l.error("models:chatCollection:createGroup dropped")(e),l10n.t("action_group_create_failed")});return g.openToast(d.createElement(y,{id:y.genId(),pendingText:s,actionText:a,retry:this.createGroup.bind(this,e,t,r,o)})),i.then(function(e){if(200===e.status&&e.gid&&Store.Chat.find(e.gid).then(function(e){g.openChat(e)}),200===e.status&&!e._duplicate&&t&&r){var o=Store.ProfilePicThumb.gadd(e.gid);return o.setPicture(t,r)}200===e.status&&e._duplicate&&l.error("createGroup failed to set picture.")()})},sync:function(){return this.findQuery({})["catch"](v.WapDrop,_.noop),a["default"].all([m.waitForBBEvent(this,c.COLLECTION_HAS_SYNCED),Store.Msg._hasSynced()])},resyncMessages:function(){l.log("ChatStore:resyncMessages")();var e=Store.Chat.filter(function(e){return!e.isNewlyCreated()}),t=e.map(function(e){var t=e.id,r={wid:t,archive:e.archive,mute:e.mute.expiration,active:e.active,isReadOnly:e.isReadOnly,modifyTag:e.modifyTag,unreadCount:e.unreadCount,notSpam:e.notSpam},o=Store.Msg.lastReceivedKey[t];if(o){var n=o;r.id=n.id,r.fromMe=n.fromMe.toString(),r.participant=n.participant}return r});return h.resyncMessages(t).then(function(e){return e.status>=400?(l.error("ChatStore:resyncMessages resume error "+e.status)(),a["default"].reject(new Error("ChatStore:resyncMessages resume error "+e.status))):(l.log("ChatStore:resyncMessages resume success")(),e.checksum&&Store.Contact.resyncContacts(e.checksum),e.data.forEach(function(e){if("delete"!==e.type){var t=Store.Contact.get(e.id);t?e.name&&(t.name=e.name):Store.Contact.add({id:e.id,name:e.name})}var r=Store.Chat.get(e.id);if(!r)return void Store.Chat.add(e);if("clear"===e.type){var o=[];r.msgs.forEach(function(e){o.push(e)}),_.each(o,function(e){e["delete"]()}),r.set({t:e.t,unreadCount:e.unreadCount,createdLocally:!1,archive:e.archive,isReadOnly:e.isReadOnly,modifyTag:e.modifyTag,msgs:[],noEarlierMsgs:!1,notSpam:e.notSpam}),r.mute.setMute(e.muteExpiration),l.log("model:chat:resume: cleared chat for "+e.id)()}else"delete"===e.type?(r["delete"](),l.log("model:chat:resume: deleted chat for "+e.id)()):(r.set(e,{merge:!0}),r.mute.setMute(e.muteExpiration))}),a["default"].resolve())})["catch"](v.WapDrop,function(e){return l.error("ChatStore:resyncMessages resume dropped")(),a["default"].reject(e)})}});e.exports=new E},924:function(e,t,r){"use strict";var o=r(343),n=r(771),i=o.extend({model:n,add:function(){var e=this,t=o.prototype.add.apply(this,arguments),r=Store.Msg.add(t,arguments[1]);return _.isArray(r)?r.forEach(function(t){e.isModel(t)&&(t.msgChunk=e)}):this.isModel(r)&&(r.msgChunk=this),this.trigger("bulk_add",t),t},replace:function(e){var t=this;this.set(e.models,{silent:!0,merge:!1}),e.models.forEach(function(e){t.isModel(e)&&(e.msgChunk=t)}),this.trigger("bulk_add",e.models)}});e.exports=i},925:function(e,t,r){"use strict";var o=r(8),n=r(1),i=r(12),s=r(11),a={handle:function(e){var t=e.shift();switch(t.type){case"const":o[t.key]=t.value;break;case"read":case"unread":var r=Store.Chat.get(t.jid);r&&("read"===t.type?r.markSeen():"unread"===t.type&&r.markUnseen());break;case"picture":Store.ProfilePicThumb.imageChanged(t.jid,t.tag);break;case"log":i.upload("server-requested");break;case"privacy":t.jid?(Store.Presence.update(t.jid)["catch"](s.WapDrop,_.noop),Store.ProfilePicThumb.update(t.jid)["catch"](s.WapDrop,_.noop),Store.Status.update(t.jid)["catch"](s.WapDrop,_.noop)):n.error("Store:Cmd:handle:privacy no jid",t)();break;default:n.warn("Store.Cmd:handle:unknown "+t.type,t)()}}};e.exports=a},926:function(e,t,r){"use strict";var o=r(59),n=o.extend({idAttribute:"char",props:{"char":"string",variant:"string"}});e.exports=n},927:function(e,t,r){"use strict";var o=r(343),n=r(926),i=r(782),s=o.extend({model:n,initialize:function(){o.prototype.initialize.call(this,{CachePolicy:{id:"emoji_variant_collection",policy:o.CACHE_POLICY.LOAD,delay:1e3}})},setVariant:function(e,t){var r=i.skinToneEmojis[e];if(!r)throw new Error("attempt to store variantless emoji");this.gadd({"char":r,variant:t})},getVariant:function(e){if(i.skinToneEmojis[e]){var t=this.get(e);return t?t.variant:null}throw new Error("attempt to get variantless emoji")}});e.exports=new s},928:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(1),a=r(343),d=r(811),c=r(35),l=r(11),u=r(21),p=a.extend({model:d,initialize:function(){a.prototype.initialize.call(this,{staleCollection:!0})},onResume:function(){_.union(Store.Chat.where({active:!0}).filter(function(e){return e.isGroup||e.isBroadcast}),Store.Chat.where({isBroadcast:!0})).forEach(function(e){Store.GroupMetadata.find(e.id)["catch"](l.WapDrop,_.noop)})},_find:function(e){var t=this;if(u.isGroup(e)){var r=Store.Chat.get(e);return r&&r.isReadOnly?c.groupMetadataFindFromPhone(e).then(function(t){return"ok"===t.status?t.data:"missing"===t.status?void _.defer(function(){Store.Chat.get(e)["delete"]()}):"error"===t.status?(s.error("model:GroupMetadata:find error "+t.info)(),i["default"].reject(new Error("model:GroupMetadata:find error"))):void 0}):c.groupMetadataFind(e).then(function(r){if(r.status>=400)return{id:e,stale:!1};var o=[],n=t.get(e);return n?n.participants.set(r.participants):o=r.participants,t.updateSubject(e,r.subject),{id:r.id,owner:r.owner,creation:r.creation,participants:o,stale:!1}})}return u.isBroadcast(e)?c.contactFindBroadcast(e).then(function(t){if(200===t.status){var r=Store.GroupMetadata.get(e);if(r&&!r.stale)return i["default"].resolve(r);var o=[];return r?r.participants.set(t.recipients):o=t.recipients,i["default"].resolve({id:e,stale:!1,participants:o})}return 404===t.status?i["default"].reject("False broadcast list query."):(s.error("models:GroupMetadataCollection:_find:bclist error: "+t.status)(),i["default"].reject(new Error("models:GroupMetadataCollection:_find:bclist error: "+t.status)))}):(s.log("groupMetadata:find trying to fetch non-group/bclist wid "+e)(),i["default"].reject(new Error("groupMetadata:find trying to fetch non-group/bclist wid "+e)))},_handle:function(e){return e},updateSubject:function(e,t){_.isString(t)&&Store.Contact.find(e).then(function(e){e.name||(e.name=t)})}});e.exports=new p},929:function(e,t,r){"use strict";e.exports={Blocklist:r(920),Call:r(922),Chat:r(923),Cmd:r(925),GroupMetadata:r(928),Msg:r(930),MsgInfo:r(932),Mute:r(933),Presence:r(934),ProfilePicThumb:r(935),Props:r(936),RecentEmoji:r(938),EmojiVariant:r(927),Status:r(939),Stream:r(106)}},930:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function n(e){if(e.notifyName){var t=Store.Contact.get(e.sender);t&&(!t.notifyName||t.notifyName.t<e.t)&&(t.notifyName={name:e.notifyName,t:e.t})}}function i(e,t,r,o){var i=[],s=[];if(t.forEach(function(t,a){t.id=new w(t.from,t.to,t.id,t.participant,t.self),_.isString(e)&&b.isBroadcast(e)&&delete t.broadcast,t.recvFresh||t.clientUrl||(t.urlState=C.URL_STATE.NO_URL),"ptt"===t.type&&!t.id.fromMe&&t.ack<0&&(t.ack=0);var d=Store.Msg.get(t.id);if(d){void 0===d.clientUrl&&t.clientUrl&&d.set({urlState:C.URL_STATE.INIT}),t.ack<d.ack&&delete t.ack;for(var c in t)t.hasOwnProperty(c)&&"undefined"==typeof t[c]&&delete t[c];d.set(t),r.isHistory&&(d.recvFresh||o)&&!d.search?(y.warn("model:Msg:handle:processMM:"+(d.recvFresh?"dup:":"overlap:")+d.id)(),s.push(d)):r.isHistory&&d.search?(d.search=!1,y.warn("model:Msg:handle:processMM load search as history "+d.id)(),i.push(d.toJSON())):"search"===r.add&&i.push(d.toJSON()),n(d)}else"search"===r.add&&(t.search=!0),r.update||i.push(t)}),0===i.length&&0===s.length)return g["default"].resolve(t.map(function(e){return Store.Msg.get(e.id)}));var a=p(i).then(function(e){var t=Store.Msg.add(e,{merge:!0});return _.each(t,function(e){n(e)}),t});return e?g["default"].join(a,Store.Chat.find(e),function(n,i){var a="function"==typeof o?o():o,d="after"===r.add||"last"===r.add,l=!r.isHistory;if(c(t,n,s,i,d,a||i.msgs),l&&b.isBroadcast(e)&&n.forEach(function(t){if("broadcast_notification"===t.type){var r=Store.GroupMetadata.get(e);"add"===t.subtype?r.participants.add({id:t.body},{merge:!0}):"remove"===t.subtype&&r.participants.remove(t.body),i.groupMetadata.stale=!1}else t.recvFresh&&u(t)}),S.supportsFeature(S.F.RECENT_EMOJI_SYNC)&&!Store.RecentEmoji.syncDue)for(var p=0;p<n.length;p++){var h=n[p];if(h.isNew&&h.isSentByMe&&h.containsEmoji){Store.RecentEmoji.periodicSync();break}}return t.map(function(e){return Store.Msg.get(e.id)})}):a.then(function(e){return t.map(function(e){return Store.Msg.get(e.id)})})}function s(e){return new g["default"](function(t,r){var o=e.map(function(e){return[e.clientUrl,e.from.split("@")[0],e.to.split("@")[0],e.t]});P.send({data:["query","refreshMedia",o],onSend:t,onDrop:r})}).then(function(t){if(200===t.status){var r=t.data;return r.length!==e.length?(y.error("Msg:refreshMedia returned length differs from orig")(),g["default"].reject("Msg:refreshMedia returned length differs from orig")):(r.forEach(function(t){var r=e.shift(),o=r.duration||t.d;o=o?o.toString():void 0;var n={url:t.url,urlState:t.url?C.URL_STATE.URL:C.URL_STATE.NO_URL,mimetype:t.mt,duration:o};"image"===r.type&&(n.fullWidth=t.w,n.fullHeight=t.h),r.set(n)}),e)}return y.error("Msg:refreshMedia error "+t.status)(),g["default"].reject("Msg:refreshMedia error "+t.status)})}function a(e,t,r,o){var n=t.msgs.length,i=o||t.msgs;if(e=_.isArray(e)?e:[e],r?i.add(e):i.add(e,{at:0}),r||0===n){var s=_.last(e).id,a=s.remote;Store.Msg.lastReceivedKey[a]=s}if(r||0===n||!Store.Msg.lastReceivedReceipt[t.id])for(var d=e.length,c=d-1;c>=0;c--){var l=e[c],u=l.id;if(u.fromMe&&!l.isNotification){Store.Msg.updateLastReceipt(u.remote,l.t);break}}}function d(e,t,r,o,n){var i,s,a,d={},c={},l=r.length,u=n;if(0===l)return{msgs:t,collection:u};for(i=0;l>i;i++)s=r[i],c[s.id]=s;for(l=t.length,i=0;l>i;i++)s=t[i],d[s.id]=s;var p=[];for(l=e.length,i=0;l>i;i++)if(s=e[i],a=d[s.id],a&&p.push(a),a=c[s.id])if(a.recvFresh)p.push(a),o.removeMsg(a),a.unset("recvFresh");else{var h=o.getAllCMCs(),m=_.find(h,function(e){return e.get(s.id)});n&&m===n||(m?(m.forEach(function(e){p.push(e),delete c[e.id]}),m===o.msgs?(o.replaceMsgsCollection(n),u=o.msgs):(o.notifyMsgCollectionMerge(n,m,n),o.removeMsgsCollection(m))):(y.error("models:Msg:reorder trying to merge CMC of orphaned message "+s.id,s)(),p.push(c[s.id])))}return{msgs:p,collection:u}}function c(e,t,r,o,n,i){var s=d(e,t,r,o,i);a(s.msgs,o,n,s.collection)}function l(e){return _.isObject(e)?JSON.parse((0,m["default"])(e)):e}function u(e){function t(t){var r=new w(e.from,t,o.id);if(!Store.Msg.some(_.matches({id:r}))){var n=l(e);n.to=t,n.id=r,n.broadcast=!0;var i=Store.Msg.add(n,{merge:!0});Store.Chat.find(t).then(function(e){a(i,e,!0)})}}var r,o=e.id;if(!e.invis)if(e.recipients&&0!==e.recipients.length)r=e.recipients,e.recipients.forEach(t);else{var n=Store.GroupMetadata.get(o.remote);n?(r=l(n.participants),_.pluck(r,"id").forEach(t)):y.log("model:msgs:broadcastFanout no group_metadata rec for bclist, cant fanout: "+o.remote)()}return r}function p(e){return g["default"].all(e.map(function(e){return["image","video"].indexOf(e.type)>-1&&!parseInt(e.width||0,10)&&e.body?new g["default"](function(t,r){var o=new Image;o.onload=function(){e.width=o.width,e.height=o.height,t(e)},o.src="data:image/jpeg;base64,"+e.body}):g["default"].resolve(e)}))}var h=r(22),m=o(h),f=r(3),g=o(f),v=r(8),y=r(1),E=r(343),T=r(11),b=r(21),S=r(80),C=r(771),M=r(36),N=r(41),w=r(60),P=r(14),R=r(35),k=E.extend({model:C,initialize:function(){E.prototype.initialize.call(this),this.lastReceivedKey={},this.lastReceivedReceipt={},this.refreshMediaPromises={},this.preAck={},this.pendingAdd={},this.listenTo(P,"change:stream",function(){P.stream===P.STREAM.DISCONNECTED&&(this.preAck={})})},_findQuery:function(e){var t,r=this;switch(e.direction){case"before":case"after":t=e.direction;break;default:t="before"}return R.msgFindQuery(t,e).then(function(o){if(o.status>=400)return y.error("model:Msg:findQuery error "+o.status)(),g["default"].reject(o.status);var n=function(){var t=r.get(e),o=Store.Chat.get(e.remote);return t?t.msgChunk:o?o.msgs:void 0};return o.forEach(function(e){e.invis=!0}),r.processMultipleMessages(e.remote,o,{add:t,isHistory:!0},n)})},getStarred:function(){var e=this;return R.msgFindQuery("star").then(function(t){return t.status>=400?(y.error("model:Msg:getStarred error "+t.status)(),g["default"].reject(t.status)):e.processMultipleMessages(void 0,t,{add:"search"})})},search:function(e){var t=this;return R.msgFindQuery("search",e).then(function(e){return e.status>=400?(y.error("model:Msg:search error "+e.status)(),g["default"].reject(e.status)):t.processMultipleMessages(void 0,e,{add:"search"})})},getContext:function(e,t){var r=this;return g["default"].join(R.msgFindQuery("before",e),R.msgFindQuery("after",e),function(o,n){return _.isArray(o)&&_.isArray(n)?g["default"].join(r.processMultipleMessages(e.remote,o,{add:"before",isHistory:!0},t),r.processMultipleMessages(e.remote,n,{add:"after",isHistory:!0},t)):(y.error("model:msg:getContext fetch error",o,n)(),g["default"].reject(o.status||n.status))})},handle:function(e){function t(e,t){var r=new w(n.from,e,t,void 0,"out"),i=o.get(r);if(i){i.updateAck(n.ack),o.updateLastReceipt(r.remote,n.t);var s=r.remote;b.isUser(s)&&(Store.MsgInfo.update(t,n.from,e,n.ack,s,n.t),b.isBroadcast(n.broadcast)&&Store.MsgInfo.update(t,n.from,n.broadcast,n.ack,s,n.t))}else y.log("Msg:out of order ack",n)(),o.preAck[r]=n}var r,o=this,n=e.shift();if("ack"===n.cmd){var i=[n.to];if(b.isBroadcast(n.to)&&1===n.ack){var s=Store.GroupMetadata.get(n.to);s&&Array.prototype.push.apply(i,_.pluck(s.participants.toArray(),"id"))}return i.forEach(function(e){t(e,n.id)}),!0}if("acks"===n.cmd)return n.id.forEach(function(e){t(n.to,e)}),!0;if(n.msg)return n.msg.recvFresh=!0,n.msg.isNew=!0,this.processMultipleMessages(n.chat,[n.msg],{add:"after",update:"update"===n.meta.add,isHistory:!1}),!0;if(n.msgs){var a=n.msgs.length;if(!a)return!1;var d=n.meta;d.isHistory=!0;for(var c=0;a>c;c++)r=n.msgs[c],r.invis=!0;return this.processMultipleMessages(n.chat,n.msgs,d),!0}if(n.recent){delete n.recent,this.trigger(v.COLLECTION_HAS_SYNCED);for(var l in n)r=n[l],r.invis=!0,this.processMultipleMessages(l,[r],{add:"last",isHistory:!0})}else y.log("************** Msg else clause. something strange is going on")()},_hasSynced:function(){return M.waitForBBEvent(this,v.COLLECTION_HAS_SYNCED)},"delete":function(){E.prototype["delete"].call(this),this.lastReceivedKey={},this.lastReceivedReceipt={},this.preAck={},this.refreshMediaPromises={}},send:function(e){return new g["default"](function(t,r){var o=e.id,n=o,i=e.toJSON();if(e.isNew=!0,!e.isGroupMsg&&Store.Blocklist.get(e.to))return void r(new T.ContactBlocked("Contact is blocked"));if(b.isBroadcast(i.to))var s=u(i);delete i.status,delete i.mimetype,delete i.height,delete i.width,delete i.recipients,delete i.chat,delete i.broadcast,delete i.ack,delete i.invis,delete i.filehash,delete i.recvFresh,N.isHttp(e.url)||delete i.url;for(var a in i)(null===i[a]||"undefined"==typeof i[a])&&delete i[a];i.id=n.id,e.isMMS&&(i.avparams=e.avParams()),"chat"!==i.type||"url"!==i.subtype||S.supportsFeature(S.F.URL)||delete i.subtype,R.msgCreateRecord(i,e.local).then(function(r){if(200===r.status){var i=n.remote,a=n.fromMe&&n.remote===Store.Conn.me?3:r.data?r.data.ack:1;e.updateAck(a),Store.Msg.lastReceivedKey[i]=o,Store.Msg.updateLastReceipt(i,r.t),b.isBroadcast(i)&&(s?s.forEach(function(e){var t=new w(Store.Conn.me,e.id,n.id),r=Store.Msg.get(t);r&&(r.ack=1,Store.Msg.lastReceivedKey[e]=t,Store.Msg.updateLastReceipt(e,r.t))}):y.log("model:msg:createRecord bclist server ack, no recipients")()),t("success")}})["catch"](function(e){throw t("dropped"),y.error("model:msg:createRecord dropped msg: "+i.id)(),e})})},resyncReceipts:function(){y.log("Msg:resyncReceipts")();var e=[];for(var t in Store.Msg.lastReceivedReceipt){var r,o=Store.Chat.get(t);if(r=o?S.gte([0,5])?o.getFirstMsgWithStatus():o.getFirstMsgFromMe():void 0){var n=r.id;n.t=Store.Msg.lastReceivedReceipt[t],e.push(n)}else y.error("Msg:resyncReceipts wid in lastReceivedReceipt, but no msg: "+t)()}return 0===e.length?g["default"].resolve():R.resyncReceipts(e).then(function(e){_.isArray(e)?(y.log("Msg:resyncReceipts success")(),e.forEach(function(e){Store.Msg.updateLastReceipt(e.id,e.t),e.acks.forEach(function(t){if(4===t.length){var r=t[1],o=r?Store.Conn.me:e.id,n=r?e.id:Store.Conn.me,i=new w(o,n,t[0],t[2]),s=Store.Msg.get(i);s&&s.updateAck(t[3])}else y.error("Msg:resyncReceipts invalid response: "+(0,m["default"])(t))()})})):y.error("Msg:resyncReceipts error",e)()})["catch"](T.LogoutDrop,T.EphemeralDrop,T.BrowserReplacedDrop,_.noop)["catch"](function(){throw y.error("Msg:resyncReceipts dropped")(),new Error("Msg:resyncReceipts dropped")})},updateLastReceipt:function(e,t){var r=this.lastReceivedReceipt[e];(!r||t>r)&&(this.lastReceivedReceipt[e]=t)},refreshMediaUrl:function(e){if(N.isEncryptedMedia(e.clientUrl))e.set({url:null,urlState:C.URL_STATE.REFRESHING}),setTimeout(function(){e.set({url:e.clientUrl,urlState:C.URL_STATE.URL})},0);else{if(this.refreshMediaPromises[e.id])return;this.refreshMediaPromises[e.id]=e,this._refreshMedia()}},_refreshMedia:_.debounce(function(){var e=_.where(this.refreshMediaPromises,{needsRefresh:!0});0!==e.length&&(e.forEach(function(e){e.set({url:null,urlState:C.URL_STATE.REFRESHING})}),s(_.clone(e)).bind(this)["finally"](function(){_.forEach(e,function(e){delete this.refreshMediaPromises[e.id]}.bind(this))})["catch"](function(t){_.forEach(e,function(e){e.urlState=C.URL_STATE.REFRESH_RETRY})}))},500),processMultipleMessages:function(e,t,r,o){var n=this,s=arguments;if(e){var a,d=this.pendingAdd[e];return a=d?d.then(function(){return i.apply(n,s)}):i.apply(n,s),a["finally"](function(){n.pendingAdd[e]===a&&(n.pendingAdd[e]=null)}),this.pendingAdd[e]=a}return i.apply(n,s)}});e.exports=new k},931:function(e,t,r){"use strict";var o=r(59),n=r(843),i=r(156),s=r(347),a=r(348),d=o.extend({props:{id:"id",t:"number"},children:{contact:i},initialize:function(){this.contact=Store.Contact.gadd({id:this.id}),this.listenTo(this.contact,"all",this._getEventBubblingHandler("contact"))},getCollection:function(){return this.collection}}),c=s.extend(a,{model:d,comparator:function(e,t){return i.Comparator(e.contact,t.contact)},isStateStale:function(e){var t=this.get(e);return t&&t.stale}}),l=o.extend(n,{Collection:"MsgInfo",props:{id:"msgKey",isPTT:"boolean",playedRemaining:{type:"number","default":0},readRemaining:{type:"number","default":0},deliveryRemaining:{type:"number","default":0}},collections:{played:c,read:c,delivery:c},derived:{settled:{deps:["isPTT","playedRemaining","readRemaining"],fn:function(){return this.isPTT?!this.playedRemaining:!this.readRemaining}}}});e.exports=l},932:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(1),a=r(21),d=r(60),c=r(343),l=r(771),u=r(931),p=r(14),h=r(35),m=c.extend({model:u,initialize:function(){c.prototype.initialize.call(this,{staleCollection:!0})},_initializeStaleCollection:function(){var e=this;this.listenTo(p,"change:stream",function(){p.stream===p.STREAM.DISCONNECTED&&e.forEach(function(e){e.settled||e.set("stale",!0)})})},_find:function(e){return e.isSentByMe?h.queryMsgInfo(e.id).then(function(t){return t.status>=400?(s.log("model:MsgInfo:findQuery error "+t.status)(),i["default"].reject(t.status)):(t.id=e.id,t.isPTT=e.type===l.TYPE.PTT,i["default"].resolve(t))}):i["default"].reject("message not sent by me")},update:function(e,t,r,o,n,i){var c,l,u=new d(t,r,e,n),p=this.get(u),h=a.isUser(u.remote);if(p)switch(o){case 4:if(c=p.played.get(n),c||(p.played.add({id:n,t:i}),p.playedRemaining-=1),h)break;case 3:if(l=p.read.filter(function(e){return e.id===n}),p.read.remove(l),3===o&&(p.read.add({id:n,t:i}),0===l.length&&(p.readRemaining-=1)),h)break;case 2:l=p.delivery.filter(function(e){return e.id===n}),p.delivery.remove(l),2===o&&(p.delivery.add({id:n,t:i}),0===l.length&&(p.deliveryRemaining-=1));break;default:s.error("model:MsgInfo:handle ack err: "+o,arguments)()}},handle:function(e){var t=this,r=e.shift();switch(r.cmd){case"ack":this.update(r.id,r.from,r.to,r.ack,r.participant,r.t);break;case"acks":r.id.forEach(function(e){t.update(e,r.from,r.to,r.ack,r.participant,r.t)})}}});e.exports=new m},933:function(e,t,r){"use strict";var o=r(1),n=r(343),i=r(844),s=r(15),a="global_mute",d=!0,c=!0,l=!0,u=n.extend({model:i,initialize:function(){n.prototype.initialize.call(this,{CachePolicy:{id:"mute",policy:n.CACHE_POLICY.LOAD,delay:1e3}})},initializeFromCache:function(){var e=s.getGlobalSounds();this.setGlobalSounds(e);var t=s.getGlobalNotifications();this.setGlobalNotifications(t);var r=s.getGlobalPreviews();this.setGlobalPreviews(r)},saveToCache:function(){if(Store.Conn.me){var e=this._config.CachePolicy.id;o.log("models:mute:cache-save: "+e)(),s.setCollection(e,[this.globalMute().toJSON()])}},globalMute:function(){var e=this.get(a);return e?e:this.add({
id:a})},getGlobalSounds:function(){return d},setGlobalSounds:function(e){d=e,s.setGlobalSounds(e)},getGlobalNotifications:function(){return c},setGlobalNotifications:function(e){c=e,s.setGlobalNotifications(e)},getGlobalPreviews:function(){return l},setGlobalPreviews:function(e){l=e,s.setGlobalPreviews(e)},handle:function(e){for(var t=0;t<e.length;t++){var r=e[t],o=Store.Chat.get(r.id);o&&"mute"===r.type&&o.mute.setMute(r.muteExpiration)}}});e.exports=new u},934:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(1),a=r(343),d=r(800),c=r(35),l=r(106),u=r(11),p=a.extend({model:d,initialize:function(){a.prototype.initialize.call(this,{staleCollection:!0}),this.listenTo(l,"change:phoneActive",this.onPresenceSubscribabilityChange)},_find:function(e){var t=this.gadd(e);return t.isUser?(t.isSubscribed=!0,c.presenceSubscribe(e)["catch"](function(e){return t.isSubscribed=!1,i["default"].reject(e)})["catch"](u.WapDrop,_.noop),c.lastseenFind(e).then(function(r){return 423===r.status?{id:e,stale:!0,hasData:!1}:401===r.status?(t.handle({id:e,deny:!0}),{id:e}):(r.id=e,t.handle(r),{id:e})})):i["default"].resolve({id:e})},handle:function(e){var t=e.shift();if(t.id===Store.Conn.me)"unavailable"===t.type?this.forEach(function(e){"unavailable"===e.type||e.stale||this.add({id:e.id,type:"unavailable",t:t.t,stale:!1},{merge:!0})}.bind(this)):s.log('models:presence:handle for self is not "unavailable" !')();else{var r=this.get(t.id);r&&("unsubscribe"===t.type?r.set({isSubscribed:!1,stale:!0}):(r.handle(t),r.stale=!1))}},onPresenceSubscribabilityChange:function(){l.phoneActive?Store.Chat.forEach(function(e){e.active&&e.presence.isUser&&e.presence.update()["catch"](u.WapDrop,_.noop)}):this.forEach(function(e){e.reset(),e.set({stale:!0,isSubscribed:!1})})}});e.exports=new p},935:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(1),a=r(343),d=r(352),c=r(15),l=r(35),u=r(11),p=r(21),h=r(350),m=r(106),f=r(14),g=a.extend({model:d,initialize:function(){a.prototype.initialize.call(this,{staleCollection:!0,CachePolicy:{id:"profile_pic_thumb",trigger:"change:tag change:raw",policy:a.CACHE_POLICY.LOAD,delay:5e3}}),this.listenTo(m,"change:phoneActive",function(){m.phoneActive&&this.onPhoneActive()})},get:function(e){var t=a.prototype.get.call(this,e);if(!_.isString(e))return t;var r=a.prototype.get.call(this,h(e));if(r){if(this.remove(r,{silent:!0}),t)return t;var o=r.toJSON();return o.id=e,this.add(o,{silent:!0})}return t?t:void 0},saveToCache:function(){if(Store.Conn.me){var e=this._config.CachePolicy.id,t=this.models.filter(function(e){return p.isWid(e.id)});t=t.map(function(e){return e=e.toJSON(),e.id=h(e.id),e}),s.log("models:profilePic:cache-save: "+e)(),c.setCollection(e,t)}},onPhoneActive:function(){if(f.stream===f.STREAM.CONNECTED){var e=[];this.forEach(function(t){t._uiObservers&&t.stale&&(t.tag||t.unset("tag",{silent:!0}),e.push(t.toJSON()))}),this.resyncPictures(e)}},onResume:function(){var e=this.filter(_.property("_uiObservers")).map(function(e){return e.tag||e.unset("tag",{silent:!0}),e.toJSON()});this.resyncPictures(e)},_find:function(e){var t=Store.Chat.get(e);return t&&t.isReadOnly?l.profilePicFindThumbFromPhone(e,this.get(e)):l.profilePicFind("ProfilePicThumb",e).then(function(t){return 401===t.status?{id:e,raw:void 0,tag:""}:423===t.status?{id:e,stale:!0}:t.status>=400?{id:e}:"undefined"==typeof t.status?{id:e,tag:t.tag,raw:void 0}:void 0})["catch"](u.WapDrop,function(){return{id:e,stale:!0}})},imageChanged:function(e,t){var r=Store.ProfilePicThumb.get(e);r&&("remove"===t?r.unset("tag"):r.tag!==t&&r.update()["catch"](u.WapDrop,_.noop))},resyncPictures:function(e){return 0===e.length?i["default"].resolve():l.resyncPictures(e).then(function(e){if(423===e.status)s.warn("ProfilePicThumbStore:resyncPictures blocked")();else{if(e.status>=400)throw s.error("ProfilePicThumbStore:resyncPictures error")(),new Error("ProfilePicThumbStore:resyncPictures error");if(!_.isArray(e))throw s.error("ProfilePicThumbStore:resyncPictures unknown reply",e)(),new Error("ProfilePicThumbStore:resyncPictures unknown reply");s.log("ProfilePicThumbStore:resyncPictures success")(),e.forEach(function(e){var t=Store.ProfilePicThumb.get(e.id);t&&t.set({tag:e.tag,raw:void 0,stale:!1})})}})["catch"](u.WapDrop,_.noop)["catch"](function(e){throw s.error("ProfilePicThumbStore:resyncPictures dropped: "+e)(),new Error("ProfilePicThumbStore:resyncPictures dropped: "+e)})}});e.exports=new g},936:function(e,t,r){"use strict";function o(e){return"number"==typeof e&&e>0?e-1:s.MAX_GROUP_SIZE}function n(e){return"number"==typeof e&&e>0?1024*e*1024:s.MAX_MEDIA_UPLOAD_SIZE}function i(e){var t;for(t in c)if("undefined"!=typeof e[t]){var r,o,n=c[t];_.isArray(n)?(r=n[0],o=n[1](e[t])):(r=n,o=e[t]),s[r]=o}for(t in d.F)"undefined"!=typeof e[t]&&d.setFeature(t,!!e[t])}var s=r(8),a=r(35),d=r(80),c={imageMaxEdge:"IMG_MAX_EDGE",maxParticipants:["MAX_GROUP_SIZE",o],maxSubject:"MAX_SUBJECT_LENGTH",media:["MAX_MEDIA_UPLOAD_SIZE",n]},l={handle:function(e){var t=e.shift();"number"==typeof t.status&&t.status>=400||i(t)},fetch:function(){return a.queryServerProps().then(function(e){"number"==typeof e.status&&e.status>=400||i(e)})}};e.exports=l},937:function(e,t,r){"use strict";var o=r(59),n=o.extend({idAttribute:"char",props:{"char":"string",weight:"number"}});e.exports=n},938:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(8),a=r(1),d=r(343),c=r(937),l=r(35),u=r(11),p=r(782),h=r(80),m=d.extend({model:c,comparator:function(e,t){return e.weight>t.weight?-1:1},initialize:function(){d.prototype.initialize.call(this,{CachePolicy:{id:"recent_emoji_collection",policy:d.CACHE_POLICY.LOAD,delay:2e3}}),this.listenTo(this,"change:weight change:length",this.sortTrimScale),this.dirty=!1,this.syncDue=!1},"delete":function(){d.prototype["delete"].call(this),this.dirty=!1,this.syncDue=!1},_findQuery:function(e){return h.supportsFeature(h.F.RECENT_EMOJI_SYNC)?l.recentEmojiQuery(e?this.toArray():void 0).then(function(e){return _.isArray(e)?(e.forEach(function(e){e["char"]=p.normalizeEmoji(e["char"])}),i["default"].resolve(e)):(a.error("models:recentEmoji:findQuery error",e)(),i["default"].reject("recent emoji fetch error"))}):i["default"].reject("gk recent emoji sync unsupported")},sync:function(){var e=this;return this.findQuery(this.dirty)["finally"](function(){e.dirty=!1})["catch"](u.WapDrop,_.noop)},_sync:_.throttle(function(e,t){e.sync()["finally"](t)},s.EMOJI_SYNC_DELAY,{leading:!1}),periodicSync:function(){h.supportsFeature(h.F.RECENT_EMOJI_SYNC)&&(a.log("models:recentEmoji:periodicSync due:"+this.syncDue+" dirty: "+this.dirty)(),this.syncDue=!0,this._sync(this,function(){this.syncDue=!1}.bind(this)))},sortTrimScale:function(){var e=this.length;e&&(this.sort(),e>30&&this.remove(this.models.slice(30)),_.first(this.models).weight<10&&_.last(this.models).weight>.01||this.forEach(function(t,r){t.weight=1+3*((e-r)/e)}))},increment:function(e){this.forEach(function(t){t["char"]===e?t.weight+=1:t.weight*=.9,t.weight=Math.round(1e3*t.weight)/1e3}),this.get(e)||this.add({"char":e,weight:1}),this.dirty=!0,this.periodicSync()}});e.exports=new m},939:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(6),a=r(1),d=r(343),c=r(349),l=r(35),u=r(11),p=r(106),h=r(14),m=r(9),f=r(80),g=r(159),v=d.extend({model:c,initialize:function(){d.prototype.initialize.call(this,{staleCollection:!0}),this.listenTo(p,"change:phoneActive",function(){p.phoneActive&&this.onPhoneActive()})},onPhoneActive:function(){h.stream===h.STREAM.CONNECTED&&this.onResume()},onResume:function(){this.filter(_.property("_uiObservers")).forEach(function(e){Store.Status.find(e.id)["catch"](u.WapDrop,_.noop)})},_find:function(e){return l.statusFind(e).then(function(t){return _.isNumber(t.status)?423===t.status?{id:e,stale:!0,status:""}:t.status>=400?{id:e,status:""}:void 0:{id:e,status:t.status}})["catch"](u.WapDrop,function(){return{id:e,stale:!0,status:""}})},_handle:function(e){return e},canSetMyStatus:function(){return f.supportsFeature(f.F.SET_STATUS)},setMyStatus:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];if(e=e.trim(),!e)return i["default"].reject(new u.ActionError);if(!this.canSetMyStatus())return i["default"].reject(new u.ActionError);var t=l.sendSetStatus(e),r=l10n.t("action_status_setting"),o=t.then(function(e){return 200===e.status?l10n.t("action_status_set"):e.status>=400?l10n.t("action_status_set_failed"):void 0})["catch"](function(e){throw a.error("models:statusCollection:setMyStatus dropped")(e),l10n.t("action_status_set_failed")});return m.openToast(s.createElement(g,{id:g.genId(),pendingText:r,actionText:o,retry:this.setMyStatus.bind(this,e)})),t.bind(this).then(function(t){200!==t.status||t._duplicate||(this.get(Store.Conn.me).status=e)})}});e.exports=new v},940:function(e,t,r){"use strict";var o=r(6),n=r(771),i=r(773),s=o.createClass({displayName:"MultiselectFooter",propTypes:{chat:o.PropTypes.instanceOf(i).isRequired,selectedMessages:o.PropTypes.arrayOf(o.PropTypes.instanceOf(n)).isRequired,onForward:o.PropTypes.func,onDelete:o.PropTypes.func,onCancel:o.PropTypes.func.isRequired},render:function(){var e,t=_.size(this.props.selectedMessages),r=l10n.t("selected_count",{count:t}),n=l10n.t("forward_message",{count:t,_plural:t}),i=l10n.t("delete_message",{count:t,_plural:t}),s=0===t?o.createElement("button",{className:"btn-icon btn-forward",disabled:"disabled",title:n},o.createElement("span",{className:"icon icon-forward"})):o.createElement("button",{className:"btn-icon btn-forward",title:n,onClick:this.props.onForward},o.createElement("span",{className:"icon icon-forward"}));return this.props.chat.canSendDeleteMsg()&&(e=0===t?o.createElement("button",{className:"btn-icon btn-delete",title:i,disabled:"disabled"},o.createElement("span",{className:"icon icon-delete"})):o.createElement("button",{className:"btn-icon btn-delete",title:i,onClick:this.props.onDelete},o.createElement("span",{className:"icon icon-delete"}))),o.createElement("div",{className:"multi-controls"},o.createElement("button",{className:"btn-icon btn-cancel",onClick:this.props.onCancel},o.createElement("span",{className:"icon icon-x"})),o.createElement("span",{className:"multi-count"},r),e,s)}});e.exports=s},941:function(e,t){"use strict";e.exports={Action:"keyboard_action",Event:"keyboard_event",Events:{LOGGED_IN:"logged_in",LOGGED_OUT:"logged_out",UNARCHIVED:"unarchived",ARCHIVED:"archived",MUTED:"muted",UNMUTED:"umuted"},Actions:{NEW_CHAT:"new_chat",NEW_GROUP:"new_group",PROFILE_STATUS:"profile_status",LOGOUT:"logout",SEARCH:"search"}}},942:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(6),a=r(8),d=r(1),c=r(9),l=r(79),u=r(103),p=r(104),h=r(782),m=r(41),f=r(21),g=r(106),v=r(11),y=r(802),E=r(153),T=r(951),b=[],S=s.createClass({displayName:"NotificationManager",mixins:[l,u,p],componentWillMount:function(){this.tone=new Audio(a.NOTIFICATION_TONE_PATH),this.regCmd("alert_new_msg",this.alertNewMsg),this.regCmd("alert_call",this.showCallNotification),this.regCmd("cancel_call",this.cancelCallNotification),this.addObserver(Store.Chat,"add remove reset change:unreadCount",this.updateUnreadCount),this.addObserver(g,"change:displayInfo",this.updateUnreadCount)},componentDidMount:function(){this.updateUnreadCount()},componentWillUnmount:function(){for(T.setTitleAndIcon(0);b.length;){var e=b.shift();e&&e.close&&e.close()}},updateUnreadCount:function(){var e;e=g.displayInfo===g.INFO.OFFLINE?-1:g.displayInfo===g.INFO.TIMEOUT?-1:Store.Chat.filter(function(e){return!e.archive&&e.isDirty()}).length,this.count!==e&&(this.count=e,T.setTitleAndIcon(e))},alertNewMsg:function(e){var t=e.get("chat");if((!document.hasFocus()||!t.get("active"))&&!Store.Mute.globalMute().isMuted&&!t.mute.isMuted&&(Store.Mute.getGlobalNotifications()&&this.showDesktopNotification(e),Store.Mute.getGlobalSounds()))if(t.isGroup){var r=Date.now(),o=t.squelch||0;r>o&&(this.playAudioNotification(),Store.GroupMetadata.find(t.id).then(function(e){var o=e.participants.length,n=1e3*Math.min(120,30+5*o);t.squelch=r+n})["catch"](v.WapDrop,function(){t.squelch=r+6e4}))}else this.playAudioNotification()},showCallNotification:function(e,t){if(window.Notification&&window.Notification.permission===a.PERMISSION_ALLOWED){var r=Store.Contact.get(t),o=r?r.get("formattedName"):f.formattedUser(t),n=l10n.t("incoming_call_notification_title",{name:o}),s=l10n.t("incoming_call_notification_text"),d=this;Store.ProfilePicThumb.find(t).timeout(1e3,"showCallNotificationTimeout").then(function(r){var o=r&&r.get("img")?r.get("img"):a.USER_DEFAULT_ICON;d._showDesktopNotification(t,e,n,s,o,!0)})["catch"](v.WapDrop,i["default"].TimeoutError,function(r){d._showDesktopNotification(t,e,n,s,a.USER_DEFAULT_ICON,!0)}),Store.Mute.getGlobalSounds()&&this.playAudioNotification()}},cancelCallNotification:function(e){var t=_.find(b,"tag",e);t&&t.close(),Store.Call.remove(Store.Call.get(e))},showDesktopNotification:function(e){if(window.Notification&&window.Notification.permission===a.PERMISSION_ALLOWED){var t,r=e.get("chat"),o=r.get("id");if(Store.Mute.getGlobalPreviews())t=y.asDesktopNotification(e);else{var n=e.displayName();t=r.isGroup?n?l10n.t("hidden_group_message_text_with_author",{author:n}):l10n.t("hidden_group_message_text"):l10n.t("hidden_message_text",{unreadCount:l10n.n(r.unreadCount),_plural:r.unreadCount})}/^[\x00-\xFF]/.test(t)||(t=" "+t);var s=l10n.isRTL()?t+" - "+E.relativeStr(e.t)+"":t+" - "+E.relativeStr(e.t)+"",d=e.get("id"),c=r.isGroup?a.GROUP_DEFAULT_ICON:a.USER_DEFAULT_ICON,l=r.isGroup?l10n.t("default_group_message_notification_title"):l10n.t("default_contact_message_notification_title"),u=this;Store.ProfilePicThumb.find(o).timeout(1500,"showDesktopNotificationTimeout").then(function(e){var t=r.get("contact").get("formattedName")||l,n=e?e.get("img"):"";u._showDesktopNotification(o,d,t,s,n||c)})["catch"](v.WapDrop,i["default"].TimeoutError,function(e){var t=r.get("contact").get("formattedName")||l;u._showDesktopNotification(o,d,t,s,c)})}},_showDesktopNotification:function(e,t,r,o,n,i){function s(){l&&l.close&&l.close()}var l;try{l=new window.Notification(h.normalizeEmoji(r),{body:h.normalizeEmoji(o),tag:i?t:e,icon:m.relToAbs(n),dir:"auto",lang:l10n.lng()})}catch(u){window.Notification=void 0}return l?(b.push(l),l.onclick=function(){i||(window.focus(),c.openChat(Store.Chat.get(e),void 0,!0)),s()},l.onclose=function(){window.removeEventListener("unload",s),b=_.without(b,l)},l.onshow=function(){_.delay(s,i?a.CALL_NOTIFICATION_TIMEOUT:a.NOTIFICATION_TIMEOUT)},_.delay(s,i?a.CALL_NOTIFICATION_TIMEOUT:5*a.NOTIFICATION_TIMEOUT),void window.addEventListener("unload",s)):void d.log("notificationManager:showDesktopNotification: could not create Notification")()},playAudioNotification:function(){this.tone.play()},render:function(){return null}});e.exports=S},943:function(e,t,r){"use strict";var o=r(6),n=r(79),i=r(105),s=r(780),a=r(45),d=3,c=o.createClass({displayName:"ToastManager",mixins:[n],componentWillMount:function(){this.regCmd("open_toast",this.openToast),this.regCmd("close_toast",this.closeToast),this.regCmd("error_2412",this.onError2412),this.regCmd("window_error",this.onWindowError)},getInitialState:function(){return{toasts:{}}},openToast:function(e,t){var r;(r=this.refs[e.props.id])?r.restartDelay():(this.state.toasts[e.props.id]=e,this.setState({toasts:this.state.toasts}))},closeToast:function(e){var t=this.state.toasts;t[e.props.id]&&this.setState({toasts:_.omit(t,e.props.id)})},componentWillUpdate:function(e,t){this.animateEnter=_.size(this.state.toasts)>_.size(t.toasts)},onError2412:function(e){this.openToast(o.createElement(s,{msg:e,id:s.genId()}))},onWindowError:function(e){this.openToast(o.createElement(s,{msg:e,id:s.genId()}))},render:function(){var e=this.animateEnter,t=_.chain(this.state.toasts).sortBy("id").reverse().map(function(t,r){var n=d>r?"slide"+r:"slide"+d;return 0!==r||e||(n=""),o.cloneElement(t,{key:t.props.id,ref:t.props.id,className:n})}).value(),r=a.isTrident?"fade_sifo":"toast-transition";return o.createElement(i,{transitionName:r},t)}});e.exports=c},944:function(e,t,r){"use strict";function o(){if(!i){var e=r(962),t=e.length/2;i=new Int32Array(t),s=new Int32Array(t);for(var o=0,n=0;t>o;o++,n+=2)i[o]=e[n]+(0===o?0:i[o-1]),s[o]=e[n+1]}}function n(e){o();for(var t=0;t<e.length;t++){var r=0|e.charCodeAt(t);if(r>=55296&&56320>r&&(r=((1023&r)<<10|1023&e.charCodeAt(++t))+65536),!(r<i[0])){for(var n=0|i.length,a=0,d=n-1|0;d>a;){var c=d+a>>1;if(i[c]>r)d=c-1|0;else{if(i[c+1]>r){d=c;break}a=c+1|0}}var l=s[d],u=i[d]+Math.abs(l)|0;if(u>r)return 0>l?"rtl":"ltr"}}}var i,s;e.exports={dir:n}},945:function(e,t,r){"use strict";function o(e){return CryptoJS.lib.WordArray.create(new Uint8Array(e))}var n=r(7),i=r(11),s=r(353),a=r(163),d=r(1),c=r(847),l=r(21),u={decryptE2EImage:function(e,t){try{if(!t)throw new i.MediaEncryptionError("no media key: "+t);if(e.length<10)throw new i.MediaEncryptionError("ciphertext too short: "+e.length);var r=s.extractAndExpand(a.decode(t),void 0,"WhatsApp Image Keys",112,!0);if(!r||r.length<112)throw new i.MediaEncryptionError("hkdf error");var d=r.slice(0,16),c=r.slice(16,48),l=r.slice(48,80),u=n.wrap(e),p=u.slice(u.limit-10).toBase64(),h=u.slice(u.offset,u.limit-10).toBuffer(),m=n.concat([new Uint8Array(d),h]).toBuffer(),f=CryptoJS.lib.WordArray.create(m),g=CryptoJS.HmacSHA256(f,o(l)).toString(CryptoJS.enc.Base64),v=n.fromBase64(g).slice(0,10).toBase64();if(!v||!p||v!==p)throw new i.MediaEncryptionError("hmac fail computed: "+g+" given: "+p);var y=CryptoJS.AES.decrypt({ciphertext:CryptoJS.lib.WordArray.create(h),salt:void 0},o(c),{iv:o(d),mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),E=n.fromBase64(y.toString(CryptoJS.enc.Base64)).toBuffer(),_=new Blob([E],{type:"image/jpeg"});return _}catch(T){throw T instanceof i.MediaEncryptionError?T:new i.MediaEncryptionError("unknown error: "+T.stack)}},ackE2EImage:function(e,t){if(e&&t){var r=l.userToLegacy(Store.Conn.me),o=n.fromUTF8(r).toBuffer(),i=CryptoJS.lib.WordArray.create(o),s=CryptoJS.lib.WordArray.create(a.decode(e)),u=CryptoJS.HmacSHA256(i,s);u.sigBytes=20,u.clamp();var p=a.urlSafe(u.toString(CryptoJS.enc.Base64)),h=t+"?ack="+p;d.log("crypto:ack:"+h)(),c.postRetry(h)}}};e.exports=u},946:function(e,t){"use strict";e.exports={"Smileys & People":["ordered1359","ordered1403","ordered1360","ordered1361","ordered1362","ordered1363","ordered1364","ordered1365","ordered1366","ordered1368","ordered1369","ordered1425","ordered1426","ordered0078","ordered1370","ordered1371","ordered1372","ordered1383","ordered1382","ordered1384","ordered1385","ordered1387","ordered1388","ordered1386","ordered1592","ordered1594","ordered1373","ordered1598","ordered1374","ordered1413","ordered1375","ordered1376","ordered1377","ordered1427","ordered1595","ordered1410","ordered1389","ordered1390","ordered1391","ordered1392","ordered1379","ordered1380","ordered1424","ordered0077","ordered1394","ordered1381","ordered1402","ordered1400","ordered1395","ordered1405","ordered1408","ordered1399","ordered1407","ordered1406","ordered1397","ordered1398","ordered1393","ordered1396","ordered1401","ordered1378","ordered1404","ordered1412","ordered1409","ordered1591","ordered1414","ordered1593","ordered1596","ordered1411","ordered1114","ordered1119","ordered1367","ordered1043","ordered1032","ordered1033","ordered1044","ordered1034","ordered1041","ordered1597","ordered1417","ordered1415","ordered1416","ordered1418","ordered1419","ordered1420","ordered1423","ordered1422","ordered1421","ordered1455","ordered0896","ordered0872","ordered0884","ordered0890","ordered0866","ordered0144","ordered0156","ordered0878","ordered0150","ordered0902","ordered1120","ordered1473","ordered0063","ordered0842","ordered0848","ordered0854","ordered0860","ordered1322","ordered1316","ordered1599","ordered1328","ordered0162","ordered1064","ordered0840","ordered0841","ordered0828","ordered0834","ordered0826","ordered0825","ordered0927","ordered0928","ordered1349","ordered1014","ordered0929","ordered0935","ordered0941","ordered0947","ordered0984","ordered1002","ordered1008","ordered0990","ordered0996","ordered0971","ordered1020","ordered1051","ordered1306","ordered0616","ordered1035","ordered1026","ordered0978","ordered1548","ordered0678","ordered1057","ordered0977","ordered0968","ordered0969","ordered0970","ordered1440","ordered1045","ordered1428","ordered1434","ordered1449","ordered1467","ordered1461","ordered1076","ordered1070","ordered1093","ordered1095","ordered1094","ordered1089","ordered1091","ordered1090","ordered0953","ordered0960","ordered0961","ordered0959","ordered0962","ordered0963","ordered0965","ordered0966","ordered0964","ordered0967","ordered0954","ordered0956","ordered0957","ordered0955","ordered0958","ordered0917","ordered0912","ordered0913","ordered0911","ordered0914","ordered0916","ordered0915","ordered1063","ordered1085","ordered0926","ordered0923","ordered0924","ordered0925","ordered0921","ordered0922","ordered0909","ordered0652","ordered0635","ordered0908","ordered0119","ordered0634","ordered0920","ordered0918","ordered0919","ordered1143","ordered0910","ordered1307","ordered1087","ordered0487"],"Animals & Nature":["ordered0815","ordered0810","ordered0806","ordered0818","ordered0809","ordered0820","ordered0821","ordered0801","ordered0808","ordered1606","ordered0807","ordered0816","ordered0822","ordered0817","ordered0786","ordered0814","ordered1446","ordered1447","ordered1448","ordered0779","ordered0781","ordered0800","ordered0799","ordered0797","ordered0796","ordered0798","ordered0819","ordered0784","ordered0813","ordered1609","ordered0790","ordered0788","ordered0773","ordered0791","ordered0789","ordered1308","ordered1607","ordered1605","ordered0774","ordered0795","ordered0793","ordered0792","ordered0794","ordered0805","ordered0812","ordered0772","ordered0771","ordered0767","ordered0766","ordered0764","ordered0763","ordered0765","ordered0803","ordered0804","ordered0785","ordered0777","ordered0776","ordered0778","ordered0775","ordered0783","ordered0761","ordered0762","ordered0780","ordered1608","ordered1273","ordered0782","ordered0802","ordered0769","ordered0768","ordered0824","ordered0823","ordered0770","ordered0811","ordered0536","ordered0615","ordered0533","ordered0534","ordered0535","ordered0532","ordered0546","ordered0062","ordered0547","ordered0629","ordered0627","ordered0550","ordered0549","ordered0548","ordered0545","ordered0541","ordered0542","ordered0540","ordered0538","ordered0543","ordered0539","ordered1092","ordered0551","ordered0531","ordered0614","ordered0787","ordered1309","ordered0499","ordered0498","ordered0500","ordered0506","ordered0507","ordered0508","ordered0509","ordered0502","ordered0503","ordered0504","ordered0505","ordered0511","ordered0514","ordered0512","ordered0513","ordered0515","ordered0510","ordered0200","ordered0516","ordered1126","ordered0174","ordered0057","ordered0053","ordered0519","ordered0115","ordered0520","ordered0521","ordered0054","ordered0522","ordered0116","ordered0524","ordered0107","ordered1247","ordered1115","ordered0177","ordered0523","ordered0056","ordered0114","ordered0527","ordered1118","ordered0525","ordered0526","ordered0055","ordered0060","ordered1117","ordered1116","ordered0495"],"Food & Drink":["ordered0562","ordered0561","ordered0563","ordered0557","ordered0558","ordered0559","ordered0556","ordered0554","ordered0566","ordered0555","ordered0565","ordered0564","ordered0560","ordered0552","ordered0553","ordered0537","ordered0544","ordered0579","ordered0594","ordered0577","ordered1610","ordered0570","ordered0569","ordered0583","ordered0598","ordered0567","ordered0578","ordered0528","ordered0568","ordered0576","ordered0529","ordered0530","ordered0575","ordered0597","ordered0584","ordered0582","ordered0596","ordered0574","ordered0572","ordered0573","ordered0571","ordered0581","ordered0580","ordered0586","ordered0587","ordered0585","ordered0595","ordered0613","ordered0593","ordered0591","ordered0592","ordered0590","ordered0610","ordered0588","ordered0589","ordered0605","ordered0606","ordered0602","ordered0603","ordered0604","ordered0609","ordered0601","ordered0600","ordered0061","ordered0607","ordered0599","ordered0608"],Activity:["ordered0112","ordered0675","ordered0698","ordered0113","ordered0673","ordered0716","ordered0699","ordered0660","ordered0127","ordered0712","ordered0719","ordered0753","ordered0718","ordered0717","ordered0715","ordered0674","ordered0130","ordered0677","ordered0131","ordered0754","ordered0646","ordered1514","ordered0700","ordered0684","ordered1563","ordered0132","ordered0706","ordered1536","ordered1542","ordered0692","ordered1305","ordered0691","ordered0672","ordered0690","ordered0636","ordered0637","ordered0751","ordered0654","ordered0642","ordered0656","ordered0651","ordered0653","ordered0647","ordered0650","ordered0671","ordered0668","ordered0666","ordered0669","ordered0667","ordered0670","ordered0655","ordered0657","ordered1042","ordered0658","ordered0661","ordered0659","ordered0662"],"Travel & Places":["ordered1502","ordered1500","ordered1504","ordered1491","ordered1493","ordered0714","ordered1498","ordered1496","ordered1497","ordered1495","ordered1505","ordered1506","ordered1507","ordered0713","ordered1534","ordered1524","ordered1499","ordered1492","ordered1503","ordered1501","ordered1512","ordered1511","ordered1510","ordered1482","ordered1490","ordered1508","ordered1483","ordered1484","ordered1487","ordered1509","ordered1481","ordered1485","ordered1486","ordered1489","ordered1488","ordered1480","ordered1586","ordered0142","ordered1587","ordered1588","ordered0129","ordered1585","ordered1520","ordered0128","ordered1590","ordered1479","ordered1589","ordered1141","ordered0099","ordered1523","ordered0139","ordered1494","ordered1522","ordered1521","ordered0676","ordered1513","ordered0644","ordered0645","ordered0643","ordered0723","ordered0486","ordered1355","ordered0745","ordered0126","ordered0633","ordered0124","ordered0720","ordered1354","ordered0496","ordered1357","ordered0721","ordered0138","ordered0730","ordered1583","ordered1584","ordered0490","ordered0489","ordered0728","ordered0722","ordered0729","ordered0492","ordered0491","ordered0725","ordered0488","ordered0494","ordered0497","ordered0517","ordered0623","ordered0622","ordered0493","ordered0724","ordered0748","ordered0747","ordered0731","ordered1356","ordered0732","ordered0733","ordered0726","ordered0734","ordered0744","ordered0735","ordered0736","ordered0737","ordered0738","ordered0740","ordered0742","ordered0743","ordered0741","ordered1096","ordered0727","ordered0123","ordered1275","ordered1276","ordered1274","ordered0122"],Objects:["ordered0027","ordered1196","ordered1197","ordered1142","ordered0029","ordered1334","ordered1335","ordered1336","ordered1337","ordered1310","ordered1345","ordered1144","ordered1145","ordered1146","ordered1147","ordered1207","ordered1202","ordered1203","ordered1204","ordered0648","ordered1208","ordered0641","ordered1177","ordered0058","ordered1178","ordered1179","ordered1205","ordered1206","ordered0638","ordered0639","ordered0640","ordered0038","ordered0039","ordered0037","ordered1303","ordered0040","ordered0028","ordered1180","ordered1221","ordered1222","ordered1111","ordered1248","ordered1302","ordered1342","ordered1582","ordered1139","ordered1136","ordered1135","ordered1137","ordered1138","ordered1131","ordered1134","ordered1088","ordered0101","ordered1249","ordered1250","ordered0098","ordered1580","ordered0118","ordered1251","ordered0103","ordered0120","ordered1253","ordered1113","ordered1252","ordered1348","ordered0100","ordered1581","ordered1528","ordered0069","ordered0110","ordered0111","ordered0755","ordered1256","ordered1209","ordered1082","ordered0102","ordered1255","ordered1254","ordered1304","ordered1084","ordered1083","ordered0518","ordered0752","ordered1232","ordered1560","ordered1562","ordered1569","ordered1227","ordered1346","ordered1574","ordered1575","ordered1578","ordered1526","ordered1577","ordered1338","ordered1353","ordered0125","ordered1358","ordered1576","ordered0624","ordered0631","ordered0611","ordered0612","ordered0626","ordered0625","ordered0630","ordered0632","ordered0628","ordered0746","ordered0143","ordered1188","ordered1187","ordered1186","ordered1086","ordered1193","ordered1189","ordered1190","ordered1191","ordered1192","ordered1185","ordered1194","ordered1184","ordered1183","ordered1175","ordered1150","ordered1164","ordered1157","ordered1155","ordered1156","ordered1151","ordered1152","ordered1153","ordered1344","ordered1154","ordered1340","ordered1352","ordered1341","ordered1158","ordered1343","ordered1148","ordered1149","ordered1339","ordered1347","ordered1195","ordered1166","ordered1168","ordered1170","ordered1171","ordered1172","ordered1167","ordered1165","ordered1173","ordered1169","ordered1233","ordered1161","ordered1311","ordered0140","ordered1163","ordered1162","ordered1159","ordered1160","ordered1525","ordered0749","ordered0750","ordered1226","ordered1228","ordered1229","ordered1225","ordered1312","ordered1313","ordered0169","ordered1176","ordered0168","ordered1315","ordered1314","ordered1223","ordered1224"],Symbols:["ordered0186","ordered1105","ordered1104","ordered1103","ordered1106","ordered1098","ordered0185","ordered1099","ordered1108","ordered1097","ordered1101","ordered1100","ordered1102","ordered1107","ordered1109","ordered0074","ordered0172","ordered0073","ordered1272","ordered0076","ordered0173","ordered1257","ordered1277","ordered0075","ordered0072","ordered1579","ordered0117","ordered0079","ordered0080","ordered0081","ordered0082","ordered0083","ordered0084","ordered0085","ordered0086","ordered0087","ordered0088","ordered0089","ordered0090","ordered0216","ordered0104","ordered0475","ordered0481","ordered0070","ordered0071","ordered1199","ordered1198","ordered0478","ordered0472","ordered0480","ordered0482","ordered0479","ordered0176","ordered0222","ordered0484","ordered1129","ordered0483","ordered0205","ordered0204","ordered0476","ordered0477","ordered0474","ordered0208","ordered0209","ordered0212","ordered0213","ordered0210","ordered0220","ordered0121","ordered1174","ordered1527","ordered0179","ordered0201","ordered1112","ordered0095","ordered1554","ordered1531","ordered1535","ordered1533","ordered1240","ordered1200","ordered0184","ordered0183","ordered0181","ordered0182","ordered0015","ordered0016","ordered1130","ordered1215","ordered1216","ordered1259","ordered0105","ordered0203","ordered0106","ordered1555","ordered1258","ordered0096","ordered0473","ordered1140","ordered0178","ordered0175","ordered0180","ordered0141","ordered1110","ordered0485","ordered0192","ordered0501","ordered0044","ordered0739","ordered0471","ordered1570","ordered1571","ordered1572","ordered1573","ordered0097","ordered1529","ordered1561","ordered0211","ordered1532","ordered1556","ordered1557","ordered1559","ordered1558","ordered1530","ordered0649","ordered1201","ordered0470","ordered0218","ordered0219","ordered0221","ordered0214","ordered0217","ordered0215","ordered0003","ordered0004","ordered0005","ordered0006","ordered0007","ordered0008","ordered0009","ordered0010","ordered0011","ordered0012","ordered1241","ordered1244","ordered0047","ordered0041","ordered0036","ordered0042","ordered0043","ordered0034","ordered0035","ordered0030","ordered0031","ordered1210","ordered1211","ordered1212","ordered0048","ordered1270","ordered1271","ordered0032","ordered0033","ordered0190","ordered0195","ordered0196","ordered0197","ordered0022","ordered0023","ordered0024","ordered0021","ordered0020","ordered0019","ordered1214","ordered0026","ordered0025","ordered0193","ordered0194","ordered0001","ordered0002","ordered0018","ordered1246","ordered1243","ordered1242","ordered1245","ordered0664","ordered0665","ordered0202","ordered0191","ordered0170","ordered1213","ordered0187","ordered0188","ordered0189","ordered0171","ordered1133","ordered1132","ordered0013","ordered0014","ordered0017","ordered1236","ordered1235","ordered1237","ordered1239","ordered1238","ordered0059","ordered1234","ordered0108","ordered0109","ordered1262","ordered1263","ordered1266","ordered1267","ordered1264","ordered1265","ordered1268","ordered0045","ordered0046","ordered0198","ordered0199","ordered1269","ordered0050","ordered0049","ordered0052","ordered0051","ordered1260","ordered1261","ordered1218","ordered1219","ordered1220","ordered1217","ordered1182","ordered1181","ordered1230","ordered1231","ordered0207","ordered0206","ordered0091","ordered0092","ordered0093","ordered0094","ordered0663","ordered0827","ordered1128","ordered1351","ordered1127","ordered1278","ordered1279","ordered1280","ordered1281","ordered1282","ordered1283","ordered1284","ordered1285","ordered1286","ordered1287","ordered1288","ordered1289","ordered1290","ordered1291","ordered1292","ordered1293","ordered1294","ordered1295","ordered1296","ordered1297","ordered1298","ordered1299","ordered1300","ordered1301"],
Flags:["ordered0225","ordered0237","ordered0228","ordered0283","ordered0233","ordered0223","ordered0230","ordered0227","ordered0231","ordered0226","ordered0232","ordered0229","ordered0236","ordered0235","ordered0234","ordered0238","ordered0254","ordered0245","ordered0241","ordered0240","ordered0257","ordered0242","ordered0258","ordered0247","ordered0249","ordered0255","ordered0251","ordered0252","ordered0239","ordered0256","ordered0253","ordered0328","ordered0458","ordered0250","ordered0244","ordered0243","ordered0246","ordered0273","ordered0339","ordered0268","ordered0259","ordered0322","ordered0346","ordered0262","ordered0435","ordered0267","ordered0269","ordered0275","ordered0260","ordered0270","ordered0341","ordered0263","ordered0261","ordered0266","ordered0271","ordered0319","ordered0272","ordered0274","ordered0276","ordered0277","ordered0280","ordered0279","ordered0281","ordered0282","ordered0284","ordered0286","ordered0430","ordered0310","ordered0288","ordered0285","ordered0290","ordered0291","ordered0294","ordered0296","ordered0293","ordered0292","ordered0297","ordered0302","ordered0396","ordered0436","ordered0298","ordered0307","ordered0301","ordered0278","ordered0304","ordered0305","ordered0311","ordered0306","ordered0300","ordered0309","ordered0314","ordered0313","ordered0303","ordered0308","ordered0315","ordered0316","ordered0320","ordered0318","ordered0317","ordered0321","ordered0331","ordered0327","ordered0323","ordered0330","ordered0329","ordered0324","ordered0326","ordered0325","ordered0332","ordered0265","ordered0334","ordered0336","ordered0333","ordered0335","ordered0347","ordered0337","ordered0340","ordered0464","ordered0345","ordered0338","ordered0348","ordered0357","ordered0349","ordered0354","ordered0353","ordered0358","ordered0351","ordered0355","ordered0356","ordered0369","ordered0365","ordered0363","ordered0377","ordered0379","ordered0376","ordered0366","ordered0374","ordered0364","ordered0371","ordered0372","ordered0375","ordered0466","ordered0378","ordered0295","ordered0361","ordered0360","ordered0368","ordered0362","ordered0373","ordered0359","ordered0380","ordered0367","ordered0381","ordered0390","ordered0389","ordered0387","ordered0382","ordered0392","ordered0386","ordered0383","ordered0385","ordered0391","ordered0384","ordered0370","ordered0343","ordered0388","ordered0393","ordered0399","ordered0406","ordered0404","ordered0394","ordered0397","ordered0407","ordered0395","ordered0398","ordered0402","ordered0400","ordered0405","ordered0403","ordered0408","ordered0409","ordered0410","ordered0412","ordered0413","ordered0248","ordered0420","ordered0342","ordered0350","ordered0401","ordered0456","ordered0463","ordered0424","ordered0429","ordered0414","ordered0425","ordered0411","ordered0416","ordered0423","ordered0419","ordered0431","ordered0422","ordered0421","ordered0415","ordered0426","ordered0467","ordered0312","ordered0344","ordered0428","ordered0289","ordered0352","ordered0417","ordered0427","ordered0433","ordered0418","ordered0264","ordered0432","ordered0448","ordered0439","ordered0449","ordered0438","ordered0441","ordered0437","ordered0440","ordered0444","ordered0446","ordered0443","ordered0445","ordered0442","ordered0434","ordered0447","ordered0451","ordered0450","ordered0224","ordered0299","ordered0452","ordered0459","ordered0453","ordered0454","ordered0461","ordered0455","ordered0457","ordered0460","ordered0462","ordered0287","ordered0465","ordered0468","ordered0469"]}},947:function(e,t){"use strict";e.exports={"":"ordered0001","":"ordered0003","":"ordered0004","":"ordered0005","":"ordered0006","":"ordered0007","":"ordered0008","":"ordered0009","":"ordered0010","":"ordered0011","":"ordered0012","":"ordered0013","":"ordered0014","":"ordered0015","":"ordered0016","":"ordered0017","":"ordered0018","":"ordered0019","":"ordered0020","":"ordered0021","":"ordered0022","":"ordered0023","":"ordered0024","":"ordered0025","":"ordered0026","":"ordered0027","":"ordered0028","":"ordered0030","":"ordered0031","":"ordered0032","":"ordered0033","":"ordered0037","":"ordered0040","":"ordered0044","":"ordered0045","":"ordered0046","":"ordered0047","":"ordered0048","":"ordered0049","":"ordered0050","":"ordered0051","":"ordered0052","":"ordered0053","":"ordered0054","":"ordered0058","":"ordered0059","":"ordered0060","":"ordered0061","":"ordered0063","":"ordered0078","":"ordered0079","":"ordered0080","":"ordered0081","":"ordered0082","":"ordered0083","":"ordered0084","":"ordered0085","":"ordered0086","":"ordered0087","":"ordered0088","":"ordered0089","":"ordered0090","":"ordered0091","":"ordered0092","":"ordered0093","":"ordered0094","":"ordered0095","":"ordered0096","":"ordered0097","":"ordered0099","":"ordered0106","":"ordered0107","":"ordered0108","":"ordered0109","":"ordered0112","":"ordered0113","":"ordered0114","":"ordered0115","":"ordered0117","":"ordered0121","":"ordered0123","":"ordered0126","":"ordered0127","":"ordered0129","":"ordered0138","":"ordered0139","":"ordered0140","":"ordered0141","":"ordered0142","":"ordered0143","":"ordered0144","":"ordered0150","":"ordered0156","":"ordered0168","":"ordered0169","":"ordered0170","":"ordered0171","":"ordered0174","":"ordered0175","":"ordered0176","":"ordered0177","":"ordered0178","":"ordered0179","":"ordered0180","":"ordered0181","":"ordered0182","":"ordered0183","":"ordered0184","":"ordered0186","":"ordered0187","":"ordered0188","":"ordered0189","":"ordered0190","":"ordered0191","":"ordered0192","":"ordered0193","":"ordered0194","":"ordered0195","":"ordered0196","":"ordered0197","":"ordered0198","":"ordered0199","":"ordered0200","":"ordered0201","":"ordered0202","":"ordered0203","":"ordered0204","":"ordered0205","":"ordered0206","":"ordered0207","":"ordered0208","":"ordered0209","":"ordered0210","":"ordered0211","":"ordered0212","":"ordered0213","":"ordered0214","":"ordered0215","":"ordered0216","":"ordered0217","":"ordered0218","":"ordered0219","":"ordered0220","":"ordered0221","":"ordered0222","":"ordered0269","":"ordered0278","":"ordered0289","":"ordered0297","":"ordered0299","":"ordered0332","":"ordered0336","":"ordered0344","":"ordered0412","":"ordered0452","":"ordered0470","":"ordered0471","":"ordered0472","":"ordered0473","":"ordered0474","":"ordered0475","":"ordered0476","":"ordered0477","":"ordered0478","":"ordered0479","":"ordered0480","":"ordered0481","":"ordered0482","":"ordered0483","":"ordered0484","":"ordered0485","":"ordered0486","":"ordered0487","":"ordered0488","":"ordered0489","":"ordered0490","":"ordered0491","":"ordered0492","":"ordered0493","":"ordered0494","":"ordered0495","":"ordered0496","":"ordered0497","":"ordered0498","":"ordered0499","":"ordered0500","":"ordered0501","":"ordered0502","":"ordered0503","":"ordered0504","":"ordered0505","":"ordered0506","":"ordered0507","":"ordered0508","":"ordered0509","":"ordered0510","":"ordered0511","":"ordered0512","":"ordered0513","":"ordered0514","":"ordered0515","":"ordered0516","":"ordered0517","":"ordered0531","":"ordered0532","":"ordered0533","":"ordered0534","":"ordered0535","":"ordered0536","":"ordered0538","":"ordered0539","":"ordered0540","":"ordered0541","":"ordered0542","":"ordered0543","":"ordered0544","":"ordered0545","":"ordered0546","":"ordered0547","":"ordered0548","":"ordered0549","":"ordered0550","":"ordered0551","":"ordered0552","":"ordered0553","":"ordered0554","":"ordered0555","":"ordered0556","":"ordered0557","":"ordered0558","":"ordered0559","":"ordered0560","":"ordered0561","":"ordered0562","":"ordered0563","":"ordered0564","":"ordered0565","":"ordered0566","":"ordered0567","":"ordered0568","":"ordered0569","":"ordered0570","":"ordered0571","":"ordered0572","":"ordered0573","":"ordered0574","":"ordered0575","":"ordered0576","":"ordered0577","":"ordered0578","":"ordered0579","":"ordered0580","":"ordered0581","":"ordered0582","":"ordered0583","":"ordered0584","":"ordered0585","":"ordered0586","":"ordered0587","":"ordered0588","":"ordered0589","":"ordered0590","":"ordered0591","":"ordered0592","":"ordered0593","":"ordered0594","":"ordered0595","":"ordered0596","":"ordered0597","":"ordered0598","":"ordered0599","":"ordered0600","":"ordered0601","":"ordered0602","":"ordered0603","":"ordered0604","":"ordered0605","":"ordered0606","":"ordered0607","":"ordered0611","":"ordered0612","":"ordered0613","":"ordered0614","":"ordered0615","":"ordered0616","":"ordered0622","":"ordered0623","":"ordered0624","":"ordered0625","":"ordered0626","":"ordered0627","":"ordered0628","":"ordered0629","":"ordered0630","":"ordered0631","":"ordered0632","":"ordered0633","":"ordered0634","":"ordered0635","":"ordered0643","":"ordered0644","":"ordered0645","":"ordered0646","":"ordered0647","":"ordered0648","":"ordered0649","":"ordered0650","":"ordered0651","":"ordered0652","":"ordered0653","":"ordered0654","":"ordered0655","":"ordered0656","":"ordered0657","":"ordered0658","":"ordered0659","":"ordered0660","":"ordered0661","":"ordered0662","":"ordered0663","":"ordered0664","":"ordered0665","":"ordered0666","":"ordered0667","":"ordered0668","":"ordered0669","":"ordered0670","":"ordered0671","":"ordered0672","":"ordered0673","":"ordered0674","":"ordered0675","":"ordered0676","":"ordered0677","":"ordered0678","":"ordered0684","":"ordered0691","":"ordered0692","":"ordered0698","":"ordered0699","":"ordered0700","":"ordered0732","":"ordered0733","":"ordered0734","":"ordered0735","":"ordered0736","":"ordered0737","":"ordered0738","":"ordered0739","":"ordered0740","":"ordered0741","":"ordered0742","":"ordered0743","":"ordered0744","":"ordered0745","":"ordered0746","":"ordered0747","":"ordered0748","":"ordered0761","":"ordered0762","":"ordered0763","":"ordered0764","":"ordered0765","":"ordered0766","":"ordered0767","":"ordered0768","":"ordered0769","":"ordered0770","":"ordered0771","":"ordered0772","":"ordered0773","":"ordered0774","":"ordered0775","":"ordered0776","":"ordered0777","":"ordered0778","":"ordered0779","":"ordered0780","":"ordered0781","":"ordered0782","":"ordered0783","":"ordered0784","":"ordered0785","":"ordered0786","":"ordered0787","":"ordered0788","":"ordered0789","":"ordered0790","":"ordered0791","":"ordered0792","":"ordered0793","":"ordered0794","":"ordered0795","":"ordered0796","":"ordered0797","":"ordered0798","":"ordered0799","":"ordered0800","":"ordered0801","":"ordered0802","":"ordered0803","":"ordered0804","":"ordered0805","":"ordered0806","":"ordered0807","":"ordered0808","":"ordered0809","":"ordered0810","":"ordered0811","":"ordered0812","":"ordered0813","":"ordered0814","":"ordered0815","":"ordered0816","":"ordered0817","":"ordered0818","":"ordered0819","":"ordered0820","":"ordered0821","":"ordered0822","":"ordered0823","":"ordered0825","":"ordered0828","":"ordered0834","":"ordered0840","":"ordered0841","":"ordered0842","":"ordered0848","":"ordered0854","":"ordered0860","":"ordered0866","":"ordered0872","":"ordered0878","":"ordered0884","":"ordered0890","":"ordered0896","":"ordered0902","":"ordered0908","":"ordered0909","":"ordered0910","":"ordered0911","":"ordered0912","":"ordered0913","":"ordered0914","":"ordered0915","":"ordered0916","":"ordered0917","":"ordered0918","":"ordered0919","":"ordered0920","":"ordered0921","":"ordered0922","":"ordered0923","":"ordered0924","":"ordered0925","":"ordered0926","":"ordered0927","":"ordered0928","":"ordered0929","":"ordered0935","":"ordered0941","":"ordered0947","":"ordered0953","":"ordered0968","":"ordered0969","":"ordered0970","":"ordered0971","":"ordered0977","":"ordered0978","":"ordered0984","":"ordered0990","":"ordered0996","":"ordered1002","":"ordered1008","":"ordered1014","":"ordered1020","":"ordered1026","":"ordered1032","":"ordered1033","":"ordered1034","":"ordered1035","":"ordered1041","":"ordered1042","":"ordered1043","":"ordered1044","":"ordered1045","":"ordered1051","":"ordered1057","":"ordered1063","":"ordered1064","":"ordered1070","":"ordered1076","":"ordered1082","":"ordered1083","":"ordered1084","":"ordered1085","":"ordered1086","":"ordered1087","":"ordered1088","":"ordered1089","":"ordered1092","":"ordered1093","":"ordered1096","":"ordered1097","":"ordered1098","":"ordered1099","":"ordered1100","":"ordered1101","":"ordered1102","":"ordered1103","":"ordered1104","":"ordered1105","":"ordered1106","":"ordered1107","":"ordered1108","":"ordered1109","":"ordered1110","":"ordered1111","":"ordered1112","":"ordered1113","":"ordered1114","":"ordered1115","":"ordered1116","":"ordered1117","":"ordered1118","":"ordered1119","":"ordered1120","":"ordered1126","":"ordered1127","":"ordered1128","":"ordered1129","":"ordered1130","":"ordered1131","":"ordered1132","":"ordered1133","":"ordered1134","":"ordered1135","":"ordered1136","":"ordered1137","":"ordered1138","":"ordered1139","":"ordered1140","":"ordered1141","":"ordered1142","":"ordered1143","":"ordered1144","":"ordered1145","":"ordered1146","":"ordered1147","":"ordered1148","":"ordered1149","":"ordered1150","":"ordered1151","":"ordered1152","":"ordered1153","":"ordered1154","":"ordered1155","":"ordered1156","":"ordered1157","":"ordered1158","":"ordered1159","":"ordered1160","":"ordered1161","":"ordered1162","":"ordered1163","":"ordered1164","":"ordered1165","":"ordered1166","":"ordered1167","":"ordered1168","":"ordered1169","":"ordered1170","":"ordered1171","":"ordered1172","":"ordered1173","":"ordered1174","":"ordered1175","":"ordered1176","":"ordered1177","":"ordered1178","":"ordered1179","":"ordered1180","":"ordered1181","":"ordered1182","":"ordered1183","":"ordered1184","":"ordered1185","":"ordered1186","":"ordered1187","":"ordered1188","":"ordered1189","":"ordered1190","":"ordered1191","":"ordered1192","":"ordered1193","":"ordered1194","":"ordered1195","":"ordered1196","":"ordered1197","":"ordered1198","":"ordered1199","":"ordered1200","":"ordered1201","":"ordered1202","":"ordered1204","":"ordered1205","":"ordered1206","":"ordered1207","":"ordered1210","":"ordered1211","":"ordered1212","":"ordered1213","":"ordered1214","":"ordered1215","":"ordered1216","":"ordered1217","":"ordered1218","":"ordered1219","":"ordered1220","":"ordered1221","":"ordered1222","":"ordered1223","":"ordered1224","":"ordered1225","":"ordered1226","":"ordered1227","":"ordered1228","":"ordered1229","":"ordered1230","":"ordered1231","":"ordered1232","":"ordered1233","":"ordered1234","":"ordered1235","":"ordered1236","":"ordered1237","":"ordered1238","":"ordered1239","":"ordered1240","":"ordered1241","":"ordered1242","":"ordered1243","":"ordered1244","":"ordered1245","":"ordered1246","":"ordered1247","":"ordered1248","":"ordered1249","":"ordered1250","":"ordered1251","":"ordered1252","":"ordered1253","":"ordered1254","":"ordered1255","":"ordered1256","":"ordered1257","":"ordered1258","":"ordered1259","":"ordered1260","":"ordered1261","":"ordered1262","":"ordered1263","":"ordered1264","":"ordered1265","":"ordered1266","":"ordered1267","":"ordered1268","":"ordered1269","":"ordered1270","":"ordered1271","":"ordered1278","":"ordered1279","":"ordered1280","":"ordered1281","":"ordered1282","":"ordered1283","":"ordered1284","":"ordered1285","":"ordered1286","":"ordered1287","":"ordered1288","":"ordered1289","":"ordered1290","":"ordered1291","":"ordered1292","":"ordered1293","":"ordered1294","":"ordered1295","":"ordered1296","":"ordered1297","":"ordered1298","":"ordered1299","":"ordered1300","":"ordered1301","":"ordered1322","":"ordered1328","":"ordered1354","":"ordered1355","":"ordered1356","":"ordered1357","":"ordered1358","":"ordered1359","":"ordered1360","":"ordered1361","":"ordered1362","":"ordered1363","":"ordered1364","":"ordered1365","":"ordered1366","":"ordered1367","":"ordered1368","":"ordered1369","":"ordered1370","":"ordered1371","":"ordered1372","":"ordered1373","":"ordered1374","":"ordered1375","":"ordered1376","":"ordered1377","":"ordered1378","":"ordered1379","":"ordered1380","":"ordered1381","":"ordered1382","":"ordered1383","":"ordered1384","":"ordered1385","":"ordered1386","":"ordered1387","":"ordered1388","":"ordered1389","":"ordered1390","":"ordered1391","":"ordered1392","":"ordered1393","":"ordered1394","":"ordered1395","":"ordered1396","":"ordered1397","":"ordered1398","":"ordered1399","":"ordered1400","":"ordered1401","":"ordered1402","":"ordered1403","":"ordered1404","":"ordered1405","":"ordered1406","":"ordered1407","":"ordered1408","":"ordered1409","":"ordered1410","":"ordered1411","":"ordered1412","":"ordered1413","":"ordered1414","":"ordered1415","":"ordered1416","":"ordered1417","":"ordered1418","":"ordered1419","":"ordered1420","":"ordered1421","":"ordered1422","":"ordered1423","":"ordered1428","":"ordered1434","":"ordered1440","":"ordered1446","":"ordered1447","":"ordered1448","":"ordered1449","":"ordered1455","":"ordered1461","":"ordered1467","":"ordered1473","":"ordered1479","":"ordered1480","":"ordered1481","":"ordered1482","":"ordered1483","":"ordered1484","":"ordered1485","":"ordered1486","":"ordered1487","":"ordered1488","":"ordered1489","":"ordered1490","":"ordered1491","":"ordered1492","":"ordered1493","":"ordered1494","":"ordered1495","":"ordered1496","":"ordered1497","":"ordered1498","":"ordered1499","":"ordered1500","":"ordered1501","":"ordered1502","":"ordered1503","":"ordered1504","":"ordered1505","":"ordered1506","":"ordered1507","":"ordered1508","":"ordered1509","":"ordered1510","":"ordered1511","":"ordered1512","":"ordered1513","":"ordered1514","":"ordered1520","":"ordered1521","":"ordered1522","":"ordered1523","":"ordered1524","":"ordered1525","":"ordered1526","":"ordered1527","":"ordered1528","":"ordered1529","":"ordered1530","":"ordered1531","":"ordered1532","":"ordered1533","":"ordered1534","":"ordered1535","":"ordered1536","":"ordered1542","":"ordered1548","":"ordered1554","":"ordered1555","":"ordered1556","":"ordered1557","":"ordered1558","":"ordered1559","":"ordered1560","":"ordered1561","":"ordered1562","":"ordered1563","":"ordered1569","":"ordered1570","":"ordered1571","":"ordered1572","":"ordered1573"}},948:function(e,t){"use strict";e.exports={"#":"ordered0001","*":"ordered0002","0":"ordered0003","1":"ordered0004","2":"ordered0005","3":"ordered0006","4":"ordered0007","5":"ordered0008","6":"ordered0009","7":"ordered0010","8":"ordered0011","9":"ordered0012","":"ordered0013","":"ordered0014","":"ordered0015","":"ordered0016","":"ordered0017","":"ordered0018","":"ordered0019","":"ordered0020","":"ordered0021","":"ordered0022","":"ordered0023","":"ordered0024","":"ordered0025","":"ordered0026","":"ordered0027","":"ordered0028","":"ordered0029","":"ordered0030","":"ordered0031","":"ordered0032","":"ordered0033","":"ordered0034","":"ordered0035","":"ordered0036","":"ordered0037","":"ordered0038","":"ordered0039","":"ordered0040","":"ordered0041","":"ordered0042","":"ordered0043","":"ordered0044","":"ordered0045","":"ordered0046","":"ordered0047","":"ordered0048","":"ordered0049","":"ordered0050","":"ordered0051","":"ordered0052","":"ordered0053","":"ordered0054","":"ordered0055","":"ordered0056","":"ordered0057","":"ordered0058","":"ordered0059","":"ordered0060","":"ordered0061","":"ordered0062","":"ordered0063","":"ordered0064","":"ordered0065","":"ordered0066","":"ordered0067","":"ordered0068","":"ordered0069","":"ordered0070","":"ordered0071","":"ordered0072","":"ordered0073","":"ordered0074","":"ordered0075","":"ordered0076","":"ordered0077","":"ordered0078","":"ordered0079","":"ordered0080","":"ordered0081","":"ordered0082","":"ordered0083","":"ordered0084","":"ordered0085","":"ordered0086","":"ordered0087","":"ordered0088","":"ordered0089","":"ordered0090","":"ordered0091","":"ordered0092","":"ordered0093","":"ordered0094","":"ordered0095","":"ordered0096","":"ordered0097","":"ordered0098","":"ordered0099","":"ordered0100","":"ordered0101","":"ordered0102","":"ordered0103","":"ordered0104","":"ordered0105","":"ordered0106","":"ordered0107","":"ordered0108","":"ordered0109","":"ordered0110","":"ordered0111","":"ordered0112","":"ordered0113","":"ordered0114","":"ordered0115","":"ordered0116","":"ordered0117","":"ordered0118","":"ordered0119","":"ordered0120","":"ordered0121","":"ordered0122","":"ordered0123","":"ordered0124","":"ordered0125","":"ordered0126","":"ordered0127","":"ordered0128","":"ordered0129","":"ordered0130","":"ordered0131","":"ordered0132","":"ordered0133","":"ordered0134","":"ordered0135","":"ordered0136","":"ordered0137","":"ordered0138","":"ordered0139","":"ordered0140","":"ordered0141","":"ordered0142","":"ordered0143","":"ordered0144","":"ordered0145","":"ordered0146","":"ordered0147","":"ordered0148","":"ordered0149","":"ordered0150","":"ordered0151","":"ordered0152","":"ordered0153","":"ordered0154","":"ordered0155","":"ordered0156","":"ordered0157","":"ordered0158","":"ordered0159","":"ordered0160","":"ordered0161","":"ordered0162","":"ordered0163","":"ordered0164","":"ordered0165","":"ordered0166","":"ordered0167","":"ordered0168","":"ordered0169","":"ordered0170","":"ordered0171","":"ordered0172","":"ordered0173","":"ordered0174","":"ordered0175","":"ordered0176","":"ordered0177","":"ordered0178","":"ordered0179","":"ordered0180","":"ordered0181","":"ordered0182","":"ordered0183","":"ordered0184","":"ordered0185","":"ordered0186","":"ordered0187","":"ordered0188","":"ordered0189","":"ordered0190","":"ordered0191","":"ordered0192","":"ordered0193","":"ordered0194","":"ordered0195","":"ordered0196","":"ordered0197","":"ordered0198","":"ordered0199","":"ordered0200","":"ordered0201","":"ordered0202","":"ordered0203","":"ordered0204","":"ordered0205","":"ordered0206","":"ordered0207","":"ordered0208","":"ordered0209","":"ordered0210","":"ordered0211","":"ordered0212","":"ordered0213","":"ordered0214","":"ordered0215","":"ordered0216","":"ordered0217","":"ordered0218","":"ordered0219","":"ordered0220","":"ordered0221","":"ordered0222","":"ordered0223","":"ordered0224","":"ordered0225","":"ordered0226","":"ordered0227","":"ordered0228","":"ordered0229","":"ordered0230","":"ordered0231","":"ordered0232","":"ordered0233","":"ordered0234","":"ordered0235","":"ordered0236","":"ordered0237","":"ordered0238","":"ordered0239","":"ordered0240","":"ordered0241","":"ordered0242","":"ordered0243","":"ordered0244","":"ordered0245","":"ordered0246","":"ordered0247","":"ordered0248","":"ordered0249","":"ordered0250","":"ordered0251","":"ordered0252","":"ordered0253","":"ordered0254","":"ordered0255","":"ordered0256","":"ordered0257","":"ordered0258","":"ordered0259","":"ordered0260","":"ordered0261","":"ordered0262","":"ordered0263","":"ordered0264","":"ordered0265","":"ordered0266","":"ordered0267","":"ordered0268","":"ordered0269","":"ordered0270","":"ordered0271","":"ordered0272","":"ordered0273","":"ordered0274","":"ordered0275","":"ordered0276","":"ordered0277","":"ordered0278","":"ordered0279","":"ordered0280","":"ordered0281","":"ordered0282","":"ordered0283","":"ordered0284","":"ordered0285","":"ordered0286","":"ordered0287","":"ordered0288","":"ordered0289","":"ordered0290","":"ordered0291","":"ordered0292","":"ordered0293","":"ordered0294","":"ordered0295","":"ordered0296","":"ordered0297","":"ordered0298","":"ordered0299","":"ordered0300","":"ordered0301","":"ordered0302","":"ordered0303","":"ordered0304","":"ordered0305","":"ordered0306","":"ordered0307","":"ordered0308","":"ordered0309","":"ordered0310","":"ordered0311","":"ordered0312","":"ordered0313","":"ordered0314","":"ordered0315","":"ordered0316","":"ordered0317","":"ordered0318","":"ordered0319","":"ordered0320","":"ordered0321","":"ordered0322","":"ordered0323","":"ordered0324","":"ordered0325","":"ordered0326","":"ordered0327","":"ordered0328","":"ordered0329","":"ordered0330","":"ordered0331","":"ordered0332","":"ordered0333","":"ordered0334","":"ordered0335","":"ordered0336","":"ordered0337","":"ordered0338","":"ordered0339","":"ordered0340","":"ordered0341","":"ordered0342","":"ordered0343","":"ordered0344","":"ordered0345","":"ordered0346","":"ordered0347","":"ordered0348","":"ordered0349","":"ordered0350","":"ordered0351","":"ordered0352","":"ordered0353","":"ordered0354","":"ordered0355","":"ordered0356","":"ordered0357","":"ordered0358","":"ordered0359","":"ordered0360","":"ordered0361","":"ordered0362","":"ordered0363","":"ordered0364","":"ordered0365","":"ordered0366","":"ordered0367","":"ordered0368","":"ordered0369","":"ordered0370","":"ordered0371","":"ordered0372","":"ordered0373","":"ordered0374","":"ordered0375","":"ordered0376","":"ordered0377","":"ordered0378","":"ordered0379","":"ordered0380","":"ordered0381","":"ordered0382","":"ordered0383","":"ordered0384","":"ordered0385","":"ordered0386","":"ordered0387","":"ordered0388","":"ordered0389","":"ordered0390","":"ordered0391","":"ordered0392","":"ordered0393","":"ordered0394","":"ordered0395","":"ordered0396","":"ordered0397","":"ordered0398","":"ordered0399","":"ordered0400","":"ordered0401","":"ordered0402","":"ordered0403","":"ordered0404","":"ordered0405","":"ordered0406","":"ordered0407","":"ordered0408","":"ordered0409","":"ordered0410","":"ordered0411","":"ordered0412","":"ordered0413","":"ordered0414","":"ordered0415","":"ordered0416","":"ordered0417","":"ordered0418","":"ordered0419","":"ordered0420","":"ordered0421","":"ordered0422","":"ordered0423","":"ordered0424","":"ordered0425","":"ordered0426","":"ordered0427","":"ordered0428","":"ordered0429","":"ordered0430","":"ordered0431","":"ordered0432","":"ordered0433","":"ordered0434","":"ordered0435","":"ordered0436","":"ordered0437","":"ordered0438","":"ordered0439","":"ordered0440","":"ordered0441","":"ordered0442","":"ordered0443","":"ordered0444","":"ordered0445","":"ordered0446","":"ordered0447","":"ordered0448","":"ordered0449","":"ordered0450","":"ordered0451","":"ordered0452","":"ordered0453","":"ordered0454","":"ordered0455","":"ordered0456","":"ordered0457","":"ordered0458","":"ordered0459","":"ordered0460","":"ordered0461","":"ordered0462","":"ordered0463","":"ordered0464","":"ordered0465","":"ordered0466","":"ordered0467","":"ordered0468","":"ordered0469","":"ordered0470","":"ordered0471","":"ordered0472","":"ordered0473","":"ordered0474","":"ordered0475","":"ordered0476","":"ordered0477","":"ordered0478","":"ordered0479","":"ordered0480","":"ordered0481","":"ordered0482","":"ordered0483","":"ordered0484","":"ordered0485","":"ordered0486","":"ordered0487","":"ordered0488","":"ordered0489","":"ordered0490","":"ordered0491","":"ordered0492","":"ordered0493","":"ordered0494","":"ordered0495","":"ordered0496","":"ordered0497","":"ordered0498","":"ordered0499","":"ordered0500","":"ordered0501","":"ordered0502","":"ordered0503","":"ordered0504","":"ordered0505","":"ordered0506","":"ordered0507","":"ordered0508","":"ordered0509","":"ordered0510","":"ordered0511","":"ordered0512","":"ordered0513","":"ordered0514","":"ordered0515","":"ordered0516","":"ordered0517","":"ordered0518","":"ordered0519","":"ordered0520","":"ordered0521","":"ordered0522","":"ordered0523","":"ordered0524","":"ordered0525","":"ordered0526","":"ordered0527","":"ordered0528","":"ordered0529","":"ordered0530","":"ordered0531","":"ordered0532","":"ordered0533","":"ordered0534","":"ordered0535","":"ordered0536","":"ordered0537","":"ordered0538","":"ordered0539","":"ordered0540","":"ordered0541","":"ordered0542","":"ordered0543","":"ordered0544","":"ordered0545","":"ordered0546","":"ordered0547","":"ordered0548","":"ordered0549","":"ordered0550","":"ordered0551","":"ordered0552","":"ordered0553","":"ordered0554","":"ordered0555","":"ordered0556","":"ordered0557","":"ordered0558","":"ordered0559","":"ordered0560","":"ordered0561","":"ordered0562","":"ordered0563","":"ordered0564","":"ordered0565","":"ordered0566","":"ordered0567","":"ordered0568","":"ordered0569","":"ordered0570","":"ordered0571","":"ordered0572","":"ordered0573","":"ordered0574","":"ordered0575","":"ordered0576","":"ordered0577","":"ordered0578","":"ordered0579","":"ordered0580","":"ordered0581","":"ordered0582","":"ordered0583","":"ordered0584","":"ordered0585","":"ordered0586","":"ordered0587","":"ordered0588","":"ordered0589","":"ordered0590","":"ordered0591","":"ordered0592","":"ordered0593","":"ordered0594","":"ordered0595","":"ordered0596","":"ordered0597","":"ordered0598","":"ordered0599","":"ordered0600","":"ordered0601","":"ordered0602","":"ordered0603","":"ordered0604","":"ordered0605","":"ordered0606","":"ordered0607","":"ordered0608","":"ordered0609","":"ordered0610","":"ordered0611","":"ordered0612","":"ordered0613","":"ordered0614","":"ordered0615","":"ordered0616","":"ordered0617","":"ordered0618","":"ordered0619","":"ordered0620","":"ordered0621","":"ordered0622","":"ordered0623","":"ordered0624","":"ordered0625","":"ordered0626","":"ordered0627","":"ordered0628","":"ordered0629","":"ordered0630","":"ordered0631","":"ordered0632","":"ordered0633","":"ordered0634","":"ordered0635","":"ordered0636","":"ordered0637","":"ordered0638","":"ordered0639","":"ordered0640","":"ordered0641","":"ordered0642","":"ordered0643","":"ordered0644","":"ordered0645","":"ordered0646","":"ordered0647","":"ordered0648","":"ordered0649","":"ordered0650","":"ordered0651","":"ordered0652","":"ordered0653","":"ordered0654","":"ordered0655","":"ordered0656","":"ordered0657","":"ordered0658","":"ordered0659","":"ordered0660","":"ordered0661","":"ordered0662","":"ordered0663","":"ordered0664","":"ordered0665","":"ordered0666","":"ordered0667","":"ordered0668","":"ordered0669","":"ordered0670","":"ordered0671","":"ordered0672","":"ordered0673","":"ordered0674","":"ordered0675","":"ordered0676",
"":"ordered0677","":"ordered0678","":"ordered0679","":"ordered0680","":"ordered0681","":"ordered0682","":"ordered0683","":"ordered0684","":"ordered0685","":"ordered0686","":"ordered0687","":"ordered0688","":"ordered0689","":"ordered0690","":"ordered0691","":"ordered0692","":"ordered0693","":"ordered0694","":"ordered0695","":"ordered0696","":"ordered0697","":"ordered0698","":"ordered0699","":"ordered0700","":"ordered0701","":"ordered0702","":"ordered0703","":"ordered0704","":"ordered0705","":"ordered0706","":"ordered0707","":"ordered0708","":"ordered0709","":"ordered0710","":"ordered0711","":"ordered0712","":"ordered0713","":"ordered0714","":"ordered0715","":"ordered0716","":"ordered0717","":"ordered0718","":"ordered0719","":"ordered0720","":"ordered0721","":"ordered0722","":"ordered0723","":"ordered0724","":"ordered0725","":"ordered0726","":"ordered0727","":"ordered0728","":"ordered0729","":"ordered0730","":"ordered0731","":"ordered0732","":"ordered0733","":"ordered0734","":"ordered0735","":"ordered0736","":"ordered0737","":"ordered0738","":"ordered0739","":"ordered0740","":"ordered0741","":"ordered0742","":"ordered0743","":"ordered0744","":"ordered0745","":"ordered0746","":"ordered0747","":"ordered0748","":"ordered0749","":"ordered0750","":"ordered0751","":"ordered0752","":"ordered0753","":"ordered0754","":"ordered0755","":"ordered0756","":"ordered0757","":"ordered0758","":"ordered0759","":"ordered0760","":"ordered0761","":"ordered0762","":"ordered0763","":"ordered0764","":"ordered0765","":"ordered0766","":"ordered0767","":"ordered0768","":"ordered0769","":"ordered0770","":"ordered0771","":"ordered0772","":"ordered0773","":"ordered0774","":"ordered0775","":"ordered0776","":"ordered0777","":"ordered0778","":"ordered0779","":"ordered0780","":"ordered0781","":"ordered0782","":"ordered0783","":"ordered0784","":"ordered0785","":"ordered0786","":"ordered0787","":"ordered0788","":"ordered0789","":"ordered0790","":"ordered0791","":"ordered0792","":"ordered0793","":"ordered0794","":"ordered0795","":"ordered0796","":"ordered0797","":"ordered0798","":"ordered0799","":"ordered0800","":"ordered0801","":"ordered0802","":"ordered0803","":"ordered0804","":"ordered0805","":"ordered0806","":"ordered0807","":"ordered0808","":"ordered0809","":"ordered0810","":"ordered0811","":"ordered0812","":"ordered0813","":"ordered0814","":"ordered0815","":"ordered0816","":"ordered0817","":"ordered0818","":"ordered0819","":"ordered0820","":"ordered0821","":"ordered0822","":"ordered0823","":"ordered0824","":"ordered0825","":"ordered0826","":"ordered0827","":"ordered0828","":"ordered0829","":"ordered0830","":"ordered0831","":"ordered0832","":"ordered0833","":"ordered0834","":"ordered0835","":"ordered0836","":"ordered0837","":"ordered0838","":"ordered0839","":"ordered0840","":"ordered0841","":"ordered0842","":"ordered0843","":"ordered0844","":"ordered0845","":"ordered0846","":"ordered0847","":"ordered0848","":"ordered0849","":"ordered0850","":"ordered0851","":"ordered0852","":"ordered0853","":"ordered0854","":"ordered0855","":"ordered0856","":"ordered0857","":"ordered0858","":"ordered0859","":"ordered0860","":"ordered0861","":"ordered0862","":"ordered0863","":"ordered0864","":"ordered0865","":"ordered0866","":"ordered0867","":"ordered0868","":"ordered0869","":"ordered0870","":"ordered0871","":"ordered0872","":"ordered0873","":"ordered0874","":"ordered0875","":"ordered0876","":"ordered0877","":"ordered0878","":"ordered0879","":"ordered0880","":"ordered0881","":"ordered0882","":"ordered0883","":"ordered0884","":"ordered0885","":"ordered0886","":"ordered0887","":"ordered0888","":"ordered0889","":"ordered0890","":"ordered0891","":"ordered0892","":"ordered0893","":"ordered0894","":"ordered0895","":"ordered0896","":"ordered0897","":"ordered0898","":"ordered0899","":"ordered0900","":"ordered0901","":"ordered0902","":"ordered0903","":"ordered0904","":"ordered0905","":"ordered0906","":"ordered0907","":"ordered0908","":"ordered0909","":"ordered0910","":"ordered0911","":"ordered0912","":"ordered0913","":"ordered0914","":"ordered0915","":"ordered0916","":"ordered0917","":"ordered0918","":"ordered0919","":"ordered0920","":"ordered0921","":"ordered0922","":"ordered0923","":"ordered0924","":"ordered0925","":"ordered0926","":"ordered0927","":"ordered0928","":"ordered0929","":"ordered0930","":"ordered0931","":"ordered0932","":"ordered0933","":"ordered0934","":"ordered0935","":"ordered0936","":"ordered0937","":"ordered0938","":"ordered0939","":"ordered0940","":"ordered0941","":"ordered0942","":"ordered0943","":"ordered0944","":"ordered0945","":"ordered0946","":"ordered0947","":"ordered0948","":"ordered0949","":"ordered0950","":"ordered0951","":"ordered0952","":"ordered0953","":"ordered0954","":"ordered0955","":"ordered0956","":"ordered0957","":"ordered0958","":"ordered0959","":"ordered0960","":"ordered0961","":"ordered0962","":"ordered0963","":"ordered0964","":"ordered0965","":"ordered0966","":"ordered0967","":"ordered0968","":"ordered0969","":"ordered0970","":"ordered0971","":"ordered0972","":"ordered0973","":"ordered0974","":"ordered0975","":"ordered0976","":"ordered0977","":"ordered0978","":"ordered0979","":"ordered0980","":"ordered0981","":"ordered0982","":"ordered0983","":"ordered0984","":"ordered0985","":"ordered0986","":"ordered0987","":"ordered0988","":"ordered0989","":"ordered0990","":"ordered0991","":"ordered0992","":"ordered0993","":"ordered0994","":"ordered0995","":"ordered0996","":"ordered0997","":"ordered0998","":"ordered0999","":"ordered1000","":"ordered1001","":"ordered1002","":"ordered1003","":"ordered1004","":"ordered1005","":"ordered1006","":"ordered1007","":"ordered1008","":"ordered1009","":"ordered1010","":"ordered1011","":"ordered1012","":"ordered1013","":"ordered1014","":"ordered1015","":"ordered1016","":"ordered1017","":"ordered1018","":"ordered1019","":"ordered1020","":"ordered1021","":"ordered1022","":"ordered1023","":"ordered1024","":"ordered1025","":"ordered1026","":"ordered1027","":"ordered1028","":"ordered1029","":"ordered1030","":"ordered1031","":"ordered1032","":"ordered1033","":"ordered1034","":"ordered1035","":"ordered1036","":"ordered1037","":"ordered1038","":"ordered1039","":"ordered1040","":"ordered1041","":"ordered1042","":"ordered1043","":"ordered1044","":"ordered1045","":"ordered1046","":"ordered1047","":"ordered1048","":"ordered1049","":"ordered1050","":"ordered1051","":"ordered1052","":"ordered1053","":"ordered1054","":"ordered1055","":"ordered1056","":"ordered1057","":"ordered1058","":"ordered1059","":"ordered1060","":"ordered1061","":"ordered1062","":"ordered1063","":"ordered1064","":"ordered1065","":"ordered1066","":"ordered1067","":"ordered1068","":"ordered1069","":"ordered1070","":"ordered1071","":"ordered1072","":"ordered1073","":"ordered1074","":"ordered1075","":"ordered1076","":"ordered1077","":"ordered1078","":"ordered1079","":"ordered1080","":"ordered1081","":"ordered1082","":"ordered1083","":"ordered1084","":"ordered1085","":"ordered1086","":"ordered1087","":"ordered1088","":"ordered1089","":"ordered1090","":"ordered1091","":"ordered1092","":"ordered1093","":"ordered1094","":"ordered1095","":"ordered1096","":"ordered1097","":"ordered1098","":"ordered1099","":"ordered1100","":"ordered1101","":"ordered1102","":"ordered1103","":"ordered1104","":"ordered1105","":"ordered1106","":"ordered1107","":"ordered1108","":"ordered1109","":"ordered1110","":"ordered1111","":"ordered1112","":"ordered1113","":"ordered1114","":"ordered1115","":"ordered1116","":"ordered1117","":"ordered1118","":"ordered1119","":"ordered1120","":"ordered1121","":"ordered1122","":"ordered1123","":"ordered1124","":"ordered1125","":"ordered1126","":"ordered1127","":"ordered1128","":"ordered1129","":"ordered1130","":"ordered1131","":"ordered1132","":"ordered1133","":"ordered1134","":"ordered1135","":"ordered1136","":"ordered1137","":"ordered1138","":"ordered1139","":"ordered1140","":"ordered1141","":"ordered1142","":"ordered1143","":"ordered1144","":"ordered1145","":"ordered1146","":"ordered1147","":"ordered1148","":"ordered1149","":"ordered1150","":"ordered1151","":"ordered1152","":"ordered1153","":"ordered1154","":"ordered1155","":"ordered1156","":"ordered1157","":"ordered1158","":"ordered1159","":"ordered1160","":"ordered1161","":"ordered1162","":"ordered1163","":"ordered1164","":"ordered1165","":"ordered1166","":"ordered1167","":"ordered1168","":"ordered1169","":"ordered1170","":"ordered1171","":"ordered1172","":"ordered1173","":"ordered1174","":"ordered1175","":"ordered1176","":"ordered1177","":"ordered1178","":"ordered1179","":"ordered1180","":"ordered1181","":"ordered1182","":"ordered1183","":"ordered1184","":"ordered1185","":"ordered1186","":"ordered1187","":"ordered1188","":"ordered1189","":"ordered1190","":"ordered1191","":"ordered1192","":"ordered1193","":"ordered1194","":"ordered1195","":"ordered1196","":"ordered1197","":"ordered1198","":"ordered1199","":"ordered1200","":"ordered1201","":"ordered1202","":"ordered1203","":"ordered1204","":"ordered1205","":"ordered1206","":"ordered1207","":"ordered1208","":"ordered1209","":"ordered1210","":"ordered1211","":"ordered1212","":"ordered1213","":"ordered1214","":"ordered1215","":"ordered1216","":"ordered1217","":"ordered1218","":"ordered1219","":"ordered1220","":"ordered1221","":"ordered1222","":"ordered1223","":"ordered1224","":"ordered1225","":"ordered1226","":"ordered1227","":"ordered1228","":"ordered1229","":"ordered1230","":"ordered1231","":"ordered1232","":"ordered1233","":"ordered1234","":"ordered1235","":"ordered1236","":"ordered1237","":"ordered1238","":"ordered1239","":"ordered1240","":"ordered1241","":"ordered1242","":"ordered1243","":"ordered1244","":"ordered1245","":"ordered1246","":"ordered1247","":"ordered1248","":"ordered1249","":"ordered1250","":"ordered1251","":"ordered1252","":"ordered1253","":"ordered1254","":"ordered1255","":"ordered1256","":"ordered1257","":"ordered1258","":"ordered1259","":"ordered1260","":"ordered1261","":"ordered1262","":"ordered1263","":"ordered1264","":"ordered1265","":"ordered1266","":"ordered1267","":"ordered1268","":"ordered1269","":"ordered1270","":"ordered1271","":"ordered1272","":"ordered1273","":"ordered1274","":"ordered1275","":"ordered1276","":"ordered1277","":"ordered1278","":"ordered1279","":"ordered1280","":"ordered1281","":"ordered1282","":"ordered1283","":"ordered1284","":"ordered1285","":"ordered1286","":"ordered1287","":"ordered1288","":"ordered1289","":"ordered1290","":"ordered1291","":"ordered1292","":"ordered1293","":"ordered1294","":"ordered1295","":"ordered1296","":"ordered1297","":"ordered1298","":"ordered1299","":"ordered1300","":"ordered1301","":"ordered1302","":"ordered1303","":"ordered1304","":"ordered1305","":"ordered1306","":"ordered1307","":"ordered1308","":"ordered1309","":"ordered1310","":"ordered1311","":"ordered1312","":"ordered1313","":"ordered1314","":"ordered1315","":"ordered1316","":"ordered1317","":"ordered1318","":"ordered1319","":"ordered1320","":"ordered1321","":"ordered1322","":"ordered1323","":"ordered1324","":"ordered1325","":"ordered1326","":"ordered1327","":"ordered1328","":"ordered1329","":"ordered1330","":"ordered1331","":"ordered1332","":"ordered1333","":"ordered1334","":"ordered1335","":"ordered1336","":"ordered1337","":"ordered1338","":"ordered1339","":"ordered1340","":"ordered1341","":"ordered1342","":"ordered1343","":"ordered1344","":"ordered1345","":"ordered1346","":"ordered1347","":"ordered1348","":"ordered1349","":"ordered1350","":"ordered1351","":"ordered1352","":"ordered1353","":"ordered1354","":"ordered1355","":"ordered1356","":"ordered1357","":"ordered1358","":"ordered1359","":"ordered1360","":"ordered1361","":"ordered1362","":"ordered1363","":"ordered1364","":"ordered1365","":"ordered1366","":"ordered1367","":"ordered1368","":"ordered1369","":"ordered1370","":"ordered1371","":"ordered1372","":"ordered1373","":"ordered1374","":"ordered1375","":"ordered1376","":"ordered1377","":"ordered1378","":"ordered1379","":"ordered1380","":"ordered1381","":"ordered1382","":"ordered1383","":"ordered1384","":"ordered1385","":"ordered1386","":"ordered1387","":"ordered1388","":"ordered1389","":"ordered1390","":"ordered1391","":"ordered1392","":"ordered1393","":"ordered1394","":"ordered1395","":"ordered1396","":"ordered1397","":"ordered1398","":"ordered1399","":"ordered1400","":"ordered1401","":"ordered1402","":"ordered1403","":"ordered1404","":"ordered1405","":"ordered1406","":"ordered1407","":"ordered1408","":"ordered1409","":"ordered1410","":"ordered1411","":"ordered1412","":"ordered1413","":"ordered1414","":"ordered1415","":"ordered1416","":"ordered1417","":"ordered1418","":"ordered1419","":"ordered1420","":"ordered1421","":"ordered1422","":"ordered1423","":"ordered1424","":"ordered1425","":"ordered1426","":"ordered1427","":"ordered1428","":"ordered1429","":"ordered1430","":"ordered1431","":"ordered1432","":"ordered1433","":"ordered1434","":"ordered1435","":"ordered1436","":"ordered1437","":"ordered1438","":"ordered1439","":"ordered1440","":"ordered1441","":"ordered1442","":"ordered1443","":"ordered1444","":"ordered1445","":"ordered1446","":"ordered1447","":"ordered1448","":"ordered1449","":"ordered1450","":"ordered1451","":"ordered1452","":"ordered1453","":"ordered1454","":"ordered1455","":"ordered1456","":"ordered1457","":"ordered1458","":"ordered1459","":"ordered1460","":"ordered1461","":"ordered1462","":"ordered1463","":"ordered1464","":"ordered1465","":"ordered1466","":"ordered1467","":"ordered1468","":"ordered1469","":"ordered1470","":"ordered1471","":"ordered1472","":"ordered1473","":"ordered1474","":"ordered1475","":"ordered1476","":"ordered1477","":"ordered1478","":"ordered1479","":"ordered1480","":"ordered1481","":"ordered1482","":"ordered1483","":"ordered1484","":"ordered1485","":"ordered1486","":"ordered1487","":"ordered1488","":"ordered1489","":"ordered1490","":"ordered1491","":"ordered1492","":"ordered1493","":"ordered1494","":"ordered1495","":"ordered1496","":"ordered1497","":"ordered1498","":"ordered1499","":"ordered1500","":"ordered1501","":"ordered1502","":"ordered1503","":"ordered1504","":"ordered1505","":"ordered1506","":"ordered1507","":"ordered1508","":"ordered1509","":"ordered1510","":"ordered1511","":"ordered1512","":"ordered1513","":"ordered1514","":"ordered1515","":"ordered1516","":"ordered1517","":"ordered1518","":"ordered1519","":"ordered1520","":"ordered1521","":"ordered1522","":"ordered1523","":"ordered1524","":"ordered1525","":"ordered1526","":"ordered1527","":"ordered1528","":"ordered1529","":"ordered1530","":"ordered1531","":"ordered1532","":"ordered1533","":"ordered1534","":"ordered1535","":"ordered1536","":"ordered1537","":"ordered1538","":"ordered1539","":"ordered1540","":"ordered1541","":"ordered1542","":"ordered1543","":"ordered1544","":"ordered1545","":"ordered1546","":"ordered1547","":"ordered1548","":"ordered1549","":"ordered1550","":"ordered1551","":"ordered1552","":"ordered1553","":"ordered1554","":"ordered1555","":"ordered1556","":"ordered1557","":"ordered1558","":"ordered1559","":"ordered1560","":"ordered1561","":"ordered1562","":"ordered1563","":"ordered1564","":"ordered1565","":"ordered1566","":"ordered1567","":"ordered1568","":"ordered1569","":"ordered1570","":"ordered1571","":"ordered1572","":"ordered1573","":"ordered1574","":"ordered1575","":"ordered1576","":"ordered1577","":"ordered1578","":"ordered1579","":"ordered1580","":"ordered1581","":"ordered1582","":"ordered1583","":"ordered1584","":"ordered1585","":"ordered1586","":"ordered1587","":"ordered1588","":"ordered1589","":"ordered1590","":"ordered1591","":"ordered1592","":"ordered1593","":"ordered1594","":"ordered1595","":"ordered1596","":"ordered1597","":"ordered1598","":"ordered1599","":"ordered1600","":"ordered1601","":"ordered1602","":"ordered1603","":"ordered1604","":"ordered1605","":"ordered1606","":"ordered1607","":"ordered1608","":"ordered1609","":"ordered1610","":"ordered1611"}},949:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(691),i=o(n),s=r(692),a=o(s),d=function(){function e(){(0,i["default"])(this,e)}return(0,a["default"])(e,[{key:"trigger",value:function(e){}}]),e}();e.exports=new d},950:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(41);e.exports={getThumb:function(e,t){var r=s.build("https://maps.googleapis.com/maps/api/staticmap",{size:"170x170",center:e+","+t,zoom:15,sensor:"true",format:"png8",mobile:"true",markers:"color:red|size:mid|"+e+","+t,key:"AIzaSyAd9DUC0P8PLPdtCBcLFcka6DTwoXhjf-k"});return new i["default"](function(e,t){var o=new Image;o.onload=function(t){var r=document.createElement("canvas");r.width=100,r.height=100;var n=r.getContext("2d");n.drawImage(o,35,35,100,100,0,0,100,100),e(r.toDataURL("image/jpeg"))},o.onerror=t,o.setAttribute("crossOrigin","anonymous"),o.src=r})}}},951:function(e,t,r){"use strict";var o=r(1),n=r(351);e.exports={setTitleAndIcon:function(e){switch(e){case-1:case 0:document.title=l10n.t("whatsapp_web");break;default:document.title="("+l10n.n(e)+") "+l10n.t("whatsapp_web")}this.setIcon(e)},setIcon:function(e){var t;t=-1===e?"favicon-error2":0===e?"favicon":10>e?"f0"+e:100>e?"f"+e:"f00";var r="/img/favicon/1x/"+t+".png",i="/img/favicon/2x/"+t+".png",s={low:{"default":r},high:{"default":i},onSet:function(e){var t=document.getElementById("favicon");t||(t=document.createElement("link"),t.id="favicon",t.rel="shortcut icon",document.head.appendChild(t)),t.href=e,t.type="image/png"}};n.loadAsset(s,t).then(function(){o.log("Favicon updated: "+t)()})}}},952:function(e,t){"use strict";var r=function o(e){if(!o.isRecordingSupported())throw"Recording is not supported in this browser";this.audioContext=new window.AudioContext,this.config=e=e||{},this.config.command="init",this.config.bufferLength=e.bufferLength||4096,this.config.monitorGain=e.monitorGain||0,this.config.numberOfChannels=e.numberOfChannels||1,this.config.originalSampleRate=this.audioContext.sampleRate,this.config.encoderSampleRate=e.encoderSampleRate||48e3,this.config.encoderPath=e.encoderPath||"oggopusEncoder.js",this.config.stream=e.stream||!1,this.config.maxBuffersPerPage=e.maxBuffersPerPage||40,this.config.encoderApplication=e.encoderApplication||2049,this.config.encoderFrameSize=e.encoderFrameSize||20,this.config.streamOptions=e.streamOptions||{optional:[],mandatory:{googEchoCancellation:!1,googAutoGainControl:!1,googNoiseSuppression:!1,googHighpassFilter:!1}},this.state="inactive",this.eventTarget=document.createDocumentFragment(),this.createAudioNodes()};r.isRecordingSupported=function(){return window.AudioContext&&navigator.getUserMedia},r.prototype.addEventListener=function(e,t,r){this.eventTarget.addEventListener(e,t,r)},r.prototype.createAudioNodes=function(){var e=this;this.scriptProcessorNode=this.audioContext.createScriptProcessor(this.config.bufferLength,this.config.numberOfChannels,this.config.numberOfChannels),this.scriptProcessorNode.onaudioprocess=function(t){e.encodeBuffers(t.inputBuffer)},this.monitorNode=this.audioContext.createGain(),this.setMonitorGain(this.config.monitorGain),this.config.sampleRate<this.audioContext.sampleRate&&this.createButterworthFilter()},r.prototype.createButterworthFilter=function(){this.filterNode=this.audioContext.createBiquadFilter(),this.filterNode2=this.audioContext.createBiquadFilter(),this.filterNode3=this.audioContext.createBiquadFilter(),this.filterNode.type=this.filterNode2.type=this.filterNode3.type="lowpass";var e=this.config.sampleRate/2;this.filterNode.frequency.value=this.filterNode2.frequency.value=this.filterNode3.frequency.value=e-e/3.5355,this.filterNode.Q.value=.51764,this.filterNode2.Q.value=.70711,this.filterNode3.Q.value=1.93184,this.filterNode.connect(this.filterNode2),this.filterNode2.connect(this.filterNode3),this.filterNode3.connect(this.scriptProcessorNode)},r.prototype.encodeBuffers=function(e){if("recording"===this.state){for(var t=[],r=0;r<e.numberOfChannels;r++)t[r]=e.getChannelData(r);this.encoder.postMessage({command:"encode",buffers:t}),this.duration+=e.duration,this.eventTarget.dispatchEvent(new CustomEvent("duration",{detail:this.duration}))}},r.prototype.initStream=function(){var e=this;navigator.getUserMedia({audio:this.config.streamOptions},function(t){e.stream=t,e.sourceNode=e.audioContext.createMediaStreamSource(t),e.sourceNode.connect(e.filterNode||e.scriptProcessorNode),e.sourceNode.connect(e.monitorNode),e.eventTarget.dispatchEvent(new Event("streamReady"))},function(t){e.eventTarget.dispatchEvent(new ErrorEvent("streamError",{error:t}))})},r.prototype.onPageEncoded=function(e){if(this.recordedPages.push(e),this.totalLength+=e.length,4&e[5]){for(var t=new Uint8Array(this.totalLength),r=0,o=0;o<this.recordedPages.length;o++)t.set(this.recordedPages[o],r),r+=this.recordedPages[o].length;this.eventTarget.dispatchEvent(new CustomEvent("dataAvailable",{detail:new Blob([t],{type:"audio/ogg"})})),this.recordedPages=[],this.eventTarget.dispatchEvent(new Event("stop"))}},r.prototype.pause=function(){"recording"===this.state&&(this.state="paused",this.eventTarget.dispatchEvent(new Event("pause")))},r.prototype.removeEventListener=function(e,t,r){this.eventTarget.removeEventListener(e,t,r)},r.prototype.resume=function(){"paused"===this.state&&(this.state="recording",this.eventTarget.dispatchEvent(new Event("resume")))},r.prototype.setMonitorGain=function(e){this.monitorNode.gain.value=e},r.prototype.start=function(){if("inactive"===this.state&&this.stream){this.recordedPages=[],this.totalLength=0,this.duration=0;var e=this;this.encoder=new Worker(this.config.encoderPath),this.encoder.addEventListener("message",function(t){e.onPageEncoded(t.data)}),this.encodeBuffers=function(){delete this.encodeBuffers},this.state="recording",this.monitorNode.connect(this.audioContext.destination),this.scriptProcessorNode.connect(this.audioContext.destination),this.eventTarget.dispatchEvent(new Event("start")),this.eventTarget.dispatchEvent(new CustomEvent("duration",{detail:this.duration})),this.encoder.postMessage(this.config)}},r.prototype.stop=function(){if("inactive"!==this.state){if(this.state="inactive",this.monitorNode.disconnect(),this.scriptProcessorNode.disconnect(),_.isFunction(this.stream.stop))this.stream.stop();else for(var e=this.stream.getAudioTracks(),t=0;t<e.length;t++)e[t].stop();delete this.stream,this.encoder.postMessage({command:"done"})}},e.exports=r},953:function(e,t,r){"use strict";var o=r(689),n={multibyteLength:function(e){return o.ucs2.decode(e).length},multibyteSubstr:function(e,t,r){var n=o.ucs2.decode(e);if("undefined"==typeof r)n=n.slice(t);else{if(0>=r)return"";n=n.slice(t,t+r)}return o.ucs2.encode(n)}};e.exports=n},954:function(e,t,r){"use strict";function o(){var e="[a-z\\d.-]+://",t="(?:(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])\\.){3}(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])",r="(?:(?:[^\\s!@#$%^&*()_=+[\\]{}\\\\|;:'\",.<>/?]+)\\.)+",o="(?:ac|ad|aero|ae|af|ag|ai|al|am|an|ao|aq|arpa|ar|asia|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|biz|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|cat|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|coop|com|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|info|int|in|io|iq|ir|is|it|je|jm|jobs|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mm|mn|mobi|mo|mp|mq|mr|ms|mt|museum|mu|mv|mw|mx|my|mz|name|na|nc|net|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|org|pa|pe|pf|pg|ph|pk|pl|pm|pn|pro|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tp|travel|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|xn--0zwm56d|xn--11b5bs3a9aj6g|xn--80akhbyknj4f|xn--9t4b11yi5a|xn--deba0ad|xn--g6w251d|xn--hgbk6aj7f53bba|xn--hlcj6aya9esc7a|xn--jxalpdlp|xn--kgbechtv|xn--zckzah|ye|yt|yu|za|zm|zw)",n="(?:"+r+o+"|"+t+")",l="(?:[;/][^#?<>\\s]*)?",u="(?:\\?[^#<>\\s]*)?(?:#[^<>\\s]*)?",p="\\s`!(\\[{;:'\".,<?",h="\\s`!()\\[\\]{};:'\".,<>?",m="[^"+p+"]",f="(?=["+h+"]|$)",g="\\b"+e+"[^<>\\s]+"+m+f,v="\\b"+n+l+u+m+f,y="(?:"+a+")?[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@"+n+u+"(?!\\w)";i=new RegExp("("+g+"|"+v+"|"+y+")","ig"),s=new RegExp("^"+e,"i"),a="mailto:",d={")":"(","]":"[","}":"{","'":"'",'"':'"',">":"<","":"","":"","":""},c=new RegExp("^(https?|mailto):","i")}function n(e,t,r){return t+""+r}var i,s,a,d,c,l=r(77),u=r(45),p=r(782),h=_.memoize(function(e){var t=r(162);return new RegExp("("+t.arabic+"{"+e+"})("+t.arabic+")","g")}),m=_.memoize(function(e,t){if(!u.isWebkit)return e;if(e.length<=t)return e;for(var r=e.split(/\s/),o=!1,i=h(t),s=0,a=r.length;a>s;++s){var d=r[s];if(d.length>t){var c=d.replace(i,n);d!==c&&(r[s]=c,o=!0)}}return o?r.join(" "):e},function(e,t){return"s:"+e+"n:"+t}),f=_.memoize(function(e,t,r,n){r=u.isWebkit?r:0;var h,f,g="",v=0;for(i||o();h=i.exec(e);){var y=h[0],E=y;if(s.test(E)||(E=(-1!==E.indexOf("@")?E.indexOf(a)?a:"":E.indexOf("irc.")?E.indexOf("ftp.")?"http://":"ftp://":"irc://")+E),c.test(E)){var T,b=E.slice(-1);(T=d[b])&&E.split(T).length!==E.split(b).length&&(i.lastIndex--,y=y.slice(0,-1),E=E.slice(0,-1)),f=_.escape(e.slice(v,h.index)),f=r&&f.length>r?m(f,r):f,g+=t?p.emojiToHTML(f,n):f;var S=document.createElement("a");S.href=E,S.title=E,S.target="_blank",S.className=l(n);var C=t?p.emojiToHTML(_.escape(y),n):_.escape(y);S.innerHTML=r&&y.length>r?m(C,r):C,g+=S.outerHTML,v=i.lastIndex}}return f=_.escape(e.slice(v)),f=r&&f.length>r?m(f,r):f,g+=t?p.emojiToHTML(f,n):f},function(e,t,r,o){return"t:"+e+"e:"+(t||!1)+"w:"+(r||0)+"c:"+o});e.exports={linkify:f,wbr:m}},955:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var n=r(3),i=o(n),s=r(8),a=r(803),d=r(41),c={vCardPrepareForSend:function(e){return new i["default"](function(t,r){var o=new FileReader;o.onload=function(){var e=c.vCardParse(o.result),r=e.vcard.FN||{},n=e.vcard.PHOTO;if(n){var i=s.MAX_VCARD_PHOTO_SIDE,l="data:image/jpeg;base64,"+n.value;return a.resizeDataURI(l,i,i).then(function(o){var i=d.parseDataURL(o);n.value=i.data,n.line="PHOTO;BASE64:"+i.data,t(c.vCardSerialize(e.rows),r.value)})}t(c.vCardSerialize(e.rows),r.value)},o.onerror=r,o.readAsText(e)})},vCardParse:function(e){function t(e){var t={line:e},r=e.split(/:/,2);return t.key=t.fullkey=r[0],t.value=r[1],r=t.key.split(/;/,2),r.length>1&&(t.key=r[0]),t}if(e){e=e.replace(/\n^ /gm,"");var r=e.split(/\n/),o="BEGIN VERSION FN N TEL EMAIL ADR PHOTO END".split(/ /),n={};o.forEach(function(e){n[e]=!0});for(var i=[],s={},a=0;a<r.length;++a){var d=t(r[a]);n[d.key]&&(i.push(d),s[d.key]=d)}return{vcard:s,rows:i}}},vCardSerialize:function(e){return e.map(function(e){return e.line.replace(/(.{75,75})/g,"$1\n ").replace(/\n^-$/gm,"")}).join("\n")},thumbnail:function(e){if(e){e=e.replace(/\n^ /gm,"");var t=e.match(/^PHOTO;(BASE64|ENCODING=b;TYPE=image\/jpeg):(.*)$/m);return t?t[2]:void 0}}};e.exports=c},956:function(e,t,r){e.exports={"default":r(957),__esModule:!0}},957:function(e,t,r){r(959),e.exports=r(29).Math.trunc},958:function(e,t,r){var o=r(16);e.exports=function(e,t,r){return o.setDesc(e,t,r)}},959:function(e,t,r){var o=r(61);o(o.S,"Math",{trunc:function(e){return(e>0?Math.floor:Math.ceil)(e)}})},962:function(e,t){e.exports=[65,26,32,26,73,1,11,1,5,1,6,23,24,31,32,449,451,7,21,2,16,5,14,1,130,4,6,2,4,4,5,1,7,1,2,3,4,1,2,20,21,83,84,140,147,166,167,38,40,7,8,39,40,1,7,-1,46,-1,2,-1,3,-1,3,-1,2,-56,64,-1,3,-1,2,-1,14,-48,82,-3,4,-101,116,-2,9,-2,12,-23,24,-30,57,-91,102,-58,67,-2,6,-28,32,-1,10,-1,4,-1,6,-43,46,-135,167,55,56,1,2,4,12,4,5,3,10,10,12,29,30,2,3,8,10,2,4,22,23,7,8,1,4,4,7,4,10,2,4,2,3,1,9,1,5,2,3,3,7,12,14,7,15,1,2,6,10,2,4,22,23,7,8,2,3,2,3,2,6,3,27,4,5,1,8,10,12,3,17,1,2,9,10,3,4,22,23,7,8,2,3,5,8,4,12,1,2,2,5,1,16,2,6,11,19,1,9,2,3,8,10,2,4,22,23,7,8,2,3,5,8,2,3,1,7,2,4,2,12,1,5,2,3,3,7,18,29,1,2,6,9,3,4,4,7,2,3,1,2,2,5,2,5,3,6,12,16,2,3,2,5,3,4,3,6,1,7,1,15,13,27,3,4,8,9,3,4,23,24,16,19,1,4,4,23,3,8,2,6,10,25,1,3,2,3,8,9,3,4,23,24,10,11,5,8,8,9,3,4,2,11,2,9,1,2,2,6,10,11,2,17,2,3,8,9,3,4,41,43,4,9,3,4,3,4,1,9,1,8,3,7,16,19,7,9,2,3,18,21,24,25,9,10,1,3,7,15,3,9,8,14,10,12,3,15,48,49,2,14,7,15,13,50,2,3,1,3,2,3,1,3,1,7,4,5,7,8,3,4,1,2,1,3,2,3,4,5,2,11,1,3,5,6,1,10,10,12,4,36,24,26,27,28,1,2,1,6,10,11,36,54,1,6,1,3,5,54,8,9,6,7,13,50,45,49,1,7,1,3,2,4,25,27,4,7,16,20,13,14,2,4,6,7,15,16,40,41,1,6,1,3,377,378,4,6,7,8,1,2,4,6,41,42,4,6,33,34,4,6,7,8,1,2,4,6,15,16,57,58,4,6,67,72,29,32,16,32,86,88,6,9,639,640,26,31,89,96,13,14,4,18,18,21,2,11,18,32,13,14,3,18,52,54,1,8,8,9,2,13,7,8,1,4,10,48,10,16,88,96,41,42,1,6,70,80,31,35,4,6,3,7,2,3,6,19,40,42,5,16,44,48,26,32,11,48,23,25,2,5,56,57,1,10,1,2,2,10,6,19,10,16,10,16,14,100,48,49,1,6,1,2,5,6,9,13,27,36,9,14,32,36,2,4,1,4,56,57,1,3,3,4,1,4,2,10,48,56,2,7,15,18,51,115,8,19,1,14,1,8,4,5,6,7,2,11,192,256,278,280,6,8,38,40,6,8,8,9,1,2,1,2,1,2,31,33,53,54,7,8,1,4,3,4,7,10,4,6,6,10,13,18,3,4,7,24,1,1,-1,98,1,14,1,17,13,114,1,5,1,3,10,11,1,4,5,11,1,2,1,2,1,2,4,5,11,13,4,9,5,9,2,18,41,470,69,95,1,263,78,528,1,340,256,1024,47,48,47,48,133,139,4,7,2,14,38,39,1,6,1,3,56,63,2,17,23,32,7,8,7,8,7,8,7,8,7,8,7,8,7,8,7,557,3,28,9,13,2,3,5,7,5,9,86,92,3,4,90,91,4,9,41,44,94,95,43,96,45,48,48,64,28,31,50,65,12,16,47,48,119,123,99,101,31,32,6582,6656,20950,20992,1165,1232,317,320,28,48,47,64,30,32,80,82,6,48,102,103,37,39,8,71,11,12,3,4,4,5,25,27,1,9,8,16,52,64,68,78,12,36,12,14,38,46,25,36,2,13,30,36,48,49,2,6,2,3,17,18,11,15,7,8,25,26,41,47,2,4,2,13,3,4,8,9,1,3,10,12,32,33,51,52,1,4,2,4,5,7,1,2,1,25,17,19,8,19,6,8,6,8,6,15,7,8,7,8,54,64,117,118,2,3,4,7,10,16,11172,11184,23,27,49,2101,6766,6768,106,144,7,19,5,10,-1,2,-10,11,-532,534,-144,176,-13,14,-2,114,-143,177,26,32,26,37,89,92,6,8,6,8,6,8,3,38,12,13,26,27,19,20,2,3,15,17,14,48,123,128,1,2,1,5,45,48,9,153,45,176,29,32,49,96,36,48,27,32,38,48,30,31,37,41,14,56,158,160,10,96,40,48,52,63,1,145,311,320,22,32,8,160,-287,288,-225,228,-1,3,-5,9,-40,43,-4,5,-165,167,-82,89,-800,831,-385,385,1,2,54,69,7,31,10,28,49,53,2,4,7,21,25,32,10,19,36,41,1,10,14,26,35,36,3,14,52,61,11,14,1,3,16,17,20,31,18,19,28,31,2,3,1,3,6,72,7,8,1,2,4,5,15,16,11,17,47,48,3,16,10,18,2,3,8,10,2,4,22,23,7,8,2,3,5,8,3,4,4,6,2,4,3,5,1,7,1,6,7,291,51,57,1,2,4,6,1,3,4,12,10,176,50,56,4,6,1,3,27,63,51,59,2,3,1,3,4,15,10,48,43,44,1,2,2,8,1,10,10,64,26,32,2,6,1,10,16,368,83,95,1,449,57,1344,922,1024,111,112,5,16,196,2944,1071,5120,583,9216,569,576,31,32,10,14,2,98,30,37,1,11,48,55,15,25,10,11,7,8,21,26,19,899,69,80,47,67,13,16493,2,3072,107,112,13,16,9,16,10,12,1,3,1,4961,246,256,39,41,62,65,9,25,2,9,30,34,59,434,18,160,85,86,71,72,2,4,1,3,2,4,4,5,12,13,1,2,7,8,65,66,4,6,8,9,7,8,28,29,4,5,5,6,1,4,7,8,340,342,51,52,57,58,57,58,57,58,57,58,8,60,512,567,4,54,8,9,14,15,7,3451,-208,215,-1561,1563,-270,542,31,32,58,64,43,118,29,42,43,48,9,16,2,3504,42711,42752,4149,4160,222,224,5762,16352,542,788480,65534,65536,65534];
}});